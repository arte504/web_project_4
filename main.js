!function(){"use strict";class e{constructor({cardData:e,isLiked:t,isOwner:s,onCardClick:r,removeHandler:i,likeHandler:n},o){this._name=e.name,this._link=e.link,this._id=e._id,this._ownerId=e.owner._id,this._likes=e.likes,this._likesCount=e.likes.length,this._cardSelector=o,this._onCardClick=r,this._onCardClick=this._onCardClick.bind(this),this._likeHandler=n,this._clickLikeHandler=this._clickLikeHandler.bind(this),this._removeHandler=i,this._removeHandler=this._removeHandler.bind(this),this._isLiked=t,this._isLiked=this._isLiked.bind(this),this._isOwner=s,this._isOwner=this._isOwner.bind(this)}_getTemplate(){return document.querySelector("#card__template").content.querySelector(".card").cloneNode(!0)}likesAmountSet(e){this._item.querySelector(".card__like-count").textContent=e}_likeCard(e){this._item.querySelector("card__like").classList.toggle("card__like-button_active"),this._likeHandler(this),e.stopImmediatePropogation()}deleteCard(){this._item.remove(),this._item=null}_deleteCardHandler(e){e.stopImmediatePropagation(),this._deleteCardHandler(this._id,this)}_setEventListeners(){this._item.querySelector(".card__like-button").addEventListener("click",(e=>{this._likeCard(e)})),this._item.querySelector(".card__delete-button").addEventListener("click",(e=>{this._deleteCardHandler(e)})),this._cardImage.addEventListener("click",(e=>{this._onCardClick(e)}))}generateCard(){return this._item=this._getTemplate(),!0===this._isLiked(this._likes)?this._element.querySelector(".card__like-button").classList.add("card__like_active"):this._element.querySelector(".card__like-button").classList.remove("card__like_active"),!0!==this._isOwner(this._ownerId)&&this._element.querySelector(".card__delete-button").classList.add("card__delete-button_hidden"),this._cardImage=this._item.querySelector(".card__image"),this._setEventListeners(),this._item.querySelector(".card__title").textContent=this._name,this._cardImage.src=this._link,this._cardImage.alt=`Image of  ${this._name} `,this._setEventListeners(),this._item}getID(){return this._id}}class t{constructor(e,t){this._formConfig=e,this._formElement=t}_showInputError=(e,t)=>{const{inputErrorClass:s,errorMessageClass:r}=this._formConfig,i=this._formElement.querySelector(` #${e.id}_error `);i.textContent=t,i.classList.add(r),e.classList.add(s)};_hideInputError=e=>{const{inputErrorClass:t,errorMessageClass:s}=this._formConfig,r=this._formElement.querySelector(` #${e.id}_error `);r.textContent="",r.classList.remove(s),e.classList.remove(t)};resetValidation(){this.inputs.forEach((e=>{this._hideInputError(e)})),this._toggleSubmitButton()}_checkInput=e=>{e.validity.valid?this._hideInputError(e):this._showInputError(e,e.validationMessage)};_checkIfFormValid=()=>this.inputs.every((e=>e.validity.valid));_toggleSubmitButton(){const{inactiveButtonClass:e,submitButtonSelector:t}=this._formConfig,s=this._formElement.querySelector(t);this._checkIfFormValid()?(s.disabled=!1,s.classList.remove(e)):(s.disabled=!0,s.classList.add(e))}_setEventListeners=()=>{const{inputSelector:e}=this._formConfig;return this.inputs=Array.from(this._formElement.querySelectorAll(e)),this.inputs.forEach((e=>{e.addEventListener("input",(()=>{this._checkInput(e),this._toggleSubmitButton()}))})),this._formElement};enableValidation(){this._formElement.addEventListener("submit",(e=>{e.preventDefault()})),this._setEventListeners()}}class s{constructor({items:e,renderer:t},s){this._items=e,this._renderer=t,this._container=document.querySelector(s),this.renderer=t}addItem(e){this._container.append(e)}prependItem(e){this._container.prepend(e)}renderItems(){this._items.forEach((e=>{this._renderer(e)}))}}const r=document.querySelector(".profile__edit-button"),i=document.forms.profile,n=(i.elements.name,i.elements.job,document.querySelector(".modal__close-button_type_edit"),document.querySelector(".profile__add-button")),o=document.querySelector(".modal_type_add-card"),a=(document.querySelector(".modal__input_type_name"),document.querySelector(".modal__input_type_link"),document.querySelector(".modal__close-button_type_add-card"),document.forms.add),l=(a.elements.title,a.elements.link,document.querySelector(".modal__submit-button"),document.querySelector(".cards__grid"),document.querySelector(".modal_type_big-image"),document.querySelector(".modal__big-image"),document.querySelector(".modal__image-caption"),document.querySelector(".modal__close-button_type_big-image"),{formSelector:".modal__container",inputSelector:".modal__input",submitButtonSelector:".modal__submit-button",inactiveButtonClass:"modal__submit-button_disabled",inputErrorClass:"modal__input_error",errorMessageClass:"modal__error_visible"});class d{constructor(e){this._modalElement=document.querySelector(e)}_checkForEscClose=e=>{"Escape"===e.key&&this.close()};open=()=>{this._modalElement.classList.add("modal_visible"),document.addEventListener("keyup",this._checkForEscClose)};close=()=>{this._modalElement.classList.remove("modal_visible"),document.removeEventListener("keyup",this._checkForEscClose)};setEventListeners(){this._modalElement.querySelector(".modal__close-button").addEventListener("click",(e=>{this.close(e)})),this._modalElement.addEventListener("click",(e=>{e.target.classList.contains("modal_visible")&&this.close(e)}))}}class c extends d{constructor(e,t){super(e),this._handleSubmitBtn=t,this._formElement=this._modalElement.querySelector(".modal__container")}getInputValues(){const e=Array.from(this._formElement.querySelectorAll(".modal__input")),t={};return e.forEach((e=>{t[e.name]=e.value})),t}setInputValues(e){Array.from(this._formElement.querySelectorAll(".modal__input")).forEach((t=>{t.value=e[t.name]}))}setEventListeners(){super.setEventListeners(),this._formElement.addEventListener("submit",(()=>{this._handleSubmitBtn(this.getInputValues()),this.close(),this._formElement.reset()}))}close(){super.close(),this._formElement.reset()}}class _ extends d{constructor(e,t){super(e),this._form=document.querySelector(this._selector),this._handleSubmit=t,this._handleSubmitHandler=this._handleSubmitHandler.bind(this)}_handleSubmitHandler(e){e.preventDefault(),this._handleSubmit(),super.close()}_setEventListeners(){super._setEventListeners(),this._form.addEventListener("submit",this._handleSubmitHandler)}_removeEventListeners(){super._removeEventListeners(),this._form.removeEventListener("submit",this._handleSubmitHandler)}}const m=new class{constructor({baseUrl:e,headers:t}){this.baseUrl=e,this.headers=t}getInitialCards(){return fetch(this.baseUrl+"/cards",{headers:this.headers}).then((e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`)))}getUserInfo(){return fetch(this.baseUrl+"/users/me",{headers:this.headers}).then((e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`)))}addCard({name:e,link:t}){return fetch(this.baseUrl+"/cards",{headers:this.headers,method:"POST",body:JSON.stringify({name:e,link:t})}).then((e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`)))}removeCard(e){return fetch(this.baseUrl+"/cards/"+e,{headers:this.headers,method:"DELETE"}).then((e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`)))}getAppInfo(){return Promise.all([this.getInitialCards(),this.getUserInfo()])}addLike(e){return fetch(this.baseUrl+"/cards/likes/"+e.getId(),{headers:this.headers,method:"PUT"}).then((e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`)))}removeLike(e){return fetch(this.baseUrl+"/cards/likes/"+e.getId(),{headers:this.headers,method:"DELETE"}).then((e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`)))}updateUserInfo({name:e,about:t}){return fetch(this.baseUrl+"/users/me",{headers:this.headers,method:"PATCH",body:JSON.stringify({name:e,about:t})}).then((e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`)))}setUserAvatar({avatar:e}){return fetch(this.baseUrl+"/users/me/avatar",{headers:this.headers,method:"PATCH",body:JSON.stringify({avatar:e})}).then((e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`)))}}({baseUrl:"https://around.nomoreparties.co/v1/group-42",headers:{authorization:"c56e30dc-2883-4270-a59e-b2f7bae969c6","Content-Type":"application/json"}});function h(t,s,r){return new e({cardData:t,isLiked:e=>void 0!==e.find((e=>e._id===s._id)),isOwner:e=>s._id===e,onCardClick:e=>{u.open(e)},deleteCardHandler:(e,t)=>{const s=new _(".delete-card",(()=>{m.removeCard(e).then((e=>t.removeCard())).catch((e=>console.log(e))).finally((function(){s.close()}))}));s.open()},likeHandler:e=>{void 0!==e._likes.find((e=>e._id===s._id))?m.removeLike(e).then((t=>{e._likes=t.likes,e.setLikes(t.likes.length)})):m.addLike(e).then((t=>{e._likes=t.likes,e.setLikes(t.likes.length)}))}},"#card")}m.getAppInfo().then((([e,t])=>{const r=new s({data:e,renderer:function(e){const s=h(e,t);r.addItem(s.generateCard())}},".cards__grid");r.setItems(),user.setUserInfo({name:t.name,job:t.about}),user.setUserAvatar({avatar:t.avatar});const i=new c(".add-card",(e=>{m.addCard({name:e.name,link:e.link}).then((e=>{const s=h(e,t);r.addItem(s.generateCard())})).catch((e=>console.log(e))).finally((function(){i.close()}))}));n.addEventListener("click",(()=>{E.resetValidation(),i.open()}))})).catch((e=>console.log(e)));const u=new class extends d{openup=e=>{const t=e.target;this._modalElement.querySelector(".modal__big-image").src=t.src,this._modalElement.querySelector(".modal__big-image").alt=t.alt,this._modalElement.querySelector(".modal__image-caption").textContent=t.alt,this.open()}}(".modal_type_big-image");u.setEventListeners();const p=new class{constructor({name:e,job:t,avatar:s}){this._name=document.querySelector(`${e}`),this._job=document.querySelector(`${t}`),this._avatar=document.querySelector(`${s}`)}getUserInfo(){return{name:this._name.textContent,job:this._job.textContent,avatar:this._avatar.src}}setUserInfo(e){const{name:t,job:s}=e;this._name.textContent=t,this._job.textContent=s}setUserAvatar({avatar:e}){this._avatar.src=e}}(".profile__title",".profile__subtitle");p.setUserInfo({name:"Artiom Shlyusberg",job:"Junior Web Dev"});const b=new c(".modal_type_edit",(e=>{p.setUserInfo(b.getInputValues()),b.close()}));b.setEventListeners(),r.addEventListener("click",(()=>{b.setInputValues(p.getUserInfo()),v.resetValidation(),b.open()}));const k=new c(".modal_type_add-card",(()=>{const e=k.getInputValues();cardsSection.prependItem(createCard(e)),k.close()}));k.setEventListeners();const v=new t(l,i);v.enableValidation();const E=new t(l,o);E.enableValidation()}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QVNDLGNBQWUsR0FBRStFLEtBQ3RDckcsS0FBS29NLFFBQVUvSyxTQUFTQyxjQUFlLEdBQUU2SSxLQUczQ2hCLGNBQ0UsTUFBTyxDQUNQakosS0FBT0YsS0FBS0MsTUFBTTJCLFlBQ2xCeUUsSUFBTXJHLEtBQUttTSxLQUFLdkssWUFDaEJ1SSxPQUFRbkssS0FBS29NLFFBQVF4SixLQUl2QmdKLFlBQVlMLEdBQ1YsTUFBTSxLQUFFckwsRUFBRixJQUFRbUcsR0FBUWtGLEVBQ3RCdkwsS0FBS0MsTUFBTTJCLFlBQWMxQixFQUN6QkYsS0FBS21NLEtBQUt2SyxZQUFjeUUsRUFHMUI2RCxlQUFlLE9BQUNDLElBQ2RuSyxLQUFLb00sUUFBUXhKLElBQU11SCxJSDRGYSxrQkFBbUIsc0JBQ3ZEK0IsRUFBZU4sWUFBWSxDQUFFMUwsS0FBTSxvQkFBcUJtRyxJQUFLLG1CQUs3RCxNQUFNZ0csRUFBa0IsSUFBSWhGLEVBQWMsb0JBQXFCb0UsSUFDN0RTLEVBQWVOLFlBQVlTLEVBQWdCNUUsa0JBQzNDNEUsRUFBZ0J0RixXQUdsQnNGLEVBQWdCbkYsb0JBRWhCbkIsRUFBV3hELGlCQUFpQixTQUFTLEtBQ25DOEosRUFBZ0J4RSxlQUFlcUUsRUFBZS9DLGVBQzlDbUQsRUFBc0IxSSxrQkFDdEJ5SSxFQUFnQnJGLFVBSWxCLE1BQU1ULEVBQWMsSUFBSWMsRUFBYyx3QkFBd0IsS0FDNUQsTUFBTXlFLEVBQVV2RixFQUFZa0IsaUJBQzVCK0QsYUFBYTdGLFlBQVk0RyxXQUFXVCxJQUNwQ3ZGLEVBQVlRLFdBR2RSLEVBQVlXLG9CQUlaLE1BQU1vRixFQUF3QixJQUFJdkosRUFBY0MsRUFBWWdELEdBQzVEc0csRUFBc0J2SCxtQkFFdEIsTUFBTWdILEVBQXdCLElBQUloSixFQUFjQyxFQUFZc0QsR0FDNUR5RixFQUFzQmhILG1CIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfNC8uL3NyYy9jb21wb25lbnRzL3NjcmlwdHMvQ2FyZC5qcyIsIndlYnBhY2s6Ly93ZWJfcHJvamVjdF80Ly4vc3JjL2NvbXBvbmVudHMvc2NyaXB0cy9Gb3JtVmFsaWRhdG9yLmpzIiwid2VicGFjazovL3dlYl9wcm9qZWN0XzQvLi9zcmMvY29tcG9uZW50cy9zY3JpcHRzL1NlY3Rpb24uanMiLCJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfNC8uL3NyYy9jb21wb25lbnRzL3V0aWxzL2NvbnN0YW50cy5qcyIsIndlYnBhY2s6Ly93ZWJfcHJvamVjdF80Ly4vc3JjL2NvbXBvbmVudHMvc2NyaXB0cy9Nb2RhbC5qcyIsIndlYnBhY2s6Ly93ZWJfcHJvamVjdF80Ly4vc3JjL2NvbXBvbmVudHMvc2NyaXB0cy9Nb2RhbFdpdGhGb3JtLmpzIiwid2VicGFjazovL3dlYl9wcm9qZWN0XzQvLi9zcmMvY29tcG9uZW50cy9zY3JpcHRzL01vZGFsRGVsZXRlQ29uZmlybWF0aW9uLmpzIiwid2VicGFjazovL3dlYl9wcm9qZWN0XzQvLi9zcmMvcGFnZXMvSW5kZXguanMiLCJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfNC8uL3NyYy9jb21wb25lbnRzL3NjcmlwdHMvQXBpLmpzIiwid2VicGFjazovL3dlYl9wcm9qZWN0XzQvLi9zcmMvY29tcG9uZW50cy9zY3JpcHRzL01vZGFsV2l0aEltYWdlLmpzIiwid2VicGFjazovL3dlYl9wcm9qZWN0XzQvLi9zcmMvY29tcG9uZW50cy9zY3JpcHRzL1VzZXJJbmZvLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImV4cG9ydCBjbGFzcyBDYXJkIHtcclxuICBjb25zdHJ1Y3Rvcih7Y2FyZERhdGEsIGlzTGlrZWQsIGlzT3duZXIsIG9uQ2FyZENsaWNrLCByZW1vdmVIYW5kbGVyLCBsaWtlSGFuZGxlcn0sIGNhcmRTZWxlY3Rvcikge1xyXG4gICAgdGhpcy5fbmFtZSA9IGNhcmREYXRhLm5hbWU7XHJcbiAgICB0aGlzLl9saW5rID0gY2FyZERhdGEubGluaztcclxuICAgIHRoaXMuX2lkID0gY2FyZERhdGEuX2lkO1xyXG4gICAgdGhpcy5fb3duZXJJZCA9IGNhcmREYXRhLm93bmVyLl9pZDtcclxuICAgIHRoaXMuX2xpa2VzID0gY2FyZERhdGEubGlrZXM7XHJcbiAgICB0aGlzLl9saWtlc0NvdW50ID0gY2FyZERhdGEubGlrZXMubGVuZ3RoO1xyXG4gICAgdGhpcy5fY2FyZFNlbGVjdG9yID0gY2FyZFNlbGVjdG9yO1xyXG5cclxuICAgIHRoaXMuX29uQ2FyZENsaWNrID0gb25DYXJkQ2xpY2s7XHJcbiAgICB0aGlzLl9vbkNhcmRDbGljayA9IHRoaXMuX29uQ2FyZENsaWNrLmJpbmQodGhpcyk7XHJcbiAgICB0aGlzLl9saWtlSGFuZGxlciA9IGxpa2VIYW5kbGVyO1xyXG4gICAgdGhpcy5fY2xpY2tMaWtlSGFuZGxlciA9IHRoaXMuX2NsaWNrTGlrZUhhbmRsZXIuYmluZCh0aGlzKTtcclxuICAgIHRoaXMuX3JlbW92ZUhhbmRsZXIgPSByZW1vdmVIYW5kbGVyO1xyXG4gICAgdGhpcy5fcmVtb3ZlSGFuZGxlciA9IHRoaXMuX3JlbW92ZUhhbmRsZXIuYmluZCh0aGlzKTtcclxuXHJcbiAgICB0aGlzLl9pc0xpa2VkID0gaXNMaWtlZDtcclxuICAgIHRoaXMuX2lzTGlrZWQgPSB0aGlzLl9pc0xpa2VkLmJpbmQodGhpcyk7XHJcbiAgICB0aGlzLl9pc093bmVyID0gaXNPd25lcjtcclxuICAgIHRoaXMuX2lzT3duZXIgPSB0aGlzLl9pc093bmVyLmJpbmQodGhpcyk7XHJcbiAgfVxyXG4gIC8vIC0tLSBHZXR0aW5nIHRoZSB0ZW1wbGF0ZSAtLS0gLy9cclxuICBfZ2V0VGVtcGxhdGUoKSB7XHJcbiAgICBjb25zdCBjYXJkID0gZG9jdW1lbnRcclxuICAgICAgLnF1ZXJ5U2VsZWN0b3IoXCIjY2FyZF9fdGVtcGxhdGVcIilcclxuICAgICAgLmNvbnRlbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkXCIpXHJcbiAgICAgIC5jbG9uZU5vZGUodHJ1ZSk7XHJcbiAgICByZXR1cm4gY2FyZDtcclxuICB9XHJcblxyXG4gIC8vIC0tLSBTZXQgdGhlIGxpa2VzIGFtb3VudCBvZiBhIGNhcmQgLS0tIC8vXHJcbiAgbGlrZXNBbW91bnRTZXQobGlrZXNDb3VudCkge1xyXG4gICAgdGhpcy5faXRlbS5xdWVyeVNlbGVjdG9yKCcuY2FyZF9fbGlrZS1jb3VudCcpLnRleHRDb250ZW50ID0gbGlrZXNDb3VudDtcclxuICB9XHJcblxyXG4gIC8vIC0tLSBUb2dnbGUgbGlrZSBidXR0b24gbWV0aG9kIC0tLSAvL1xyXG4gIF9saWtlQ2FyZChldmVudCkge1xyXG4gICAgY29uc3QgbGlrZUVsZW1lbnQgPSB0aGlzLl9pdGVtLnF1ZXJ5U2VsZWN0b3IoJ2NhcmRfX2xpa2UnKTtcclxuICAgIGxpa2VFbGVtZW50LmNsYXNzTGlzdC50b2dnbGUoXCJjYXJkX19saWtlLWJ1dHRvbl9hY3RpdmVcIik7XHJcbiAgICB0aGlzLl9saWtlSGFuZGxlcih0aGlzKTtcclxuICAgIGV2ZW50LnN0b3BJbW1lZGlhdGVQcm9wb2dhdGlvbigpO1xyXG4gIH1cclxuICAvLyAtLS0gQ2FyZCBkZWxldGluZyBtZXRob2QgLS0tIC8vXHJcbiAgZGVsZXRlQ2FyZCgpIHtcclxuICAgIHRoaXMuX2l0ZW0ucmVtb3ZlKCk7XHJcbiAgICB0aGlzLl9pdGVtID0gbnVsbCBcclxuICB9XHJcbiAgLy8gLS0tIFRoZSBjYXJkIGRlbGV0aW5nIGV2ZW50IGhhbmRsZXIgLS0tIC8vXHJcbiAgX2RlbGV0ZUNhcmRIYW5kbGVyKGV2ZW50KSB7XHJcbiAgICBldmVudC5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKTtcclxuICAgIHRoaXMuX2RlbGV0ZUNhcmRIYW5kbGVyKHRoaXMuX2lkLCB0aGlzKTtcclxuICB9XHJcbiAgXHJcbiAgLy8gLS0tIFNldCBldmVudHMgbGlzdGVuZXJzIGZvciB0aGUgY2FyZHMgdGhhdCB3aWxsIGJlIGNyZWF0ZWQhIC0tLSAvL1xyXG4gIF9zZXRFdmVudExpc3RlbmVycygpIHtcclxuICAgIHRoaXMuX2l0ZW1cclxuICAgICAgLnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9fbGlrZS1idXR0b25cIilcclxuICAgICAgLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoZXZlbnQpID0+IHtcclxuICAgICAgICB0aGlzLl9saWtlQ2FyZChldmVudCk7XHJcbiAgICAgIH0pO1xyXG5cclxuICAgIHRoaXMuX2l0ZW1cclxuICAgICAgLnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9fZGVsZXRlLWJ1dHRvblwiKVxyXG4gICAgICAuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIChldmVudCkgPT4ge1xyXG4gICAgICAgIHRoaXMuX2RlbGV0ZUNhcmRIYW5kbGVyKGV2ZW50KTtcclxuICAgICAgfSk7XHJcblxyXG4gICAgdGhpcy5fY2FyZEltYWdlXHJcbiAgICAgIC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKGV2ZW50KSA9PiB7XHJcbiAgICAgICAgdGhpcy5fb25DYXJkQ2xpY2soZXZlbnQpO1xyXG4gICAgICB9KTtcclxuICB9XHJcblxyXG4gIC8vIC0tLSBDcmVhdGluZyB0aGUgY2FyZCBhbmQgY2FyZCBlbGVtZW50cyAtLS0gLy9cclxuICBnZW5lcmF0ZUNhcmQoKSB7XHJcbiAgICB0aGlzLl9pdGVtID0gdGhpcy5fZ2V0VGVtcGxhdGUoKTtcclxuXHJcbiAgICBpZiAodGhpcy5faXNMaWtlZCh0aGlzLl9saWtlcykgPT09IHRydWUpIHtcclxuICAgICAgdGhpcy5fZWxlbWVudC5xdWVyeVNlbGVjdG9yKCcuY2FyZF9fbGlrZS1idXR0b24nKS5jbGFzc0xpc3QuYWRkKCdjYXJkX19saWtlX2FjdGl2ZScpO1xyXG4gICAgfSBcclxuICAgIGVsc2Uge1xyXG4gICAgICB0aGlzLl9lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJy5jYXJkX19saWtlLWJ1dHRvbicpLmNsYXNzTGlzdC5yZW1vdmUoJ2NhcmRfX2xpa2VfYWN0aXZlJyk7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKHRoaXMuX2lzT3duZXIodGhpcy5fb3duZXJJZCkgIT09IHRydWUpIHtcclxuICAgICAgdGhpcy5fZWxlbWVudC5xdWVyeVNlbGVjdG9yKCcuY2FyZF9fZGVsZXRlLWJ1dHRvbicpLmNsYXNzTGlzdC5hZGQoJ2NhcmRfX2RlbGV0ZS1idXR0b25faGlkZGVuJyk7XHJcbiAgICB9XHJcblxyXG4gICAgdGhpcy5fY2FyZEltYWdlID0gdGhpcy5faXRlbVxyXG4gICAgICAucXVlcnlTZWxlY3RvcihcIi5jYXJkX19pbWFnZVwiKTtcclxuICAgIHRoaXMuX3NldEV2ZW50TGlzdGVuZXJzKCk7XHJcbiAgICB0aGlzLl9pdGVtXHJcbiAgICAgIC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX3RpdGxlXCIpXHJcbiAgICAgIC50ZXh0Q29udGVudCA9IHRoaXMuX25hbWU7XHJcbiAgICB0aGlzLl9jYXJkSW1hZ2Uuc3JjID0gdGhpcy5fbGluaztcclxuICAgIHRoaXMuX2NhcmRJbWFnZS5hbHQgPSAnSW1hZ2Ugb2YgJytgICR7dGhpcy5fbmFtZX0gYDtcclxuXHJcbiAgICB0aGlzLl9zZXRFdmVudExpc3RlbmVycygpO1xyXG5cclxuICAgIHJldHVybiB0aGlzLl9pdGVtO1xyXG4gIH1cclxuXHJcbiAgZ2V0SUQoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5faWQ7XHJcbiAgfVxyXG59IiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgRm9ybVZhbGlkYXRvciB7XHJcbiAgY29uc3RydWN0b3IoZm9ybUNvbmZpZywgZm9ybUVsZW1lbnQpIHtcclxuICAgIHRoaXMuX2Zvcm1Db25maWcgPSBmb3JtQ29uZmlnO1xyXG4gICAgdGhpcy5fZm9ybUVsZW1lbnQgPSBmb3JtRWxlbWVudDtcclxuICB9XHJcblxyXG4gIF9zaG93SW5wdXRFcnJvciA9IChpbnB1dEVsZW1lbnQsIGVycm9yTWVzc2FnZSkgPT4ge1xyXG4gICAgY29uc3QgeyBpbnB1dEVycm9yQ2xhc3MsIGVycm9yTWVzc2FnZUNsYXNzIH0gPSB0aGlzLl9mb3JtQ29uZmlnO1xyXG4gICAgY29uc3QgZXJyb3JFbGVtZW50ID0gdGhpcy5fZm9ybUVsZW1lbnQucXVlcnlTZWxlY3RvcihgICMke2lucHV0RWxlbWVudC5pZH1fZXJyb3IgYCk7XHJcbiAgICBlcnJvckVsZW1lbnQudGV4dENvbnRlbnQgPSBlcnJvck1lc3NhZ2U7XHJcbiAgICBlcnJvckVsZW1lbnQuY2xhc3NMaXN0LmFkZChlcnJvck1lc3NhZ2VDbGFzcyk7XHJcbiAgICBpbnB1dEVsZW1lbnQuY2xhc3NMaXN0LmFkZChpbnB1dEVycm9yQ2xhc3MpO1xyXG4gIH07XHJcbiAgXHJcbiAgX2hpZGVJbnB1dEVycm9yID0gKGlucHV0RWxlbWVudCkgPT4ge1xyXG4gICAgY29uc3QgeyBpbnB1dEVycm9yQ2xhc3MsIGVycm9yTWVzc2FnZUNsYXNzIH0gPSB0aGlzLl9mb3JtQ29uZmlnO1xyXG4gICAgY29uc3QgZXJyb3JFbGVtZW50ID0gdGhpcy5fZm9ybUVsZW1lbnQucXVlcnlTZWxlY3RvcihgICMke2lucHV0RWxlbWVudC5pZH1fZXJyb3IgYCk7XHJcbiAgICBlcnJvckVsZW1lbnQudGV4dENvbnRlbnQgPSBcIlwiO1xyXG4gICAgZXJyb3JFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoZXJyb3JNZXNzYWdlQ2xhc3MpO1xyXG4gICAgaW5wdXRFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoaW5wdXRFcnJvckNsYXNzKTtcclxuICB9O1xyXG5cclxuICByZXNldFZhbGlkYXRpb24oKSB7XHJcbiAgICB0aGlzLmlucHV0cy5mb3JFYWNoKChpbnB1dCkgPT4ge1xyXG4gICAgICB0aGlzLl9oaWRlSW5wdXRFcnJvcihpbnB1dCk7XHJcbiAgICB9KTtcclxuICAgIHRoaXMuX3RvZ2dsZVN1Ym1pdEJ1dHRvbigpO1xyXG4gIH1cclxuXHJcbiAgX2NoZWNrSW5wdXQgPSAoaW5wdXRFbGVtZW50KSA9PiB7XHJcbiAgICBpZiAoIWlucHV0RWxlbWVudC52YWxpZGl0eS52YWxpZCkge1xyXG4gICAgICB0aGlzLl9zaG93SW5wdXRFcnJvcihpbnB1dEVsZW1lbnQsIGlucHV0RWxlbWVudC52YWxpZGF0aW9uTWVzc2FnZSk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB0aGlzLl9oaWRlSW5wdXRFcnJvcihpbnB1dEVsZW1lbnQpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgX2NoZWNrSWZGb3JtVmFsaWQgPSAoKSA9PiB0aGlzLmlucHV0cy5ldmVyeSgoaW5wdXQpID0+IGlucHV0LnZhbGlkaXR5LnZhbGlkKTtcclxuXHJcbiAgX3RvZ2dsZVN1Ym1pdEJ1dHRvbigpIHtcclxuICAgIGNvbnN0IHsgaW5hY3RpdmVCdXR0b25DbGFzcywgc3VibWl0QnV0dG9uU2VsZWN0b3IgfSA9IHRoaXMuX2Zvcm1Db25maWc7XHJcbiAgICBjb25zdCBidXR0b25FbGVtZW50ID0gdGhpcy5fZm9ybUVsZW1lbnQucXVlcnlTZWxlY3RvcihzdWJtaXRCdXR0b25TZWxlY3Rvcik7XHJcblxyXG4gICAgaWYgKHRoaXMuX2NoZWNrSWZGb3JtVmFsaWQoKSkge1xyXG4gICAgICBidXR0b25FbGVtZW50LmRpc2FibGVkID0gZmFsc2U7XHJcbiAgICAgIGJ1dHRvbkVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZShpbmFjdGl2ZUJ1dHRvbkNsYXNzKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGJ1dHRvbkVsZW1lbnQuZGlzYWJsZWQgPSB0cnVlO1xyXG4gICAgICBidXR0b25FbGVtZW50LmNsYXNzTGlzdC5hZGQoaW5hY3RpdmVCdXR0b25DbGFzcyk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBfc2V0RXZlbnRMaXN0ZW5lcnMgPSAoKSA9PiB7XHJcbiAgICBjb25zdCB7IGlucHV0U2VsZWN0b3IgfSA9IHRoaXMuX2Zvcm1Db25maWc7XHJcbiAgICB0aGlzLmlucHV0cyA9IEFycmF5LmZyb20odGhpcy5fZm9ybUVsZW1lbnQucXVlcnlTZWxlY3RvckFsbChpbnB1dFNlbGVjdG9yKSk7XHJcblxyXG4gICAgdGhpcy5pbnB1dHMuZm9yRWFjaCgoaW5wdXQpID0+IHtcclxuICAgICAgaW5wdXQuYWRkRXZlbnRMaXN0ZW5lcihcImlucHV0XCIsICgpID0+IHtcclxuICAgICAgICB0aGlzLl9jaGVja0lucHV0KGlucHV0KTtcclxuICAgICAgICB0aGlzLl90b2dnbGVTdWJtaXRCdXR0b24oKTtcclxuICAgICAgfSk7XHJcbiAgICB9KTtcclxuICAgIHJldHVybiB0aGlzLl9mb3JtRWxlbWVudDtcclxuICB9O1xyXG5cclxuICBlbmFibGVWYWxpZGF0aW9uKCkge1xyXG4gICAgdGhpcy5fZm9ybUVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCAoZXZlbnQpID0+IHtcclxuICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcclxuICAgIH0pO1xyXG4gICAgdGhpcy5fc2V0RXZlbnRMaXN0ZW5lcnMoKTtcclxuICB9XHJcbn0iLCJleHBvcnQgZGVmYXVsdCBjbGFzcyBTZWN0aW9uIHtcclxuICBjb25zdHJ1Y3Rvcih7IGl0ZW1zLCByZW5kZXJlciB9LCBjb250YWluZXJTZWxlY3Rvcikge1xyXG4gICAgdGhpcy5faXRlbXMgPSBpdGVtcztcclxuICAgIHRoaXMuX3JlbmRlcmVyID0gcmVuZGVyZXI7XHJcbiAgICB0aGlzLl9jb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGNvbnRhaW5lclNlbGVjdG9yKTtcclxuICAgIHRoaXMucmVuZGVyZXIgPSByZW5kZXJlcjtcclxuICB9XHJcblxyXG4gIGFkZEl0ZW0oZWxlbWVudCkge1xyXG4gICAgdGhpcy5fY29udGFpbmVyLmFwcGVuZChlbGVtZW50KTtcclxuICB9XHJcblxyXG4gIHByZXBlbmRJdGVtKGVsZW1lbnQpIHtcclxuICAgIHRoaXMuX2NvbnRhaW5lci5wcmVwZW5kKGVsZW1lbnQpO1xyXG4gIH1cclxuXHJcbiAgcmVuZGVySXRlbXMoKSB7XHJcbiAgICB0aGlzLl9pdGVtcy5mb3JFYWNoKChjYXJkKSA9PiB7XHJcbiAgICAgIHRoaXMuX3JlbmRlcmVyKGNhcmQpO1xyXG4gICAgfSk7XHJcbiAgfVxyXG59XHJcbiIsIi8vIC0tICdFZGl0IHByb2ZpbGUnIG1vZGFsIGNvbnN0cyAtLSAvL1xyXG5leHBvcnQgY29uc3QgZWRpdEJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wcm9maWxlX19lZGl0LWJ1dHRvbicpO1xyXG5leHBvcnQgY29uc3QgcHJvZmlsZU1vZGFsID0gZG9jdW1lbnQuZm9ybXMucHJvZmlsZTtcclxuZXhwb3J0IGNvbnN0IG5hbWVJbnB1dCA9IHByb2ZpbGVNb2RhbC5lbGVtZW50cy5uYW1lO1xyXG5leHBvcnQgY29uc3Qgam9iSW5wdXQgPSBwcm9maWxlTW9kYWwuZWxlbWVudHMuam9iO1xyXG5leHBvcnQgY29uc3QgZWRpdENsb3NlQnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLm1vZGFsX19jbG9zZS1idXR0b25fdHlwZV9lZGl0Jyk7XHJcbi8vIC0tICdBZGQtY2FyZCcgbW9kYWwgY29uc3RzIC0tIC8vXHJcbmV4cG9ydCBjb25zdCBhZGRDYXJkQnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnByb2ZpbGVfX2FkZC1idXR0b24nKTtcclxuZXhwb3J0IGNvbnN0IGFkZENhcmRNb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbF90eXBlX2FkZC1jYXJkJyk7XHJcbmV4cG9ydCBjb25zdCBjYXJkSW5wdXRUaXRsZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbF9faW5wdXRfdHlwZV9uYW1lJyk7XHJcbmV4cG9ydCBjb25zdCBjYXJkSW5wdXRMaW5rID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLm1vZGFsX19pbnB1dF90eXBlX2xpbmsnKTtcclxuZXhwb3J0IGNvbnN0IGFkZENhcmRDbG9zZUJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbF9fY2xvc2UtYnV0dG9uX3R5cGVfYWRkLWNhcmQnKTtcclxuLy8gLS0tICdBZGQtQ2FyZCcgZm9ybSBjb25zdHMgLS0tIC8vXHJcbmV4cG9ydCBjb25zdCBhZGRDYXJkRm9ybSA9IGRvY3VtZW50LmZvcm1zLmFkZDtcclxuZXhwb3J0IGNvbnN0IGFkZENhcmRGb3JtVGl0ZWwgPSBhZGRDYXJkRm9ybS5lbGVtZW50cy50aXRsZTtcclxuZXhwb3J0IGNvbnN0IGFkZENhcmRGb3JtTGluayA9IGFkZENhcmRGb3JtLmVsZW1lbnRzLmxpbms7XHJcbi8vIC0tLSBHZW5lcmFsIGNvbnN0IC0tLSAvL1xyXG5leHBvcnQgY29uc3Qgc3VibWl0QnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLm1vZGFsX19zdWJtaXQtYnV0dG9uJyk7XHJcbmV4cG9ydCBjb25zdCBjYXJkTGlzdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5jYXJkc19fZ3JpZCcpO1xyXG4vLyAtLS0gQmlnIGltYWdlIG1vZGFsIGNvbnN0cyAtLS0gLy9cclxuZXhwb3J0IGNvbnN0IGNhcmRCaWdNb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbF90eXBlX2JpZy1pbWFnZScpO1xyXG5leHBvcnQgY29uc3QgY2FyZEJpZ01vZGFsSW1hZ2UgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubW9kYWxfX2JpZy1pbWFnZScpO1xyXG5leHBvcnQgY29uc3QgY2FyZEJpZ01vZGFsVGV4dCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbF9faW1hZ2UtY2FwdGlvbicpO1xyXG5leHBvcnQgY29uc3QgY2FyZEJpZ01vZGFsQ2xvc2VJY29uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLm1vZGFsX19jbG9zZS1idXR0b25fdHlwZV9iaWctaW1hZ2UnKTtcclxuLy8gLS0tIEZvcm0gY29uZmlnIGNvbnN0cyAtLS0gLy9cclxuZXhwb3J0IGNvbnN0IGZvcm1Db25maWcgPSB7XHJcbiAgZm9ybVNlbGVjdG9yOiBcIi5tb2RhbF9fY29udGFpbmVyXCIsXHJcbiAgaW5wdXRTZWxlY3RvcjogXCIubW9kYWxfX2lucHV0XCIsXHJcbiAgc3VibWl0QnV0dG9uU2VsZWN0b3I6IFwiLm1vZGFsX19zdWJtaXQtYnV0dG9uXCIsXHJcbiAgaW5hY3RpdmVCdXR0b25DbGFzczogXCJtb2RhbF9fc3VibWl0LWJ1dHRvbl9kaXNhYmxlZFwiLFxyXG4gIGlucHV0RXJyb3JDbGFzczogXCJtb2RhbF9faW5wdXRfZXJyb3JcIixcclxuICBlcnJvck1lc3NhZ2VDbGFzczogXCJtb2RhbF9fZXJyb3JfdmlzaWJsZVwiXHJcbn07XHJcbi8vIC0tLSBpbml0Q2FyZHMgY29uc3RzIC0tLSAvL1xyXG5leHBvcnQgY29uc3QgaW5pdENhcmRzID0gW1xyXG4gIHtcclxuICAgIG5hbWU6IFwiWW9zZW1pdGUgVmFsbGV5XCIsXHJcbiAgICBsaW5rOiBcImh0dHBzOi8vY29kZS5zMy55YW5kZXgubmV0L3dlYi1jb2RlL3lvc2VtaXRlLmpwZ1wiXHJcbiAgfSxcclxuICB7XHJcbiAgICBuYW1lOiBcIkxha2UgTG91aXNlXCIsXHJcbiAgICBsaW5rOiBcImh0dHBzOi8vY29kZS5zMy55YW5kZXgubmV0L3dlYi1jb2RlL2xha2UtbG91aXNlLmpwZ1wiXHJcbiAgfSxcclxuICB7XHJcbiAgICBuYW1lOiBcIkJhbGQgTW91bnRhaW5zXCIsXHJcbiAgICBsaW5rOiBcImh0dHBzOi8vY29kZS5zMy55YW5kZXgubmV0L3dlYi1jb2RlL2JhbGQtbW91bnRhaW5zLmpwZ1wiXHJcbiAgfSxcclxuICB7XHJcbiAgICBuYW1lOiBcIkxhdGVtYXJcIixcclxuICAgIGxpbms6IFwiaHR0cHM6Ly9jb2RlLnMzLnlhbmRleC5uZXQvd2ViLWNvZGUvbGF0ZW1hci5qcGdcIlxyXG4gIH0sXHJcbiAge1xyXG4gICAgbmFtZTogXCJWYW5vaXNlIE5hdGlvbmFsIFBhcmtcIixcclxuICAgIGxpbms6IFwiaHR0cHM6Ly9jb2RlLnMzLnlhbmRleC5uZXQvd2ViLWNvZGUvdmFub2lzZS5qcGdcIlxyXG4gIH0sXHJcbiAge1xyXG4gICAgbmFtZTogXCJMYWdvIGRpIEJyYWllc1wiLFxyXG4gICAgbGluazogXCJodHRwczovL2NvZGUuczMueWFuZGV4Lm5ldC93ZWItY29kZS9sYWdvLmpwZ1wiXHJcbiAgfVxyXG5dOyIsImV4cG9ydCBkZWZhdWx0IGNsYXNzIE1vZGFsIHtcclxuICBjb25zdHJ1Y3Rvcihtb2RhbFNlbGVjdG9yKSB7XHJcbiAgICB0aGlzLl9tb2RhbEVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKG1vZGFsU2VsZWN0b3IpO1xyXG4gIH1cclxuICAvLyAtLS0gQ2xvc2UgbW9kYWwgb24gRVNDIG1ldGhvZCAtLS0gLy9cclxuICBfY2hlY2tGb3JFc2NDbG9zZSA9IChldmVudCkgPT4ge1xyXG4gICAgaWYgKGV2ZW50LmtleSA9PT0gXCJFc2NhcGVcIikge1xyXG4gICAgICB0aGlzLmNsb3NlKCk7XHJcbiAgICB9XHJcbiAgfVxyXG4gIC8vIC0tLSBPcGVuIG1vZGFsIG1ldGhvZCAtLS0gLy8gXHJcbiAgb3BlbiA9ICgpID0+IHtcclxuICAgIHRoaXMuX21vZGFsRWxlbWVudC5jbGFzc0xpc3QuYWRkKFwibW9kYWxfdmlzaWJsZVwiKTtcclxuICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJrZXl1cFwiLCB0aGlzLl9jaGVja0ZvckVzY0Nsb3NlKTtcclxuICB9XHJcbiAgLy8gLS0tIENsb3NlIG1vZGFsIG1ldGhvZCAtLS0gLy9cclxuICBjbG9zZSA9ICgpID0+IHtcclxuICAgIHRoaXMuX21vZGFsRWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKFwibW9kYWxfdmlzaWJsZVwiKTtcclxuICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJrZXl1cFwiLCB0aGlzLl9jaGVja0ZvckVzY0Nsb3NlKTtcclxuICB9XHJcblxyXG4gIHNldEV2ZW50TGlzdGVuZXJzKCkge1xyXG4gICAgLy8gLS0tIENsb3NlIG1vZGFsIG9uIGNsb3NlKCdYJykgYnV0dG9uIC0tLSAvL1xyXG4gICAgdGhpcy5fbW9kYWxFbGVtZW50XHJcbiAgICAucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fY2xvc2UtYnV0dG9uXCIpXHJcbiAgICAuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIChldmVudCkgPT4ge1xyXG4gICAgICB0aGlzLmNsb3NlKGV2ZW50KTtcclxuICAgIH0pO1xyXG4gICAgLy8gQ2xvc2UgbW9kYWwgb24gb3ZlcmxheShvdXQgb2YgdGhlIG1vZGFsKSBjbGljayAtLS0gLy8vXHJcbiAgICB0aGlzLl9tb2RhbEVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIChldmVudCkgPT4ge1xyXG4gICAgICBpZiAoZXZlbnQudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucyhcIm1vZGFsX3Zpc2libGVcIikpIHtcclxuICAgICAgICB0aGlzLmNsb3NlKGV2ZW50KTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG59IiwiaW1wb3J0IE1vZGFsIGZyb20gXCIuL01vZGFsLmpzXCI7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBNb2RhbFdpdGhGb3JtIGV4dGVuZHMgTW9kYWwge1xyXG4gIGNvbnN0cnVjdG9yKG1vZGFsU2VsZWN0b3IsIGhhbmRsZVN1Ym1pdCkge1xyXG4gICAgc3VwZXIobW9kYWxTZWxlY3Rvcik7XHJcbiAgICB0aGlzLl9oYW5kbGVTdWJtaXRCdG4gPSBoYW5kbGVTdWJtaXQ7XHJcbiAgICB0aGlzLl9mb3JtRWxlbWVudCA9IHRoaXMuX21vZGFsRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19jb250YWluZXJcIik7XHJcbiAgfVxyXG5cclxuICBnZXRJbnB1dFZhbHVlcygpIHtcclxuICAgIGNvbnN0IGlucHV0TGlzdCA9IEFycmF5LmZyb20oXHJcbiAgICAgIHRoaXMuX2Zvcm1FbGVtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCIubW9kYWxfX2lucHV0XCIpXHJcbiAgICApO1xyXG4gICAgY29uc3QgaW5wdXRWYWx1ZXMgPSB7fTtcclxuICAgIGlucHV0TGlzdC5mb3JFYWNoKChpbnB1dCkgPT4ge2lucHV0VmFsdWVzW2lucHV0Lm5hbWVdID0gaW5wdXQudmFsdWU7fSk7XHJcbiAgICByZXR1cm4gaW5wdXRWYWx1ZXM7XHJcbiAgfVxyXG5cclxuICBzZXRJbnB1dFZhbHVlcyh2YWx1ZXMpIHtcclxuICAgIGNvbnN0IGlucHV0TGlzdCA9IEFycmF5LmZyb20oXHJcbiAgICAgIHRoaXMuX2Zvcm1FbGVtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCIubW9kYWxfX2lucHV0XCIpXHJcbiAgICApO1xyXG4gICAgaW5wdXRMaXN0LmZvckVhY2goKGlucHV0KSA9PiB7aW5wdXQudmFsdWUgPSB2YWx1ZXNbaW5wdXQubmFtZV07fSlcclxuICB9XHJcblxyXG4gIHNldEV2ZW50TGlzdGVuZXJzKCkge1xyXG4gICAgc3VwZXIuc2V0RXZlbnRMaXN0ZW5lcnMoKTtcclxuICAgIHRoaXMuX2Zvcm1FbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgKCkgPT4ge1xyXG4gICAgICB0aGlzLl9oYW5kbGVTdWJtaXRCdG4odGhpcy5nZXRJbnB1dFZhbHVlcygpKTtcclxuICAgICAgdGhpcy5jbG9zZSgpO1xyXG4gICAgICB0aGlzLl9mb3JtRWxlbWVudC5yZXNldCgpO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBjbG9zZSgpIHtcclxuICAgIHN1cGVyLmNsb3NlKCk7XHJcbiAgICB0aGlzLl9mb3JtRWxlbWVudC5yZXNldCgpO1xyXG4gIH1cclxufSIsImltcG9ydCBNb2RhbCBmcm9tICcuL01vZGFsLmpzJztcclxuICBcclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgTW9kYWxEZWxldGVDb25maXJtYXRpb24gZXh0ZW5kcyBNb2RhbCB7XHJcbiAgY29uc3RydWN0b3IgKHNlbGVjdG9yLCBoYW5kbGVTdWJtaXQpIHtcclxuICAgIHN1cGVyKHNlbGVjdG9yKTtcclxuICAgIHRoaXMuX2Zvcm0gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHRoaXMuX3NlbGVjdG9yKTtcclxuICAgIHRoaXMuX2hhbmRsZVN1Ym1pdCA9IGhhbmRsZVN1Ym1pdDtcclxuICAgIHRoaXMuX2hhbmRsZVN1Ym1pdEhhbmRsZXIgPSB0aGlzLl9oYW5kbGVTdWJtaXRIYW5kbGVyLmJpbmQodGhpcyk7XHJcbiAgfVxyXG4gIFxyXG4gIF9oYW5kbGVTdWJtaXRIYW5kbGVyIChldmVudCkge1xyXG4gICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcclxuICAgIHRoaXMuX2hhbmRsZVN1Ym1pdCgpO1xyXG4gICAgc3VwZXIuY2xvc2UoKTtcclxuICB9XHJcbiAgXHJcbiAgX3NldEV2ZW50TGlzdGVuZXJzICgpIHtcclxuICAgIHN1cGVyLl9zZXRFdmVudExpc3RlbmVycygpO1xyXG4gICAgdGhpcy5fZm9ybS5hZGRFdmVudExpc3RlbmVyKCdzdWJtaXQnLCB0aGlzLl9oYW5kbGVTdWJtaXRIYW5kbGVyKTtcclxuICB9XHJcbiAgXHJcbiAgX3JlbW92ZUV2ZW50TGlzdGVuZXJzICgpIHtcclxuICAgIHN1cGVyLl9yZW1vdmVFdmVudExpc3RlbmVycygpO1xyXG4gICAgdGhpcy5fZm9ybS5yZW1vdmVFdmVudExpc3RlbmVyKCdzdWJtaXQnLCB0aGlzLl9oYW5kbGVTdWJtaXRIYW5kbGVyKTtcclxuICB9XHJcbn0iLCJpbXBvcnQgQXBpIGZyb20gXCIuLi9jb21wb25lbnRzL3NjcmlwdHMvQXBpLmpzXCI7XHJcbmltcG9ydCB7IENhcmQgfSBmcm9tIFwiLi4vY29tcG9uZW50cy9zY3JpcHRzL0NhcmQuanNcIjtcclxuaW1wb3J0IEZvcm1WYWxpZGF0b3IgZnJvbSBcIi4uL2NvbXBvbmVudHMvc2NyaXB0cy9Gb3JtVmFsaWRhdG9yLmpzXCI7XHJcbmltcG9ydCBTZWN0aW9uIGZyb20gXCIuLi9jb21wb25lbnRzL3NjcmlwdHMvU2VjdGlvbi5qc1wiO1xyXG5pbXBvcnQge1xyXG4gIGVkaXRCdXR0b24sXHJcbiAgcHJvZmlsZU1vZGFsLFxyXG4gIGFkZENhcmRCdXR0b24sXHJcbiAgYWRkQ2FyZE1vZGFsLFxyXG4gIGZvcm1Db25maWdcclxufSBmcm9tIFwiLi4vY29tcG9uZW50cy91dGlscy9jb25zdGFudHMuanNcIjtcclxuaW1wb3J0IE1vZGFsV2l0aEltYWdlIGZyb20gXCIuLi9jb21wb25lbnRzL3NjcmlwdHMvTW9kYWxXaXRoSW1hZ2UuanNcIjtcclxuaW1wb3J0IE1vZGFsV2l0aEZvcm0gZnJvbSBcIi4uL2NvbXBvbmVudHMvc2NyaXB0cy9Nb2RhbFdpdGhGb3JtLmpzXCI7XHJcbmltcG9ydCBNb2RhbERlbGV0ZUNvbmZpcm1hdGlvbiBmcm9tIFwiLi4vY29tcG9uZW50cy9zY3JpcHRzL01vZGFsRGVsZXRlQ29uZmlybWF0aW9uLmpzXCI7XHJcbmltcG9ydCBVc2VySW5mbyBmcm9tIFwiLi4vY29tcG9uZW50cy9zY3JpcHRzL1VzZXJJbmZvLmpzXCI7XHJcbmltcG9ydCBcIi4vaW5kZXguY3NzXCI7XHJcblxyXG5jb25zdCBhcGkgPSBuZXcgQXBpKHtcclxuICBiYXNlVXJsOiAnaHR0cHM6Ly9hcm91bmQubm9tb3JlcGFydGllcy5jby92MS9ncm91cC00MicsXHJcbiAgaGVhZGVyczoge1xyXG4gICAgYXV0aG9yaXphdGlvbjogJ2M1NmUzMGRjLTI4ODMtNDI3MC1hNTllLWIyZjdiYWU5NjljNicsXHJcbiAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nXHJcbiAgfVxyXG59KTsgXHJcblxyXG4vLyArKysrKyBDYXJkIFNlY3Rpb24gKysrKysgLy9cclxuY29uc3QgY2FyZFNlbGVjdG9yID0gJyNjYXJkJztcclxuLy8gLS0tIENhcmQgcmVuZGVyIGZ1bmN0aW9uIC0tLSAvL1xyXG5mdW5jdGlvbiByZW5kZXJDYXJkIChpbml0Q2FyZCwgdXNlciwgc2VsZWN0b3IpIHtcclxuICByZXR1cm4gbmV3IENhcmQoe1xyXG4gICAgY2FyZERhdGE6IGluaXRDYXJkLFxyXG4gICAgaXNMaWtlZDogKGxpc3RMaWtlcykgPT4ge1xyXG4gICAgICByZXR1cm4gKGxpc3RMaWtlcy5maW5kKGl0ZW0gPT4gaXRlbS5faWQgPT09IHVzZXIuX2lkKSAhPT0gdW5kZWZpbmVkKTtcclxuICAgIH0sXHJcbiAgICBpc093bmVyOiAob3duZXIpID0+IHtcclxuICAgICAgcmV0dXJuICh1c2VyLl9pZCA9PT0gb3duZXIpO1xyXG4gICAgfSxcclxuICAgIG9uQ2FyZENsaWNrOiAoY2FyZEluZm8pID0+IHtcclxuICAgICAgYmlnSW1hZ2VNb2RhbC5vcGVuKGNhcmRJbmZvKTtcclxuICAgIH0sXHJcbiAgICBkZWxldGVDYXJkSGFuZGxlcjogKGlkLCBjYXJkKSA9PiB7XHJcbiAgICAgIGNvbnN0IGRlbGV0ZUNvbmZpcm0gPSBuZXcgTW9kYWxEZWxldGVDb25maXJtYXRpb24oJy5kZWxldGUtY2FyZCcsICgpID0+IHtcclxuICAgICAgICBhcGkucmVtb3ZlQ2FyZChpZClcclxuICAgICAgICAgIC50aGVuKHJlcyA9PiBjYXJkLnJlbW92ZUNhcmQoKSlcclxuICAgICAgICAgIC5jYXRjaCgoZXJyKSA9PiBjb25zb2xlLmxvZyhlcnIpKVxyXG4gICAgICAgICAgLmZpbmFsbHkoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBkZWxldGVDb25maXJtLmNsb3NlKCk7XHJcbiAgICAgICAgICB9KTtcclxuICAgICAgfSk7XHJcbiAgICAgIGRlbGV0ZUNvbmZpcm0ub3BlbigpO1xyXG4gICAgfSxcclxuICAgIGxpa2VIYW5kbGVyOiAoY2FyZEluZm8pID0+IHtcclxuICAgICAgaWYgKGNhcmRJbmZvLl9saWtlcy5maW5kKGl0ZW0gPT4gaXRlbS5faWQgPT09IHVzZXIuX2lkKSAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgYXBpLnJlbW92ZUxpa2UoY2FyZEluZm8pXHJcbiAgICAgICAgICAudGhlbihyZXMgPT4ge1xyXG4gICAgICAgICAgICBjYXJkSW5mby5fbGlrZXMgPSByZXMubGlrZXM7XHJcbiAgICAgICAgICAgIGNhcmRJbmZvLnNldExpa2VzKHJlcy5saWtlcy5sZW5ndGgpO1xyXG4gICAgICAgICAgfSk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgYXBpLmFkZExpa2UoY2FyZEluZm8pLnRoZW4ocmVzID0+IHtcclxuICAgICAgICAgIGNhcmRJbmZvLl9saWtlcyA9IHJlcy5saWtlcztcclxuICAgICAgICAgIGNhcmRJbmZvLnNldExpa2VzKHJlcy5saWtlcy5sZW5ndGgpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfSxcclxuICBjYXJkU2VsZWN0b3IpO1xyXG59XHJcblxyXG5hcGkuZ2V0QXBwSW5mbygpXHJcbiAgLnRoZW4oKFtpbml0aWFsQ2FyZHMsIHVzZXJJbmZvXSkgPT4ge1xyXG4gICAgY29uc3QgY2FyZHNTZWN0aW9uID0gbmV3IFNlY3Rpb24oe1xyXG4gICAgICBkYXRhOiBpbml0aWFsQ2FyZHMsXHJcbiAgICAgIHJlbmRlcmVyOiBmdW5jdGlvbiAoaW5pdGlhbENhcmQpIHtcclxuICAgICAgICBjb25zdCBjYXJkID0gcmVuZGVyQ2FyZChpbml0aWFsQ2FyZCwgdXNlckluZm8sIGNhcmRTZWxlY3Rvcik7XHJcbiAgICAgICAgY2FyZHNTZWN0aW9uLmFkZEl0ZW0oY2FyZC5nZW5lcmF0ZUNhcmQoKSk7XHJcbiAgICAgIH1cclxuICAgIH0sICcuY2FyZHNfX2dyaWQnKTtcclxuICAgIGNhcmRzU2VjdGlvbi5zZXRJdGVtcygpO1xyXG5cclxuICAgIHVzZXIuc2V0VXNlckluZm8oe1xyXG4gICAgICBuYW1lOiB1c2VySW5mby5uYW1lLFxyXG4gICAgICBqb2I6IHVzZXJJbmZvLmFib3V0XHJcbiAgICB9KTtcclxuXHJcbiAgICB1c2VyLnNldFVzZXJBdmF0YXIoe1xyXG4gICAgICBhdmF0YXI6IHVzZXJJbmZvLmF2YXRhclxyXG4gICAgfSk7XHJcblxyXG4gICAgY29uc3QgbW9kYWxBZGRDYXJkID0gbmV3IE1vZGFsV2l0aEZvcm0oJy5hZGQtY2FyZCcsIChjYXJkRGF0YSkgPT4ge1xyXG4gICAgICBhcGkuYWRkQ2FyZCh7IG5hbWU6IGNhcmREYXRhLm5hbWUsIGxpbms6IGNhcmREYXRhLmxpbmsgfSlcclxuICAgICAgICAudGhlbigocmVzKSA9PiB7XHJcbiAgICAgICAgICBjb25zdCBuZXdDYXJkID0gcmVuZGVyQ2FyZChyZXMsIHVzZXJJbmZvLCBjYXJkU2VsZWN0b3IpO1xyXG4gICAgICAgICAgY2FyZHNTZWN0aW9uLmFkZEl0ZW0obmV3Q2FyZC5nZW5lcmF0ZUNhcmQoKSk7XHJcbiAgICAgICAgfSlcclxuICAgICAgICAuY2F0Y2goKGVycikgPT4gY29uc29sZS5sb2coZXJyKSlcclxuICAgICAgICAuZmluYWxseShmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICBtb2RhbEFkZENhcmQuY2xvc2UoKTtcclxuICAgICAgICB9KTtcclxuICAgIH0pO1xyXG5cclxuICAgIGFkZENhcmRCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7XHJcbiAgICAgIGFkZENhcmRGb3JtVmFsaWRhdGlvbi5yZXNldFZhbGlkYXRpb24oKTtcclxuICAgICAgbW9kYWxBZGRDYXJkLm9wZW4oKTtcclxuICAgIH0pO1xyXG4gIH0pXHJcbiAgLmNhdGNoKChlcnIpID0+IGNvbnNvbGUubG9nKGVycikpO1xyXG5cclxuLy8gLS0tIE1vZGFsV2l0aEltYWdlIGluc3RhbmNlIC0tLSAvL1xyXG5jb25zdCBiaWdJbWFnZU1vZGFsID0gbmV3IE1vZGFsV2l0aEltYWdlKFwiLm1vZGFsX3R5cGVfYmlnLWltYWdlXCIpO1xyXG5iaWdJbWFnZU1vZGFsLnNldEV2ZW50TGlzdGVuZXJzKCk7XHJcblxyXG4vLyArKysrKyAnVXNlciBJbmZvJyArKysrKyAvL1xyXG4vLyAtLS0gVXNlckluZm8gaW5zdGFuY2UgLS0tIC8vXHJcbmNvbnN0IHVzZXJJbmZvVmFsdWVzID0gbmV3IFVzZXJJbmZvKFwiLnByb2ZpbGVfX3RpdGxlXCIsIFwiLnByb2ZpbGVfX3N1YnRpdGxlXCIpO1xyXG51c2VySW5mb1ZhbHVlcy5zZXRVc2VySW5mbyh7IG5hbWU6IFwiQXJ0aW9tIFNobHl1c2JlcmdcIiwgam9iOiBcIkp1bmlvciBXZWIgRGV2XCIgfSk7XHJcblxyXG4vLyArKysrKyBGb3JtcyArKysrKyAvL1xyXG4vLyA9PT0gJ0VkaXQgcHJvZmlsZScgZm9ybSA9PT0gLy9cclxuLy8gLS0tIEZvcm0gY3JlYXRpb24gbWV0aG9kIC0tLSAvL1xyXG5jb25zdCBlZGl0UHJvZmlsZUZvcm0gPSBuZXcgTW9kYWxXaXRoRm9ybShcIi5tb2RhbF90eXBlX2VkaXRcIiwgKGRhdGEpID0+IHtcclxuICB1c2VySW5mb1ZhbHVlcy5zZXRVc2VySW5mbyhlZGl0UHJvZmlsZUZvcm0uZ2V0SW5wdXRWYWx1ZXMoKSk7XHJcbiAgZWRpdFByb2ZpbGVGb3JtLmNsb3NlKCk7XHJcbn0pO1xyXG4vLyAtLS0gU2V0IGV2ZW50IGxpc3RlbmVycyBmb3IgdGhlIGZvcm0gLS0tIC8vXHJcbmVkaXRQcm9maWxlRm9ybS5zZXRFdmVudExpc3RlbmVycygpO1xyXG4vLyAtLS0gU2V0IHZhbHVlcyBhbmQgb3BlbiB0aGUgZm9ybSAtLS0gLy9cclxuZWRpdEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xyXG4gIGVkaXRQcm9maWxlRm9ybS5zZXRJbnB1dFZhbHVlcyh1c2VySW5mb1ZhbHVlcy5nZXRVc2VySW5mbygpKVxyXG4gIHByb2ZpbGVGb3JtVmFsaWRhdGlvbi5yZXNldFZhbGlkYXRpb24oKTtcclxuICBlZGl0UHJvZmlsZUZvcm0ub3BlbigpO1xyXG59KTtcclxuLy8gPT09ICdBZGQgY2FyZCcgZm9ybSA9PT0gLy9cclxuLy8gLS0tIEZvcm0gY3JlYXRpb24gbWV0aG9kIC0tLSAvL1xyXG5jb25zdCBhZGRDYXJkRm9ybSA9IG5ldyBNb2RhbFdpdGhGb3JtKFwiLm1vZGFsX3R5cGVfYWRkLWNhcmRcIiwgKCkgPT4ge1xyXG4gIGNvbnN0IG5ld0NhcmQgPSBhZGRDYXJkRm9ybS5nZXRJbnB1dFZhbHVlcygpO1xyXG4gIGNhcmRzU2VjdGlvbi5wcmVwZW5kSXRlbShjcmVhdGVDYXJkKG5ld0NhcmQpKTtcclxuICBhZGRDYXJkRm9ybS5jbG9zZSgpO1xyXG59KTtcclxuLy8gLS0tIFNldCBldmVudCBsaXN0ZW5lcnMgZm9yICdhZGQgY2FyZCcgbW9kYWwgLS0tIC8vXHJcbmFkZENhcmRGb3JtLnNldEV2ZW50TGlzdGVuZXJzKCk7XHJcblxyXG4vLyArKysrKyBWYWxpZGF0aW9uICsrKysrIC8vXHJcbi8vIC0tLSAnRWRpdCBwcm9maWxlJyBmb3JtIHZhbGlkYXRpb24gYWRkaW5nIC0tLSAvL1xyXG5jb25zdCBwcm9maWxlRm9ybVZhbGlkYXRpb24gPSBuZXcgRm9ybVZhbGlkYXRvcihmb3JtQ29uZmlnLCBwcm9maWxlTW9kYWwpO1xyXG5wcm9maWxlRm9ybVZhbGlkYXRpb24uZW5hYmxlVmFsaWRhdGlvbigpO1xyXG4vLyAtLS0gJ0FkZCBjYXJkJyBmb3JtIHZhbGlkYXRpb24gYWRkaW5nIC0tLSAvL1xyXG5jb25zdCBhZGRDYXJkRm9ybVZhbGlkYXRpb24gPSBuZXcgRm9ybVZhbGlkYXRvcihmb3JtQ29uZmlnLCBhZGRDYXJkTW9kYWwpO1xyXG5hZGRDYXJkRm9ybVZhbGlkYXRpb24uZW5hYmxlVmFsaWRhdGlvbigpOyIsImV4cG9ydCBkZWZhdWx0IGNsYXNzIEFwaSB7XHJcbiAgY29uc3RydWN0b3IoeyBiYXNlVXJsLCBoZWFkZXJzIH0pIHtcclxuICAgIHRoaXMuYmFzZVVybCA9IGJhc2VVcmw7XHJcbiAgICB0aGlzLmhlYWRlcnMgPSBoZWFkZXJzO1xyXG4gIH1cclxuXHJcbiAgLy8gLS0tIEdFVCBodHRwczovL2Fyb3VuZC5ub21vcmVwYXJ0aWVzLmNvL3YxL2dyb3VwLTQyL2NhcmRzIC0tLSAvL1xyXG4gIGdldEluaXRpYWxDYXJkcygpIHtcclxuICAgIHJldHVybiBmZXRjaCh0aGlzLmJhc2VVcmwgKyBcIi9jYXJkc1wiLCB7XHJcbiAgICAgIGhlYWRlcnM6IHRoaXMuaGVhZGVyc1xyXG4gICAgfSlcclxuICAgIC50aGVuKChyZXMpID0+IHtcclxuICAgICAgaWYgKHJlcy5vaykge1xyXG4gICAgICAgIHJldHVybiByZXMuanNvbigpO1xyXG4gICAgICB9IFxyXG4gICAgICBlbHNlIHtcclxuICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoYEVycm9yOiAke3Jlcy5zdGF0dXN9YCk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLy8gLS0tIEdFVCBodHRwczovL2Fyb3VuZC5ub21vcmVwYXJ0aWVzLmNvL3YxL2dyb3VwLTQyL3VzZXJzL21lIC0tLSAvL1xyXG4gIGdldFVzZXJJbmZvKCkge1xyXG4gICAgcmV0dXJuIGZldGNoKHRoaXMuYmFzZVVybCArIFwiL3VzZXJzL21lXCIsIHtcclxuICAgICAgaGVhZGVyczogdGhpcy5oZWFkZXJzXHJcbiAgICB9KVxyXG4gICAgLnRoZW4oKHJlcykgPT4ge1xyXG4gICAgICBpZiAocmVzLm9rKSB7XHJcbiAgICAgICAgcmV0dXJuIHJlcy5qc29uKCk7XHJcbiAgICAgIH0gXHJcbiAgICAgIGVsc2Uge1xyXG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChgRXJyb3I6ICR7cmVzLnN0YXR1c31gKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvLyAtLS0gUE9TVCBodHRwczovL2Fyb3VuZC5ub21vcmVwYXJ0aWVzLmNvL3YxL2dyb3VwLTQyL2NhcmRzIC0tLSAvL1xyXG4gIGFkZENhcmQoeyBuYW1lLCBsaW5rIH0pIHtcclxuICAgIHJldHVybiBmZXRjaCh0aGlzLmJhc2VVcmwgKyBcIi9jYXJkc1wiLCB7XHJcbiAgICAgIGhlYWRlcnM6IHRoaXMuaGVhZGVycyxcclxuICAgICAgbWV0aG9kOiBcIlBPU1RcIixcclxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe25hbWUsbGlua30pXHJcbiAgICB9KVxyXG4gICAgLnRoZW4oKHJlcykgPT4ge1xyXG4gICAgICBpZiAocmVzLm9rKSB7XHJcbiAgICAgICAgcmV0dXJuIHJlcy5qc29uKCk7XHJcbiAgICAgIH0gXHJcbiAgICAgIGVsc2Uge1xyXG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChgRXJyb3I6ICR7cmVzLnN0YXR1c31gKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvLyAtLS0gREVMRVRFIGh0dHBzOi8vYXJvdW5kLm5vbW9yZXBhcnRpZXMuY28vdjEvZ3JvdXAtNDIvY2FyZHMvY2FyZElEIC0tLSAvL1xyXG4gIHJlbW92ZUNhcmQoY2FyZElEKSB7XHJcbiAgICByZXR1cm4gZmV0Y2godGhpcy5iYXNlVXJsICsgXCIvY2FyZHMvXCIgKyBjYXJkSUQsIHtcclxuICAgICAgaGVhZGVyczogdGhpcy5oZWFkZXJzLFxyXG4gICAgICBtZXRob2Q6IFwiREVMRVRFXCJcclxuICAgIH0pXHJcbiAgICAudGhlbigocmVzKSA9PiB7XHJcbiAgICAgIGlmIChyZXMub2spIHtcclxuICAgICAgICByZXR1cm4gcmVzLmpzb24oKTtcclxuICAgICAgfSBcclxuICAgICAgZWxzZSB7XHJcbiAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGBFcnJvcjogJHtyZXMuc3RhdHVzfWApO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIGdldEFwcEluZm8oKSB7XHJcbiAgICByZXR1cm4gUHJvbWlzZS5hbGwoW3RoaXMuZ2V0SW5pdGlhbENhcmRzKCksIHRoaXMuZ2V0VXNlckluZm8oKV0pO1xyXG4gIH1cclxuXHJcbi8vIC0tLSBBZGQvcmVtb3ZlIGxpa2VzIC0tLSAvL1xyXG4gIC8vIC0tLSBQVVQgaHR0cHM6Ly9hcm91bmQubm9tb3JlcGFydGllcy5jby92MS9ncm91cElkL2NhcmRzL2xpa2VzL2NhcmRJZCAtLS0gLy9cclxuICBhZGRMaWtlKGNhcmQpIHtcclxuICAgIHJldHVybiBmZXRjaCh0aGlzLmJhc2VVcmwgKyBcIi9jYXJkcy9saWtlcy9cIiArIGNhcmQuZ2V0SWQoKSwge1xyXG4gICAgICBoZWFkZXJzOiB0aGlzLmhlYWRlcnMsXHJcbiAgICAgIG1ldGhvZDogXCJQVVRcIlxyXG4gICAgfSlcclxuICAgIC50aGVuKChyZXMpID0+IHtcclxuICAgICAgaWYgKHJlcy5vaykge1xyXG4gICAgICAgIHJldHVybiByZXMuanNvbigpO1xyXG4gICAgICB9IFxyXG4gICAgICBlbHNlIHtcclxuICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoYEVycm9yOiAke3Jlcy5zdGF0dXN9YCk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLy8gLS0tIERFTEVURSBodHRwczovL2Fyb3VuZC5ub21vcmVwYXJ0aWVzLmNvL3YxL2dyb3VwSWQvY2FyZHMvbGlrZXMvY2FyZElkIC0tLSAvL1xyXG4gIHJlbW92ZUxpa2UoY2FyZCkge1xyXG4gICAgcmV0dXJuIGZldGNoKHRoaXMuYmFzZVVybCArIFwiL2NhcmRzL2xpa2VzL1wiICsgY2FyZC5nZXRJZCgpLCB7XHJcbiAgICAgIGhlYWRlcnM6IHRoaXMuaGVhZGVycyxcclxuICAgICAgbWV0aG9kOiBcIkRFTEVURVwiXHJcbiAgICB9KVxyXG4gICAgLnRoZW4oKHJlcykgPT4ge1xyXG4gICAgICBpZiAocmVzLm9rKSB7XHJcbiAgICAgICAgcmV0dXJuIHJlcy5qc29uKCk7XHJcbiAgICAgIH0gXHJcbiAgICAgIGVsc2Uge1xyXG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChgRXJyb3I6ICR7cmVzLnN0YXR1c31gKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuLy8gLS0tIEVkaXRpbmcgUHJvZmlsZSBpbmZvIC0tLSAvL1xyXG4gIC8vIC0tLSBQQVRDSCBodHRwczovL2Fyb3VuZC5ub21vcmVwYXJ0aWVzLmNvL3YxL2dyb3VwSWQvdXNlcnMvbWUgLS0tIC8vXHJcbiAgdXBkYXRlVXNlckluZm8oeyBuYW1lLCBhYm91dCB9KSB7XHJcbiAgICByZXR1cm4gZmV0Y2godGhpcy5iYXNlVXJsICsgXCIvdXNlcnMvbWVcIiwge1xyXG4gICAgICBoZWFkZXJzOiB0aGlzLmhlYWRlcnMsXHJcbiAgICAgIG1ldGhvZDogXCJQQVRDSFwiLFxyXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7bmFtZSxhYm91dH0pXHJcbiAgICB9KVxyXG4gICAgLnRoZW4oKHJlcykgPT4ge1xyXG4gICAgICBpZiAocmVzLm9rKSB7XHJcbiAgICAgICAgcmV0dXJuIHJlcy5qc29uKCk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGBFcnJvcjogJHtyZXMuc3RhdHVzfWApO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8vIFBBVENIIGh0dHBzOi8vYXJvdW5kLm5vbW9yZXBhcnRpZXMuY28vdjEvZ3JvdXBJZC91c2Vycy9tZS9hdmF0YXJcclxuICBzZXRVc2VyQXZhdGFyKHsgYXZhdGFyIH0pIHtcclxuICAgIHJldHVybiBmZXRjaCh0aGlzLmJhc2VVcmwgKyBcIi91c2Vycy9tZS9hdmF0YXJcIiwge1xyXG4gICAgICBoZWFkZXJzOiB0aGlzLmhlYWRlcnMsXHJcbiAgICAgIG1ldGhvZDogXCJQQVRDSFwiLFxyXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7YXZhdGFyfSlcclxuICAgIH0pXHJcbiAgICAudGhlbigocmVzKSA9PiB7XHJcbiAgICAgIGlmIChyZXMub2spIHtcclxuICAgICAgICByZXR1cm4gcmVzLmpzb24oKTtcclxuICAgICAgfSBcclxuICAgICAgZWxzZSB7XHJcbiAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGBFcnJvcjogJHtyZXMuc3RhdHVzfWApO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcbn0iLCJpbXBvcnQgTW9kYWwgZnJvbSBcIi4vTW9kYWwuanNcIjtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIE1vZGFsV2l0aEltYWdlIGV4dGVuZHMgTW9kYWwge1xyXG4gIC8vIC0tLSBPcGVuIGJpZyBpbWFnZSBtb2RhbCBtZXRob2QgLS0tIC8vXHJcbiAgb3BlbnVwID0gKGV2ZW50KSA9PiB7XHJcbiAgICBjb25zdCBiaWdJbWFnZSA9IGV2ZW50LnRhcmdldDtcclxuICAgIHRoaXMuX21vZGFsRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19iaWctaW1hZ2VcIikuc3JjID0gYmlnSW1hZ2Uuc3JjO1xyXG4gICAgdGhpcy5fbW9kYWxFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2JpZy1pbWFnZVwiKS5hbHQgPSBiaWdJbWFnZS5hbHQ7XHJcbiAgICB0aGlzLl9tb2RhbEVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9faW1hZ2UtY2FwdGlvblwiKS50ZXh0Q29udGVudCA9IGJpZ0ltYWdlLmFsdDtcclxuXHJcbiAgICB0aGlzLm9wZW4oKTtcclxuICB9XHJcbn0iLCJleHBvcnQgZGVmYXVsdCBjbGFzcyBVc2VySW5mbyB7XHJcbiAgY29uc3RydWN0b3IoIHtuYW1lLCBqb2IsIGF2YXRhcn0gKSB7XHJcbiAgICB0aGlzLl9uYW1lID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgJHtuYW1lfWApO1xyXG4gICAgdGhpcy5fam9iID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgJHtqb2J9YCk7XHJcbiAgICB0aGlzLl9hdmF0YXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGAke2F2YXRhcn1gKTtcclxuICB9XHJcblxyXG4gIGdldFVzZXJJbmZvKCkge1xyXG4gICAgcmV0dXJuIHtcclxuICAgIG5hbWUgOiB0aGlzLl9uYW1lLnRleHRDb250ZW50LFxyXG4gICAgam9iIDogdGhpcy5fam9iLnRleHRDb250ZW50LFxyXG4gICAgYXZhdGFyOiB0aGlzLl9hdmF0YXIuc3JjXHJcbiAgICB9O1xyXG4gIH1cclxuXHJcbiAgc2V0VXNlckluZm8odXNlckluZm8pIHtcclxuICAgIGNvbnN0IHsgbmFtZSwgam9iIH0gPSB1c2VySW5mbztcclxuICAgIHRoaXMuX25hbWUudGV4dENvbnRlbnQgPSBuYW1lO1xyXG4gICAgdGhpcy5fam9iLnRleHRDb250ZW50ID0gam9iO1xyXG4gIH1cclxuXHJcbiAgc2V0VXNlckF2YXRhcigge2F2YXRhcn0gKSB7XHJcbiAgICB0aGlzLl9hdmF0YXIuc3JjID0gYXZhdGFyO1xyXG4gIH1cclxufVxyXG4iXSwibmFtZXMiOlsiQ2FyZCIsImNvbnN0cnVjdG9yIiwiY2FyZERhdGEiLCJpc0xpa2VkIiwiaXNPd25lciIsIm9uQ2FyZENsaWNrIiwicmVtb3ZlSGFuZGxlciIsImxpa2VIYW5kbGVyIiwiY2FyZFNlbGVjdG9yIiwidGhpcyIsIl9uYW1lIiwibmFtZSIsIl9saW5rIiwibGluayIsIl9pZCIsIl9vd25lcklkIiwib3duZXIiLCJfbGlrZXMiLCJsaWtlcyIsIl9saWtlc0NvdW50IiwibGVuZ3RoIiwiX2NhcmRTZWxlY3RvciIsIl9vbkNhcmRDbGljayIsImJpbmQiLCJfbGlrZUhhbmRsZXIiLCJfY2xpY2tMaWtlSGFuZGxlciIsIl9yZW1vdmVIYW5kbGVyIiwiX2lzTGlrZWQiLCJfaXNPd25lciIsIl9nZXRUZW1wbGF0ZSIsImRvY3VtZW50IiwicXVlcnlTZWxlY3RvciIsImNvbnRlbnQiLCJjbG9uZU5vZGUiLCJsaWtlc0Ftb3VudFNldCIsImxpa2VzQ291bnQiLCJfaXRlbSIsInRleHRDb250ZW50IiwiX2xpa2VDYXJkIiwiZXZlbnQiLCJjbGFzc0xpc3QiLCJ0b2dnbGUiLCJzdG9wSW1tZWRpYXRlUHJvcG9nYXRpb24iLCJkZWxldGVDYXJkIiwicmVtb3ZlIiwiX2RlbGV0ZUNhcmRIYW5kbGVyIiwic3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uIiwiX3NldEV2ZW50TGlzdGVuZXJzIiwiYWRkRXZlbnRMaXN0ZW5lciIsIl9jYXJkSW1hZ2UiLCJnZW5lcmF0ZUNhcmQiLCJfZWxlbWVudCIsImFkZCIsInNyYyIsImFsdCIsImdldElEIiwiRm9ybVZhbGlkYXRvciIsImZvcm1Db25maWciLCJmb3JtRWxlbWVudCIsIl9mb3JtQ29uZmlnIiwiX2Zvcm1FbGVtZW50IiwiX3Nob3dJbnB1dEVycm9yIiwiaW5wdXRFbGVtZW50IiwiZXJyb3JNZXNzYWdlIiwiaW5wdXRFcnJvckNsYXNzIiwiZXJyb3JNZXNzYWdlQ2xhc3MiLCJlcnJvckVsZW1lbnQiLCJpZCIsIl9oaWRlSW5wdXRFcnJvciIsInJlc2V0VmFsaWRhdGlvbiIsImlucHV0cyIsImZvckVhY2giLCJpbnB1dCIsIl90b2dnbGVTdWJtaXRCdXR0b24iLCJfY2hlY2tJbnB1dCIsInZhbGlkaXR5IiwidmFsaWQiLCJ2YWxpZGF0aW9uTWVzc2FnZSIsIl9jaGVja0lmRm9ybVZhbGlkIiwiZXZlcnkiLCJpbmFjdGl2ZUJ1dHRvbkNsYXNzIiwic3VibWl0QnV0dG9uU2VsZWN0b3IiLCJidXR0b25FbGVtZW50IiwiZGlzYWJsZWQiLCJpbnB1dFNlbGVjdG9yIiwiQXJyYXkiLCJmcm9tIiwicXVlcnlTZWxlY3RvckFsbCIsImVuYWJsZVZhbGlkYXRpb24iLCJwcmV2ZW50RGVmYXVsdCIsIlNlY3Rpb24iLCJpdGVtcyIsInJlbmRlcmVyIiwiY29udGFpbmVyU2VsZWN0b3IiLCJfaXRlbXMiLCJfcmVuZGVyZXIiLCJfY29udGFpbmVyIiwiYWRkSXRlbSIsImVsZW1lbnQiLCJhcHBlbmQiLCJwcmVwZW5kSXRlbSIsInByZXBlbmQiLCJyZW5kZXJJdGVtcyIsImNhcmQiLCJlZGl0QnV0dG9uIiwicHJvZmlsZU1vZGFsIiwiZm9ybXMiLCJwcm9maWxlIiwiYWRkQ2FyZEJ1dHRvbiIsImVsZW1lbnRzIiwiam9iIiwiYWRkQ2FyZE1vZGFsIiwiYWRkQ2FyZEZvcm0iLCJ0aXRsZSIsImZvcm1TZWxlY3RvciIsIk1vZGFsIiwibW9kYWxTZWxlY3RvciIsIl9tb2RhbEVsZW1lbnQiLCJfY2hlY2tGb3JFc2NDbG9zZSIsImtleSIsImNsb3NlIiwib3BlbiIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJzZXRFdmVudExpc3RlbmVycyIsInRhcmdldCIsImNvbnRhaW5zIiwiTW9kYWxXaXRoRm9ybSIsImhhbmRsZVN1Ym1pdCIsInN1cGVyIiwiX2hhbmRsZVN1Ym1pdEJ0biIsImdldElucHV0VmFsdWVzIiwiaW5wdXRMaXN0IiwiaW5wdXRWYWx1ZXMiLCJ2YWx1ZSIsInNldElucHV0VmFsdWVzIiwidmFsdWVzIiwicmVzZXQiLCJNb2RhbERlbGV0ZUNvbmZpcm1hdGlvbiIsInNlbGVjdG9yIiwiX2Zvcm0iLCJfc2VsZWN0b3IiLCJfaGFuZGxlU3VibWl0IiwiX2hhbmRsZVN1Ym1pdEhhbmRsZXIiLCJfcmVtb3ZlRXZlbnRMaXN0ZW5lcnMiLCJhcGkiLCJiYXNlVXJsIiwiaGVhZGVycyIsImdldEluaXRpYWxDYXJkcyIsImZldGNoIiwidGhlbiIsInJlcyIsIm9rIiwianNvbiIsIlByb21pc2UiLCJyZWplY3QiLCJzdGF0dXMiLCJnZXRVc2VySW5mbyIsImFkZENhcmQiLCJtZXRob2QiLCJib2R5IiwiSlNPTiIsInN0cmluZ2lmeSIsInJlbW92ZUNhcmQiLCJjYXJkSUQiLCJnZXRBcHBJbmZvIiwiYWxsIiwiYWRkTGlrZSIsImdldElkIiwicmVtb3ZlTGlrZSIsInVwZGF0ZVVzZXJJbmZvIiwiYWJvdXQiLCJzZXRVc2VyQXZhdGFyIiwiYXZhdGFyIiwiYXV0aG9yaXphdGlvbiIsInJlbmRlckNhcmQiLCJpbml0Q2FyZCIsInVzZXIiLCJsaXN0TGlrZXMiLCJ1bmRlZmluZWQiLCJmaW5kIiwiaXRlbSIsImNhcmRJbmZvIiwiYmlnSW1hZ2VNb2RhbCIsImRlbGV0ZUNhcmRIYW5kbGVyIiwiZGVsZXRlQ29uZmlybSIsImNhdGNoIiwiZXJyIiwiY29uc29sZSIsImxvZyIsImZpbmFsbHkiLCJzZXRMaWtlcyIsImluaXRpYWxDYXJkcyIsInVzZXJJbmZvIiwiY2FyZHNTZWN0aW9uIiwiZGF0YSIsImluaXRpYWxDYXJkIiwic2V0SXRlbXMiLCJzZXRVc2VySW5mbyIsIm1vZGFsQWRkQ2FyZCIsIm5ld0NhcmQiLCJhZGRDYXJkRm9ybVZhbGlkYXRpb24iLCJvcGVudXAiLCJiaWdJbWFnZSIsInVzZXJJbmZvVmFsdWVzIiwiX2pvYiIsIl9hdmF0YXIiLCJlZGl0UHJvZmlsZUZvcm0iLCJwcm9maWxlRm9ybVZhbGlkYXRpb24iLCJjcmVhdGVDYXJkIl0sInNvdXJjZVJvb3QiOiIifQ==