!function(){"use strict";class e{constructor(e,t){this._formConfig=e,this._formElement=t,this.inputs=Array.from(this._formElement.querySelectorAll(this._formConfig.inputSelector)),this._buttonElement=this._formElement.querySelector(this._formConfig.submitButtonSelector)}_showInputError=(e,t)=>{const{inputErrorClass:s,errorMessageClass:r}=this._formConfig,n=this._formElement.querySelector(` #${e.id}_error `);n.textContent=t,n.classList.add(r),e.classList.add(s)};_hideInputError=e=>{const{inputErrorClass:t,errorMessageClass:s}=this._formConfig,r=this._formElement.querySelector(` #${e.id}_error `);r.textContent="",r.classList.remove(s),e.classList.remove(t)};_checkInput=e=>{e.validity.valid?this._hideInputError(e):this._showInputError(e,e.validationMessage)};_checkIValid=()=>this.inputs.every((e=>e.validity.valid));_toggleSubmitButton(){this._checkIValid()?(this._buttonElement.disabled=!1,this._buttonElement.classList.remove(this._formConfig.inactiveButtonClass)):(this._buttonElement.disabled=!0,this._buttonElement.classList.add(this._formConfig.inactiveButtonClass))}_setEventListeners=()=>(this.inputs.forEach((e=>{e.addEventListener("input",(()=>{this._checkInput(e),this._toggleSubmitButton()}))})),this._formElement);enableValidation(){this._formElement.addEventListener("submit",(e=>{e.preventDefault()})),this._setEventListeners()}}class t{constructor(e,t,s,r,n,i){this._name=e.name,this._link=e.link,this._ownerId=e.owner._id,this._cardId=e._id,this._likes=e.likes,this._userId=i,this._template=n,this._onCardClick=t,this._likeClickHandler=r,this._removeHandler=s}_getTemplate(){return this._template.content.querySelector(".card").cloneNode(!0)}_setAttributes(e,t){for(const s in t)e.setAttribute(s,t[s])}deleteCard(){this._userId===this._ownerId&&(this._card.remove(),this._card=null)}_handelLike(e){e.classList.toggle("card__like-button_active")}_likeStatus(){const e=this._cardElement.querySelector(".card__like-button");Array.from(this._likes).forEach((t=>{t._id===this._userId&&e.classList.add("card__like-button_active")}))}_setEventListeners(){this._cardElement.querySelector(".card__like-button").addEventListener("click",(()=>{this._likeClickHandler(this)})),this._cardElement.querySelector(".card__delete-button").addEventListener("click",(()=>{this._removeHandler(this)})),this._cardElement.querySelector(".card__image").addEventListener("click",(()=>{this._onCardClick(this._name,this._link)}))}getCardId(){return this._cardId}generateCard(e){return this._cardElement=this._getTemplate(),this._setEventListeners(),this._card=this._cardElement,this._setAttributes(this._cardElement.querySelector(".card__image"),{src:this._link,alt:this._name}),this._cardElement.querySelector(".card__title").textContent=this._name,this._ownerId!==e&&this._cardElement.querySelector(".card__delete-button").remove(),this._likeStatus(),this._cardElement.querySelector(".card__like-count").textContent=this._likes.length,this._cardElement}checkIfLiked(e){return this._likes.find((t=>t._id===e))?this._liked=!0:this._liked=!1,this._liked}_cardLiked(){this._cardElement.querySelector(".card__like-button").classList.add("card__like-button_active")}_cardUnliked(){this._cardElement.querySelector(".card__like-button").classList.remove("card__like-button_active")}refreshCard(e,t){this._likes=e.likes,this.checkIfLiked(t)?this._cardLiked():this._cardUnliked(),this._cardElement.querySelector(".card__like-count").textContent=this._likes.length}}class s{constructor(e,t){this._modalElement=document.querySelector(e),this._escapeKeyHandler=this._escapeKeyHandler.bind(this),this._checkKeyPress=t}open(){this._modalElement.classList.add("modal_visible"),document.addEventListener("keyup",this._escapeKeyHandler)}close(){this._modalElement.classList.remove("modal_visible"),document.removeEventListener("keyup",this._escapeKeyHandler)}_escapeKeyHandler(e){this._checkKeyPress(e.key)&&this.close()}setEventListeners(){this._modalElement.addEventListener("click",(e=>{e.target.classList.contains("modal__close-button")&&this.close(),e.target.classList.contains("modal_visible")&&this.close()}))}}class r extends s{constructor(e,t,s){super(e,t),this._handleSubmit=s,this._submitButton=this._modalElement.querySelector(".modal__submit-button"),this._form=document.querySelector(".modal__container"),this._textInButton=this._submitButton.textContent}getInputValues(){this._inputList=this._modalElement.querySelectorAll(".modal__input");const e={};return this._inputList.forEach((t=>{e[t.name]=t.value})),this._entredValue||e}setInputValues(e){this._entredValue=e}setEventListeners(){this._modalElement.addEventListener("submit",(e=>{e.preventDefault(),this._submitButton.textContent="Saving...",this._handleSubmit(this.getInputValues())})),super.setEventListeners()}close(){this._submitButton.textContent=this._textInButton,this._form.reset(),super.close()}}class n{constructor({items:e,renderer:t},s){this._renderedElements=e,this._renderer=t,this._container=document.querySelector(s)}renderItems(){this._renderedElements.forEach((e=>{this._renderer(e)}))}addItem(e){this._container.prepend(e)}}const i=document.querySelector(".profile__edit-button"),a=document.querySelector(".modal_type_edit"),o=document.querySelector(".profile__title"),l=document.querySelector(".modal__input_type_title"),d=document.querySelector(".profile__subtitle"),_=document.querySelector(".modal__input_type_subtitle"),c=(document.querySelector(".modal__close-button_type_edit"),document.querySelector(".profile__image")),h=document.querySelector(".profile__image-overlay"),u=document.querySelector(".modal_type_avatar"),m=u.querySelector(".modal__input_type_avatar"),p=(document.querySelector(".modal__close-button_type_avatar"),document.querySelector(".profile__add-button")),y=document.querySelector(".modal_type_add-card"),b=document.querySelector(".modal__input_type_name"),E=document.querySelector(".modal__input_type_link"),v=(document.querySelector(".modal__close-button_type_add-card"),document.forms.add),k=(v.elements.title,v.elements.link,document.querySelector(".modal__submit-button"),document.querySelector(".cards__grid"),document.querySelector("#card__template")),f=document.querySelector(".modal_type_big-image"),g=f.querySelector(".modal__big-image"),S=f.querySelector(".modal__image-caption"),C=(document.querySelector(".modal__close-button_type_big-image"),document.querySelector(".modal_type_delete-card"),{formSelector:".modal__container",inputSelector:".modal__input",submitButtonSelector:".modal__submit-button",inactiveButtonClass:"modal__submit-button_disabled",inputErrorClass:"modal__input_error",errorMessageClass:"modal__error_visible"}),L=e=>"Escape"===e,I=()=>{b.value="",E.value=""};new e(C,a).enableValidation(),new e(C,u).enableValidation(),new e(C,y).enableValidation();const q=e=>console.log(e),U=new class{constructor(e){this._baseUrl=e.baseUrl,this._headers=e.headers}_response(e){return e.ok?e.json():Promise.reject(`Error: ${e.status} - ${e.statusText}`)}getCardList(){return fetch(`${this._baseUrl}/cards`,{headers:this._headers}).then(this._response)}getUserInfo(){return fetch(`${this._baseUrl}/users/me`,{headers:this._headers}).then(this._response)}setUserInfo(e,t){return fetch(`${this._baseUrl}/users/me`,{headers:this._headers,method:"PATCH",body:JSON.stringify(e,t)}).then(this._response)}addCard(e){return fetch(`${this._baseUrl}/cards`,{headers:this._headers,method:"POST",body:JSON.stringify(e)}).then(this._response)}removeCard(e){return fetch(`${this._baseUrl}/cards/${e}`,{headers:this._headers,method:"DELETE"}).then(this._response)}likeCard(e){return fetch(`${this._baseUrl}/cards/likes/${e}`,{headers:this._headers,method:"PUT"}).then(this._response)}unlikeCard(e){return fetch(`${this._baseUrl}/cards/likes/${e}`,{headers:this._headers,method:"DELETE"}).then(this._response)}setUserAvatar(e){return fetch(`${this._baseUrl}/users/me/avatar`,{headers:this._headers,method:"PATCH",body:JSON.stringify(e)}).then(this._response)}}({baseUrl:"https://around.nomoreparties.co/v1/group-12",headers:{authorization:"709a0d9d-db06-4890-a594-b07e7309a353","Content-Type":"application/json"}}),x=new class{constructor(e,t,s){this._nameElement=e,this._titleElement=t,this._pictureElement=s}getUserInfo(){return{name:this._name.textContent,job:this._job.textContent,avatar:this._avatar,id:this._id}}getUserData(){return this._data}setUserInfo(e,t){this._name=e,this._job=t,this._nameElement.textContent=this._name,this._titleElement.textContent=this._job}setUserAvatar(e){this._avatar=e,this._pictureElement.setAttribute("src",this._avatar)}}(o,d,c);let w;U.getUserInfo().then((e=>(x.setUserInfo(e.name,e.about),c.src=e.avatar,w=e._id,x))).then((()=>{U.getCardList().then((e=>{const s=(e,t)=>{T.open(e,t)},i=e=>{B.setInputValues(e),B.open()},a=e=>{e.checkIfLiked(w)?U.unlikeCard(e.getCardId()).then((t=>{e.refreshCard(t,w)})).catch(q):U.likeCard(e.getCardId()).then((t=>{e.refreshCard(t,w)})).catch(q)},o=e=>new t(e,s,i,a,k,w),l=new n({items:e,renderer:e=>{const t=o(e);l.addItem(t.generateCard(w))}},".cards__grid");l.renderItems();const d=new r(".modal_type_add-card",L,(({titleInput:e,linkInput:t})=>{U.addCard({name:e,link:t}).then((e=>{const t=o(e);l.addItem(t.generateCard(w)),I(),d.close(I)})).catch(q)}));d.setEventListeners(),p.addEventListener("click",(()=>{d.open()}))})).catch(q)})).catch(q);const A=new r(".modal_type_edit",L,(({nameInput:e,jobInput:t})=>{U.setUserInfo({name:e,about:t}).then((()=>{x.setUserInfo(e,t),A.close()})).catch(q)}));A.setEventListeners(),i.addEventListener("click",(()=>{l.value=o.textContent,_.value=d.textContent,A.open()}));const $=new r(".modal_type_avatar",L,(({avatarLinkInput:e})=>{U.setUserAvatar({avatar:e}).then((()=>{x.setUserAvatar(e),$.close()})).catch(q).finally($.close())}));$.setEventListeners(),h.addEventListener("click",(()=>{m.value="",$.open()}));const B=new r(".modal_type_delete-card",L,(e=>{U.removeCard(e.getCardId()).then((()=>{e.deleteCard(),B.close()})).catch(q).finally(B.close())}));B.setEventListeners();const T=new class extends s{constructor(e,t){super(e,t),this._modalImage=document.querySelector(".modal__big-image"),this._modalTitle=document.querySelector(".modal__image-caption")}open(e,t){this._modalTitle.textContent=e,this._modalImage.setAttribute("src",t),super.open()}}(".modal_type_big-image",L,g,S);T.setEventListeners()}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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SWxILEVEcEpPLHFCQ3NKakNrRCxHQUNBLEVBQUdpRSxnQkFBZ0I3QixNQUVqQjlCLEVBQ0c2QixjQUFjLENBQUNDLE9BQUFBLElBQ2ZkLE1BQUssS0FDSmdCLEVBQVFILGNBQWNDLEdBQ3RCNEIsRUFBZ0J2SCxXQUVqQjZHLE1BQU1wRCxHQUNOZ0UsUUFBUUYsRUFBZ0J2SCxZQUcvQnVILEVBQWdCckgsb0JBRWhCcUMsRUFBaUJ2RyxpQkFBaUIsU0FBUyxLQUN6Q3lHLEVBQWlCekIsTUFBUSxHQUN6QnVHLEVBQWdCeEgsVUFJbEIsTUFBTTRHLEVBQWtCLElBQUl0RyxFRHpLTSwwQkMyS2hDa0QsR0FDQ3FELElBQ0MvQyxFQUNHeUIsV0FBV3NCLEVBQUtsSSxhQUNoQm1HLE1BQUssS0FDSitCLEVBQUsxSSxhQUNMeUksRUFBZ0IzRyxXQUVqQjZHLE1BQU1wRCxHQUNOZ0UsUUFBUWQsRUFBZ0IzRyxZQUcvQjJHLEVBQWdCekcsb0JBRWhCLE1BQU1pRCxFQUFnQixJRzlOUCxjQUE2QjVELEVBQzFDN0YsWUFBYWdPLEVBQU9qSSxHQUNsQmUsTUFBT2tILEVBQU9qSSxHQUNkNUYsS0FBSzhOLFlBQWNoSSxTQUFTckYsY0FBYyxxQkFDMUNULEtBQUsrTixZQUFjakksU0FBU3JGLGNBQWMseUJBRzVDeUYsS0FBS25ELEVBQU1FLEdBQ1RqRCxLQUFLK04sWUFBWTdNLFlBQWM2QixFQUMvQi9DLEtBQUs4TixZQUFZMUosYUFBYSxNQUFPbkIsR0FFckMwRCxNQUFNVCxTSjJCc0Isd0JDMEw5QndELEVBQ0FILEVBQ0FDLEdBRUZGLEVBQWNqRCxvQiIsInNvdXJjZXMiOlsid2VicGFjazovL3dlYl9wcm9qZWN0XzQvLi9zcmMvY29tcG9uZW50cy9zY3JpcHRzL0Zvcm1WYWxpZGF0b3IuanMiLCJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfNC8uL3NyYy9jb21wb25lbnRzL3NjcmlwdHMvQ2FyZC5qcyIsIndlYnBhY2s6Ly93ZWJfcHJvamVjdF80Ly4vc3JjL2NvbXBvbmVudHMvc2NyaXB0cy9Nb2RhbC5qcyIsIndlYnBhY2s6Ly93ZWJfcHJvamVjdF80Ly4vc3JjL2NvbXBvbmVudHMvc2NyaXB0cy9Nb2RhbFdpdGhGb3JtLmpzIiwid2VicGFjazovL3dlYl9wcm9qZWN0XzQvLi9zcmMvY29tcG9uZW50cy9zY3JpcHRzL1NlY3Rpb24uanMiLCJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfNC8uL3NyYy9jb21wb25lbnRzL3V0aWxzL2NvbnN0YW50cy5qcyIsIndlYnBhY2s6Ly93ZWJfcHJvamVjdF80Ly4vc3JjL3BhZ2VzL0luZGV4LmpzIiwid2VicGFjazovL3dlYl9wcm9qZWN0XzQvLi9zcmMvY29tcG9uZW50cy9zY3JpcHRzL0FwaS5qcyIsIndlYnBhY2s6Ly93ZWJfcHJvamVjdF80Ly4vc3JjL2NvbXBvbmVudHMvc2NyaXB0cy9Vc2VySW5mby5qcyIsIndlYnBhY2s6Ly93ZWJfcHJvamVjdF80Ly4vc3JjL2NvbXBvbmVudHMvc2NyaXB0cy9Nb2RhbFdpdGhJbWFnZS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnQgZGVmYXVsdCBjbGFzcyBGb3JtVmFsaWRhdG9yIHtcclxuICBjb25zdHJ1Y3Rvcihmb3JtQ29uZmlnLCBmb3JtRWxlbWVudCkge1xyXG4gICAgdGhpcy5fZm9ybUNvbmZpZyA9IGZvcm1Db25maWc7XHJcbiAgICB0aGlzLl9mb3JtRWxlbWVudCA9IGZvcm1FbGVtZW50O1xyXG4gICAgdGhpcy5pbnB1dHMgPSBBcnJheS5mcm9tKHRoaXMuX2Zvcm1FbGVtZW50LnF1ZXJ5U2VsZWN0b3JBbGwodGhpcy5fZm9ybUNvbmZpZy5pbnB1dFNlbGVjdG9yKSk7XHJcbiAgICB0aGlzLl9idXR0b25FbGVtZW50ID0gdGhpcy5fZm9ybUVsZW1lbnQucXVlcnlTZWxlY3Rvcih0aGlzLl9mb3JtQ29uZmlnLnN1Ym1pdEJ1dHRvblNlbGVjdG9yKTtcclxuICB9XHJcblxyXG4gIF9zaG93SW5wdXRFcnJvciA9IChpbnB1dEVsZW1lbnQsIGVycm9yTWVzc2FnZSkgPT4ge1xyXG4gICAgY29uc3QgeyBpbnB1dEVycm9yQ2xhc3MsIGVycm9yTWVzc2FnZUNsYXNzIH0gPSB0aGlzLl9mb3JtQ29uZmlnO1xyXG4gICAgY29uc3QgZXJyb3JFbGVtZW50ID0gdGhpcy5fZm9ybUVsZW1lbnQucXVlcnlTZWxlY3RvcihgICMke2lucHV0RWxlbWVudC5pZH1fZXJyb3IgYCk7XHJcbiAgICBlcnJvckVsZW1lbnQudGV4dENvbnRlbnQgPSBlcnJvck1lc3NhZ2U7XHJcbiAgICBlcnJvckVsZW1lbnQuY2xhc3NMaXN0LmFkZChlcnJvck1lc3NhZ2VDbGFzcyk7XHJcbiAgICBpbnB1dEVsZW1lbnQuY2xhc3NMaXN0LmFkZChpbnB1dEVycm9yQ2xhc3MpO1xyXG4gIH07XHJcbiAgXHJcbiAgX2hpZGVJbnB1dEVycm9yID0gKGlucHV0RWxlbWVudCkgPT4ge1xyXG4gICAgY29uc3QgeyBpbnB1dEVycm9yQ2xhc3MsIGVycm9yTWVzc2FnZUNsYXNzIH0gPSB0aGlzLl9mb3JtQ29uZmlnO1xyXG4gICAgY29uc3QgZXJyb3JFbGVtZW50ID0gdGhpcy5fZm9ybUVsZW1lbnQucXVlcnlTZWxlY3RvcihgICMke2lucHV0RWxlbWVudC5pZH1fZXJyb3IgYCk7XHJcbiAgICBlcnJvckVsZW1lbnQudGV4dENvbnRlbnQgPSBcIlwiO1xyXG4gICAgZXJyb3JFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoZXJyb3JNZXNzYWdlQ2xhc3MpO1xyXG4gICAgaW5wdXRFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoaW5wdXRFcnJvckNsYXNzKTtcclxuICB9O1xyXG5cclxuICBfY2hlY2tJbnB1dCA9IChpbnB1dEVsZW1lbnQpID0+IHtcclxuICAgIGlmICghaW5wdXRFbGVtZW50LnZhbGlkaXR5LnZhbGlkKSB7XHJcbiAgICAgIHRoaXMuX3Nob3dJbnB1dEVycm9yKGlucHV0RWxlbWVudCwgaW5wdXRFbGVtZW50LnZhbGlkYXRpb25NZXNzYWdlKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRoaXMuX2hpZGVJbnB1dEVycm9yKGlucHV0RWxlbWVudCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBfY2hlY2tJVmFsaWQgPSAoKSA9PiB0aGlzLmlucHV0cy5ldmVyeSgoaW5wdXQpID0+IGlucHV0LnZhbGlkaXR5LnZhbGlkKTtcclxuXHJcbiAgX3RvZ2dsZVN1Ym1pdEJ1dHRvbigpIHtcclxuICAgIGlmICh0aGlzLl9jaGVja0lWYWxpZCgpKSB7XHJcbiAgICAgIHRoaXMuX2J1dHRvbkVsZW1lbnQuZGlzYWJsZWQgPSBmYWxzZTtcclxuICAgICAgdGhpcy5fYnV0dG9uRWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKHRoaXMuX2Zvcm1Db25maWcuaW5hY3RpdmVCdXR0b25DbGFzcyk7XHJcbiAgICB9IFxyXG4gICAgZWxzZSB7XHJcbiAgICAgIHRoaXMuX2J1dHRvbkVsZW1lbnQuZGlzYWJsZWQgPSB0cnVlO1xyXG4gICAgICB0aGlzLl9idXR0b25FbGVtZW50LmNsYXNzTGlzdC5hZGQodGhpcy5fZm9ybUNvbmZpZy5pbmFjdGl2ZUJ1dHRvbkNsYXNzKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIF9zZXRFdmVudExpc3RlbmVycyA9ICgpID0+IHtcclxuICAgIHRoaXMuaW5wdXRzLmZvckVhY2goKGlucHV0KSA9PiB7XHJcbiAgICAgIGlucHV0LmFkZEV2ZW50TGlzdGVuZXIoXCJpbnB1dFwiLCAoKSA9PiB7XHJcbiAgICAgICAgdGhpcy5fY2hlY2tJbnB1dChpbnB1dCk7XHJcbiAgICAgICAgdGhpcy5fdG9nZ2xlU3VibWl0QnV0dG9uKCk7XHJcbiAgICAgIH0pO1xyXG4gICAgfSk7XHJcbiAgICByZXR1cm4gdGhpcy5fZm9ybUVsZW1lbnQ7XHJcbiAgfTtcclxuXHJcbiAgZW5hYmxlVmFsaWRhdGlvbigpIHtcclxuICAgIHRoaXMuX2Zvcm1FbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgKGV2ZW50KSA9PiB7XHJcbiAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICB9KTtcclxuICAgIHRoaXMuX3NldEV2ZW50TGlzdGVuZXJzKCk7XHJcbiAgfVxyXG59IiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgQ2FyZCB7XHJcbiAgY29uc3RydWN0b3IoIFxyXG4gICAgZGF0YSwgXHJcbiAgICBvbkNhcmRDbGljaywgXHJcbiAgICByZW1vdmVIYW5kbGVyLCBcclxuICAgIGxpa2VDbGlja0hhbmRsZXIsXHJcbiAgICB0ZW1wbGF0ZSwgXHJcbiAgICB1c2VySWQgKSBcclxuICB7XHJcbiAgICB0aGlzLl9uYW1lID0gZGF0YS5uYW1lO1xyXG4gICAgdGhpcy5fbGluayA9IGRhdGEubGluaztcclxuICAgIHRoaXMuX293bmVySWQgPSBkYXRhLm93bmVyLl9pZDtcclxuICAgIHRoaXMuX2NhcmRJZCA9IGRhdGEuX2lkO1xyXG4gICAgdGhpcy5fbGlrZXMgPSBkYXRhLmxpa2VzO1xyXG4gICAgdGhpcy5fdXNlcklkID0gdXNlcklkO1xyXG5cclxuICAgIHRoaXMuX3RlbXBsYXRlID0gdGVtcGxhdGU7XHJcbiAgICB0aGlzLl9vbkNhcmRDbGljayA9IG9uQ2FyZENsaWNrO1xyXG4gICAgdGhpcy5fbGlrZUNsaWNrSGFuZGxlciA9IGxpa2VDbGlja0hhbmRsZXI7XHJcbiAgICB0aGlzLl9yZW1vdmVIYW5kbGVyID0gcmVtb3ZlSGFuZGxlcjtcclxuICB9XHJcbiAgLy8gLS0tIEdldCBjYXJkIHRlbXBsYXRlIC0tLSAvL1xyXG4gIF9nZXRUZW1wbGF0ZSgpIHtcclxuICAgIGNvbnN0IGNhcmRFbGVtZW50ID0gdGhpcy5fdGVtcGxhdGVcclxuICAgIC5jb250ZW50XHJcbiAgICAucXVlcnlTZWxlY3RvcignLmNhcmQnKVxyXG4gICAgLmNsb25lTm9kZSh0cnVlKTtcclxuXHJcbiAgICByZXR1cm4gY2FyZEVsZW1lbnQ7XHJcbiAgfVxyXG5cclxuICBfc2V0QXR0cmlidXRlcyhjYXJkRWxlbWVudCwgYXR0cmlicykge1xyXG4gICAgZm9yIChjb25zdCBrZXkgaW4gYXR0cmlicykge1xyXG4gICAgICBjYXJkRWxlbWVudC5zZXRBdHRyaWJ1dGUoa2V5LCBhdHRyaWJzW2tleV0pO1xyXG4gICAgfVxyXG4gIH1cclxuICAvLyAtLS0gQ2FyZCBkZWxldGluZyBtZXRob2QgLS0tIC8vXHJcbiAgZGVsZXRlQ2FyZCgpIHtcclxuICAgIGlmKHRoaXMuX3VzZXJJZCA9PT0gdGhpcy5fb3duZXJJZCl7XHJcbiAgICAgIHRoaXMuX2NhcmQucmVtb3ZlKCk7XHJcbiAgICAgIHRoaXMuX2NhcmQgPSBudWxsO1xyXG4gICAgfVxyXG4gIH1cclxuICAvLyAtLS0gTGlrZSBoYW5kbGVyIC0tLSAvL1xyXG4gIF9oYW5kZWxMaWtlKGxpa2VCdG4pIHtcclxuICAgIGxpa2VCdG4uY2xhc3NMaXN0LnRvZ2dsZSgnY2FyZF9fbGlrZS1idXR0b25fYWN0aXZlJylcclxuICB9XHJcbiAgLy8gLS0tIENoZWNrIGZvciBhbGwgY2FyZHMgaWYgbGlrZWQgb3Igbm90IC0tLSAvL1xyXG4gIF9saWtlU3RhdHVzKCkge1xyXG4gICAgY29uc3QgbGlrZUJ0biA9IHRoaXMuX2NhcmRFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJy5jYXJkX19saWtlLWJ1dHRvbicpO1xyXG4gICAgY29uc3QgbGlrZXMgPSBBcnJheS5mcm9tKHRoaXMuX2xpa2VzKTtcclxuICAgIGxpa2VzLmZvckVhY2goKGVsZW1lbnQpID0+IHtcclxuICAgICAgaWYoZWxlbWVudC5faWQgPT09IHRoaXMuX3VzZXJJZCl7XHJcbiAgICAgICAgbGlrZUJ0bi5jbGFzc0xpc3QuYWRkKFwiY2FyZF9fbGlrZS1idXR0b25fYWN0aXZlXCIpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcbiAgLy8gLS0tIFNldCBldmVudHMgbGlzdGVuZXJzIGZvciB0aGUgY2FyZHMgdGhhdCB3aWxsIGJlIGNyZWF0ZWQhIC0tLSAvL1xyXG4gIF9zZXRFdmVudExpc3RlbmVycygpIHtcclxuICAgIHRoaXMuX2NhcmRFbGVtZW50XHJcbiAgICAgIC5xdWVyeVNlbGVjdG9yKCcuY2FyZF9fbGlrZS1idXR0b24nKVxyXG4gICAgICAuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcclxuICAgICAgICB0aGlzLl9saWtlQ2xpY2tIYW5kbGVyKHRoaXMpO1xyXG4gICAgICB9KTtcclxuXHJcbiAgICB0aGlzLl9jYXJkRWxlbWVudFxyXG4gICAgICAucXVlcnlTZWxlY3RvcignLmNhcmRfX2RlbGV0ZS1idXR0b24nKVxyXG4gICAgICAuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcclxuICAgICAgICB0aGlzLl9yZW1vdmVIYW5kbGVyKHRoaXMpO1xyXG4gICAgICB9KTtcclxuXHJcbiAgICB0aGlzLl9jYXJkRWxlbWVudFxyXG4gICAgICAucXVlcnlTZWxlY3RvcignLmNhcmRfX2ltYWdlJylcclxuICAgICAgLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XHJcbiAgICAgICAgdGhpcy5fb25DYXJkQ2xpY2sodGhpcy5fbmFtZSwgdGhpcy5fbGluayk7XHJcbiAgICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgZ2V0Q2FyZElkKCkge1xyXG4gICAgcmV0dXJuIHRoaXMuX2NhcmRJZDtcclxuICB9XHJcblxyXG4gIC8vIC0tLSBDcmVhdGluZyB0aGUgY2FyZCBhbmQgY2FyZCBlbGVtZW50cyAtLS0gLy9cclxuICBnZW5lcmF0ZUNhcmQodXNlcklkKSB7XHJcbiAgICB0aGlzLl9jYXJkRWxlbWVudCA9IHRoaXMuX2dldFRlbXBsYXRlKCk7XHJcbiAgICB0aGlzLl9zZXRFdmVudExpc3RlbmVycygpO1xyXG4gICAgdGhpcy5fY2FyZCA9IHRoaXMuX2NhcmRFbGVtZW50O1xyXG5cclxuICAgIHRoaXMuX3NldEF0dHJpYnV0ZXModGhpcy5fY2FyZEVsZW1lbnRcclxuICAgICAgLnF1ZXJ5U2VsZWN0b3IoJy5jYXJkX19pbWFnZScpLCB7XHJcbiAgICAgICAgc3JjOiB0aGlzLl9saW5rLFxyXG4gICAgICAgIGFsdDogdGhpcy5fbmFtZVxyXG4gICAgfSk7XHJcbiAgICB0aGlzLl9jYXJkRWxlbWVudFxyXG4gICAgICAucXVlcnlTZWxlY3RvcignLmNhcmRfX3RpdGxlJykudGV4dENvbnRlbnQgPSB0aGlzLl9uYW1lO1xyXG5cclxuICAgIGlmKHRoaXMuX293bmVySWQgIT09IHVzZXJJZCkge1xyXG4gICAgICB0aGlzLl9jYXJkRWxlbWVudFxyXG4gICAgICAgIC5xdWVyeVNlbGVjdG9yKCcuY2FyZF9fZGVsZXRlLWJ1dHRvbicpLnJlbW92ZSgpO1xyXG4gICAgfVxyXG5cclxuICAgIHRoaXMuX2xpa2VTdGF0dXMoKTtcclxuICAgIC8vIC0tLSBTaG93IGxpa2UgY291bnQgLS0tIC8vXHJcbiAgICB0aGlzLl9jYXJkRWxlbWVudFxyXG4gICAgICAucXVlcnlTZWxlY3RvcignLmNhcmRfX2xpa2UtY291bnQnKS50ZXh0Q29udGVudCA9IHRoaXMuX2xpa2VzLmxlbmd0aDtcclxuXHJcbiAgICByZXR1cm4gdGhpcy5fY2FyZEVsZW1lbnQ7XHJcbiAgfVxyXG5cclxuICBjaGVja0lmTGlrZWQodXNlcikge1xyXG4gICAgaWYodGhpcy5fbGlrZXMuZmluZCgobGlrZSkgPT4gbGlrZS5faWQgPT09IHVzZXIpKSB7XHJcbiAgICAgIHRoaXMuX2xpa2VkID0gdHJ1ZTtcclxuICAgIH1cclxuICAgIGVsc2V7XHJcbiAgICAgIHRoaXMuX2xpa2VkID0gZmFsc2U7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHRoaXMuX2xpa2VkO1xyXG4gIH1cclxuXHJcbiAgX2NhcmRMaWtlZCgpIHtcclxuICAgIHRoaXMuX2NhcmRFbGVtZW50XHJcbiAgICAgIC5xdWVyeVNlbGVjdG9yKCcuY2FyZF9fbGlrZS1idXR0b24nKVxyXG4gICAgICAuY2xhc3NMaXN0LmFkZChcImNhcmRfX2xpa2UtYnV0dG9uX2FjdGl2ZVwiKTtcclxuICB9XHJcblxyXG4gIF9jYXJkVW5saWtlZCgpIHtcclxuICAgIHRoaXMuX2NhcmRFbGVtZW50XHJcbiAgICAgIC5xdWVyeVNlbGVjdG9yKCcuY2FyZF9fbGlrZS1idXR0b24nKVxyXG4gICAgICAuY2xhc3NMaXN0LnJlbW92ZShcImNhcmRfX2xpa2UtYnV0dG9uX2FjdGl2ZVwiKTtcclxuICB9XHJcblxyXG4gIHJlZnJlc2hDYXJkKGRhdGEsIHVzZXJJZCkge1xyXG4gICAgdGhpcy5fbGlrZXMgPSBkYXRhLmxpa2VzO1xyXG4gICAgaWYodGhpcy5jaGVja0lmTGlrZWQodXNlcklkKSkge1xyXG4gICAgICB0aGlzLl9jYXJkTGlrZWQoKTtcclxuICAgIH1cclxuICAgIGVsc2Uge1xyXG4gICAgICB0aGlzLl9jYXJkVW5saWtlZCgpO1xyXG4gICAgfVxyXG4gICAgdGhpcy5fY2FyZEVsZW1lbnRcclxuICAgICAgLnF1ZXJ5U2VsZWN0b3IoJy5jYXJkX19saWtlLWNvdW50JylcclxuICAgICAgLnRleHRDb250ZW50ID0gdGhpcy5fbGlrZXMubGVuZ3RoO1xyXG4gIH1cclxufVxyXG4iLCJleHBvcnQgZGVmYXVsdCBjbGFzcyBNb2RhbCB7XHJcbiAgY29uc3RydWN0b3IoIG1vZGFsU2VsZWN0b3IsIGNoZWNrS2V5UHJlc3MgKSB7XHJcbiAgICB0aGlzLl9tb2RhbEVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKG1vZGFsU2VsZWN0b3IpO1xyXG4gICAgdGhpcy5fZXNjYXBlS2V5SGFuZGxlciA9IHRoaXMuX2VzY2FwZUtleUhhbmRsZXIuYmluZCh0aGlzKTtcclxuICAgIHRoaXMuX2NoZWNrS2V5UHJlc3MgPSBjaGVja0tleVByZXNzO1xyXG4gIH1cclxuICAvLyAtLS0gT3BlbiBtb2RhbCBtZXRob2QgLS0tIC8vIFxyXG4gIG9wZW4oKSB7XHJcbiAgICB0aGlzLl9tb2RhbEVsZW1lbnQuY2xhc3NMaXN0LmFkZChcIm1vZGFsX3Zpc2libGVcIik7XHJcbiAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwia2V5dXBcIiwgdGhpcy5fZXNjYXBlS2V5SGFuZGxlcik7XHJcbiAgfVxyXG4gIC8vIC0tLSBDbG9zZSBtb2RhbCBtZXRob2QgLS0tIC8vXHJcbiAgY2xvc2UoKSB7XHJcbiAgICB0aGlzLl9tb2RhbEVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZShcIm1vZGFsX3Zpc2libGVcIik7XHJcbiAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKFwia2V5dXBcIiwgdGhpcy5fZXNjYXBlS2V5SGFuZGxlcik7XHJcbiAgfVxyXG4gIC8vIC0tLSBDbG9zZSBtb2RhbCBvbiBFU0MgbWV0aG9kIC0tLSAvL1xyXG4gIF9lc2NhcGVLZXlIYW5kbGVyKGV2ZW50KSB7XHJcbiAgICBpZiAodGhpcy5fY2hlY2tLZXlQcmVzcyhldmVudC5rZXkpKSB7XHJcbiAgICAgIHRoaXMuY2xvc2UoKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHNldEV2ZW50TGlzdGVuZXJzKCkge1xyXG4gICAgdGhpcy5fbW9kYWxFbGVtZW50XHJcbiAgICAgIC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKGV2ZW50KSA9PiB7XHJcbiAgICAgICAgLy8gLS0tIENsb3NlIG1vZGFsIG9uIGNsb3NlKCdYJykgYnV0dG9uIC0tLSAvL1xyXG4gICAgICAgIGlmIChldmVudC50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCdtb2RhbF9fY2xvc2UtYnV0dG9uJykpIHtcclxuICAgICAgICAgIHRoaXMuY2xvc2UoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gQ2xvc2UgbW9kYWwgb24gb3ZlcmxheShvdXQgb2YgdGhlIG1vZGFsKSBjbGljayAtLS0gLy8vXHJcbiAgICAgICAgaWYgKGV2ZW50LnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoJ21vZGFsX3Zpc2libGUnKSkge1xyXG4gICAgICAgICAgdGhpcy5jbG9zZSgpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcbn0iLCJpbXBvcnQgTW9kYWwgZnJvbSBcIi4vTW9kYWwuanNcIjtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIE1vZGFsV2l0aEZvcm0gZXh0ZW5kcyBNb2RhbCB7XHJcbiAgY29uc3RydWN0b3Ioc2VsZWN0b3IsIGNoZWNrS2V5UHJlc3MsIGhhbmRsZVN1Ym1pdCApIHtcclxuICAgIHN1cGVyKHNlbGVjdG9yLCBjaGVja0tleVByZXNzKTtcclxuICAgIHRoaXMuX2hhbmRsZVN1Ym1pdCA9IGhhbmRsZVN1Ym1pdDtcclxuICAgIHRoaXMuX3N1Ym1pdEJ1dHRvbiA9IHRoaXMuX21vZGFsRWxlbWVudC5xdWVyeVNlbGVjdG9yKCcubW9kYWxfX3N1Ym1pdC1idXR0b24nKTtcclxuICAgIHRoaXMuX2Zvcm0gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubW9kYWxfX2NvbnRhaW5lcicpO1xyXG4gICAgdGhpcy5fdGV4dEluQnV0dG9uID0gdGhpcy5fc3VibWl0QnV0dG9uLnRleHRDb250ZW50O1xyXG4gIH1cclxuXHJcbiAgZ2V0SW5wdXRWYWx1ZXMoKSB7XHJcbiAgICB0aGlzLl9pbnB1dExpc3QgPSB0aGlzLl9tb2RhbEVsZW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLm1vZGFsX19pbnB1dCcpO1xyXG4gICAgY29uc3QgZm9ybUlucHV0VmFsdWVzID0ge307XHJcbiAgICB0aGlzLl9pbnB1dExpc3RcclxuICAgICAgLmZvckVhY2goKGlucHV0KSA9PiB7IGZvcm1JbnB1dFZhbHVlc1tpbnB1dC5uYW1lXSA9IGlucHV0LnZhbHVlIH1cclxuICAgICk7XHJcblxyXG4gICAgcmV0dXJuIHRoaXMuX2VudHJlZFZhbHVlIHx8IGZvcm1JbnB1dFZhbHVlcztcclxuICB9XHJcblxyXG4gIHNldElucHV0VmFsdWVzKGVudHJlZFZhbHVlKSB7XHJcbiAgICB0aGlzLl9lbnRyZWRWYWx1ZSA9IGVudHJlZFZhbHVlO1xyXG4gIH1cclxuXHJcbiAgc2V0RXZlbnRMaXN0ZW5lcnMoKSB7XHJcbiAgICB0aGlzLl9tb2RhbEVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCAoZXZlbnQpID0+IHtcclxuICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgLy8gLS0tIFVYIGZvciBtb2RhbHMgLS0tIC8vXHJcbiAgICAgIHRoaXMuX3N1Ym1pdEJ1dHRvbi50ZXh0Q29udGVudCA9IFwiU2F2aW5nLi4uXCI7XHJcbiAgICAgIHRoaXMuX2hhbmRsZVN1Ym1pdCh0aGlzLmdldElucHV0VmFsdWVzKCkpO1xyXG4gICAgfSlcclxuICAgIHN1cGVyLnNldEV2ZW50TGlzdGVuZXJzKCk7XHJcbiAgfVxyXG5cclxuICBjbG9zZSgpIHtcclxuICAgIHRoaXMuX3N1Ym1pdEJ1dHRvbi50ZXh0Q29udGVudCA9IHRoaXMuX3RleHRJbkJ1dHRvbjtcclxuICAgIHRoaXMuX2Zvcm0ucmVzZXQoKTtcclxuICAgIHN1cGVyLmNsb3NlKCk7XHJcbiAgfVxyXG59IiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgU2VjdGlvbiB7XHJcbiAgY29uc3RydWN0b3IoeyBpdGVtcywgcmVuZGVyZXIgfSwgY29udGFpbmVyU2VsZWN0b3IpIHtcclxuICAgIHRoaXMuX3JlbmRlcmVkRWxlbWVudHMgPSBpdGVtcztcclxuICAgIHRoaXMuX3JlbmRlcmVyID0gcmVuZGVyZXI7XHJcbiAgICB0aGlzLl9jb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGNvbnRhaW5lclNlbGVjdG9yKTtcclxuICB9XHJcblxyXG4gIHJlbmRlckl0ZW1zKCkge1xyXG4gICAgdGhpcy5fcmVuZGVyZWRFbGVtZW50cy5mb3JFYWNoKChpdGVtKSA9PiB7XHJcbiAgICAgIHRoaXMuX3JlbmRlcmVyKGl0ZW0pXHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIGFkZEl0ZW0oaXRlbSkge1xyXG4gICAgdGhpcy5fY29udGFpbmVyLnByZXBlbmQoaXRlbSk7XHJcbiAgfVxyXG59XHJcbiIsIi8vIC0tLSAnRWRpdCBwcm9maWxlJyBtb2RhbCBjb25zdHMgLS0tIC8vXHJcbmV4cG9ydCBjb25zdCBlZGl0QnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnByb2ZpbGVfX2VkaXQtYnV0dG9uJyk7XHJcbmV4cG9ydCBjb25zdCBwcm9maWxlTW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubW9kYWxfdHlwZV9lZGl0Jyk7XHJcbmV4cG9ydCBjb25zdCBwcm9maWxlTmFtZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wcm9maWxlX190aXRsZScpO1xyXG5leHBvcnQgY29uc3QgbmFtZUlucHV0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLm1vZGFsX19pbnB1dF90eXBlX3RpdGxlJyk7XHJcbmV4cG9ydCBjb25zdCBwcm9maWxlSm9iID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnByb2ZpbGVfX3N1YnRpdGxlJyk7XHJcbmV4cG9ydCBjb25zdCBqb2JJbnB1dCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbF9faW5wdXRfdHlwZV9zdWJ0aXRsZScpO1xyXG5leHBvcnQgY29uc3QgZWRpdENsb3NlQnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLm1vZGFsX19jbG9zZS1idXR0b25fdHlwZV9lZGl0Jyk7XHJcbi8vIC0tLSAnQXZhdGFyXCIgbW9kYWwgY29uc3RzIC0tLSAvL1xyXG5leHBvcnQgY29uc3QgdXNlckF2YXRhciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wcm9maWxlX19pbWFnZScpO1xyXG5leHBvcnQgY29uc3QgYXZhdGFyRWRpdEJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wcm9maWxlX19pbWFnZS1vdmVybGF5Jyk7XHJcbmV4cG9ydCBjb25zdCBhdmF0YXJNb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbF90eXBlX2F2YXRhcicpO1xyXG5leHBvcnQgY29uc3QgYXZhdGFyTW9kYWxJbnB1dCA9IGF2YXRhck1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbF9faW5wdXRfdHlwZV9hdmF0YXInKTtcclxuZXhwb3J0IGNvbnN0IGF2YXRhckNsb3NlQnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLm1vZGFsX19jbG9zZS1idXR0b25fdHlwZV9hdmF0YXInKVxyXG4vLyAtLS0gJ0FkZC1jYXJkJyBtb2RhbCBjb25zdHMgLS0tIC8vXHJcbmV4cG9ydCBjb25zdCBhZGRDYXJkQnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnByb2ZpbGVfX2FkZC1idXR0b24nKTtcclxuZXhwb3J0IGNvbnN0IGFkZENhcmRNb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbF90eXBlX2FkZC1jYXJkJyk7XHJcbmV4cG9ydCBjb25zdCBjYXJkSW5wdXRUaXRsZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbF9faW5wdXRfdHlwZV9uYW1lJyk7XHJcbmV4cG9ydCBjb25zdCBjYXJkSW5wdXRMaW5rID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLm1vZGFsX19pbnB1dF90eXBlX2xpbmsnKTtcclxuZXhwb3J0IGNvbnN0IGFkZENhcmRDbG9zZUJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbF9fY2xvc2UtYnV0dG9uX3R5cGVfYWRkLWNhcmQnKTtcclxuLy8gLS0tICdBZGQtQ2FyZCcgZm9ybSBjb25zdHMgLS0tIC8vXHJcbmV4cG9ydCBjb25zdCBhZGRDYXJkRm9ybSA9IGRvY3VtZW50LmZvcm1zLmFkZDtcclxuZXhwb3J0IGNvbnN0IGFkZENhcmRGb3JtVGl0ZWwgPSBhZGRDYXJkRm9ybS5lbGVtZW50cy50aXRsZTtcclxuZXhwb3J0IGNvbnN0IGFkZENhcmRGb3JtTGluayA9IGFkZENhcmRGb3JtLmVsZW1lbnRzLmxpbms7XHJcbi8vIC0tLSBHZW5lcmFsIGNvbnN0IC0tLSAvL1xyXG5leHBvcnQgY29uc3Qgc3VibWl0QnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLm1vZGFsX19zdWJtaXQtYnV0dG9uJyk7XHJcbmV4cG9ydCBjb25zdCBjYXJkTGlzdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5jYXJkc19fZ3JpZCcpO1xyXG5leHBvcnQgY29uc3QgY2FyZFRlbXBsYXRlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI2NhcmRfX3RlbXBsYXRlJyk7XHJcbi8vIC0tLSBCaWcgaW1hZ2UgbW9kYWwgY29uc3RzIC0tLSAvL1xyXG5leHBvcnQgY29uc3QgYmlnSW1hZ2VNb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbF90eXBlX2JpZy1pbWFnZScpO1xyXG5leHBvcnQgY29uc3QgYmlnSW1hZ2UgPSBiaWdJbWFnZU1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbF9fYmlnLWltYWdlJyk7XHJcbmV4cG9ydCBjb25zdCBiaWdJbWFnZVRpdGxlID0gYmlnSW1hZ2VNb2RhbC5xdWVyeVNlbGVjdG9yKCcubW9kYWxfX2ltYWdlLWNhcHRpb24nKTtcclxuZXhwb3J0IGNvbnN0IGNhcmRCaWdNb2RhbENsb3NlSWNvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbF9fY2xvc2UtYnV0dG9uX3R5cGVfYmlnLWltYWdlJyk7XHJcbi8vIC0tLSAnRGVsZXRlIGNhcmQnIG1vZGFsIGNvbnN0cyAtLS0gLy9cclxuZXhwb3J0IGNvbnN0IGRlbGV0ZUNhcmQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubW9kYWxfdHlwZV9kZWxldGUtY2FyZCcpO1xyXG4vLyAtLS0gU2VsZWN0b3JzIC0tLSAvL1xyXG5leHBvcnQgY29uc3QgcHJvZmlsZU1vZGFsU2VsZWN0b3IgPSAnLm1vZGFsX3R5cGVfZWRpdCc7XHJcbmV4cG9ydCBjb25zdCBhdmF0YXJNb2RhbFNlbGVjdG9yID0gJy5tb2RhbF90eXBlX2F2YXRhcic7XHJcbmV4cG9ydCBjb25zdCBhZGRDYXJkTW9kYWxTZWxlY3RvciA9ICcubW9kYWxfdHlwZV9hZGQtY2FyZCc7XHJcbmV4cG9ydCBjb25zdCBkZWxldGVDYXJkU2VsZWN0b3IgPSAnLm1vZGFsX3R5cGVfZGVsZXRlLWNhcmQnO1xyXG5leHBvcnQgY29uc3QgYmlnSW1hZ2VTZWxlY3RvciA9ICcubW9kYWxfdHlwZV9iaWctaW1hZ2UnO1xyXG5leHBvcnQgY29uc3QgY2FyZExpc3RTZWxlY3RvciA9ICcuY2FyZHNfX2dyaWQnXHJcbi8vIC0tLSBGb3JtIGNvbmZpZyBjb25zdHMgLS0tIC8vXHJcbmV4cG9ydCBjb25zdCBmb3JtQ29uZmlnID0ge1xyXG4gIGZvcm1TZWxlY3RvcjogXCIubW9kYWxfX2NvbnRhaW5lclwiLFxyXG4gIGlucHV0U2VsZWN0b3I6IFwiLm1vZGFsX19pbnB1dFwiLFxyXG4gIHN1Ym1pdEJ1dHRvblNlbGVjdG9yOiBcIi5tb2RhbF9fc3VibWl0LWJ1dHRvblwiLFxyXG4gIGluYWN0aXZlQnV0dG9uQ2xhc3M6IFwibW9kYWxfX3N1Ym1pdC1idXR0b25fZGlzYWJsZWRcIixcclxuICBpbnB1dEVycm9yQ2xhc3M6IFwibW9kYWxfX2lucHV0X2Vycm9yXCIsXHJcbiAgZXJyb3JNZXNzYWdlQ2xhc3M6IFwibW9kYWxfX2Vycm9yX3Zpc2libGVcIlxyXG59O1xyXG4vLyAtLS0gQVBJIGNvbnN0IC0tLSAvL1xyXG5leHBvcnQgY29uc3QgYXBpQ29uZmlnID0ge1xyXG4gIGJhc2VVcmw6IFwiaHR0cHM6Ly9hcm91bmQubm9tb3JlcGFydGllcy5jby92MS9ncm91cC0xMlwiLFxyXG4gIGhlYWRlcnM6IFxyXG4gIHtcclxuICAgIGF1dGhvcml6YXRpb246IFwiNzA5YTBkOWQtZGIwNi00ODkwLWE1OTQtYjA3ZTczMDlhMzUzXCIsXHJcbiAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nIFxyXG4gIH0sXHJcbn07IiwiaW1wb3J0IFwiLi9pbmRleC5jc3NcIjtcclxuaW1wb3J0IEZvcm1WYWxpZGF0b3IgZnJvbSBcIi4uL2NvbXBvbmVudHMvc2NyaXB0cy9Gb3JtVmFsaWRhdG9yLmpzXCI7XHJcbmltcG9ydCBDYXJkIGZyb20gXCIuLi9jb21wb25lbnRzL3NjcmlwdHMvQ2FyZC5qc1wiO1xyXG5pbXBvcnQgTW9kYWxXaXRoSW1hZ2UgZnJvbSBcIi4uL2NvbXBvbmVudHMvc2NyaXB0cy9Nb2RhbFdpdGhJbWFnZS5qc1wiO1xyXG5pbXBvcnQgTW9kYWxXaXRoRm9ybSBmcm9tIFwiLi4vY29tcG9uZW50cy9zY3JpcHRzL01vZGFsV2l0aEZvcm0uanNcIjtcclxuaW1wb3J0IEFwaSBmcm9tIFwiLi4vY29tcG9uZW50cy9zY3JpcHRzL0FwaS5qc1wiXHJcbmltcG9ydCBTZWN0aW9uIGZyb20gXCIuLi9jb21wb25lbnRzL3NjcmlwdHMvU2VjdGlvbi5qc1wiO1xyXG5pbXBvcnQgVXNlckluZm8gZnJvbSBcIi4uL2NvbXBvbmVudHMvc2NyaXB0cy9Vc2VySW5mby5qc1wiO1xyXG5pbXBvcnQge1xyXG4gIHByb2ZpbGVOYW1lLFxyXG4gIHByb2ZpbGVKb2IsXHJcbiAgZWRpdEJ1dHRvbixcclxuICBjYXJkTGlzdFNlbGVjdG9yLFxyXG4gIHByb2ZpbGVNb2RhbCxcclxuICBwcm9maWxlTW9kYWxTZWxlY3RvcixcclxuICBjYXJkVGVtcGxhdGUsXHJcbiAgYWRkQ2FyZEJ1dHRvbixcclxuICBhZGRDYXJkTW9kYWwsXHJcbiAgYWRkQ2FyZE1vZGFsU2VsZWN0b3IsXHJcbiAgY2FyZElucHV0VGl0bGUsXHJcbiAgY2FyZElucHV0TGluayxcclxuICBhdmF0YXJNb2RhbCxcclxuICBhdmF0YXJNb2RhbFNlbGVjdG9yLFxyXG4gIGF2YXRhck1vZGFsSW5wdXQsXHJcbiAgdXNlckF2YXRhcixcclxuICBhdmF0YXJFZGl0QnV0dG9uLFxyXG4gIGJpZ0ltYWdlU2VsZWN0b3IsXHJcbiAgYmlnSW1hZ2UsXHJcbiAgYmlnSW1hZ2VUaXRsZSxcclxuICBkZWxldGVDYXJkU2VsZWN0b3IsXHJcbiAgYXBpQ29uZmlnLFxyXG4gIGZvcm1Db25maWcsXHJcbiAgbmFtZUlucHV0LFxyXG4gIGpvYklucHV0XHJcbn0gZnJvbSBcIi4uL2NvbXBvbmVudHMvdXRpbHMvY29uc3RhbnRzLmpzXCI7XHJcblxyXG4vLyA9PT09PSBNb2RhbHMgPT09PT0gLy9cclxuLy8gLS0tICdFc2MnIGNoZWNrIC0tLSAvL1xyXG5jb25zdCBjaGVja0ZvckVzY1ByZXNzZWQgPSAoa2V5KSA9PiBrZXkgPT09IFwiRXNjYXBlXCI7XHJcbi8vIC0tLSBBZGQgbW9kYWwgcmVzZXQgaW5wdXQgLS0tIC8vXHJcbmNvbnN0IG1vZGFsUmVzZXRJbnB1dHMgPSAoKSA9PiB7XHJcbiAgY2FyZElucHV0VGl0bGUudmFsdWUgPSBcIlwiO1xyXG4gIGNhcmRJbnB1dExpbmsudmFsdWUgPSBcIlwiO1xyXG59XHJcblxyXG4vLyA9PT09PSBWYWxpZGF0aW9uID09PT09IC8vXHJcbi8vIC0tLSAnRWRpdCBwcm9maWxlJyBmb3JtIHZhbGlkYXRpb24gLS0tIC8vXHJcbmNvbnN0IHByb2ZpbGVGb3JtVmFsaWRhdGlvbiA9IG5ldyBGb3JtVmFsaWRhdG9yKGZvcm1Db25maWcsIHByb2ZpbGVNb2RhbCk7XHJcbnByb2ZpbGVGb3JtVmFsaWRhdGlvbi5lbmFibGVWYWxpZGF0aW9uKCk7XHJcbi8vIC0tLSAnQXZhdGFyJyBmb3JtIHZhbGlkYXRpb24gLS0tIC8vXHJcbmNvbnN0IGF2YXRhckZvcm1WYWxpZGF0aW9uID0gbmV3IEZvcm1WYWxpZGF0b3IoZm9ybUNvbmZpZywgYXZhdGFyTW9kYWwpO1xyXG5hdmF0YXJGb3JtVmFsaWRhdGlvbi5lbmFibGVWYWxpZGF0aW9uKCk7XHJcbi8vIC0tLSAnQWRkIGNhcmQnIGZvcm0gdmFsaWRhdGlvbiAtLS0gLy9cclxuY29uc3QgYWRkQ2FyZEZvcm1WYWxpZGF0aW9uID0gbmV3IEZvcm1WYWxpZGF0b3IoZm9ybUNvbmZpZywgYWRkQ2FyZE1vZGFsKTtcclxuYWRkQ2FyZEZvcm1WYWxpZGF0aW9uLmVuYWJsZVZhbGlkYXRpb24oKTtcclxuXHJcbi8vID09PT09IEFQSSAmIENhcmQgPT09PT0gLy9cclxuLy8gLS0tIEFQSSBlcnJvciBoYW5kbGVyIC0tLSAvLyBcclxuY29uc3QgYXBpRXJyID0gKGVycikgPT4gY29uc29sZS5sb2coZXJyKTtcclxuLy8gLS0tIFNldHRpbmcgdGhlIGRlZmF1bHQgZmV0Y2hpbmcgbWV0aG9kIC0tLSAvL1xyXG5jb25zdCBhcGkgPSBuZXcgQXBpKGFwaUNvbmZpZyk7XHJcbi8vIC0tLSBTZXQgd2hhdCAncHJvZmlsZScgd2lsbCBjb250YWlucyAtLS0gLy9cclxuY29uc3QgcHJvZmlsZSA9IG5ldyBVc2VySW5mbyhcclxuICBwcm9maWxlTmFtZSwgXHJcbiAgcHJvZmlsZUpvYixcclxuICB1c2VyQXZhdGFyXHJcbik7XHJcbmxldCB1c2VySUQ7XHJcbmFwaVxyXG4gIC8vIC0tLSBHZXQgdXNlciBpbmZvIG1ldGhvZCAtLS0gLy9cclxuICAuZ2V0VXNlckluZm8oKVxyXG4gIC50aGVuKChyZXMpID0+IHtcclxuICAgIHByb2ZpbGUuc2V0VXNlckluZm8ocmVzLm5hbWUsIHJlcy5hYm91dCk7XHJcbiAgICB1c2VyQXZhdGFyLnNyYyA9IHJlcy5hdmF0YXI7XHJcbiAgICB1c2VySUQgPSByZXMuX2lkO1xyXG4gICAgcmV0dXJuIHByb2ZpbGU7XHJcbiAgfSlcclxuICAvLyAtLS0gVXNlIHVzZXIgaW5mbyBmb3IgY3JlYXRpb24gb2YgbmV3IGNhcmRzIGFuZCBjYXJkIHNlY3Rpb24gLS0tIC8vIFxyXG4gIC50aGVuKCgpID0+IHtcclxuICAgIGFwaVxyXG4gICAgICAuZ2V0Q2FyZExpc3QoKVxyXG4gICAgICAudGhlbigoZGF0YSkgPT4ge1xyXG4gICAgICAgIC8vIC0tLSBPbiBjYXJkIGNsaWNrIGhhbmRsZXIgLS0tIC8vXHJcbiAgICAgICAgY29uc3Qgb25DYXJkQ2xpY2sgPSAobmFtZSwgbGluaykgPT4ge1xyXG4gICAgICAgICAgYmlnSW1hZ2VNb2RhbC5vcGVuKG5hbWUsIGxpbmspO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvLyAtLS0gRGVsZXRlIGNhcmQgYnV0dG9uIGhhbmRsZXIgLS0tIC8vXHJcbiAgICAgICAgY29uc3QgZGVsZXRlQ2FyZEhhbmRsZXIgPSAoZGF0YSkgPT4ge1xyXG4gICAgICAgICAgZGVsZXRlQ2FyZE1vZGFsLnNldElucHV0VmFsdWVzKGRhdGEpO1xyXG4gICAgICAgICAgZGVsZXRlQ2FyZE1vZGFsLm9wZW4oKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gLS0tIExpa2UgYnV0dG9uIGNsaWNrIGhhbmRsZXIgLS0tIC8vXHJcbiAgICAgICAgY29uc3QgbGlrZUNsaWNrSGFuZGxlciA9IChjYXJkKSA9PiB7XHJcbiAgICAgICAgICBpZiAoY2FyZC5jaGVja0lmTGlrZWQodXNlcklEKSkge1xyXG4gICAgICAgICAgICBhcGlcclxuICAgICAgICAgICAgICAudW5saWtlQ2FyZChjYXJkLmdldENhcmRJZCgpKVxyXG4gICAgICAgICAgICAgIC50aGVuKChkYXRhKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBjYXJkLnJlZnJlc2hDYXJkKGRhdGEsIHVzZXJJRCk7XHJcbiAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAuY2F0Y2goYXBpRXJyKTtcclxuICAgICAgICAgIH0gXHJcbiAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgYXBpXHJcbiAgICAgICAgICAgICAgLmxpa2VDYXJkKGNhcmQuZ2V0Q2FyZElkKCkpXHJcbiAgICAgICAgICAgICAgLnRoZW4oKGRhdGEpID0+IHtcclxuICAgICAgICAgICAgICAgIGNhcmQucmVmcmVzaENhcmQoZGF0YSwgdXNlcklEKTtcclxuICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgIC5jYXRjaChhcGlFcnIpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICAvLyAtLS0gTmV3IGNhcmQgaW5zdGFuY2UgYWRkaW5nIC0tLSAvL1xyXG4gICAgICAgIGNvbnN0IG5ld0NhcmRJbnN0YW5jZSA9IChjYXJkRGF0YSkgPT4ge1xyXG4gICAgICAgICAgY29uc3QgY2FyZEluc3RhbmNlID0gbmV3IENhcmQoXHJcbiAgICAgICAgICAgIGNhcmREYXRhLFxyXG4gICAgICAgICAgICBvbkNhcmRDbGljayxcclxuICAgICAgICAgICAgZGVsZXRlQ2FyZEhhbmRsZXIsXHJcbiAgICAgICAgICAgIGxpa2VDbGlja0hhbmRsZXIsXHJcbiAgICAgICAgICAgIGNhcmRUZW1wbGF0ZSxcclxuICAgICAgICAgICAgdXNlcklEXHJcbiAgICAgICAgICApO1xyXG4gICAgICAgICAgcmV0dXJuIGNhcmRJbnN0YW5jZTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBjb25zdCBjYXJkU2VjdGlvbiA9IG5ldyBTZWN0aW9uKFxyXG4gICAgICAgICAge1xyXG4gICAgICAgICAgICBpdGVtczogZGF0YSxcclxuICAgICAgICAgICAgcmVuZGVyZXI6IChpdGVtKSA9PiB7XHJcbiAgICAgICAgICAgICAgY29uc3QgY2FyZEluc3RhbmNlID0gbmV3Q2FyZEluc3RhbmNlKGl0ZW0pO1xyXG4gICAgICAgICAgICAgIGNhcmRTZWN0aW9uLmFkZEl0ZW0oY2FyZEluc3RhbmNlLmdlbmVyYXRlQ2FyZCh1c2VySUQpKTtcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgIH0sXHJcbiAgICAgICAgICBjYXJkTGlzdFNlbGVjdG9yXHJcbiAgICAgICAgKTtcclxuICAgICAgICBjYXJkU2VjdGlvbi5yZW5kZXJJdGVtcygpO1xyXG5cclxuICAgICAgICBjb25zdCBhZGROZXdDYXJkTW9kYWwgPSBuZXcgTW9kYWxXaXRoRm9ybShcclxuICAgICAgICAgIGFkZENhcmRNb2RhbFNlbGVjdG9yLFxyXG4gICAgICAgICAgY2hlY2tGb3JFc2NQcmVzc2VkLFxyXG4gICAgICAgICAgKHsgdGl0bGVJbnB1dDogbmFtZSwgbGlua0lucHV0OiBsaW5rIH0pID0+IHtcclxuICAgICAgICAgICAgYXBpXHJcbiAgICAgICAgICAgICAgLmFkZENhcmQoeyBuYW1lLCBsaW5rIH0pXHJcbiAgICAgICAgICAgICAgLnRoZW4oKGRhdGEpID0+IHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGFkZE5ld0NhcmRJbnN0YW5jZSA9IG5ld0NhcmRJbnN0YW5jZShkYXRhKTtcclxuICAgICAgICAgICAgICAgIGNhcmRTZWN0aW9uLmFkZEl0ZW0oXHJcbiAgICAgICAgICAgICAgICAgIGFkZE5ld0NhcmRJbnN0YW5jZS5nZW5lcmF0ZUNhcmQodXNlcklEKVxyXG4gICAgICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgICAgIG1vZGFsUmVzZXRJbnB1dHMoKTtcclxuICAgICAgICAgICAgICAgIGFkZE5ld0NhcmRNb2RhbC5jbG9zZShtb2RhbFJlc2V0SW5wdXRzKTtcclxuICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgIC5jYXRjaChhcGlFcnIpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICk7XHJcbiAgICAgICAgYWRkTmV3Q2FyZE1vZGFsLnNldEV2ZW50TGlzdGVuZXJzKCk7XHJcbiAgICAgICAgYWRkQ2FyZEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xyXG4gICAgICAgICAgYWRkTmV3Q2FyZE1vZGFsLm9wZW4oKTtcclxuICAgICAgICB9KTtcclxuICAgICAgfSlcclxuICAgIC5jYXRjaChhcGlFcnIpO1xyXG59KVxyXG4uY2F0Y2goYXBpRXJyKTtcclxuXHJcbi8vID09PT09ICdFZGl0JyBwcm9maWxlID09PT09IC8vXHJcbi8vIC0tLSBFZGl0IHByb2ZpbGUgbW9kYWwgLS0tIC8vXHJcbmNvbnN0IGVkaXRQcm9maWxlTW9kYWwgPSBuZXcgTW9kYWxXaXRoRm9ybSAoXHJcbiAgcHJvZmlsZU1vZGFsU2VsZWN0b3IsXHJcbiAgY2hlY2tGb3JFc2NQcmVzc2VkLFxyXG4gICh7bmFtZUlucHV0OiBuYW1lLCBqb2JJbnB1dDphYm91dH0pID0+IFxyXG4gIHtcclxuICAgIGFwaVxyXG4gICAgICAuc2V0VXNlckluZm8oe25hbWUsYWJvdXR9KVxyXG4gICAgICAudGhlbigoKSA9PiB7XHJcbiAgICAgICAgcHJvZmlsZS5zZXRVc2VySW5mbyhuYW1lLCBhYm91dCk7XHJcbiAgICAgICAgZWRpdFByb2ZpbGVNb2RhbC5jbG9zZSgpO1xyXG4gICAgICB9KVxyXG4gICAgICAuY2F0Y2goYXBpRXJyKTtcclxuICB9XHJcbilcclxuZWRpdFByb2ZpbGVNb2RhbC5zZXRFdmVudExpc3RlbmVycygpO1xyXG4vLyAtLS0gRWRpdCBidXR0b24gaGFuZGxlciAtLS0gLy8gXHJcbmVkaXRCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIgLCAoKSA9PiB7XHJcbiAgbmFtZUlucHV0LnZhbHVlID0gcHJvZmlsZU5hbWUudGV4dENvbnRlbnQ7XHJcbiAgam9iSW5wdXQudmFsdWUgPSBwcm9maWxlSm9iLnRleHRDb250ZW50O1xyXG4gIGVkaXRQcm9maWxlTW9kYWwub3BlbigpO1xyXG59KTtcclxuLy8gLS0tIEF2YXRhciBlZGl0IG1vZGFsIC0tLSAvL1xyXG5jb25zdCBhdmF0YXJFZGl0TW9kYWwgPSBuZXcgTW9kYWxXaXRoRm9ybSAoXHJcbiAgYXZhdGFyTW9kYWxTZWxlY3RvcixcclxuICBjaGVja0ZvckVzY1ByZXNzZWQsXHJcbiAgKHsgYXZhdGFyTGlua0lucHV0OmF2YXRhciB9KSA9PiBcclxuICB7XHJcbiAgICBhcGlcclxuICAgICAgLnNldFVzZXJBdmF0YXIoe2F2YXRhcn0pXHJcbiAgICAgIC50aGVuKCgpID0+IHtcclxuICAgICAgICBwcm9maWxlLnNldFVzZXJBdmF0YXIoYXZhdGFyKTtcclxuICAgICAgICBhdmF0YXJFZGl0TW9kYWwuY2xvc2UoKTtcclxuICAgICAgfSlcclxuICAgICAgLmNhdGNoKGFwaUVycilcclxuICAgICAgLmZpbmFsbHkoYXZhdGFyRWRpdE1vZGFsLmNsb3NlKCkpXHJcbiAgfVxyXG4pO1xyXG5hdmF0YXJFZGl0TW9kYWwuc2V0RXZlbnRMaXN0ZW5lcnMoKTtcclxuLy8gLS0tIEF2YXRhciBlZGl0IGJ1dHRvbiAtLS0gLy9cclxuYXZhdGFyRWRpdEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xyXG4gIGF2YXRhck1vZGFsSW5wdXQudmFsdWUgPSBcIlwiO1xyXG4gIGF2YXRhckVkaXRNb2RhbC5vcGVuKCk7XHJcbn0pXHJcblxyXG4vLyAtLS0gRGVsZXRlIGNhcmQgbW9kYWwgaW5zdGFuY2UgYW5kIGV2ZW50cyAtLS0gLy9cclxuY29uc3QgZGVsZXRlQ2FyZE1vZGFsID0gbmV3IE1vZGFsV2l0aEZvcm0oXHJcbiAgZGVsZXRlQ2FyZFNlbGVjdG9yLFxyXG4gIGNoZWNrRm9yRXNjUHJlc3NlZCxcclxuICAoY2FyZCkgPT4ge1xyXG4gICAgYXBpXHJcbiAgICAgIC5yZW1vdmVDYXJkKGNhcmQuZ2V0Q2FyZElkKCkpXHJcbiAgICAgIC50aGVuKCgpID0+IHtcclxuICAgICAgICBjYXJkLmRlbGV0ZUNhcmQoKTtcclxuICAgICAgICBkZWxldGVDYXJkTW9kYWwuY2xvc2UoKTtcclxuICAgICAgfSlcclxuICAgICAgLmNhdGNoKGFwaUVycilcclxuICAgICAgLmZpbmFsbHkoZGVsZXRlQ2FyZE1vZGFsLmNsb3NlKCkpO1xyXG4gIH1cclxuKTtcclxuZGVsZXRlQ2FyZE1vZGFsLnNldEV2ZW50TGlzdGVuZXJzKCk7XHJcbi8vIC0tLSBCaWcgaW1hZ2UgbW9kYWwgaW5zdGFuY2UgLS0tIC8vXHJcbmNvbnN0IGJpZ0ltYWdlTW9kYWwgPSBuZXcgTW9kYWxXaXRoSW1hZ2UoXHJcbiAgYmlnSW1hZ2VTZWxlY3RvcixcclxuICBjaGVja0ZvckVzY1ByZXNzZWQsXHJcbiAgYmlnSW1hZ2UsXHJcbiAgYmlnSW1hZ2VUaXRsZVxyXG4pO1xyXG5iaWdJbWFnZU1vZGFsLnNldEV2ZW50TGlzdGVuZXJzKCk7XHJcbiIsImV4cG9ydCBkZWZhdWx0IGNsYXNzIEFwaSB7XHJcbiAgY29uc3RydWN0b3IoY29uZmlnKSB7XHJcbiAgICB0aGlzLl9iYXNlVXJsID0gY29uZmlnLmJhc2VVcmw7XHJcbiAgICB0aGlzLl9oZWFkZXJzID0gY29uZmlnLmhlYWRlcnM7XHJcbiAgfVxyXG4gIC8vIC0tLSBHbG9iYWwgQVBJIHJlc3BvbnNlIG1ldGhvZCAtLS0gLy9cclxuICBfcmVzcG9uc2UocmVzKSB7XHJcbiAgICByZXR1cm4gcmVzLm9rXHJcbiAgICA/IHJlcy5qc29uKClcclxuICAgIDogUHJvbWlzZS5yZWplY3QoYEVycm9yOiAke3Jlcy5zdGF0dXN9IC0gJHtyZXMuc3RhdHVzVGV4dH1gKTtcclxuICB9XHJcbiAgLy8gLS0tIEdldCBjYXJkIGxpc3QgZnJvbSB0aGUgc2VydmVyIC0tLSAvL1xyXG4gIGdldENhcmRMaXN0KCkge1xyXG4gICAgcmV0dXJuIChcclxuICAgICAgZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vY2FyZHNgLCB7XHJcbiAgICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVyc1xyXG4gICAgICB9KVxyXG4gICAgICAudGhlbih0aGlzLl9yZXNwb25zZSlcclxuICAgICk7XHJcbiAgfVxyXG4gIC8vIC0tLSBHZXQgdXNlciBpbmZvIGZyb20gdGhlIHNlcnZlciAtLS0gLy9cclxuICBnZXRVc2VySW5mbygpIHtcclxuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS91c2Vycy9tZWAsIHtcclxuICAgICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzXHJcbiAgICAgIH0pXHJcbiAgICAgIC50aGVuKHRoaXMuX3Jlc3BvbnNlKVxyXG4gIH1cclxuICAvLyAtLS0gVXBkYXRpbmcvRWRpdGluZyB1c2VyIHByb2ZpbGUgaW5mbyAtLS0gLy9cclxuICBzZXRVc2VySW5mbyhuYW1lLCBhYm91dCkge1xyXG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L3VzZXJzL21lYCwge1xyXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxyXG4gICAgICBtZXRob2Q6IFwiUEFUQ0hcIixcclxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoXHJcbiAgICAgICAgbmFtZSwgXHJcbiAgICAgICAgYWJvdXRcclxuICAgICAgKVxyXG4gICAgfSlcclxuICAgIC50aGVuKHRoaXMuX3Jlc3BvbnNlKVxyXG4gIH1cclxuICAvLyAtLS0gQWRkaW5nIG5ldyBjYXJkIC0tLSAvL1xyXG4gIGFkZENhcmQoZGF0YSkge1xyXG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L2NhcmRzYCwge1xyXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxyXG4gICAgICBtZXRob2Q6IFwiUE9TVFwiLFxyXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeShkYXRhKVxyXG4gICAgfSlcclxuICAgIC50aGVuKHRoaXMuX3Jlc3BvbnNlKVxyXG4gIH1cclxuICAvLyAtLS0gUmVtb3ZpbmcgYSBjYXJkIC0tLSAvL1xyXG4gIHJlbW92ZUNhcmQoY2FyZElkKSB7XHJcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vY2FyZHMvJHtjYXJkSWR9YCwge1xyXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxyXG4gICAgICBtZXRob2Q6IFwiREVMRVRFXCJcclxuICAgIH0pXHJcbiAgICAudGhlbih0aGlzLl9yZXNwb25zZSlcclxuICB9XHJcbiAgLy8gLS0tIExpa2UgYSBjYXJkIC0tLSAvL1xyXG4gIGxpa2VDYXJkKGNhcmRJZCkge1xyXG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L2NhcmRzL2xpa2VzLyR7Y2FyZElkfWAsIHtcclxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcclxuICAgICAgbWV0aG9kOiBcIlBVVFwiXHJcbiAgICB9KVxyXG4gICAgLnRoZW4odGhpcy5fcmVzcG9uc2UpXHJcbiAgfVxyXG4gIC8vIC0tLSBVbmxpa2UgYSBjYXJkIC0tLSAvL1xyXG4gIHVubGlrZUNhcmQoY2FyZElkKSB7XHJcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vY2FyZHMvbGlrZXMvJHtjYXJkSWR9YCAsIHtcclxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcclxuICAgICAgbWV0aG9kOiBcIkRFTEVURVwiXHJcbiAgICB9KVxyXG4gICAgLnRoZW4odGhpcy5fcmVzcG9uc2UpXHJcbiAgfVxyXG4gIC8vIC0tLSBTZXR0aW5nIHVzZXIgcHJvZmlsZSBhdmF0YXIgLS0tIC8vXHJcbiAgc2V0VXNlckF2YXRhcihhdmF0YXIpIHtcclxuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS91c2Vycy9tZS9hdmF0YXJgLCB7XHJcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXHJcbiAgICAgIG1ldGhvZDogXCJQQVRDSFwiLFxyXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeShcclxuICAgICAgICAgIGF2YXRhclxyXG4gICAgICApXHJcbiAgICB9KVxyXG4gICAgLnRoZW4odGhpcy5fcmVzcG9uc2UpXHJcbiAgfVxyXG59XHJcbiIsImV4cG9ydCBkZWZhdWx0IGNsYXNzIFVzZXJJbmZvIHtcclxuICBjb25zdHJ1Y3RvciggbmFtZUVsZW1lbnQsIHRpdGxlRWxlbWVudCwgcGljdHVyZUVsZW1lbnQgKSB7XHJcbiAgICB0aGlzLl9uYW1lRWxlbWVudCA9IG5hbWVFbGVtZW50O1xyXG4gICAgdGhpcy5fdGl0bGVFbGVtZW50ID0gdGl0bGVFbGVtZW50O1xyXG4gICAgdGhpcy5fcGljdHVyZUVsZW1lbnQgPSBwaWN0dXJlRWxlbWVudDtcclxuICB9XHJcblxyXG4gIGdldFVzZXJJbmZvKCkge1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgbmFtZTogdGhpcy5fbmFtZS50ZXh0Q29udGVudCxcclxuICAgICAgam9iOiB0aGlzLl9qb2IudGV4dENvbnRlbnQsXHJcbiAgICAgIGF2YXRhcjogdGhpcy5fYXZhdGFyLFxyXG4gICAgICBpZDogdGhpcy5faWRcclxuICAgIH07XHJcbiAgfVxyXG5cclxuICBnZXRVc2VyRGF0YSgpIHtcclxuICAgIHJldHVybiB0aGlzLl9kYXRhO1xyXG4gIH1cclxuXHJcbiAgc2V0VXNlckluZm8obmFtZSwgam9iKSB7XHJcbiAgICB0aGlzLl9uYW1lID0gbmFtZTtcclxuICAgIHRoaXMuX2pvYiA9IGpvYjtcclxuICAgIHRoaXMuX25hbWVFbGVtZW50LnRleHRDb250ZW50ID0gdGhpcy5fbmFtZTtcclxuICAgIHRoaXMuX3RpdGxlRWxlbWVudC50ZXh0Q29udGVudCA9IHRoaXMuX2pvYjtcclxuICB9XHJcblxyXG4gIHNldFVzZXJBdmF0YXIoYXZhdGFyKSB7XHJcbiAgICB0aGlzLl9hdmF0YXIgPSBhdmF0YXI7XHJcbiAgICB0aGlzLl9waWN0dXJlRWxlbWVudC5zZXRBdHRyaWJ1dGUoXCJzcmNcIiwgdGhpcy5fYXZhdGFyKTtcclxuICB9XHJcbn1cclxuIiwiaW1wb3J0IE1vZGFsIGZyb20gXCIuL01vZGFsLmpzXCI7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBNb2RhbFdpdGhJbWFnZSBleHRlbmRzIE1vZGFsIHtcclxuICBjb25zdHJ1Y3RvciggbW9kYWwsIGNoZWNrS2V5UHJlc3MgKXtcclxuICAgIHN1cGVyKCBtb2RhbCwgY2hlY2tLZXlQcmVzcyApO1xyXG4gICAgdGhpcy5fbW9kYWxJbWFnZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbF9fYmlnLWltYWdlJyk7XHJcbiAgICB0aGlzLl9tb2RhbFRpdGxlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLm1vZGFsX19pbWFnZS1jYXB0aW9uJyk7XHJcbiAgfVxyXG4gIC8vIC0tLSBPcGVuIGJpZyBpbWFnZSBtb2RhbCBtZXRob2QgLS0tIC8vXHJcbiAgb3BlbihuYW1lLCBsaW5rKSB7XHJcbiAgICB0aGlzLl9tb2RhbFRpdGxlLnRleHRDb250ZW50ID0gbmFtZTtcclxuICAgIHRoaXMuX21vZGFsSW1hZ2Uuc2V0QXR0cmlidXRlKFwic3JjXCIsIGxpbmspOyBcclxuXHJcbiAgICBzdXBlci5vcGVuKCk7XHJcbiAgfVxyXG59Il0sIm5hbWVzIjpbIkZvcm1WYWxpZGF0b3IiLCJjb25zdHJ1Y3RvciIsImZvcm1Db25maWciLCJmb3JtRWxlbWVudCIsInRoaXMiLCJfZm9ybUNvbmZpZyIsIl9mb3JtRWxlbWVudCIsImlucHV0cyIsIkFycmF5IiwiZnJvbSIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJpbnB1dFNlbGVjdG9yIiwiX2J1dHRvbkVsZW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwic3VibWl0QnV0dG9uU2VsZWN0b3IiLCJfc2hvd0lucHV0RXJyb3IiLCJpbnB1dEVsZW1lbnQiLCJlcnJvck1lc3NhZ2UiLCJpbnB1dEVycm9yQ2xhc3MiLCJlcnJvck1lc3NhZ2VDbGFzcyIsImVycm9yRWxlbWVudCIsImlkIiwidGV4dENvbnRlbnQiLCJjbGFzc0xpc3QiLCJhZGQiLCJfaGlkZUlucHV0RXJyb3IiLCJyZW1vdmUiLCJfY2hlY2tJbnB1dCIsInZhbGlkaXR5IiwidmFsaWQiLCJ2YWxpZGF0aW9uTWVzc2FnZSIsIl9jaGVja0lWYWxpZCIsImV2ZXJ5IiwiaW5wdXQiLCJfdG9nZ2xlU3VibWl0QnV0dG9uIiwiZGlzYWJsZWQiLCJpbmFjdGl2ZUJ1dHRvbkNsYXNzIiwiX3NldEV2ZW50TGlzdGVuZXJzIiwiZm9yRWFjaCIsImFkZEV2ZW50TGlzdGVuZXIiLCJlbmFibGVWYWxpZGF0aW9uIiwiZXZlbnQiLCJwcmV2ZW50RGVmYXVsdCIsIkNhcmQiLCJkYXRhIiwib25DYXJkQ2xpY2siLCJyZW1vdmVIYW5kbGVyIiwibGlrZUNsaWNrSGFuZGxlciIsInRlbXBsYXRlIiwidXNlcklkIiwiX25hbWUiLCJuYW1lIiwiX2xpbmsiLCJsaW5rIiwiX293bmVySWQiLCJvd25lciIsIl9pZCIsIl9jYXJkSWQiLCJfbGlrZXMiLCJsaWtlcyIsIl91c2VySWQiLCJfdGVtcGxhdGUiLCJfb25DYXJkQ2xpY2siLCJfbGlrZUNsaWNrSGFuZGxlciIsIl9yZW1vdmVIYW5kbGVyIiwiX2dldFRlbXBsYXRlIiwiY29udGVudCIsImNsb25lTm9kZSIsIl9zZXRBdHRyaWJ1dGVzIiwiY2FyZEVsZW1lbnQiLCJhdHRyaWJzIiwia2V5Iiwic2V0QXR0cmlidXRlIiwiZGVsZXRlQ2FyZCIsIl9jYXJkIiwiX2hhbmRlbExpa2UiLCJsaWtlQnRuIiwidG9nZ2xlIiwiX2xpa2VTdGF0dXMiLCJfY2FyZEVsZW1lbnQiLCJlbGVtZW50IiwiZ2V0Q2FyZElkIiwiZ2VuZXJhdGVDYXJkIiwic3JjIiwiYWx0IiwibGVuZ3RoIiwiY2hlY2tJZkxpa2VkIiwidXNlciIsImZpbmQiLCJsaWtlIiwiX2xpa2VkIiwiX2NhcmRMaWtlZCIsIl9jYXJkVW5saWtlZCIsInJlZnJlc2hDYXJkIiwiTW9kYWwiLCJtb2RhbFNlbGVjdG9yIiwiY2hlY2tLZXlQcmVzcyIsIl9tb2RhbEVsZW1lbnQiLCJkb2N1bWVudCIsIl9lc2NhcGVLZXlIYW5kbGVyIiwiYmluZCIsIl9jaGVja0tleVByZXNzIiwib3BlbiIsImNsb3NlIiwicmVtb3ZlRXZlbnRMaXN0ZW5lciIsInNldEV2ZW50TGlzdGVuZXJzIiwidGFyZ2V0IiwiY29udGFpbnMiLCJNb2RhbFdpdGhGb3JtIiwic2VsZWN0b3IiLCJoYW5kbGVTdWJtaXQiLCJzdXBlciIsIl9oYW5kbGVTdWJtaXQiLCJfc3VibWl0QnV0dG9uIiwiX2Zvcm0iLCJfdGV4dEluQnV0dG9uIiwiZ2V0SW5wdXRWYWx1ZXMiLCJfaW5wdXRMaXN0IiwiZm9ybUlucHV0VmFsdWVzIiwidmFsdWUiLCJfZW50cmVkVmFsdWUiLCJzZXRJbnB1dFZhbHVlcyIsImVudHJlZFZhbHVlIiwicmVzZXQiLCJTZWN0aW9uIiwiaXRlbXMiLCJyZW5kZXJlciIsImNvbnRhaW5lclNlbGVjdG9yIiwiX3JlbmRlcmVkRWxlbWVudHMiLCJfcmVuZGVyZXIiLCJfY29udGFpbmVyIiwicmVuZGVySXRlbXMiLCJpdGVtIiwiYWRkSXRlbSIsInByZXBlbmQiLCJlZGl0QnV0dG9uIiwicHJvZmlsZU1vZGFsIiwicHJvZmlsZU5hbWUiLCJuYW1lSW5wdXQiLCJwcm9maWxlSm9iIiwiam9iSW5wdXQiLCJ1c2VyQXZhdGFyIiwiYXZhdGFyRWRpdEJ1dHRvbiIsImF2YXRhck1vZGFsIiwiYXZhdGFyTW9kYWxJbnB1dCIsImFkZENhcmRCdXR0b24iLCJhZGRDYXJkTW9kYWwiLCJjYXJkSW5wdXRUaXRsZSIsImNhcmRJbnB1dExpbmsiLCJhZGRDYXJkRm9ybSIsImZvcm1zIiwiY2FyZFRlbXBsYXRlIiwiZWxlbWVudHMiLCJ0aXRsZSIsImJpZ0ltYWdlTW9kYWwiLCJiaWdJbWFnZSIsImJpZ0ltYWdlVGl0bGUiLCJmb3JtU2VsZWN0b3IiLCJjaGVja0ZvckVzY1ByZXNzZWQiLCJtb2RhbFJlc2V0SW5wdXRzIiwiYXBpRXJyIiwiZXJyIiwiY29uc29sZSIsImxvZyIsImFwaSIsImNvbmZpZyIsIl9iYXNlVXJsIiwiYmFzZVVybCIsIl9oZWFkZXJzIiwiaGVhZGVycyIsIl9yZXNwb25zZSIsInJlcyIsIm9rIiwianNvbiIsIlByb21pc2UiLCJyZWplY3QiLCJzdGF0dXMiLCJzdGF0dXNUZXh0IiwiZ2V0Q2FyZExpc3QiLCJmZXRjaCIsInRoZW4iLCJnZXRVc2VySW5mbyIsInNldFVzZXJJbmZvIiwiYWJvdXQiLCJtZXRob2QiLCJib2R5IiwiSlNPTiIsInN0cmluZ2lmeSIsImFkZENhcmQiLCJyZW1vdmVDYXJkIiwiY2FyZElkIiwibGlrZUNhcmQiLCJ1bmxpa2VDYXJkIiwic2V0VXNlckF2YXRhciIsImF2YXRhciIsImF1dGhvcml6YXRpb24iLCJwcm9maWxlIiwibmFtZUVsZW1lbnQiLCJ0aXRsZUVsZW1lbnQiLCJwaWN0dXJlRWxlbWVudCIsIl9uYW1lRWxlbWVudCIsIl90aXRsZUVsZW1lbnQiLCJfcGljdHVyZUVsZW1lbnQiLCJqb2IiLCJfam9iIiwiX2F2YXRhciIsImdldFVzZXJEYXRhIiwiX2RhdGEiLCJ1c2VySUQiLCJkZWxldGVDYXJkSGFuZGxlciIsImRlbGV0ZUNhcmRNb2RhbCIsImNhcmQiLCJjYXRjaCIsIm5ld0NhcmRJbnN0YW5jZSIsImNhcmREYXRhIiwiY2FyZFNlY3Rpb24iLCJjYXJkSW5zdGFuY2UiLCJhZGROZXdDYXJkTW9kYWwiLCJ0aXRsZUlucHV0IiwibGlua0lucHV0IiwiYWRkTmV3Q2FyZEluc3RhbmNlIiwiZWRpdFByb2ZpbGVNb2RhbCIsImF2YXRhckVkaXRNb2RhbCIsImF2YXRhckxpbmtJbnB1dCIsImZpbmFsbHkiLCJtb2RhbCIsIl9tb2RhbEltYWdlIiwiX21vZGFsVGl0bGUiXSwic291cmNlUm9vdCI6IiJ9