!function(){"use strict";class e{constructor({cardData:e,isLiked:t,isOwner:s,onCardClick:r,removeHandler:i,likeHandler:n},o){this._name=e.name,this._link=e.link,this._id=e._id,this._ownerId=e.owner._id,this._likes=e.likes,this._likesCount=e.likes.length,this._cardSelector=o,this._onCardClick=r,this._onCardClick=this._onCardClick.bind(this),this._likeHandler=n,this._clickLikeHandler=this._clickLikeHandler.bind(this),this._removeHandler=i,this._removeHandler=this._removeHandler.bind(this),this._isLiked=t,this._isLiked=this._isLiked.bind(this),this._isOwner=s,this._isOwner=this._isOwner.bind(this)}_getTemplate(){return document.querySelector("#card__template").content.querySelector(".card").cloneNode(!0)}likesAmountSet(e){this._item.querySelector(".card__like-count").textContent=e}_likeCard(e){this._item.querySelector("card__like").classList.toggle("card__like-button_active"),this._likeHandler(this),e.stopImmediatePropogation()}deleteCard(){this._item.remove(),this._item=null}_deleteCardHandler(e){e.stopImmediatePropagation(),this._deleteCardHandler(this._id,this)}_setEventListeners(){this._item.querySelector(".card__like-button").addEventListener("click",(e=>{this._likeCard(e)})),this._item.querySelector(".card__delete-button").addEventListener("click",(e=>{this._deleteCardHandler(e)})),this._cardImage.addEventListener("click",(e=>{this._onCardClick(e)}))}generateCard(){return this._item=this._getTemplate(),!0===this._isLiked(this._likes)?this._element.querySelector(".card__like-button").classList.add("card__like_active"):this._element.querySelector(".card__like-button").classList.remove("card__like_active"),!0!==this._isOwner(this._ownerId)&&this._element.querySelector(".card__delete-button").classList.add("card__delete-button_hidden"),this._cardImage=this._item.querySelector(".card__image"),this._setEventListeners(),this._item.querySelector(".card__title").textContent=this._name,this._cardImage.src=this._link,this._cardImage.alt=`Image of  ${this._name} `,this._setEventListeners(),this._item}getID(){return this._id}}class t{constructor(e,t){this._formConfig=e,this._formElement=t}_showInputError=(e,t)=>{const{inputErrorClass:s,errorMessageClass:r}=this._formConfig,i=this._formElement.querySelector(` #${e.id}_error `);i.textContent=t,i.classList.add(r),e.classList.add(s)};_hideInputError=e=>{const{inputErrorClass:t,errorMessageClass:s}=this._formConfig,r=this._formElement.querySelector(` #${e.id}_error `);r.textContent="",r.classList.remove(s),e.classList.remove(t)};resetValidation(){this.inputs.forEach((e=>{this._hideInputError(e)})),this._toggleSubmitButton()}_checkInput=e=>{e.validity.valid?this._hideInputError(e):this._showInputError(e,e.validationMessage)};_checkIfFormValid=()=>this.inputs.every((e=>e.validity.valid));_toggleSubmitButton(){const{inactiveButtonClass:e,submitButtonSelector:t}=this._formConfig,s=this._formElement.querySelector(t);this._checkIfFormValid()?(s.disabled=!1,s.classList.remove(e)):(s.disabled=!0,s.classList.add(e))}_setEventListeners=()=>{const{inputSelector:e}=this._formConfig;return this.inputs=Array.from(this._formElement.querySelectorAll(e)),this.inputs.forEach((e=>{e.addEventListener("input",(()=>{this._checkInput(e),this._toggleSubmitButton()}))})),this._formElement};enableValidation(){this._formElement.addEventListener("submit",(e=>{e.preventDefault()})),this._setEventListeners()}}class s{constructor({items:e,renderer:t},s){this._items=e,this._renderer=t,this._container=document.querySelector(s)}addItem(e){this._container.prepend(e)}clear(){this._container.innerHTML=""}renderItems(){this.clear(),this._items.forEach((e=>{this._renderer(e)}))}}const r=document.querySelector(".profile__edit-button"),i=document.forms.profile,n=(i.elements.name,i.elements.job,document.querySelector(".modal__close-button_type_edit"),document.querySelector(".profile__add-button")),o=document.querySelector(".modal_type_add-card"),a=(document.querySelector(".modal__input_type_name"),document.querySelector(".modal__input_type_link"),document.querySelector(".modal__close-button_type_add-card"),document.forms.add),l=(a.elements.title,a.elements.link,document.querySelector(".modal__submit-button"),document.querySelector(".cards__grid"),document.querySelector(".modal_type_big-image"),document.querySelector(".modal__big-image"),document.querySelector(".modal__image-caption"),document.querySelector(".modal__close-button_type_big-image"),{formSelector:".modal__container",inputSelector:".modal__input",submitButtonSelector:".modal__submit-button",inactiveButtonClass:"modal__submit-button_disabled",inputErrorClass:"modal__input_error",errorMessageClass:"modal__error_visible"});class d{constructor(e){this._modalElement=document.querySelector(e)}_checkForEscClose=e=>{"Escape"===e.key&&this.close()};open=()=>{this._modalElement.classList.add("modal_visible"),document.addEventListener("keyup",this._checkForEscClose)};close=()=>{this._modalElement.classList.remove("modal_visible"),document.removeEventListener("keyup",this._checkForEscClose)};setEventListeners(){this._modalElement.querySelector(".modal__close-button").addEventListener("click",(e=>{this.close(e)})),this._modalElement.addEventListener("click",(e=>{e.target.classList.contains("modal_visible")&&this.close(e)}))}}class c extends d{constructor(e,t){super(e),this._handleSubmitBtn=t,this._formElement=this._modalElement.querySelector(".modal__container")}getInputValues(){const e=Array.from(this._formElement.querySelectorAll(".modal__input")),t={};return e.forEach((e=>{t[e.name]=e.value})),t}setInputValues(e){Array.from(this._formElement.querySelectorAll(".modal__input")).forEach((t=>{t.value=e[t.name]}))}setEventListeners(){super.setEventListeners(),this._formElement.addEventListener("submit",(()=>{this._handleSubmitBtn(this.getInputValues()),this.close(),this._formElement.reset()}))}close(){super.close(),this._formElement.reset()}}class _ extends d{constructor(e,t){super(e),this._form=document.querySelector(this._selector),this._handleSubmit=t,this._handleSubmitHandler=this._handleSubmitHandler.bind(this)}_handleSubmitHandler(e){e.preventDefault(),this._handleSubmit(),super.close()}_setEventListeners(){super._setEventListeners(),this._form.addEventListener("submit",this._handleSubmitHandler)}_removeEventListeners(){super._removeEventListeners(),this._form.removeEventListener("submit",this._handleSubmitHandler)}}const m=new class{constructor({baseUrl:e,headers:t}){this.baseUrl=e,this.headers=t}getInitialCards(){return fetch(this.baseUrl+"/cards",{headers:this.headers}).then((e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`)))}getUserInfo(){return fetch(this.baseUrl+"/users/me",{headers:this.headers}).then((e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`)))}addCard({name:e,link:t}){return fetch(this.baseUrl+"/cards",{headers:this.headers,method:"POST",body:JSON.stringify({name:e,link:t})}).then((e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`)))}removeCard(e){return fetch(this.baseUrl+"/cards/"+e,{headers:this.headers,method:"DELETE"}).then((e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`)))}getAppInfo(){return Promise.all([this.getInitialCards(),this.getUserInfo()])}addLike(e){return fetch(this.baseUrl+"/cards/likes/"+e.getId(),{headers:this.headers,method:"PUT"}).then((e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`)))}removeLike(e){return fetch(this.baseUrl+"/cards/likes/"+e.getId(),{headers:this.headers,method:"DELETE"}).then((e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`)))}updateUserInfo({name:e,about:t}){return fetch(this.baseUrl+"/users/me",{headers:this.headers,method:"PATCH",body:JSON.stringify({name:e,about:t})}).then((e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`)))}setUserAvatar({avatar:e}){return fetch(this.baseUrl+"/users/me/avatar",{headers:this.headers,method:"PATCH",body:JSON.stringify({avatar:e})}).then((e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`)))}}({baseUrl:"https://around.nomoreparties.co/v1/group-12",headers:{authorization:"709a0d9d-db06-4890-a594-b07e7309a353","Content-Type":"application/json"}});function h(t,s,r){return new e({cardData:t,isLiked:e=>void 0!==e.find((e=>e._id===s._id)),isOwner:e=>s._id===e,onCardClick:e=>{u.open(e)},deleteCardHandler:(e,t)=>{const s=new _(".delete-card",(()=>{m.removeCard(e).then((e=>t.removeCard())).catch((e=>console.log(e))).finally((function(){s.close()}))}));s.open()},likeHandler:e=>{void 0!==e._likes.find((e=>e._id===s._id))?m.removeLike(e).then((t=>{e._likes=t.likes,e.setLikes(t.likes.length)})):m.addLike(e).then((t=>{e._likes=t.likes,e.setLikes(t.likes.length)}))}},"#card")}m.getAppInfo().then((([e,t])=>{const r=new s({data:e,renderer:function(e){const s=h(e,t);r.addItem(s.generateCard())}},".cards__grid");r.renderItems(),user.setUserInfo({name:t.name,job:t.about}),user.setUserAvatar({avatar:t.avatar});const i=new c(".add-card",(e=>{m.addCard({name:e.name,link:e.link}).then((e=>{const s=h(e,t);r.addItem(s.generateCard())})).catch((e=>console.log(e))).finally((function(){i.close()}))}));n.addEventListener("click",(()=>{E.resetValidation(),i.open()}))})).catch((e=>console.log(e)));const u=new class extends d{openup=e=>{const t=e.target;this._modalElement.querySelector(".modal__big-image").src=t.src,this._modalElement.querySelector(".modal__big-image").alt=t.alt,this._modalElement.querySelector(".modal__image-caption").textContent=t.alt,this.open()}}(".modal_type_big-image");u.setEventListeners();const b=new class{constructor({name:e,job:t,avatar:s}){this._name=document.querySelector(`${e}`),this._job=document.querySelector(`${t}`),this._avatar=document.querySelector(`${s}`)}getUserInfo(){return{name:this._name.textContent,job:this._job.textContent,avatar:this._avatar.src}}setUserInfo({name:e,job:t}){this._name.textContent=e,this._job.textContent=t}setUserAvatar({avatar:e}){this._avatar.src=e}}(".profile__title",".profile__subtitle");b.setUserInfo({name:"Artiom Shlyusberg",job:"Junior Web Dev"});const p=new c(".modal_type_edit",(e=>{b.setUserInfo(p.getInputValues()),p.close()}));p.setEventListeners(),r.addEventListener("click",(()=>{p.setInputValues(b.getUserInfo()),v.resetValidation(),p.open()}));const k=new c(".modal_type_add-card",(()=>{const e=k.getInputValues();cardsSection.prependItem(createCard(e)),k.close()}));k.setEventListeners();const v=new t(l,i);v.enableValidation();const E=new t(l,o);E.enableValidation()}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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K0UsS0FDdENyRyxLQUFLbU0sUUFBVTlLLFNBQVNDLGNBQWUsR0FBRTZJLEtBRzNDaEIsY0FDRSxNQUFPLENBQ1BqSixLQUFPRixLQUFLQyxNQUFNMkIsWUFDbEJ5RSxJQUFNckcsS0FBS2tNLEtBQUt0SyxZQUNoQnVJLE9BQVFuSyxLQUFLbU0sUUFBUXZKLEtBSXZCK0ksYUFBYSxLQUFDekwsRUFBRCxJQUFPbUcsSUFDbEJyRyxLQUFLQyxNQUFNMkIsWUFBYzFCLEVBQ3pCRixLQUFLa00sS0FBS3RLLFlBQWN5RSxFQUcxQjZELGVBQWUsT0FBQ0MsSUFDZG5LLEtBQUttTSxRQUFRdkosSUFBTXVILElINkZhLGtCQUFtQixzQkFDdkQ4QixFQUFlTixZQUFZLENBQUV6TCxLQUFNLG9CQUFxQm1HLElBQUssbUJBSzdELE1BQU0rRixFQUFrQixJQUFJL0UsRUFBYyxvQkFBcUJvRSxJQUM3RFEsRUFBZU4sWUFBWVMsRUFBZ0IzRSxrQkFDM0MyRSxFQUFnQnJGLFdBR2xCcUYsRUFBZ0JsRixvQkFFaEJuQixFQUFXeEQsaUJBQWlCLFNBQVMsS0FDbkM2SixFQUFnQnZFLGVBQWVvRSxFQUFlOUMsZUFDOUNrRCxFQUFzQnpJLGtCQUN0QndJLEVBQWdCcEYsVUFJbEIsTUFBTVQsRUFBYyxJQUFJYyxFQUFjLHdCQUF3QixLQUM1RCxNQUFNd0UsRUFBVXRGLEVBQVlrQixpQkFDNUIrRCxhQUFhYyxZQUFZQyxXQUFXVixJQUNwQ3RGLEVBQVlRLFdBR2RSLEVBQVlXLG9CQUlaLE1BQU1tRixFQUF3QixJQUFJdEosRUFBY0MsRUFBWWdELEdBQzVEcUcsRUFBc0J0SCxtQkFFdEIsTUFBTStHLEVBQXdCLElBQUkvSSxFQUFjQyxFQUFZc0QsR0FDNUR3RixFQUFzQi9HLG1CIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfNC8uL3NyYy9jb21wb25lbnRzL3NjcmlwdHMvQ2FyZC5qcyIsIndlYnBhY2s6Ly93ZWJfcHJvamVjdF80Ly4vc3JjL2NvbXBvbmVudHMvc2NyaXB0cy9Gb3JtVmFsaWRhdG9yLmpzIiwid2VicGFjazovL3dlYl9wcm9qZWN0XzQvLi9zcmMvY29tcG9uZW50cy9zY3JpcHRzL1NlY3Rpb24uanMiLCJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfNC8uL3NyYy9jb21wb25lbnRzL3V0aWxzL2NvbnN0YW50cy5qcyIsIndlYnBhY2s6Ly93ZWJfcHJvamVjdF80Ly4vc3JjL2NvbXBvbmVudHMvc2NyaXB0cy9Nb2RhbC5qcyIsIndlYnBhY2s6Ly93ZWJfcHJvamVjdF80Ly4vc3JjL2NvbXBvbmVudHMvc2NyaXB0cy9Nb2RhbFdpdGhGb3JtLmpzIiwid2VicGFjazovL3dlYl9wcm9qZWN0XzQvLi9zcmMvY29tcG9uZW50cy9zY3JpcHRzL01vZGFsRGVsZXRlQ29uZmlybWF0aW9uLmpzIiwid2VicGFjazovL3dlYl9wcm9qZWN0XzQvLi9zcmMvcGFnZXMvSW5kZXguanMiLCJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfNC8uL3NyYy9jb21wb25lbnRzL3NjcmlwdHMvQXBpLmpzIiwid2VicGFjazovL3dlYl9wcm9qZWN0XzQvLi9zcmMvY29tcG9uZW50cy9zY3JpcHRzL01vZGFsV2l0aEltYWdlLmpzIiwid2VicGFjazovL3dlYl9wcm9qZWN0XzQvLi9zcmMvY29tcG9uZW50cy9zY3JpcHRzL1VzZXJJbmZvLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImV4cG9ydCBjbGFzcyBDYXJkIHtcclxuICBjb25zdHJ1Y3Rvcih7Y2FyZERhdGEsIGlzTGlrZWQsIGlzT3duZXIsIG9uQ2FyZENsaWNrLCByZW1vdmVIYW5kbGVyLCBsaWtlSGFuZGxlcn0sIGNhcmRTZWxlY3Rvcikge1xyXG4gICAgdGhpcy5fbmFtZSA9IGNhcmREYXRhLm5hbWU7XHJcbiAgICB0aGlzLl9saW5rID0gY2FyZERhdGEubGluaztcclxuICAgIHRoaXMuX2lkID0gY2FyZERhdGEuX2lkO1xyXG4gICAgdGhpcy5fb3duZXJJZCA9IGNhcmREYXRhLm93bmVyLl9pZDtcclxuICAgIHRoaXMuX2xpa2VzID0gY2FyZERhdGEubGlrZXM7XHJcbiAgICB0aGlzLl9saWtlc0NvdW50ID0gY2FyZERhdGEubGlrZXMubGVuZ3RoO1xyXG4gICAgdGhpcy5fY2FyZFNlbGVjdG9yID0gY2FyZFNlbGVjdG9yO1xyXG5cclxuICAgIHRoaXMuX29uQ2FyZENsaWNrID0gb25DYXJkQ2xpY2s7XHJcbiAgICB0aGlzLl9vbkNhcmRDbGljayA9IHRoaXMuX29uQ2FyZENsaWNrLmJpbmQodGhpcyk7XHJcbiAgICB0aGlzLl9saWtlSGFuZGxlciA9IGxpa2VIYW5kbGVyO1xyXG4gICAgdGhpcy5fY2xpY2tMaWtlSGFuZGxlciA9IHRoaXMuX2NsaWNrTGlrZUhhbmRsZXIuYmluZCh0aGlzKTtcclxuICAgIHRoaXMuX3JlbW92ZUhhbmRsZXIgPSByZW1vdmVIYW5kbGVyO1xyXG4gICAgdGhpcy5fcmVtb3ZlSGFuZGxlciA9IHRoaXMuX3JlbW92ZUhhbmRsZXIuYmluZCh0aGlzKTtcclxuXHJcbiAgICB0aGlzLl9pc0xpa2VkID0gaXNMaWtlZDtcclxuICAgIHRoaXMuX2lzTGlrZWQgPSB0aGlzLl9pc0xpa2VkLmJpbmQodGhpcyk7XHJcbiAgICB0aGlzLl9pc093bmVyID0gaXNPd25lcjtcclxuICAgIHRoaXMuX2lzT3duZXIgPSB0aGlzLl9pc093bmVyLmJpbmQodGhpcyk7XHJcbiAgfVxyXG4gIC8vIC0tLSBHZXR0aW5nIHRoZSB0ZW1wbGF0ZSAtLS0gLy9cclxuICBfZ2V0VGVtcGxhdGUoKSB7XHJcbiAgICBjb25zdCBjYXJkID0gZG9jdW1lbnRcclxuICAgICAgLnF1ZXJ5U2VsZWN0b3IoXCIjY2FyZF9fdGVtcGxhdGVcIilcclxuICAgICAgLmNvbnRlbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkXCIpXHJcbiAgICAgIC5jbG9uZU5vZGUodHJ1ZSk7XHJcbiAgICByZXR1cm4gY2FyZDtcclxuICB9XHJcblxyXG4gIC8vIC0tLSBTZXQgdGhlIGxpa2VzIGFtb3VudCBvZiBhIGNhcmQgLS0tIC8vXHJcbiAgbGlrZXNBbW91bnRTZXQobGlrZXNDb3VudCkge1xyXG4gICAgdGhpcy5faXRlbS5xdWVyeVNlbGVjdG9yKCcuY2FyZF9fbGlrZS1jb3VudCcpLnRleHRDb250ZW50ID0gbGlrZXNDb3VudDtcclxuICB9XHJcblxyXG4gIC8vIC0tLSBUb2dnbGUgbGlrZSBidXR0b24gbWV0aG9kIC0tLSAvL1xyXG4gIF9saWtlQ2FyZChldmVudCkge1xyXG4gICAgY29uc3QgbGlrZUVsZW1lbnQgPSB0aGlzLl9pdGVtLnF1ZXJ5U2VsZWN0b3IoJ2NhcmRfX2xpa2UnKTtcclxuICAgIGxpa2VFbGVtZW50LmNsYXNzTGlzdC50b2dnbGUoXCJjYXJkX19saWtlLWJ1dHRvbl9hY3RpdmVcIik7XHJcbiAgICB0aGlzLl9saWtlSGFuZGxlcih0aGlzKTtcclxuICAgIGV2ZW50LnN0b3BJbW1lZGlhdGVQcm9wb2dhdGlvbigpO1xyXG4gIH1cclxuICAvLyAtLS0gQ2FyZCBkZWxldGluZyBtZXRob2QgLS0tIC8vXHJcbiAgZGVsZXRlQ2FyZCgpIHtcclxuICAgIHRoaXMuX2l0ZW0ucmVtb3ZlKCk7XHJcbiAgICB0aGlzLl9pdGVtID0gbnVsbCBcclxuICB9XHJcbiAgLy8gLS0tIFRoZSBjYXJkIGRlbGV0aW5nIGV2ZW50IGhhbmRsZXIgLS0tIC8vXHJcbiAgX2RlbGV0ZUNhcmRIYW5kbGVyKGV2ZW50KSB7XHJcbiAgICBldmVudC5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKTtcclxuICAgIHRoaXMuX2RlbGV0ZUNhcmRIYW5kbGVyKHRoaXMuX2lkLCB0aGlzKTtcclxuICB9XHJcbiAgXHJcbiAgLy8gLS0tIFNldCBldmVudHMgbGlzdGVuZXJzIGZvciB0aGUgY2FyZHMgdGhhdCB3aWxsIGJlIGNyZWF0ZWQhIC0tLSAvL1xyXG4gIF9zZXRFdmVudExpc3RlbmVycygpIHtcclxuICAgIHRoaXMuX2l0ZW1cclxuICAgICAgLnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9fbGlrZS1idXR0b25cIilcclxuICAgICAgLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoZXZlbnQpID0+IHtcclxuICAgICAgICB0aGlzLl9saWtlQ2FyZChldmVudCk7XHJcbiAgICAgIH0pO1xyXG5cclxuICAgIHRoaXMuX2l0ZW1cclxuICAgICAgLnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9fZGVsZXRlLWJ1dHRvblwiKVxyXG4gICAgICAuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIChldmVudCkgPT4ge1xyXG4gICAgICAgIHRoaXMuX2RlbGV0ZUNhcmRIYW5kbGVyKGV2ZW50KTtcclxuICAgICAgfSk7XHJcblxyXG4gICAgdGhpcy5fY2FyZEltYWdlXHJcbiAgICAgIC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKGV2ZW50KSA9PiB7XHJcbiAgICAgICAgdGhpcy5fb25DYXJkQ2xpY2soZXZlbnQpO1xyXG4gICAgICB9KTtcclxuICB9XHJcblxyXG4gIC8vIC0tLSBDcmVhdGluZyB0aGUgY2FyZCBhbmQgY2FyZCBlbGVtZW50cyAtLS0gLy9cclxuICBnZW5lcmF0ZUNhcmQoKSB7XHJcbiAgICB0aGlzLl9pdGVtID0gdGhpcy5fZ2V0VGVtcGxhdGUoKTtcclxuXHJcbiAgICBpZiAodGhpcy5faXNMaWtlZCh0aGlzLl9saWtlcykgPT09IHRydWUpIHtcclxuICAgICAgdGhpcy5fZWxlbWVudC5xdWVyeVNlbGVjdG9yKCcuY2FyZF9fbGlrZS1idXR0b24nKS5jbGFzc0xpc3QuYWRkKCdjYXJkX19saWtlX2FjdGl2ZScpO1xyXG4gICAgfSBcclxuICAgIGVsc2Uge1xyXG4gICAgICB0aGlzLl9lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJy5jYXJkX19saWtlLWJ1dHRvbicpLmNsYXNzTGlzdC5yZW1vdmUoJ2NhcmRfX2xpa2VfYWN0aXZlJyk7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKHRoaXMuX2lzT3duZXIodGhpcy5fb3duZXJJZCkgIT09IHRydWUpIHtcclxuICAgICAgdGhpcy5fZWxlbWVudC5xdWVyeVNlbGVjdG9yKCcuY2FyZF9fZGVsZXRlLWJ1dHRvbicpLmNsYXNzTGlzdC5hZGQoJ2NhcmRfX2RlbGV0ZS1idXR0b25faGlkZGVuJyk7XHJcbiAgICB9XHJcblxyXG4gICAgdGhpcy5fY2FyZEltYWdlID0gdGhpcy5faXRlbVxyXG4gICAgICAucXVlcnlTZWxlY3RvcihcIi5jYXJkX19pbWFnZVwiKTtcclxuICAgIHRoaXMuX3NldEV2ZW50TGlzdGVuZXJzKCk7XHJcbiAgICB0aGlzLl9pdGVtXHJcbiAgICAgIC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX3RpdGxlXCIpXHJcbiAgICAgIC50ZXh0Q29udGVudCA9IHRoaXMuX25hbWU7XHJcbiAgICB0aGlzLl9jYXJkSW1hZ2Uuc3JjID0gdGhpcy5fbGluaztcclxuICAgIHRoaXMuX2NhcmRJbWFnZS5hbHQgPSAnSW1hZ2Ugb2YgJytgICR7dGhpcy5fbmFtZX0gYDtcclxuXHJcbiAgICB0aGlzLl9zZXRFdmVudExpc3RlbmVycygpO1xyXG5cclxuICAgIHJldHVybiB0aGlzLl9pdGVtO1xyXG4gIH1cclxuXHJcbiAgZ2V0SUQoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5faWQ7XHJcbiAgfVxyXG59IiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgRm9ybVZhbGlkYXRvciB7XHJcbiAgY29uc3RydWN0b3IoZm9ybUNvbmZpZywgZm9ybUVsZW1lbnQpIHtcclxuICAgIHRoaXMuX2Zvcm1Db25maWcgPSBmb3JtQ29uZmlnO1xyXG4gICAgdGhpcy5fZm9ybUVsZW1lbnQgPSBmb3JtRWxlbWVudDtcclxuICB9XHJcblxyXG4gIF9zaG93SW5wdXRFcnJvciA9IChpbnB1dEVsZW1lbnQsIGVycm9yTWVzc2FnZSkgPT4ge1xyXG4gICAgY29uc3QgeyBpbnB1dEVycm9yQ2xhc3MsIGVycm9yTWVzc2FnZUNsYXNzIH0gPSB0aGlzLl9mb3JtQ29uZmlnO1xyXG4gICAgY29uc3QgZXJyb3JFbGVtZW50ID0gdGhpcy5fZm9ybUVsZW1lbnQucXVlcnlTZWxlY3RvcihgICMke2lucHV0RWxlbWVudC5pZH1fZXJyb3IgYCk7XHJcbiAgICBlcnJvckVsZW1lbnQudGV4dENvbnRlbnQgPSBlcnJvck1lc3NhZ2U7XHJcbiAgICBlcnJvckVsZW1lbnQuY2xhc3NMaXN0LmFkZChlcnJvck1lc3NhZ2VDbGFzcyk7XHJcbiAgICBpbnB1dEVsZW1lbnQuY2xhc3NMaXN0LmFkZChpbnB1dEVycm9yQ2xhc3MpO1xyXG4gIH07XHJcbiAgXHJcbiAgX2hpZGVJbnB1dEVycm9yID0gKGlucHV0RWxlbWVudCkgPT4ge1xyXG4gICAgY29uc3QgeyBpbnB1dEVycm9yQ2xhc3MsIGVycm9yTWVzc2FnZUNsYXNzIH0gPSB0aGlzLl9mb3JtQ29uZmlnO1xyXG4gICAgY29uc3QgZXJyb3JFbGVtZW50ID0gdGhpcy5fZm9ybUVsZW1lbnQucXVlcnlTZWxlY3RvcihgICMke2lucHV0RWxlbWVudC5pZH1fZXJyb3IgYCk7XHJcbiAgICBlcnJvckVsZW1lbnQudGV4dENvbnRlbnQgPSBcIlwiO1xyXG4gICAgZXJyb3JFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoZXJyb3JNZXNzYWdlQ2xhc3MpO1xyXG4gICAgaW5wdXRFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoaW5wdXRFcnJvckNsYXNzKTtcclxuICB9O1xyXG5cclxuICByZXNldFZhbGlkYXRpb24oKSB7XHJcbiAgICB0aGlzLmlucHV0cy5mb3JFYWNoKChpbnB1dCkgPT4ge1xyXG4gICAgICB0aGlzLl9oaWRlSW5wdXRFcnJvcihpbnB1dCk7XHJcbiAgICB9KTtcclxuICAgIHRoaXMuX3RvZ2dsZVN1Ym1pdEJ1dHRvbigpO1xyXG4gIH1cclxuXHJcbiAgX2NoZWNrSW5wdXQgPSAoaW5wdXRFbGVtZW50KSA9PiB7XHJcbiAgICBpZiAoIWlucHV0RWxlbWVudC52YWxpZGl0eS52YWxpZCkge1xyXG4gICAgICB0aGlzLl9zaG93SW5wdXRFcnJvcihpbnB1dEVsZW1lbnQsIGlucHV0RWxlbWVudC52YWxpZGF0aW9uTWVzc2FnZSk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB0aGlzLl9oaWRlSW5wdXRFcnJvcihpbnB1dEVsZW1lbnQpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgX2NoZWNrSWZGb3JtVmFsaWQgPSAoKSA9PiB0aGlzLmlucHV0cy5ldmVyeSgoaW5wdXQpID0+IGlucHV0LnZhbGlkaXR5LnZhbGlkKTtcclxuXHJcbiAgX3RvZ2dsZVN1Ym1pdEJ1dHRvbigpIHtcclxuICAgIGNvbnN0IHsgaW5hY3RpdmVCdXR0b25DbGFzcywgc3VibWl0QnV0dG9uU2VsZWN0b3IgfSA9IHRoaXMuX2Zvcm1Db25maWc7XHJcbiAgICBjb25zdCBidXR0b25FbGVtZW50ID0gdGhpcy5fZm9ybUVsZW1lbnQucXVlcnlTZWxlY3RvcihzdWJtaXRCdXR0b25TZWxlY3Rvcik7XHJcblxyXG4gICAgaWYgKHRoaXMuX2NoZWNrSWZGb3JtVmFsaWQoKSkge1xyXG4gICAgICBidXR0b25FbGVtZW50LmRpc2FibGVkID0gZmFsc2U7XHJcbiAgICAgIGJ1dHRvbkVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZShpbmFjdGl2ZUJ1dHRvbkNsYXNzKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGJ1dHRvbkVsZW1lbnQuZGlzYWJsZWQgPSB0cnVlO1xyXG4gICAgICBidXR0b25FbGVtZW50LmNsYXNzTGlzdC5hZGQoaW5hY3RpdmVCdXR0b25DbGFzcyk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBfc2V0RXZlbnRMaXN0ZW5lcnMgPSAoKSA9PiB7XHJcbiAgICBjb25zdCB7IGlucHV0U2VsZWN0b3IgfSA9IHRoaXMuX2Zvcm1Db25maWc7XHJcbiAgICB0aGlzLmlucHV0cyA9IEFycmF5LmZyb20odGhpcy5fZm9ybUVsZW1lbnQucXVlcnlTZWxlY3RvckFsbChpbnB1dFNlbGVjdG9yKSk7XHJcblxyXG4gICAgdGhpcy5pbnB1dHMuZm9yRWFjaCgoaW5wdXQpID0+IHtcclxuICAgICAgaW5wdXQuYWRkRXZlbnRMaXN0ZW5lcihcImlucHV0XCIsICgpID0+IHtcclxuICAgICAgICB0aGlzLl9jaGVja0lucHV0KGlucHV0KTtcclxuICAgICAgICB0aGlzLl90b2dnbGVTdWJtaXRCdXR0b24oKTtcclxuICAgICAgfSk7XHJcbiAgICB9KTtcclxuICAgIHJldHVybiB0aGlzLl9mb3JtRWxlbWVudDtcclxuICB9O1xyXG5cclxuICBlbmFibGVWYWxpZGF0aW9uKCkge1xyXG4gICAgdGhpcy5fZm9ybUVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCAoZXZlbnQpID0+IHtcclxuICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcclxuICAgIH0pO1xyXG4gICAgdGhpcy5fc2V0RXZlbnRMaXN0ZW5lcnMoKTtcclxuICB9XHJcbn0iLCJleHBvcnQgZGVmYXVsdCBjbGFzcyBTZWN0aW9uIHtcclxuICBjb25zdHJ1Y3Rvcih7IGl0ZW1zLCByZW5kZXJlciB9LCBjb250YWluZXJTZWxlY3Rvcikge1xyXG4gICAgdGhpcy5faXRlbXMgPSBpdGVtcztcclxuICAgIHRoaXMuX3JlbmRlcmVyID0gcmVuZGVyZXI7XHJcbiAgICB0aGlzLl9jb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGNvbnRhaW5lclNlbGVjdG9yKTtcclxuICB9XHJcblxyXG4gIGFkZEl0ZW0oZWxlbWVudCkge1xyXG4gICAgdGhpcy5fY29udGFpbmVyLnByZXBlbmQoZWxlbWVudCk7XHJcbiAgfVxyXG5cclxuICBjbGVhciAoKSB7XHJcbiAgICB0aGlzLl9jb250YWluZXIuaW5uZXJIVE1MID0gJyc7XHJcbiAgfVxyXG5cclxuICByZW5kZXJJdGVtcygpIHtcclxuICAgIHRoaXMuY2xlYXIoKTtcclxuICAgIFxyXG4gICAgdGhpcy5faXRlbXMuZm9yRWFjaCgoY2FyZCkgPT4ge1xyXG4gICAgICB0aGlzLl9yZW5kZXJlcihjYXJkKTtcclxuICAgIH0pO1xyXG4gIH1cclxufVxyXG4iLCIvLyAtLSAnRWRpdCBwcm9maWxlJyBtb2RhbCBjb25zdHMgLS0gLy9cclxuZXhwb3J0IGNvbnN0IGVkaXRCdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucHJvZmlsZV9fZWRpdC1idXR0b24nKTtcclxuZXhwb3J0IGNvbnN0IHByb2ZpbGVNb2RhbCA9IGRvY3VtZW50LmZvcm1zLnByb2ZpbGU7XHJcbmV4cG9ydCBjb25zdCBuYW1lSW5wdXQgPSBwcm9maWxlTW9kYWwuZWxlbWVudHMubmFtZTtcclxuZXhwb3J0IGNvbnN0IGpvYklucHV0ID0gcHJvZmlsZU1vZGFsLmVsZW1lbnRzLmpvYjtcclxuZXhwb3J0IGNvbnN0IGVkaXRDbG9zZUJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbF9fY2xvc2UtYnV0dG9uX3R5cGVfZWRpdCcpO1xyXG4vLyAtLSAnQWRkLWNhcmQnIG1vZGFsIGNvbnN0cyAtLSAvL1xyXG5leHBvcnQgY29uc3QgYWRkQ2FyZEJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wcm9maWxlX19hZGQtYnV0dG9uJyk7XHJcbmV4cG9ydCBjb25zdCBhZGRDYXJkTW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubW9kYWxfdHlwZV9hZGQtY2FyZCcpO1xyXG5leHBvcnQgY29uc3QgY2FyZElucHV0VGl0bGUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubW9kYWxfX2lucHV0X3R5cGVfbmFtZScpO1xyXG5leHBvcnQgY29uc3QgY2FyZElucHV0TGluayA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbF9faW5wdXRfdHlwZV9saW5rJyk7XHJcbmV4cG9ydCBjb25zdCBhZGRDYXJkQ2xvc2VCdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubW9kYWxfX2Nsb3NlLWJ1dHRvbl90eXBlX2FkZC1jYXJkJyk7XHJcbi8vIC0tLSAnQWRkLUNhcmQnIGZvcm0gY29uc3RzIC0tLSAvL1xyXG5leHBvcnQgY29uc3QgYWRkQ2FyZEZvcm0gPSBkb2N1bWVudC5mb3Jtcy5hZGQ7XHJcbmV4cG9ydCBjb25zdCBhZGRDYXJkRm9ybVRpdGVsID0gYWRkQ2FyZEZvcm0uZWxlbWVudHMudGl0bGU7XHJcbmV4cG9ydCBjb25zdCBhZGRDYXJkRm9ybUxpbmsgPSBhZGRDYXJkRm9ybS5lbGVtZW50cy5saW5rO1xyXG4vLyAtLS0gR2VuZXJhbCBjb25zdCAtLS0gLy9cclxuZXhwb3J0IGNvbnN0IHN1Ym1pdEJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbF9fc3VibWl0LWJ1dHRvbicpO1xyXG5leHBvcnQgY29uc3QgY2FyZExpc3QgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuY2FyZHNfX2dyaWQnKTtcclxuLy8gLS0tIEJpZyBpbWFnZSBtb2RhbCBjb25zdHMgLS0tIC8vXHJcbmV4cG9ydCBjb25zdCBjYXJkQmlnTW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubW9kYWxfdHlwZV9iaWctaW1hZ2UnKTtcclxuZXhwb3J0IGNvbnN0IGNhcmRCaWdNb2RhbEltYWdlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLm1vZGFsX19iaWctaW1hZ2UnKTtcclxuZXhwb3J0IGNvbnN0IGNhcmRCaWdNb2RhbFRleHQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubW9kYWxfX2ltYWdlLWNhcHRpb24nKTtcclxuZXhwb3J0IGNvbnN0IGNhcmRCaWdNb2RhbENsb3NlSWNvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbF9fY2xvc2UtYnV0dG9uX3R5cGVfYmlnLWltYWdlJyk7XHJcbi8vIC0tLSBGb3JtIGNvbmZpZyBjb25zdHMgLS0tIC8vXHJcbmV4cG9ydCBjb25zdCBmb3JtQ29uZmlnID0ge1xyXG4gIGZvcm1TZWxlY3RvcjogXCIubW9kYWxfX2NvbnRhaW5lclwiLFxyXG4gIGlucHV0U2VsZWN0b3I6IFwiLm1vZGFsX19pbnB1dFwiLFxyXG4gIHN1Ym1pdEJ1dHRvblNlbGVjdG9yOiBcIi5tb2RhbF9fc3VibWl0LWJ1dHRvblwiLFxyXG4gIGluYWN0aXZlQnV0dG9uQ2xhc3M6IFwibW9kYWxfX3N1Ym1pdC1idXR0b25fZGlzYWJsZWRcIixcclxuICBpbnB1dEVycm9yQ2xhc3M6IFwibW9kYWxfX2lucHV0X2Vycm9yXCIsXHJcbiAgZXJyb3JNZXNzYWdlQ2xhc3M6IFwibW9kYWxfX2Vycm9yX3Zpc2libGVcIlxyXG59O1xyXG4vLyAtLS0gaW5pdENhcmRzIGNvbnN0cyAtLS0gLy9cclxuZXhwb3J0IGNvbnN0IGluaXRDYXJkcyA9IFtcclxuICB7XHJcbiAgICBuYW1lOiBcIllvc2VtaXRlIFZhbGxleVwiLFxyXG4gICAgbGluazogXCJodHRwczovL2NvZGUuczMueWFuZGV4Lm5ldC93ZWItY29kZS95b3NlbWl0ZS5qcGdcIlxyXG4gIH0sXHJcbiAge1xyXG4gICAgbmFtZTogXCJMYWtlIExvdWlzZVwiLFxyXG4gICAgbGluazogXCJodHRwczovL2NvZGUuczMueWFuZGV4Lm5ldC93ZWItY29kZS9sYWtlLWxvdWlzZS5qcGdcIlxyXG4gIH0sXHJcbiAge1xyXG4gICAgbmFtZTogXCJCYWxkIE1vdW50YWluc1wiLFxyXG4gICAgbGluazogXCJodHRwczovL2NvZGUuczMueWFuZGV4Lm5ldC93ZWItY29kZS9iYWxkLW1vdW50YWlucy5qcGdcIlxyXG4gIH0sXHJcbiAge1xyXG4gICAgbmFtZTogXCJMYXRlbWFyXCIsXHJcbiAgICBsaW5rOiBcImh0dHBzOi8vY29kZS5zMy55YW5kZXgubmV0L3dlYi1jb2RlL2xhdGVtYXIuanBnXCJcclxuICB9LFxyXG4gIHtcclxuICAgIG5hbWU6IFwiVmFub2lzZSBOYXRpb25hbCBQYXJrXCIsXHJcbiAgICBsaW5rOiBcImh0dHBzOi8vY29kZS5zMy55YW5kZXgubmV0L3dlYi1jb2RlL3Zhbm9pc2UuanBnXCJcclxuICB9LFxyXG4gIHtcclxuICAgIG5hbWU6IFwiTGFnbyBkaSBCcmFpZXNcIixcclxuICAgIGxpbms6IFwiaHR0cHM6Ly9jb2RlLnMzLnlhbmRleC5uZXQvd2ViLWNvZGUvbGFnby5qcGdcIlxyXG4gIH1cclxuXTsiLCJleHBvcnQgZGVmYXVsdCBjbGFzcyBNb2RhbCB7XHJcbiAgY29uc3RydWN0b3IobW9kYWxTZWxlY3Rvcikge1xyXG4gICAgdGhpcy5fbW9kYWxFbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcihtb2RhbFNlbGVjdG9yKTtcclxuICB9XHJcbiAgLy8gLS0tIENsb3NlIG1vZGFsIG9uIEVTQyBtZXRob2QgLS0tIC8vXHJcbiAgX2NoZWNrRm9yRXNjQ2xvc2UgPSAoZXZlbnQpID0+IHtcclxuICAgIGlmIChldmVudC5rZXkgPT09IFwiRXNjYXBlXCIpIHtcclxuICAgICAgdGhpcy5jbG9zZSgpO1xyXG4gICAgfVxyXG4gIH1cclxuICAvLyAtLS0gT3BlbiBtb2RhbCBtZXRob2QgLS0tIC8vIFxyXG4gIG9wZW4gPSAoKSA9PiB7XHJcbiAgICB0aGlzLl9tb2RhbEVsZW1lbnQuY2xhc3NMaXN0LmFkZChcIm1vZGFsX3Zpc2libGVcIik7XHJcbiAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwia2V5dXBcIiwgdGhpcy5fY2hlY2tGb3JFc2NDbG9zZSk7XHJcbiAgfVxyXG4gIC8vIC0tLSBDbG9zZSBtb2RhbCBtZXRob2QgLS0tIC8vXHJcbiAgY2xvc2UgPSAoKSA9PiB7XHJcbiAgICB0aGlzLl9tb2RhbEVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZShcIm1vZGFsX3Zpc2libGVcIik7XHJcbiAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKFwia2V5dXBcIiwgdGhpcy5fY2hlY2tGb3JFc2NDbG9zZSk7XHJcbiAgfVxyXG5cclxuICBzZXRFdmVudExpc3RlbmVycygpIHtcclxuICAgIC8vIC0tLSBDbG9zZSBtb2RhbCBvbiBjbG9zZSgnWCcpIGJ1dHRvbiAtLS0gLy9cclxuICAgIHRoaXMuX21vZGFsRWxlbWVudFxyXG4gICAgLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2Nsb3NlLWJ1dHRvblwiKVxyXG4gICAgLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoZXZlbnQpID0+IHtcclxuICAgICAgdGhpcy5jbG9zZShldmVudCk7XHJcbiAgICB9KTtcclxuICAgIC8vIENsb3NlIG1vZGFsIG9uIG92ZXJsYXkob3V0IG9mIHRoZSBtb2RhbCkgY2xpY2sgLS0tIC8vL1xyXG4gICAgdGhpcy5fbW9kYWxFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoZXZlbnQpID0+IHtcclxuICAgICAgaWYgKGV2ZW50LnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoXCJtb2RhbF92aXNpYmxlXCIpKSB7XHJcbiAgICAgICAgdGhpcy5jbG9zZShldmVudCk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxufSIsImltcG9ydCBNb2RhbCBmcm9tIFwiLi9Nb2RhbC5qc1wiO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgTW9kYWxXaXRoRm9ybSBleHRlbmRzIE1vZGFsIHtcclxuICBjb25zdHJ1Y3Rvcihtb2RhbFNlbGVjdG9yLCBoYW5kbGVTdWJtaXQpIHtcclxuICAgIHN1cGVyKG1vZGFsU2VsZWN0b3IpO1xyXG4gICAgdGhpcy5faGFuZGxlU3VibWl0QnRuID0gaGFuZGxlU3VibWl0O1xyXG4gICAgdGhpcy5fZm9ybUVsZW1lbnQgPSB0aGlzLl9tb2RhbEVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fY29udGFpbmVyXCIpO1xyXG4gIH1cclxuXHJcbiAgZ2V0SW5wdXRWYWx1ZXMoKSB7XHJcbiAgICBjb25zdCBpbnB1dExpc3QgPSBBcnJheS5mcm9tKFxyXG4gICAgICB0aGlzLl9mb3JtRWxlbWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLm1vZGFsX19pbnB1dFwiKVxyXG4gICAgKTtcclxuICAgIGNvbnN0IGlucHV0VmFsdWVzID0ge307XHJcbiAgICBpbnB1dExpc3QuZm9yRWFjaCgoaW5wdXQpID0+IHtpbnB1dFZhbHVlc1tpbnB1dC5uYW1lXSA9IGlucHV0LnZhbHVlO30pO1xyXG4gICAgcmV0dXJuIGlucHV0VmFsdWVzO1xyXG4gIH1cclxuXHJcbiAgc2V0SW5wdXRWYWx1ZXModmFsdWVzKSB7XHJcbiAgICBjb25zdCBpbnB1dExpc3QgPSBBcnJheS5mcm9tKFxyXG4gICAgICB0aGlzLl9mb3JtRWxlbWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLm1vZGFsX19pbnB1dFwiKVxyXG4gICAgKTtcclxuICAgIGlucHV0TGlzdC5mb3JFYWNoKChpbnB1dCkgPT4ge2lucHV0LnZhbHVlID0gdmFsdWVzW2lucHV0Lm5hbWVdO30pXHJcbiAgfVxyXG5cclxuICBzZXRFdmVudExpc3RlbmVycygpIHtcclxuICAgIHN1cGVyLnNldEV2ZW50TGlzdGVuZXJzKCk7XHJcbiAgICB0aGlzLl9mb3JtRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsICgpID0+IHtcclxuICAgICAgdGhpcy5faGFuZGxlU3VibWl0QnRuKHRoaXMuZ2V0SW5wdXRWYWx1ZXMoKSk7XHJcbiAgICAgIHRoaXMuY2xvc2UoKTtcclxuICAgICAgdGhpcy5fZm9ybUVsZW1lbnQucmVzZXQoKTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgY2xvc2UoKSB7XHJcbiAgICBzdXBlci5jbG9zZSgpO1xyXG4gICAgdGhpcy5fZm9ybUVsZW1lbnQucmVzZXQoKTtcclxuICB9XHJcbn0iLCJpbXBvcnQgTW9kYWwgZnJvbSAnLi9Nb2RhbC5qcyc7XHJcbiAgXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIE1vZGFsRGVsZXRlQ29uZmlybWF0aW9uIGV4dGVuZHMgTW9kYWwge1xyXG4gIGNvbnN0cnVjdG9yIChzZWxlY3RvciwgaGFuZGxlU3VibWl0KSB7XHJcbiAgICBzdXBlcihzZWxlY3Rvcik7XHJcbiAgICB0aGlzLl9mb3JtID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcih0aGlzLl9zZWxlY3Rvcik7XHJcbiAgICB0aGlzLl9oYW5kbGVTdWJtaXQgPSBoYW5kbGVTdWJtaXQ7XHJcbiAgICB0aGlzLl9oYW5kbGVTdWJtaXRIYW5kbGVyID0gdGhpcy5faGFuZGxlU3VibWl0SGFuZGxlci5iaW5kKHRoaXMpO1xyXG4gIH1cclxuICBcclxuICBfaGFuZGxlU3VibWl0SGFuZGxlciAoZXZlbnQpIHtcclxuICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICB0aGlzLl9oYW5kbGVTdWJtaXQoKTtcclxuICAgIHN1cGVyLmNsb3NlKCk7XHJcbiAgfVxyXG4gIFxyXG4gIF9zZXRFdmVudExpc3RlbmVycyAoKSB7XHJcbiAgICBzdXBlci5fc2V0RXZlbnRMaXN0ZW5lcnMoKTtcclxuICAgIHRoaXMuX2Zvcm0uYWRkRXZlbnRMaXN0ZW5lcignc3VibWl0JywgdGhpcy5faGFuZGxlU3VibWl0SGFuZGxlcik7XHJcbiAgfVxyXG4gIFxyXG4gIF9yZW1vdmVFdmVudExpc3RlbmVycyAoKSB7XHJcbiAgICBzdXBlci5fcmVtb3ZlRXZlbnRMaXN0ZW5lcnMoKTtcclxuICAgIHRoaXMuX2Zvcm0ucmVtb3ZlRXZlbnRMaXN0ZW5lcignc3VibWl0JywgdGhpcy5faGFuZGxlU3VibWl0SGFuZGxlcik7XHJcbiAgfVxyXG59IiwiaW1wb3J0IEFwaSBmcm9tIFwiLi4vY29tcG9uZW50cy9zY3JpcHRzL0FwaS5qc1wiO1xyXG5pbXBvcnQgeyBDYXJkIH0gZnJvbSBcIi4uL2NvbXBvbmVudHMvc2NyaXB0cy9DYXJkLmpzXCI7XHJcbmltcG9ydCBGb3JtVmFsaWRhdG9yIGZyb20gXCIuLi9jb21wb25lbnRzL3NjcmlwdHMvRm9ybVZhbGlkYXRvci5qc1wiO1xyXG5pbXBvcnQgU2VjdGlvbiBmcm9tIFwiLi4vY29tcG9uZW50cy9zY3JpcHRzL1NlY3Rpb24uanNcIjtcclxuaW1wb3J0IHtcclxuICBlZGl0QnV0dG9uLFxyXG4gIHByb2ZpbGVNb2RhbCxcclxuICBhZGRDYXJkQnV0dG9uLFxyXG4gIGFkZENhcmRNb2RhbCxcclxuICBmb3JtQ29uZmlnXHJcbn0gZnJvbSBcIi4uL2NvbXBvbmVudHMvdXRpbHMvY29uc3RhbnRzLmpzXCI7XHJcbmltcG9ydCBNb2RhbFdpdGhJbWFnZSBmcm9tIFwiLi4vY29tcG9uZW50cy9zY3JpcHRzL01vZGFsV2l0aEltYWdlLmpzXCI7XHJcbmltcG9ydCBNb2RhbFdpdGhGb3JtIGZyb20gXCIuLi9jb21wb25lbnRzL3NjcmlwdHMvTW9kYWxXaXRoRm9ybS5qc1wiO1xyXG5pbXBvcnQgTW9kYWxEZWxldGVDb25maXJtYXRpb24gZnJvbSBcIi4uL2NvbXBvbmVudHMvc2NyaXB0cy9Nb2RhbERlbGV0ZUNvbmZpcm1hdGlvbi5qc1wiO1xyXG5pbXBvcnQgVXNlckluZm8gZnJvbSBcIi4uL2NvbXBvbmVudHMvc2NyaXB0cy9Vc2VySW5mby5qc1wiO1xyXG5pbXBvcnQgXCIuL2luZGV4LmNzc1wiO1xyXG5cclxuY29uc3QgYXBpID0gbmV3IEFwaSh7XHJcbiAgYmFzZVVybDogJ2h0dHBzOi8vYXJvdW5kLm5vbW9yZXBhcnRpZXMuY28vdjEvZ3JvdXAtMTInLFxyXG4gIGhlYWRlcnM6IHtcclxuICAgIGF1dGhvcml6YXRpb246ICc3MDlhMGQ5ZC1kYjA2LTQ4OTAtYTU5NC1iMDdlNzMwOWEzNTMnLFxyXG4gICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJ1xyXG4gIH1cclxufSk7IFxyXG5cclxuLy8gKysrKysgQ2FyZCBTZWN0aW9uICsrKysrIC8vXHJcbmNvbnN0IGNhcmRTZWxlY3RvciA9ICcjY2FyZCc7XHJcbi8vIC0tLSBDYXJkIHJlbmRlciBmdW5jdGlvbiAtLS0gLy9cclxuZnVuY3Rpb24gcmVuZGVyQ2FyZCAoaW5pdENhcmQsIHVzZXIsIHNlbGVjdG9yKSB7XHJcbiAgcmV0dXJuIG5ldyBDYXJkKHtcclxuICAgIGNhcmREYXRhOiBpbml0Q2FyZCxcclxuICAgIGlzTGlrZWQ6IChsaXN0TGlrZXMpID0+IHtcclxuICAgICAgcmV0dXJuIChsaXN0TGlrZXMuZmluZChpdGVtID0+IGl0ZW0uX2lkID09PSB1c2VyLl9pZCkgIT09IHVuZGVmaW5lZCk7XHJcbiAgICB9LFxyXG4gICAgaXNPd25lcjogKG93bmVyKSA9PiB7XHJcbiAgICAgIHJldHVybiAodXNlci5faWQgPT09IG93bmVyKTtcclxuICAgIH0sXHJcbiAgICBvbkNhcmRDbGljazogKGNhcmRJbmZvKSA9PiB7XHJcbiAgICAgIGJpZ0ltYWdlTW9kYWwub3BlbihjYXJkSW5mbyk7XHJcbiAgICB9LFxyXG4gICAgZGVsZXRlQ2FyZEhhbmRsZXI6IChpZCwgY2FyZCkgPT4ge1xyXG4gICAgICBjb25zdCBkZWxldGVDb25maXJtID0gbmV3IE1vZGFsRGVsZXRlQ29uZmlybWF0aW9uKCcuZGVsZXRlLWNhcmQnLCAoKSA9PiB7XHJcbiAgICAgICAgYXBpLnJlbW92ZUNhcmQoaWQpXHJcbiAgICAgICAgICAudGhlbihyZXMgPT4gY2FyZC5yZW1vdmVDYXJkKCkpXHJcbiAgICAgICAgICAuY2F0Y2goKGVycikgPT4gY29uc29sZS5sb2coZXJyKSlcclxuICAgICAgICAgIC5maW5hbGx5KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgZGVsZXRlQ29uZmlybS5jbG9zZSgpO1xyXG4gICAgICAgICAgfSk7XHJcbiAgICAgIH0pO1xyXG4gICAgICBkZWxldGVDb25maXJtLm9wZW4oKTtcclxuICAgIH0sXHJcbiAgICBsaWtlSGFuZGxlcjogKGNhcmRJbmZvKSA9PiB7XHJcbiAgICAgIGlmIChjYXJkSW5mby5fbGlrZXMuZmluZChpdGVtID0+IGl0ZW0uX2lkID09PSB1c2VyLl9pZCkgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgIGFwaS5yZW1vdmVMaWtlKGNhcmRJbmZvKVxyXG4gICAgICAgICAgLnRoZW4ocmVzID0+IHtcclxuICAgICAgICAgICAgY2FyZEluZm8uX2xpa2VzID0gcmVzLmxpa2VzO1xyXG4gICAgICAgICAgICBjYXJkSW5mby5zZXRMaWtlcyhyZXMubGlrZXMubGVuZ3RoKTtcclxuICAgICAgICAgIH0pO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGFwaS5hZGRMaWtlKGNhcmRJbmZvKS50aGVuKHJlcyA9PiB7XHJcbiAgICAgICAgICBjYXJkSW5mby5fbGlrZXMgPSByZXMubGlrZXM7XHJcbiAgICAgICAgICBjYXJkSW5mby5zZXRMaWtlcyhyZXMubGlrZXMubGVuZ3RoKTtcclxuICAgICAgICB9KTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH0sXHJcbiAgY2FyZFNlbGVjdG9yKTtcclxufVxyXG5cclxuYXBpLmdldEFwcEluZm8oKVxyXG4gIC50aGVuKChbaW5pdGlhbENhcmRzLCB1c2VySW5mb10pID0+IHtcclxuICAgIGNvbnN0IGNhcmRzU2VjdGlvbiA9IG5ldyBTZWN0aW9uKHtcclxuICAgICAgZGF0YTogaW5pdGlhbENhcmRzLFxyXG4gICAgICByZW5kZXJlcjogZnVuY3Rpb24gKGluaXRpYWxDYXJkKSB7XHJcbiAgICAgICAgY29uc3QgY2FyZCA9IHJlbmRlckNhcmQoaW5pdGlhbENhcmQsIHVzZXJJbmZvLCBjYXJkU2VsZWN0b3IpO1xyXG4gICAgICAgIGNhcmRzU2VjdGlvbi5hZGRJdGVtKGNhcmQuZ2VuZXJhdGVDYXJkKCkpO1xyXG4gICAgICB9XHJcbiAgICB9LCAnLmNhcmRzX19ncmlkJyk7XHJcbiAgICBjYXJkc1NlY3Rpb24ucmVuZGVySXRlbXMoKTtcclxuXHJcbiAgICB1c2VyLnNldFVzZXJJbmZvKHtcclxuICAgICAgbmFtZTogdXNlckluZm8ubmFtZSxcclxuICAgICAgam9iOiB1c2VySW5mby5hYm91dFxyXG4gICAgfSk7XHJcblxyXG4gICAgdXNlci5zZXRVc2VyQXZhdGFyKHtcclxuICAgICAgYXZhdGFyOiB1c2VySW5mby5hdmF0YXJcclxuICAgIH0pO1xyXG5cclxuICAgIGNvbnN0IG1vZGFsQWRkQ2FyZCA9IG5ldyBNb2RhbFdpdGhGb3JtKCcuYWRkLWNhcmQnLCAoY2FyZERhdGEpID0+IHtcclxuICAgICAgYXBpLmFkZENhcmQoeyBuYW1lOiBjYXJkRGF0YS5uYW1lLCBsaW5rOiBjYXJkRGF0YS5saW5rIH0pXHJcbiAgICAgICAgLnRoZW4oKHJlcykgPT4ge1xyXG4gICAgICAgICAgY29uc3QgbmV3Q2FyZCA9IHJlbmRlckNhcmQocmVzLCB1c2VySW5mbywgY2FyZFNlbGVjdG9yKTtcclxuICAgICAgICAgIGNhcmRzU2VjdGlvbi5hZGRJdGVtKG5ld0NhcmQuZ2VuZXJhdGVDYXJkKCkpO1xyXG4gICAgICAgIH0pXHJcbiAgICAgICAgLmNhdGNoKChlcnIpID0+IGNvbnNvbGUubG9nKGVycikpXHJcbiAgICAgICAgLmZpbmFsbHkoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgbW9kYWxBZGRDYXJkLmNsb3NlKCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBhZGRDYXJkQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4ge1xyXG4gICAgICBhZGRDYXJkRm9ybVZhbGlkYXRpb24ucmVzZXRWYWxpZGF0aW9uKCk7XHJcbiAgICAgIG1vZGFsQWRkQ2FyZC5vcGVuKCk7XHJcbiAgICB9KTtcclxuICB9KVxyXG4gIC5jYXRjaCgoZXJyKSA9PiBjb25zb2xlLmxvZyhlcnIpKTtcclxuXHJcbi8vIC0tLSBNb2RhbFdpdGhJbWFnZSBpbnN0YW5jZSAtLS0gLy9cclxuY29uc3QgYmlnSW1hZ2VNb2RhbCA9IG5ldyBNb2RhbFdpdGhJbWFnZShcIi5tb2RhbF90eXBlX2JpZy1pbWFnZVwiKTtcclxuYmlnSW1hZ2VNb2RhbC5zZXRFdmVudExpc3RlbmVycygpO1xyXG5cclxuLy8gKysrKysgJ1VzZXIgSW5mbycgKysrKysgLy9cclxuLy8gLS0tIFVzZXJJbmZvIGluc3RhbmNlIC0tLSAvL1xyXG5jb25zdCB1c2VySW5mb1ZhbHVlcyA9IG5ldyBVc2VySW5mbyhcIi5wcm9maWxlX190aXRsZVwiLCBcIi5wcm9maWxlX19zdWJ0aXRsZVwiKTtcclxudXNlckluZm9WYWx1ZXMuc2V0VXNlckluZm8oeyBuYW1lOiBcIkFydGlvbSBTaGx5dXNiZXJnXCIsIGpvYjogXCJKdW5pb3IgV2ViIERldlwiIH0pO1xyXG5cclxuLy8gKysrKysgRm9ybXMgKysrKysgLy9cclxuLy8gPT09ICdFZGl0IHByb2ZpbGUnIGZvcm0gPT09IC8vXHJcbi8vIC0tLSBGb3JtIGNyZWF0aW9uIG1ldGhvZCAtLS0gLy9cclxuY29uc3QgZWRpdFByb2ZpbGVGb3JtID0gbmV3IE1vZGFsV2l0aEZvcm0oXCIubW9kYWxfdHlwZV9lZGl0XCIsIChkYXRhKSA9PiB7XHJcbiAgdXNlckluZm9WYWx1ZXMuc2V0VXNlckluZm8oZWRpdFByb2ZpbGVGb3JtLmdldElucHV0VmFsdWVzKCkpO1xyXG4gIGVkaXRQcm9maWxlRm9ybS5jbG9zZSgpO1xyXG59KTtcclxuLy8gLS0tIFNldCBldmVudCBsaXN0ZW5lcnMgZm9yIHRoZSBmb3JtIC0tLSAvL1xyXG5lZGl0UHJvZmlsZUZvcm0uc2V0RXZlbnRMaXN0ZW5lcnMoKTtcclxuLy8gLS0tIFNldCB2YWx1ZXMgYW5kIG9wZW4gdGhlIGZvcm0gLS0tIC8vXHJcbmVkaXRCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcclxuICBlZGl0UHJvZmlsZUZvcm0uc2V0SW5wdXRWYWx1ZXModXNlckluZm9WYWx1ZXMuZ2V0VXNlckluZm8oKSlcclxuICBwcm9maWxlRm9ybVZhbGlkYXRpb24ucmVzZXRWYWxpZGF0aW9uKCk7XHJcbiAgZWRpdFByb2ZpbGVGb3JtLm9wZW4oKTtcclxufSk7XHJcbi8vID09PSAnQWRkIGNhcmQnIGZvcm0gPT09IC8vXHJcbi8vIC0tLSBGb3JtIGNyZWF0aW9uIG1ldGhvZCAtLS0gLy9cclxuY29uc3QgYWRkQ2FyZEZvcm0gPSBuZXcgTW9kYWxXaXRoRm9ybShcIi5tb2RhbF90eXBlX2FkZC1jYXJkXCIsICgpID0+IHtcclxuICBjb25zdCBuZXdDYXJkID0gYWRkQ2FyZEZvcm0uZ2V0SW5wdXRWYWx1ZXMoKTtcclxuICBjYXJkc1NlY3Rpb24ucHJlcGVuZEl0ZW0oY3JlYXRlQ2FyZChuZXdDYXJkKSk7XHJcbiAgYWRkQ2FyZEZvcm0uY2xvc2UoKTtcclxufSk7XHJcbi8vIC0tLSBTZXQgZXZlbnQgbGlzdGVuZXJzIGZvciAnYWRkIGNhcmQnIG1vZGFsIC0tLSAvL1xyXG5hZGRDYXJkRm9ybS5zZXRFdmVudExpc3RlbmVycygpO1xyXG5cclxuLy8gKysrKysgVmFsaWRhdGlvbiArKysrKyAvL1xyXG4vLyAtLS0gJ0VkaXQgcHJvZmlsZScgZm9ybSB2YWxpZGF0aW9uIGFkZGluZyAtLS0gLy9cclxuY29uc3QgcHJvZmlsZUZvcm1WYWxpZGF0aW9uID0gbmV3IEZvcm1WYWxpZGF0b3IoZm9ybUNvbmZpZywgcHJvZmlsZU1vZGFsKTtcclxucHJvZmlsZUZvcm1WYWxpZGF0aW9uLmVuYWJsZVZhbGlkYXRpb24oKTtcclxuLy8gLS0tICdBZGQgY2FyZCcgZm9ybSB2YWxpZGF0aW9uIGFkZGluZyAtLS0gLy9cclxuY29uc3QgYWRkQ2FyZEZvcm1WYWxpZGF0aW9uID0gbmV3IEZvcm1WYWxpZGF0b3IoZm9ybUNvbmZpZywgYWRkQ2FyZE1vZGFsKTtcclxuYWRkQ2FyZEZvcm1WYWxpZGF0aW9uLmVuYWJsZVZhbGlkYXRpb24oKTsiLCJleHBvcnQgZGVmYXVsdCBjbGFzcyBBcGkge1xyXG4gIGNvbnN0cnVjdG9yKHsgYmFzZVVybCwgaGVhZGVycyB9KSB7XHJcbiAgICB0aGlzLmJhc2VVcmwgPSBiYXNlVXJsO1xyXG4gICAgdGhpcy5oZWFkZXJzID0gaGVhZGVycztcclxuICB9XHJcblxyXG4gIC8vIC0tLSBHRVQgaHR0cHM6Ly9hcm91bmQubm9tb3JlcGFydGllcy5jby92MS9ncm91cC0xMi9jYXJkcyAtLS0gLy9cclxuICBnZXRJbml0aWFsQ2FyZHMoKSB7XHJcbiAgICByZXR1cm4gZmV0Y2godGhpcy5iYXNlVXJsICsgXCIvY2FyZHNcIiwge1xyXG4gICAgICBoZWFkZXJzOiB0aGlzLmhlYWRlcnNcclxuICAgIH0pXHJcbiAgICAudGhlbigocmVzKSA9PiB7XHJcbiAgICAgIGlmIChyZXMub2spIHtcclxuICAgICAgICByZXR1cm4gcmVzLmpzb24oKTtcclxuICAgICAgfSBcclxuICAgICAgZWxzZSB7XHJcbiAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGBFcnJvcjogJHtyZXMuc3RhdHVzfWApO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8vIC0tLSBHRVQgaHR0cHM6Ly9hcm91bmQubm9tb3JlcGFydGllcy5jby92MS9ncm91cC0xMi91c2Vycy9tZSAtLS0gLy9cclxuICBnZXRVc2VySW5mbygpIHtcclxuICAgIHJldHVybiBmZXRjaCh0aGlzLmJhc2VVcmwgKyBcIi91c2Vycy9tZVwiLCB7XHJcbiAgICAgIGhlYWRlcnM6IHRoaXMuaGVhZGVyc1xyXG4gICAgfSlcclxuICAgIC50aGVuKChyZXMpID0+IHtcclxuICAgICAgaWYgKHJlcy5vaykge1xyXG4gICAgICAgIHJldHVybiByZXMuanNvbigpO1xyXG4gICAgICB9IFxyXG4gICAgICBlbHNlIHtcclxuICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoYEVycm9yOiAke3Jlcy5zdGF0dXN9YCk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLy8gLS0tIFBPU1QgaHR0cHM6Ly9hcm91bmQubm9tb3JlcGFydGllcy5jby92MS9ncm91cC0xMi9jYXJkcyAtLS0gLy9cclxuICBhZGRDYXJkKHsgbmFtZSwgbGluayB9KSB7XHJcbiAgICByZXR1cm4gZmV0Y2godGhpcy5iYXNlVXJsICsgXCIvY2FyZHNcIiwge1xyXG4gICAgICBoZWFkZXJzOiB0aGlzLmhlYWRlcnMsXHJcbiAgICAgIG1ldGhvZDogXCJQT1NUXCIsXHJcbiAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHtuYW1lLGxpbmt9KVxyXG4gICAgfSlcclxuICAgIC50aGVuKChyZXMpID0+IHtcclxuICAgICAgaWYgKHJlcy5vaykge1xyXG4gICAgICAgIHJldHVybiByZXMuanNvbigpO1xyXG4gICAgICB9IFxyXG4gICAgICBlbHNlIHtcclxuICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoYEVycm9yOiAke3Jlcy5zdGF0dXN9YCk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLy8gLS0tIERFTEVURSBodHRwczovL2Fyb3VuZC5ub21vcmVwYXJ0aWVzLmNvL3YxL2dyb3VwLTEyL2NhcmRzL2NhcmRJRCAtLS0gLy9cclxuICByZW1vdmVDYXJkKGNhcmRJRCkge1xyXG4gICAgcmV0dXJuIGZldGNoKHRoaXMuYmFzZVVybCArIFwiL2NhcmRzL1wiICsgY2FyZElELCB7XHJcbiAgICAgIGhlYWRlcnM6IHRoaXMuaGVhZGVycyxcclxuICAgICAgbWV0aG9kOiBcIkRFTEVURVwiXHJcbiAgICB9KVxyXG4gICAgLnRoZW4oKHJlcykgPT4ge1xyXG4gICAgICBpZiAocmVzLm9rKSB7XHJcbiAgICAgICAgcmV0dXJuIHJlcy5qc29uKCk7XHJcbiAgICAgIH0gXHJcbiAgICAgIGVsc2Uge1xyXG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChgRXJyb3I6ICR7cmVzLnN0YXR1c31gKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBnZXRBcHBJbmZvKCkge1xyXG4gICAgcmV0dXJuIFByb21pc2UuYWxsKFt0aGlzLmdldEluaXRpYWxDYXJkcygpLCB0aGlzLmdldFVzZXJJbmZvKCldKTtcclxuICB9XHJcblxyXG4vLyAtLS0gQWRkL3JlbW92ZSBsaWtlcyAtLS0gLy9cclxuICAvLyAtLS0gUFVUIGh0dHBzOi8vYXJvdW5kLm5vbW9yZXBhcnRpZXMuY28vdjEvZ3JvdXBJZC9jYXJkcy9saWtlcy9jYXJkSWQgLS0tIC8vXHJcbiAgYWRkTGlrZShjYXJkKSB7XHJcbiAgICByZXR1cm4gZmV0Y2godGhpcy5iYXNlVXJsICsgXCIvY2FyZHMvbGlrZXMvXCIgKyBjYXJkLmdldElkKCksIHtcclxuICAgICAgaGVhZGVyczogdGhpcy5oZWFkZXJzLFxyXG4gICAgICBtZXRob2Q6IFwiUFVUXCJcclxuICAgIH0pXHJcbiAgICAudGhlbigocmVzKSA9PiB7XHJcbiAgICAgIGlmIChyZXMub2spIHtcclxuICAgICAgICByZXR1cm4gcmVzLmpzb24oKTtcclxuICAgICAgfSBcclxuICAgICAgZWxzZSB7XHJcbiAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGBFcnJvcjogJHtyZXMuc3RhdHVzfWApO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8vIC0tLSBERUxFVEUgaHR0cHM6Ly9hcm91bmQubm9tb3JlcGFydGllcy5jby92MS9ncm91cElkL2NhcmRzL2xpa2VzL2NhcmRJZCAtLS0gLy9cclxuICByZW1vdmVMaWtlKGNhcmQpIHtcclxuICAgIHJldHVybiBmZXRjaCh0aGlzLmJhc2VVcmwgKyBcIi9jYXJkcy9saWtlcy9cIiArIGNhcmQuZ2V0SWQoKSwge1xyXG4gICAgICBoZWFkZXJzOiB0aGlzLmhlYWRlcnMsXHJcbiAgICAgIG1ldGhvZDogXCJERUxFVEVcIlxyXG4gICAgfSlcclxuICAgIC50aGVuKChyZXMpID0+IHtcclxuICAgICAgaWYgKHJlcy5vaykge1xyXG4gICAgICAgIHJldHVybiByZXMuanNvbigpO1xyXG4gICAgICB9IFxyXG4gICAgICBlbHNlIHtcclxuICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoYEVycm9yOiAke3Jlcy5zdGF0dXN9YCk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbi8vIC0tLSBFZGl0aW5nIFByb2ZpbGUgaW5mbyAtLS0gLy9cclxuICAvLyAtLS0gUEFUQ0ggaHR0cHM6Ly9hcm91bmQubm9tb3JlcGFydGllcy5jby92MS9ncm91cElkL3VzZXJzL21lIC0tLSAvL1xyXG4gIHVwZGF0ZVVzZXJJbmZvKHsgbmFtZSwgYWJvdXQgfSkge1xyXG4gICAgcmV0dXJuIGZldGNoKHRoaXMuYmFzZVVybCArIFwiL3VzZXJzL21lXCIsIHtcclxuICAgICAgaGVhZGVyczogdGhpcy5oZWFkZXJzLFxyXG4gICAgICBtZXRob2Q6IFwiUEFUQ0hcIixcclxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe25hbWUsYWJvdXR9KVxyXG4gICAgfSlcclxuICAgIC50aGVuKChyZXMpID0+IHtcclxuICAgICAgaWYgKHJlcy5vaykge1xyXG4gICAgICAgIHJldHVybiByZXMuanNvbigpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChgRXJyb3I6ICR7cmVzLnN0YXR1c31gKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvLyBQQVRDSCBodHRwczovL2Fyb3VuZC5ub21vcmVwYXJ0aWVzLmNvL3YxL2dyb3VwSWQvdXNlcnMvbWUvYXZhdGFyXHJcbiAgc2V0VXNlckF2YXRhcih7IGF2YXRhciB9KSB7XHJcbiAgICByZXR1cm4gZmV0Y2godGhpcy5iYXNlVXJsICsgXCIvdXNlcnMvbWUvYXZhdGFyXCIsIHtcclxuICAgICAgaGVhZGVyczogdGhpcy5oZWFkZXJzLFxyXG4gICAgICBtZXRob2Q6IFwiUEFUQ0hcIixcclxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe2F2YXRhcn0pXHJcbiAgICB9KVxyXG4gICAgLnRoZW4oKHJlcykgPT4ge1xyXG4gICAgICBpZiAocmVzLm9rKSB7XHJcbiAgICAgICAgcmV0dXJuIHJlcy5qc29uKCk7XHJcbiAgICAgIH0gXHJcbiAgICAgIGVsc2Uge1xyXG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChgRXJyb3I6ICR7cmVzLnN0YXR1c31gKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG59IiwiaW1wb3J0IE1vZGFsIGZyb20gXCIuL01vZGFsLmpzXCI7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBNb2RhbFdpdGhJbWFnZSBleHRlbmRzIE1vZGFsIHtcclxuICAvLyAtLS0gT3BlbiBiaWcgaW1hZ2UgbW9kYWwgbWV0aG9kIC0tLSAvL1xyXG4gIG9wZW51cCA9IChldmVudCkgPT4ge1xyXG4gICAgY29uc3QgYmlnSW1hZ2UgPSBldmVudC50YXJnZXQ7XHJcbiAgICB0aGlzLl9tb2RhbEVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fYmlnLWltYWdlXCIpLnNyYyA9IGJpZ0ltYWdlLnNyYztcclxuICAgIHRoaXMuX21vZGFsRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19iaWctaW1hZ2VcIikuYWx0ID0gYmlnSW1hZ2UuYWx0O1xyXG4gICAgdGhpcy5fbW9kYWxFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2ltYWdlLWNhcHRpb25cIikudGV4dENvbnRlbnQgPSBiaWdJbWFnZS5hbHQ7XHJcblxyXG4gICAgdGhpcy5vcGVuKCk7XHJcbiAgfVxyXG59IiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgVXNlckluZm8ge1xyXG4gIGNvbnN0cnVjdG9yKCB7bmFtZSwgam9iLCBhdmF0YXJ9ICkge1xyXG4gICAgdGhpcy5fbmFtZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYCR7bmFtZX1gKTtcclxuICAgIHRoaXMuX2pvYiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYCR7am9ifWApO1xyXG4gICAgdGhpcy5fYXZhdGFyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgJHthdmF0YXJ9YCk7XHJcbiAgfVxyXG5cclxuICBnZXRVc2VySW5mbygpIHtcclxuICAgIHJldHVybiB7XHJcbiAgICBuYW1lIDogdGhpcy5fbmFtZS50ZXh0Q29udGVudCxcclxuICAgIGpvYiA6IHRoaXMuX2pvYi50ZXh0Q29udGVudCxcclxuICAgIGF2YXRhcjogdGhpcy5fYXZhdGFyLnNyY1xyXG4gICAgfTtcclxuICB9XHJcblxyXG4gIHNldFVzZXJJbmZvKCB7bmFtZSwgam9ifSApIHtcclxuICAgIHRoaXMuX25hbWUudGV4dENvbnRlbnQgPSBuYW1lO1xyXG4gICAgdGhpcy5fam9iLnRleHRDb250ZW50ID0gam9iO1xyXG4gIH1cclxuXHJcbiAgc2V0VXNlckF2YXRhcigge2F2YXRhcn0gKSB7XHJcbiAgICB0aGlzLl9hdmF0YXIuc3JjID0gYXZhdGFyO1xyXG4gIH1cclxufVxyXG4iXSwibmFtZXMiOlsiQ2FyZCIsImNvbnN0cnVjdG9yIiwiY2FyZERhdGEiLCJpc0xpa2VkIiwiaXNPd25lciIsIm9uQ2FyZENsaWNrIiwicmVtb3ZlSGFuZGxlciIsImxpa2VIYW5kbGVyIiwiY2FyZFNlbGVjdG9yIiwidGhpcyIsIl9uYW1lIiwibmFtZSIsIl9saW5rIiwibGluayIsIl9pZCIsIl9vd25lcklkIiwib3duZXIiLCJfbGlrZXMiLCJsaWtlcyIsIl9saWtlc0NvdW50IiwibGVuZ3RoIiwiX2NhcmRTZWxlY3RvciIsIl9vbkNhcmRDbGljayIsImJpbmQiLCJfbGlrZUhhbmRsZXIiLCJfY2xpY2tMaWtlSGFuZGxlciIsIl9yZW1vdmVIYW5kbGVyIiwiX2lzTGlrZWQiLCJfaXNPd25lciIsIl9nZXRUZW1wbGF0ZSIsImRvY3VtZW50IiwicXVlcnlTZWxlY3RvciIsImNvbnRlbnQiLCJjbG9uZU5vZGUiLCJsaWtlc0Ftb3VudFNldCIsImxpa2VzQ291bnQiLCJfaXRlbSIsInRleHRDb250ZW50IiwiX2xpa2VDYXJkIiwiZXZlbnQiLCJjbGFzc0xpc3QiLCJ0b2dnbGUiLCJzdG9wSW1tZWRpYXRlUHJvcG9nYXRpb24iLCJkZWxldGVDYXJkIiwicmVtb3ZlIiwiX2RlbGV0ZUNhcmRIYW5kbGVyIiwic3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uIiwiX3NldEV2ZW50TGlzdGVuZXJzIiwiYWRkRXZlbnRMaXN0ZW5lciIsIl9jYXJkSW1hZ2UiLCJnZW5lcmF0ZUNhcmQiLCJfZWxlbWVudCIsImFkZCIsInNyYyIsImFsdCIsImdldElEIiwiRm9ybVZhbGlkYXRvciIsImZvcm1Db25maWciLCJmb3JtRWxlbWVudCIsIl9mb3JtQ29uZmlnIiwiX2Zvcm1FbGVtZW50IiwiX3Nob3dJbnB1dEVycm9yIiwiaW5wdXRFbGVtZW50IiwiZXJyb3JNZXNzYWdlIiwiaW5wdXRFcnJvckNsYXNzIiwiZXJyb3JNZXNzYWdlQ2xhc3MiLCJlcnJvckVsZW1lbnQiLCJpZCIsIl9oaWRlSW5wdXRFcnJvciIsInJlc2V0VmFsaWRhdGlvbiIsImlucHV0cyIsImZvckVhY2giLCJpbnB1dCIsIl90b2dnbGVTdWJtaXRCdXR0b24iLCJfY2hlY2tJbnB1dCIsInZhbGlkaXR5IiwidmFsaWQiLCJ2YWxpZGF0aW9uTWVzc2FnZSIsIl9jaGVja0lmRm9ybVZhbGlkIiwiZXZlcnkiLCJpbmFjdGl2ZUJ1dHRvbkNsYXNzIiwic3VibWl0QnV0dG9uU2VsZWN0b3IiLCJidXR0b25FbGVtZW50IiwiZGlzYWJsZWQiLCJpbnB1dFNlbGVjdG9yIiwiQXJyYXkiLCJmcm9tIiwicXVlcnlTZWxlY3RvckFsbCIsImVuYWJsZVZhbGlkYXRpb24iLCJwcmV2ZW50RGVmYXVsdCIsIlNlY3Rpb24iLCJpdGVtcyIsInJlbmRlcmVyIiwiY29udGFpbmVyU2VsZWN0b3IiLCJfaXRlbXMiLCJfcmVuZGVyZXIiLCJfY29udGFpbmVyIiwiYWRkSXRlbSIsImVsZW1lbnQiLCJwcmVwZW5kIiwiY2xlYXIiLCJpbm5lckhUTUwiLCJyZW5kZXJJdGVtcyIsImNhcmQiLCJlZGl0QnV0dG9uIiwicHJvZmlsZU1vZGFsIiwiZm9ybXMiLCJwcm9maWxlIiwiYWRkQ2FyZEJ1dHRvbiIsImVsZW1lbnRzIiwiam9iIiwiYWRkQ2FyZE1vZGFsIiwiYWRkQ2FyZEZvcm0iLCJ0aXRsZSIsImZvcm1TZWxlY3RvciIsIk1vZGFsIiwibW9kYWxTZWxlY3RvciIsIl9tb2RhbEVsZW1lbnQiLCJfY2hlY2tGb3JFc2NDbG9zZSIsImtleSIsImNsb3NlIiwib3BlbiIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJzZXRFdmVudExpc3RlbmVycyIsInRhcmdldCIsImNvbnRhaW5zIiwiTW9kYWxXaXRoRm9ybSIsImhhbmRsZVN1Ym1pdCIsInN1cGVyIiwiX2hhbmRsZVN1Ym1pdEJ0biIsImdldElucHV0VmFsdWVzIiwiaW5wdXRMaXN0IiwiaW5wdXRWYWx1ZXMiLCJ2YWx1ZSIsInNldElucHV0VmFsdWVzIiwidmFsdWVzIiwicmVzZXQiLCJNb2RhbERlbGV0ZUNvbmZpcm1hdGlvbiIsInNlbGVjdG9yIiwiX2Zvcm0iLCJfc2VsZWN0b3IiLCJfaGFuZGxlU3VibWl0IiwiX2hhbmRsZVN1Ym1pdEhhbmRsZXIiLCJfcmVtb3ZlRXZlbnRMaXN0ZW5lcnMiLCJhcGkiLCJiYXNlVXJsIiwiaGVhZGVycyIsImdldEluaXRpYWxDYXJkcyIsImZldGNoIiwidGhlbiIsInJlcyIsIm9rIiwianNvbiIsIlByb21pc2UiLCJyZWplY3QiLCJzdGF0dXMiLCJnZXRVc2VySW5mbyIsImFkZENhcmQiLCJtZXRob2QiLCJib2R5IiwiSlNPTiIsInN0cmluZ2lmeSIsInJlbW92ZUNhcmQiLCJjYXJkSUQiLCJnZXRBcHBJbmZvIiwiYWxsIiwiYWRkTGlrZSIsImdldElkIiwicmVtb3ZlTGlrZSIsInVwZGF0ZVVzZXJJbmZvIiwiYWJvdXQiLCJzZXRVc2VyQXZhdGFyIiwiYXZhdGFyIiwiYXV0aG9yaXphdGlvbiIsInJlbmRlckNhcmQiLCJpbml0Q2FyZCIsInVzZXIiLCJsaXN0TGlrZXMiLCJ1bmRlZmluZWQiLCJmaW5kIiwiaXRlbSIsImNhcmRJbmZvIiwiYmlnSW1hZ2VNb2RhbCIsImRlbGV0ZUNhcmRIYW5kbGVyIiwiZGVsZXRlQ29uZmlybSIsImNhdGNoIiwiZXJyIiwiY29uc29sZSIsImxvZyIsImZpbmFsbHkiLCJzZXRMaWtlcyIsImluaXRpYWxDYXJkcyIsInVzZXJJbmZvIiwiY2FyZHNTZWN0aW9uIiwiZGF0YSIsImluaXRpYWxDYXJkIiwic2V0VXNlckluZm8iLCJtb2RhbEFkZENhcmQiLCJuZXdDYXJkIiwiYWRkQ2FyZEZvcm1WYWxpZGF0aW9uIiwib3BlbnVwIiwiYmlnSW1hZ2UiLCJ1c2VySW5mb1ZhbHVlcyIsIl9qb2IiLCJfYXZhdGFyIiwiZWRpdFByb2ZpbGVGb3JtIiwicHJvZmlsZUZvcm1WYWxpZGF0aW9uIiwicHJlcGVuZEl0ZW0iLCJjcmVhdGVDYXJkIl0sInNvdXJjZVJvb3QiOiIifQ==