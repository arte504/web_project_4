!function(){"use strict";class e{constructor(e,t){this._formConfig=e,this._formElement=t}_showInputError=(e,t)=>{const{inputErrorClass:r,errorMessageClass:s}=this._formConfig,o=this._formElement.querySelector(` #${e.id}_error `);o.textContent=t,o.classList.add(s),e.classList.add(r)};_hideInputError=e=>{const{inputErrorClass:t,errorMessageClass:r}=this._formConfig,s=this._formElement.querySelector(` #${e.id}_error `);s.textContent="",s.classList.remove(r),e.classList.remove(t)};resetValidation(){this.inputs.forEach((e=>{this._hideInputError(e)})),this._toggleSubmitButton()}_checkInput=e=>{e.validity.valid?this._hideInputError(e):this._showInputError(e,e.validationMessage)};_checkIfFormValid=()=>this.inputs.every((e=>e.validity.valid));_toggleSubmitButton(){const{inactiveButtonClass:e,submitButtonSelector:t}=this._formConfig,r=this._formElement.querySelector(t);this._checkIfFormValid()?(r.disabled=!1,r.classList.remove(e)):(r.disabled=!0,r.classList.add(e))}_setEventListeners=()=>{const{inputSelector:e}=this._formConfig;return this.inputs=Array.from(this._formElement.querySelectorAll(e)),this.inputs.forEach((e=>{e.addEventListener("input",(()=>{this._checkInput(e),this._toggleSubmitButton()}))})),this._formElement};enableValidation(){this._formElement.addEventListener("submit",(e=>{e.preventDefault()})),this._setEventListeners()}}class t{constructor({data:e,onCardClick:t,removeHandler:r,likeHandler:s},o,n){this._name=e.name,this._link=e.link,this._owner=e.owner,this._cardTemplateSelector=n,this._likes=e.likes,this._userId=o,this._onCardClick=t,this._likeHandler=s,this._id=e._id,this._removeHandler=r}id(){return this._id}deleteCard(){const e=document.getElementById(id);e&&e.parentNode.removeChild(e),this._cardElement=null}_renderLikes(){this._likes.some((e=>e._id===this._userId))&&this._cardElement.querySelector(".card__like-button").classList.add("card__like-button_active")}showLikes(e){this._cardElement.querySelector(".card__like-count").textContent=e}updateLikes(e){this._likes=e,this._renderLikes()}_setEventListeners(){this._cardElement.querySelector(".card__like-button").addEventListener("click",(e=>{this._likeCard(e)})),this._cardElement.querySelector(".card__delete-button").addEventListener("click",(()=>{this._removeHandler(this._id)})),this._cardImage.addEventListener("click",(e=>{this._onCardClick(e)}))}_showDeleteIcon(){this._owner._id!==this._userId&&this._cardElement.querySelector(".card__delete-button").classList.add("card__delete-button_hidden")}generateCard(){return this._cardTemplate=document.querySelector(this._cardTemplateSelector).content.querySelector(".card"),this._cardElement=this._cardTemplate.cloneNode(!0),this._cardImage=this._cardElement.querySelector(".card__image"),this._cardTitle=this._cardElement.querySelector(".card__title"),this._cardTitle.textContent=this._name,this._cardImage.src=this._link,this._cardImage.alt=`Image of  ${this._name} `,this._renderLikes(),this.showLikes(this._likes.length),this._showDeleteIcon(),this._cardElement.id=this._id,this._setEventListeners(),this._item}}class r{constructor(e){this._modalSelector=e,this._checkForEscClose=this._checkForEscClose.bind(this)}_checkForEscClose=e=>{"Escape"===e.key&&this.close()};open=()=>{this._modalSelector.classList.add("modal_visible"),document.addEventListener("keyup",this._checkForEscClose)};close=()=>{this._modalSelector.classList.remove("modal_visible"),document.removeEventListener("keyup",this._checkForEscClose)};setEventListeners(){this._modalSelector.addEventListener("click",(e=>{(e.target.classList.contains("modal")||e.target.classList.contains("modal__close-button")||e.target.classList.contains("modal_visible"))&&this.close()}))}}class s extends r{constructor({modalSelector:e,handleSubmit:t}){super(e),this._handleSubmit=t,this._formElement=this._modalSelector.querySelector(".modal__container")}getInputValues(){const e=Array.from(this._formElement.querySelectorAll(".modal__input")),t={};return e.forEach((e=>{t[e.name]=e.value})),t}setInputValues(e){Array.from(this._formElement.querySelectorAll(".modal__input")).forEach((t=>{t.value=e[t.name]}))}setEventListeners(){super.setEventListeners(),this._formElement.addEventListener("submit",(e=>{e.preventDefault(),this._handleSubmit(this.getInputValues())}))}setSubmitHandler(e){this._handleSubmit=e}close(){super.close(),this._formElement.reset()}}class o{constructor({items:e,renderer:t},r){this._items=e,this._renderer=t,this._container=document.querySelector(r)}addItem(e){this._container.prepend(e)}clear(){this._container.innerHTML=""}renderItems(){this.clear(),this._items.forEach((e=>{this._renderer(e)}))}}class n{constructor(e,t,r){this._name=e,this._job=t,this._avatar=r}getUserInfo(){return this._userInfo={title:this._title.textContent,job:this._job.textContent}}setUserInfo(e,t,r){this._userInfo={title:e,job:t,userAvatar:r},r?(avatarImage.src=this._userInfo.userAvatar,profileName.textContent=this._userInfo.title,profileJob.textContent=this._userInfo.job):(profileName.textContent=this._userInfo.title,profileJob.textContent=this._userInfo.job)}}const i=document.querySelector(".profile__edit-button"),a=document.querySelector(".modal_type_edit"),l=document.querySelector(".profile__title"),c=(document.querySelector(".modal__input_type_title"),document.querySelector(".profile__subtitle")),d=(document.querySelector(".modal__input_type_subtitle"),document.querySelector(".modal__close-button_type_edit"),document.querySelector(".profile__image")),_=document.querySelector(".profile__image-edit"),u=document.querySelector(".modal_type_avatar"),h=(u.querySelector(".modal__input_type_avatar"),document.querySelector(".modal__close-button_type_avatar"),document.querySelector(".profile__add-button")),m=document.querySelector(".modal_type_add-card"),b=(document.querySelector(".modal__input_type_name"),document.querySelector(".modal__input_type_link"),document.querySelector(".modal__close-button_type_add-card"),document.forms.add),p=(b.elements.title,b.elements.link,document.querySelector(".modal__submit-button"),document.querySelector(".cards__grid"),document.querySelector(".modal_type_big-image")),f=(document.querySelector(".modal__big-image"),document.querySelector(".modal__image-caption"),document.querySelector(".modal__close-button_type_big-image"),document.querySelector(".modal_type_delete-card")),E={formSelector:".modal__container",inputSelector:".modal__input",submitButtonSelector:".modal__submit-button",inactiveButtonClass:"modal__submit-button_disabled",inputErrorClass:"modal__input_error",errorMessageClass:"modal__error_visible"},S=new class extends r{openup=e=>{const t=e.target;this._modalElement.querySelector(".modal__big-image").src=t.src,this._modalElement.querySelector(".modal__big-image").alt=t.alt,this._modalElement.querySelector(".modal__image-caption").textContent=t.alt,this.open()}}(p);S.setEventListeners();const k=new s({modalSelector:f});function y(e,t){t.querySelector(".modal__submit-button").textContent=e?"Saving...":"Save"}k.setEventListeners();const v=new class{constructor({baseUrl:e,headers:t}){this._baseUrl=e,this._headers=t}getCardList(){return fetch(this._baseUrl+"/cards",{headers:this._headers}).then((function(e){if(e.ok)return e.json().then((e=>e));Promise.reject("Error!"+e.statusText)}))}getUserInfo(){return fetch(this._baseUrl+"/users/me",{headers:this._headers}).then((e=>e.ok?e.json():Promise.reject("Error!"+e.statusText)))}getAppInfo(){return Promise.all([this.getUserInfo(),this.getCardList()])}addCard({name:e,link:t}){return fetch(this._baseUrl+"/cards",{headers:this._headers,method:"POST",body:JSON.stringify({name:e,link:t})}).then((e=>{if(e.ok)return e.json();Promise.reject("Error!"+e.statusText)}))}removeCard(e){return fetch(this._baseUrl+"/cards/"+e,{headers:this._headers,method:"DELETE"}).then((e=>e.ok?e.json():Promise.reject("Error!"+e.statusText)))}addLike(e){return fetch(this._baseUrl+"/cards/likes/"+e,{headers:this._headers,method:"PUT"}).then((e=>{if(e.ok)return e.json();Promise.reject("Error!"+e.statusText)}))}removeLike(e){return fetch(this._baseUrl+"/cards/likes/"+e,{headers:this._headers,method:"DELETE"}).then((e=>e.ok?e.json():Promise.reject("Error!"+e.statusText)))}setUserInfo({name:e,job:t}){return fetch(this._baseUrl+"/users/me",{headers:this._headers,method:"PATCH",body:JSON.stringify({name:e,job:t})}).then((e=>e.ok?e.json():Promise.reject("Error!"+e.statusText+e.status)))}setUserAvatar({avatar:e}){return fetch(this._baseUrl+"/users/me/avatar",{headers:this._headers,method:"PATCH",body:JSON.stringify({avatar:e})}).then((e=>e.ok?e.json():Promise.reject("Error!"+e.statusText)))}updateUserInfo({name:e,job:t}){return fetch(this._baseUrl+"/users/me",{headers:this._headers,method:"PATCH",body:JSON.stringify({name:e,job:t})}).then((e=>e.ok?e.json():Promise.reject("Error!"+e.statusText)))}}({baseUrl:"https://around.nomoreparties.co/v1/group-12",headers:{authorization:"709a0d9d-db06-4890-a594-b07e7309a353","Content-Type":"application/json"}});v.getAppInfo().then((([e,r])=>{const _=new o({items:r,renderer:b},".cards__grid");_.renderItems();const u=new s({modalSelector:m,modalSubmition:e=>{y(!0,m),v.addCard(e).then((e=>{console.log(e),b(e),u.close(),y(!1,m)})).catch((e=>console.log(e)))}});function b(r){const s=new t({data:r,handleCardClick:({name:e,link:t})=>{S.open(t,e)},handleDeleteClick:e=>{k.open(e),k.setSubmitHandler((()=>{v.removeCard(e).then((()=>{s.deleteCardModal(),k.close()})).catch((e=>console.log(e)))}))},likeHandler:e=>{o.querySelector(".card__like-button").classList.contains("card__like-button_active")?v.deleteLike(e).then((e=>{o.querySelector(".card__like-button").classList.remove("card__like-button_active"),s.showLikes(e.likes.length),s._likes=e.likes})).catch((e=>console.log(e))):(s._cardElement.classList.toggle("card__like-button_active"),v.addLike(e).then((e=>{o.querySelector(".card__like-button").classList.add("card__like-button_active"),s.showLikes(e.likes.length),s._likes=e.likes})).catch((e=>console.log(e))))}},e._id,".card__template"),o=s.generateCard();_.addItem(o),y(!0,m)}h.addEventListener("click",(()=>{u.open(),y(!1,m)})),u.setEventListeners();const p=new n(l,c,d);v.getUserInfo().then((e=>{p.setUserInfo(e.name,e.job,e.avatar)}));const f=new s({modalSelector:a,modalSubmition:e=>{y(!0,a),v.setUserInfos({name:e.title,about:e.desc}).then((e=>{y(!1,a),p.setUserInfo(e.name,e.about),f.close(),console.log(e)})).catch((e=>console.log(e)))}});f.setEventListeners(),i.addEventListener("click",(()=>{f.open();const e=p.getUserInfo();inputName.value=e.title,inputJob.value=e.job}))})).catch((e=>console.log(e)));const g=new s({modalSelector:u,modalSubmition:e=>{!function(e){y(!0,u),v.setUserAvatar({avatar:e.avatarURL}).then((e=>{d.src=e.avatar,y(!1,u),g.close()})).catch((e=>console.log(e)))}(e)}});_.addEventListener("click",(()=>{g.open()})),g.setEventListeners(),new e(E,a).enableValidation(),new e(E,u).enableValidation(),new e(E,m).enableValidation()}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QyxJQUFJRSxLQWlCMUIsTUFBTWMsRUFBYSxJQUFJOUcsRUFBYyxDQUNuQ1osY0FBZXVELEVBQ2ZpRCxlQUFpQnZKLEtBZm5CLFNBQTBCQSxHQUN4QmtILEdBQWEsRUFBTVosR0FDbkJlLEVBQUkwQixjQUFjLENBQ2hCeEQsT0FBUXZGLEVBQUswSyxZQUVkOUMsTUFBS0MsSUFDSjdCLEVBQUFBLElBQWtCNkIsRUFBSXRDLE9BQ3RCMkIsR0FBYSxFQUFPWixHQUNwQm1FLEVBQVdySCxXQUVac0csT0FBTUMsR0FBT0gsUUFBUUMsSUFBSUUsS0FNeEJnQixDQUFpQjNLLE1BSXJCcUcsRUFBaUIxRyxpQkFBaUIsU0FBUyxLQUN6QzhLLEVBQVdwSCxVQUdib0gsRUFBV2xILG9CQUltQixJQUFJcEcsRUFBY0UsRUFBWStJLEdBQ3RDeEcsbUJBRU8sSUFBSXpDLEVBQWNFLEVBQVlpSixHQUN0QzFHLG1CQUVTLElBQUl6QyxFQUFjRSxFQUFZbUosR0FDdEM1RyxtQiIsInNvdXJjZXMiOlsid2VicGFjazovL3dlYl9wcm9qZWN0XzQvLi9zcmMvY29tcG9uZW50cy9zY3JpcHRzL0Zvcm1WYWxpZGF0b3IuanMiLCJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfNC8uL3NyYy9jb21wb25lbnRzL3NjcmlwdHMvQ2FyZC5qcyIsIndlYnBhY2s6Ly93ZWJfcHJvamVjdF80Ly4vc3JjL2NvbXBvbmVudHMvc2NyaXB0cy9Nb2RhbC5qcyIsIndlYnBhY2s6Ly93ZWJfcHJvamVjdF80Ly4vc3JjL2NvbXBvbmVudHMvc2NyaXB0cy9Nb2RhbFdpdGhGb3JtLmpzIiwid2VicGFjazovL3dlYl9wcm9qZWN0XzQvLi9zcmMvY29tcG9uZW50cy9zY3JpcHRzL1NlY3Rpb24uanMiLCJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfNC8uL3NyYy9jb21wb25lbnRzL3NjcmlwdHMvVXNlckluZm8uanMiLCJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfNC8uL3NyYy9jb21wb25lbnRzL3V0aWxzL2NvbnN0YW50cy5qcyIsIndlYnBhY2s6Ly93ZWJfcHJvamVjdF80Ly4vc3JjL3BhZ2VzL0luZGV4LmpzIiwid2VicGFjazovL3dlYl9wcm9qZWN0XzQvLi9zcmMvY29tcG9uZW50cy9zY3JpcHRzL01vZGFsV2l0aEltYWdlLmpzIiwid2VicGFjazovL3dlYl9wcm9qZWN0XzQvLi9zcmMvY29tcG9uZW50cy9zY3JpcHRzL0FwaS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnQgZGVmYXVsdCBjbGFzcyBGb3JtVmFsaWRhdG9yIHtcclxuICBjb25zdHJ1Y3Rvcihmb3JtQ29uZmlnLCBmb3JtRWxlbWVudCkge1xyXG4gICAgdGhpcy5fZm9ybUNvbmZpZyA9IGZvcm1Db25maWc7XHJcbiAgICB0aGlzLl9mb3JtRWxlbWVudCA9IGZvcm1FbGVtZW50O1xyXG4gIH1cclxuXHJcbiAgX3Nob3dJbnB1dEVycm9yID0gKGlucHV0RWxlbWVudCwgZXJyb3JNZXNzYWdlKSA9PiB7XHJcbiAgICBjb25zdCB7IGlucHV0RXJyb3JDbGFzcywgZXJyb3JNZXNzYWdlQ2xhc3MgfSA9IHRoaXMuX2Zvcm1Db25maWc7XHJcbiAgICBjb25zdCBlcnJvckVsZW1lbnQgPSB0aGlzLl9mb3JtRWxlbWVudC5xdWVyeVNlbGVjdG9yKGAgIyR7aW5wdXRFbGVtZW50LmlkfV9lcnJvciBgKTtcclxuICAgIGVycm9yRWxlbWVudC50ZXh0Q29udGVudCA9IGVycm9yTWVzc2FnZTtcclxuICAgIGVycm9yRWxlbWVudC5jbGFzc0xpc3QuYWRkKGVycm9yTWVzc2FnZUNsYXNzKTtcclxuICAgIGlucHV0RWxlbWVudC5jbGFzc0xpc3QuYWRkKGlucHV0RXJyb3JDbGFzcyk7XHJcbiAgfTtcclxuICBcclxuICBfaGlkZUlucHV0RXJyb3IgPSAoaW5wdXRFbGVtZW50KSA9PiB7XHJcbiAgICBjb25zdCB7IGlucHV0RXJyb3JDbGFzcywgZXJyb3JNZXNzYWdlQ2xhc3MgfSA9IHRoaXMuX2Zvcm1Db25maWc7XHJcbiAgICBjb25zdCBlcnJvckVsZW1lbnQgPSB0aGlzLl9mb3JtRWxlbWVudC5xdWVyeVNlbGVjdG9yKGAgIyR7aW5wdXRFbGVtZW50LmlkfV9lcnJvciBgKTtcclxuICAgIGVycm9yRWxlbWVudC50ZXh0Q29udGVudCA9IFwiXCI7XHJcbiAgICBlcnJvckVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZShlcnJvck1lc3NhZ2VDbGFzcyk7XHJcbiAgICBpbnB1dEVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZShpbnB1dEVycm9yQ2xhc3MpO1xyXG4gIH07XHJcblxyXG4gIHJlc2V0VmFsaWRhdGlvbigpIHtcclxuICAgIHRoaXMuaW5wdXRzLmZvckVhY2goKGlucHV0KSA9PiB7XHJcbiAgICAgIHRoaXMuX2hpZGVJbnB1dEVycm9yKGlucHV0KTtcclxuICAgIH0pO1xyXG4gICAgdGhpcy5fdG9nZ2xlU3VibWl0QnV0dG9uKCk7XHJcbiAgfVxyXG5cclxuICBfY2hlY2tJbnB1dCA9IChpbnB1dEVsZW1lbnQpID0+IHtcclxuICAgIGlmICghaW5wdXRFbGVtZW50LnZhbGlkaXR5LnZhbGlkKSB7XHJcbiAgICAgIHRoaXMuX3Nob3dJbnB1dEVycm9yKGlucHV0RWxlbWVudCwgaW5wdXRFbGVtZW50LnZhbGlkYXRpb25NZXNzYWdlKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRoaXMuX2hpZGVJbnB1dEVycm9yKGlucHV0RWxlbWVudCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBfY2hlY2tJZkZvcm1WYWxpZCA9ICgpID0+IHRoaXMuaW5wdXRzLmV2ZXJ5KChpbnB1dCkgPT4gaW5wdXQudmFsaWRpdHkudmFsaWQpO1xyXG5cclxuICBfdG9nZ2xlU3VibWl0QnV0dG9uKCkge1xyXG4gICAgY29uc3QgeyBpbmFjdGl2ZUJ1dHRvbkNsYXNzLCBzdWJtaXRCdXR0b25TZWxlY3RvciB9ID0gdGhpcy5fZm9ybUNvbmZpZztcclxuICAgIGNvbnN0IGJ1dHRvbkVsZW1lbnQgPSB0aGlzLl9mb3JtRWxlbWVudC5xdWVyeVNlbGVjdG9yKHN1Ym1pdEJ1dHRvblNlbGVjdG9yKTtcclxuXHJcbiAgICBpZiAodGhpcy5fY2hlY2tJZkZvcm1WYWxpZCgpKSB7XHJcbiAgICAgIGJ1dHRvbkVsZW1lbnQuZGlzYWJsZWQgPSBmYWxzZTtcclxuICAgICAgYnV0dG9uRWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKGluYWN0aXZlQnV0dG9uQ2xhc3MpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgYnV0dG9uRWxlbWVudC5kaXNhYmxlZCA9IHRydWU7XHJcbiAgICAgIGJ1dHRvbkVsZW1lbnQuY2xhc3NMaXN0LmFkZChpbmFjdGl2ZUJ1dHRvbkNsYXNzKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIF9zZXRFdmVudExpc3RlbmVycyA9ICgpID0+IHtcclxuICAgIGNvbnN0IHsgaW5wdXRTZWxlY3RvciB9ID0gdGhpcy5fZm9ybUNvbmZpZztcclxuICAgIHRoaXMuaW5wdXRzID0gQXJyYXkuZnJvbSh0aGlzLl9mb3JtRWxlbWVudC5xdWVyeVNlbGVjdG9yQWxsKGlucHV0U2VsZWN0b3IpKTtcclxuXHJcbiAgICB0aGlzLmlucHV0cy5mb3JFYWNoKChpbnB1dCkgPT4ge1xyXG4gICAgICBpbnB1dC5hZGRFdmVudExpc3RlbmVyKFwiaW5wdXRcIiwgKCkgPT4ge1xyXG4gICAgICAgIHRoaXMuX2NoZWNrSW5wdXQoaW5wdXQpO1xyXG4gICAgICAgIHRoaXMuX3RvZ2dsZVN1Ym1pdEJ1dHRvbigpO1xyXG4gICAgICB9KTtcclxuICAgIH0pO1xyXG4gICAgcmV0dXJuIHRoaXMuX2Zvcm1FbGVtZW50O1xyXG4gIH07XHJcblxyXG4gIGVuYWJsZVZhbGlkYXRpb24oKSB7XHJcbiAgICB0aGlzLl9mb3JtRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIChldmVudCkgPT4ge1xyXG4gICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgfSk7XHJcbiAgICB0aGlzLl9zZXRFdmVudExpc3RlbmVycygpO1xyXG4gIH1cclxufSIsImV4cG9ydCBkZWZhdWx0IGNsYXNzIENhcmQge1xyXG4gIGNvbnN0cnVjdG9yKFxyXG4gICAgeyBkYXRhLCBvbkNhcmRDbGljaywgcmVtb3ZlSGFuZGxlciwgbGlrZUhhbmRsZXIgfSxcclxuICAgIHVzZXJJZCwgY2FyZFRlbXBsYXRlU2VsZWN0b3JcclxuICApIHtcclxuICAgIHRoaXMuX25hbWUgPSBkYXRhLm5hbWU7XHJcbiAgICB0aGlzLl9saW5rID0gZGF0YS5saW5rO1xyXG4gICAgdGhpcy5fb3duZXIgPSBkYXRhLm93bmVyO1xyXG4gICAgdGhpcy5fY2FyZFRlbXBsYXRlU2VsZWN0b3IgPSBjYXJkVGVtcGxhdGVTZWxlY3RvcjtcclxuICAgIHRoaXMuX2xpa2VzID0gZGF0YS5saWtlcztcclxuICAgIHRoaXMuX3VzZXJJZCA9IHVzZXJJZDtcclxuICAgIHRoaXMuX29uQ2FyZENsaWNrID0gb25DYXJkQ2xpY2s7XHJcbiAgICB0aGlzLl9saWtlSGFuZGxlciA9IGxpa2VIYW5kbGVyO1xyXG4gICAgdGhpcy5faWQgPSBkYXRhLl9pZDtcclxuICAgIHRoaXMuX3JlbW92ZUhhbmRsZXIgPSByZW1vdmVIYW5kbGVyO1xyXG4gIH1cclxuXHJcbiAgaWQoKXtcclxuICAgIHJldHVybiB0aGlzLl9pZDtcclxuICB9XHJcbiAgLy8gLS0tIENhcmQgZGVsZXRpbmcgbWV0aG9kIC0tLSAvL1xyXG4gIGRlbGV0ZUNhcmQoKSB7XHJcbiAgICBjb25zdCBjYXJkRWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkKTtcclxuICAgIGlmKGNhcmRFbGVtZW50KXtcclxuICAgICAgY2FyZEVsZW1lbnQucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChjYXJkRWxlbWVudCk7XHJcbiAgICB9XHJcbiAgICB0aGlzLl9jYXJkRWxlbWVudCA9IG51bGw7XHJcbiAgfVxyXG5cclxuICBfcmVuZGVyTGlrZXMgKCl7XHJcbiAgICAvL2NvbnNvbGUubG9nKHRoaXMuX2xpa2VzKTtcclxuICAgIGlmICh0aGlzLl9saWtlcy5zb21lKChsaWtlKSA9PiBsaWtlLl9pZCA9PT0gdGhpcy5fdXNlcklkKSkge1xyXG4gICAgICAgIHRoaXMuX2NhcmRFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9fbGlrZS1idXR0b25cIikuY2xhc3NMaXN0LmFkZChcImNhcmRfX2xpa2UtYnV0dG9uX2FjdGl2ZVwiKTtcclxuICAgIH1cclxuICB9XHJcbiAgc2hvd0xpa2VzKGNvdW50KXtcclxuICAgIHRoaXMuX2NhcmRFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9fbGlrZS1jb3VudFwiKS50ZXh0Q29udGVudCA9IGNvdW50O1xyXG4gIH1cclxuXHJcbiAgLy8gLS0tIFRvZ2dsZSBsaWtlIGJ1dHRvbiBtZXRob2QgLS0tIC8vXHJcbiAgdXBkYXRlTGlrZXMobmV3TGlrZXMpIHtcclxuICAgIHRoaXMuX2xpa2VzID0gbmV3TGlrZXM7XHJcbiAgICB0aGlzLl9yZW5kZXJMaWtlcygpO1xyXG4gIH1cclxuXHJcbiAgLy8gLS0tIFNldCBldmVudHMgbGlzdGVuZXJzIGZvciB0aGUgY2FyZHMgdGhhdCB3aWxsIGJlIGNyZWF0ZWQhIC0tLSAvL1xyXG4gIF9zZXRFdmVudExpc3RlbmVycygpIHtcclxuICAgIHRoaXMuX2NhcmRFbGVtZW50XHJcbiAgICAgIC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX2xpa2UtYnV0dG9uXCIpXHJcbiAgICAgIC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKGV2ZW50KSA9PiB7XHJcbiAgICAgICAgdGhpcy5fbGlrZUNhcmQoZXZlbnQpO1xyXG4gICAgICB9KTtcclxuXHJcbiAgICB0aGlzLl9jYXJkRWxlbWVudFxyXG4gICAgICAucXVlcnlTZWxlY3RvcihcIi5jYXJkX19kZWxldGUtYnV0dG9uXCIpXHJcbiAgICAgIC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xyXG4gICAgICAgIHRoaXMuX3JlbW92ZUhhbmRsZXIodGhpcy5faWQpO1xyXG4gICAgICB9KTtcclxuXHJcbiAgICB0aGlzLl9jYXJkSW1hZ2UuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIChldmVudCkgPT4ge1xyXG4gICAgICB0aGlzLl9vbkNhcmRDbGljayhldmVudCk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIF9zaG93RGVsZXRlSWNvbigpIHtcclxuICAgIGlmKHRoaXMuX293bmVyLl9pZCAhPT0gdGhpcy5fdXNlcklkKSB7XHJcbiAgICAgIHRoaXMuX2NhcmRFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJy5jYXJkX19kZWxldGUtYnV0dG9uJykuY2xhc3NMaXN0LmFkZCgnY2FyZF9fZGVsZXRlLWJ1dHRvbl9oaWRkZW4nKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8vIC0tLSBDcmVhdGluZyB0aGUgY2FyZCBhbmQgY2FyZCBlbGVtZW50cyAtLS0gLy9cclxuICBnZW5lcmF0ZUNhcmQoKSB7XHJcbiAgICB0aGlzLl9jYXJkVGVtcGxhdGUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHRoaXMuX2NhcmRUZW1wbGF0ZVNlbGVjdG9yKS5jb250ZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZFwiKTtcclxuICAgIHRoaXMuX2NhcmRFbGVtZW50ID0gdGhpcy5fY2FyZFRlbXBsYXRlLmNsb25lTm9kZSh0cnVlKTtcclxuICAgIHRoaXMuX2NhcmRJbWFnZSA9IHRoaXMuX2NhcmRFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9faW1hZ2VcIik7XHJcbiAgICB0aGlzLl9jYXJkVGl0bGUgPSB0aGlzLl9jYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX3RpdGxlXCIpO1xyXG4gICAgdGhpcy5fY2FyZFRpdGxlLnRleHRDb250ZW50ID0gdGhpcy5fbmFtZTtcclxuICAgIHRoaXMuX2NhcmRJbWFnZS5zcmMgPSB0aGlzLl9saW5rO1xyXG4gICAgdGhpcy5fY2FyZEltYWdlLmFsdCA9IFwiSW1hZ2Ugb2YgXCIgKyBgICR7dGhpcy5fbmFtZX0gYDtcclxuICAgIHRoaXMuX3JlbmRlckxpa2VzKCk7XHJcbiAgICB0aGlzLnNob3dMaWtlcyh0aGlzLl9saWtlcy5sZW5ndGgpO1xyXG4gICAgdGhpcy5fc2hvd0RlbGV0ZUljb24oKTtcclxuICAgIHRoaXMuX2NhcmRFbGVtZW50LmlkID0gdGhpcy5faWQ7XHJcbiAgICB0aGlzLl9zZXRFdmVudExpc3RlbmVycygpO1xyXG5cclxuICAgIHJldHVybiB0aGlzLl9pdGVtO1xyXG4gIH1cclxufVxyXG4iLCJleHBvcnQgZGVmYXVsdCBjbGFzcyBNb2RhbCB7XHJcbiAgY29uc3RydWN0b3IobW9kYWxTZWxlY3Rvcikge1xyXG4gICAgdGhpcy5fbW9kYWxTZWxlY3RvciA9IG1vZGFsU2VsZWN0b3I7XHJcbiAgICB0aGlzLl9jaGVja0ZvckVzY0Nsb3NlID0gdGhpcy5fY2hlY2tGb3JFc2NDbG9zZS5iaW5kKHRoaXMpO1xyXG4gIH1cclxuICAvLyAtLS0gQ2xvc2UgbW9kYWwgb24gRVNDIG1ldGhvZCAtLS0gLy9cclxuICBfY2hlY2tGb3JFc2NDbG9zZSA9IChldmVudCkgPT4ge1xyXG4gICAgaWYgKGV2ZW50LmtleSA9PT0gXCJFc2NhcGVcIikge1xyXG4gICAgICB0aGlzLmNsb3NlKCk7XHJcbiAgICB9XHJcbiAgfVxyXG4gIC8vIC0tLSBPcGVuIG1vZGFsIG1ldGhvZCAtLS0gLy8gXHJcbiAgb3BlbiA9ICgpID0+IHtcclxuICAgIHRoaXMuX21vZGFsU2VsZWN0b3IuY2xhc3NMaXN0LmFkZChcIm1vZGFsX3Zpc2libGVcIik7XHJcbiAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwia2V5dXBcIiwgdGhpcy5fY2hlY2tGb3JFc2NDbG9zZSk7XHJcbiAgfVxyXG4gIC8vIC0tLSBDbG9zZSBtb2RhbCBtZXRob2QgLS0tIC8vXHJcbiAgY2xvc2UgPSAoKSA9PiB7XHJcbiAgICB0aGlzLl9tb2RhbFNlbGVjdG9yLmNsYXNzTGlzdC5yZW1vdmUoXCJtb2RhbF92aXNpYmxlXCIpO1xyXG4gICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImtleXVwXCIsIHRoaXMuX2NoZWNrRm9yRXNjQ2xvc2UpO1xyXG4gIH1cclxuXHJcbiAgc2V0RXZlbnRMaXN0ZW5lcnMoKSB7XHJcbiAgICB0aGlzLl9tb2RhbFNlbGVjdG9yLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHtcclxuICAgICAgICBpZihlLnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoJ21vZGFsJykgfHxcclxuICAgICAgICAgIGUudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygnbW9kYWxfX2Nsb3NlLWJ1dHRvbicpIHx8XHJcbiAgICAgICAgICBlLnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoJ21vZGFsX3Zpc2libGUnKSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHRoaXMuY2xvc2UoKTtcclxuICAgICAgICB9XHJcbiAgICB9KVxyXG4gIH1cclxufSIsImltcG9ydCBNb2RhbCBmcm9tIFwiLi9Nb2RhbC5qc1wiO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgTW9kYWxXaXRoRm9ybSBleHRlbmRzIE1vZGFsIHtcclxuICBjb25zdHJ1Y3Rvcih7bW9kYWxTZWxlY3RvciwgaGFuZGxlU3VibWl0fSkge1xyXG4gICAgc3VwZXIobW9kYWxTZWxlY3Rvcik7XHJcbiAgICB0aGlzLl9oYW5kbGVTdWJtaXQgPSBoYW5kbGVTdWJtaXQ7XHJcbiAgICB0aGlzLl9mb3JtRWxlbWVudCA9IHRoaXMuX21vZGFsU2VsZWN0b3IucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fY29udGFpbmVyXCIpO1xyXG4gIH1cclxuXHJcbiAgZ2V0SW5wdXRWYWx1ZXMoKSB7XHJcbiAgICBjb25zdCBpbnB1dExpc3QgPSBBcnJheS5mcm9tKFxyXG4gICAgICB0aGlzLl9mb3JtRWxlbWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLm1vZGFsX19pbnB1dFwiKVxyXG4gICAgKTtcclxuICAgIGNvbnN0IGlucHV0VmFsdWVzID0ge307XHJcbiAgICBpbnB1dExpc3QuZm9yRWFjaCgoaW5wdXQpID0+IHtpbnB1dFZhbHVlc1tpbnB1dC5uYW1lXSA9IGlucHV0LnZhbHVlO30pO1xyXG4gICAgcmV0dXJuIGlucHV0VmFsdWVzO1xyXG4gIH1cclxuXHJcbiAgc2V0SW5wdXRWYWx1ZXModmFsdWVzKSB7XHJcbiAgICBjb25zdCBpbnB1dExpc3QgPSBBcnJheS5mcm9tKFxyXG4gICAgICB0aGlzLl9mb3JtRWxlbWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLm1vZGFsX19pbnB1dFwiKVxyXG4gICAgKTtcclxuICAgIGlucHV0TGlzdC5mb3JFYWNoKChpbnB1dCkgPT4ge2lucHV0LnZhbHVlID0gdmFsdWVzW2lucHV0Lm5hbWVdO30pXHJcbiAgfVxyXG5cclxuICBzZXRFdmVudExpc3RlbmVycygpIHtcclxuICAgIHN1cGVyLnNldEV2ZW50TGlzdGVuZXJzKCk7IFxyXG5cclxuICAgIHRoaXMuX2Zvcm1FbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgKGV2ZW50KSA9PiB7XHJcbiAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgIHRoaXMuX2hhbmRsZVN1Ym1pdCh0aGlzLmdldElucHV0VmFsdWVzKCkpO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBzZXRTdWJtaXRIYW5kbGVyKGV2ZW50KSB7XHJcbiAgICB0aGlzLl9oYW5kbGVTdWJtaXQgPSBldmVudDtcclxuICB9XHJcblxyXG4gIGNsb3NlKCkge1xyXG4gICAgc3VwZXIuY2xvc2UoKTtcclxuICAgIHRoaXMuX2Zvcm1FbGVtZW50LnJlc2V0KCk7XHJcbiAgfVxyXG59IiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgU2VjdGlvbiB7XHJcbiAgY29uc3RydWN0b3IoeyBpdGVtcywgcmVuZGVyZXIgfSwgY29udGFpbmVyU2VsZWN0b3IpIHtcclxuICAgIHRoaXMuX2l0ZW1zID0gaXRlbXM7XHJcbiAgICB0aGlzLl9yZW5kZXJlciA9IHJlbmRlcmVyO1xyXG4gICAgdGhpcy5fY29udGFpbmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcihjb250YWluZXJTZWxlY3Rvcik7XHJcbiAgfVxyXG5cclxuICBhZGRJdGVtKGVsZW1lbnQpIHtcclxuICAgIHRoaXMuX2NvbnRhaW5lci5wcmVwZW5kKGVsZW1lbnQpO1xyXG4gIH1cclxuXHJcbiAgY2xlYXIgKCkge1xyXG4gICAgdGhpcy5fY29udGFpbmVyLmlubmVySFRNTCA9ICcnO1xyXG4gIH1cclxuXHJcbiAgcmVuZGVySXRlbXMoKSB7XHJcbiAgICB0aGlzLmNsZWFyKCk7XHJcbiAgICBcclxuICAgIHRoaXMuX2l0ZW1zLmZvckVhY2goKGNhcmQpID0+IHtcclxuICAgICAgdGhpcy5fcmVuZGVyZXIoY2FyZCk7XHJcbiAgICB9KTtcclxuICB9XHJcbn1cclxuIiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgVXNlckluZm8ge1xyXG4gIGNvbnN0cnVjdG9yKCBuYW1lLCBqb2IsIGF2YXRhciApIHtcclxuICAgIHRoaXMuX25hbWUgPSBuYW1lO1xyXG4gICAgdGhpcy5fam9iID0gam9iO1xyXG4gICAgdGhpcy5fYXZhdGFyID0gYXZhdGFyO1xyXG4gIH1cclxuXHJcbiAgZ2V0VXNlckluZm8oKXtcclxuICAgIHJldHVybiB0aGlzLl91c2VySW5mbyA9IHt0aXRsZTogdGhpcy5fdGl0bGUudGV4dENvbnRlbnQsIGpvYjp0aGlzLl9qb2IudGV4dENvbnRlbnR9O1xyXG4gIH1cclxuXHJcbiAgc2V0VXNlckluZm8odGl0bGUsIGpvYiwgdXNlckF2YXRhcil7XHJcbiAgICB0aGlzLl91c2VySW5mbyA9IHsgdGl0bGUsIGpvYiwgdXNlckF2YXRhciB9O1xyXG4gICAgaWYodXNlckF2YXRhcil7XHJcbiAgICAgICAgYXZhdGFySW1hZ2Uuc3JjID0gdGhpcy5fdXNlckluZm8udXNlckF2YXRhcjtcclxuICAgICAgICBwcm9maWxlTmFtZS50ZXh0Q29udGVudCA9IHRoaXMuX3VzZXJJbmZvLnRpdGxlO1xyXG4gICAgICAgIHByb2ZpbGVKb2IudGV4dENvbnRlbnQgPSB0aGlzLl91c2VySW5mby5qb2I7XHJcbiAgICB9XHJcbiAgICBlbHNle1xyXG4gICAgICAgIHByb2ZpbGVOYW1lLnRleHRDb250ZW50ID0gdGhpcy5fdXNlckluZm8udGl0bGU7XHJcbiAgICAgICAgcHJvZmlsZUpvYi50ZXh0Q29udGVudCA9IHRoaXMuX3VzZXJJbmZvLmpvYjtcclxuICAgIH1cclxufVxyXG59XHJcbiIsIi8vIC0tLSAnRWRpdCBwcm9maWxlJyBtb2RhbCBjb25zdHMgLS0tIC8vXHJcbmV4cG9ydCBjb25zdCBlZGl0QnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnByb2ZpbGVfX2VkaXQtYnV0dG9uJyk7XHJcbmV4cG9ydCBjb25zdCBwcm9maWxlTW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubW9kYWxfdHlwZV9lZGl0Jyk7XHJcbmV4cG9ydCBjb25zdCBwcm9maWxlTmFtZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wcm9maWxlX190aXRsZScpO1xyXG5leHBvcnQgY29uc3QgbmFtZUlucHV0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLm1vZGFsX19pbnB1dF90eXBlX3RpdGxlJyk7XHJcbmV4cG9ydCBjb25zdCBwcm9maWxlSm9iID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnByb2ZpbGVfX3N1YnRpdGxlJyk7XHJcbmV4cG9ydCBjb25zdCBqb2JJbnB1dCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbF9faW5wdXRfdHlwZV9zdWJ0aXRsZScpO1xyXG5leHBvcnQgY29uc3QgZWRpdENsb3NlQnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLm1vZGFsX19jbG9zZS1idXR0b25fdHlwZV9lZGl0Jyk7XHJcbi8vIC0tLSAnQXZhdGFyXCIgbW9kYWwgY29uc3RzIC0tLSAvL1xyXG5leHBvcnQgY29uc3QgYXZhdGFySW1hZ2UgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucHJvZmlsZV9faW1hZ2UnKTtcclxuZXhwb3J0IGNvbnN0IGF2YXRhckVkaXRCdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucHJvZmlsZV9faW1hZ2UtZWRpdCcpO1xyXG5leHBvcnQgY29uc3QgYXZhdGFyTW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubW9kYWxfdHlwZV9hdmF0YXInKTtcclxuZXhwb3J0IGNvbnN0IGF2YXRhck1vZGFsSW5wdXQgPSBhdmF0YXJNb2RhbC5xdWVyeVNlbGVjdG9yKCcubW9kYWxfX2lucHV0X3R5cGVfYXZhdGFyJyk7XHJcbmV4cG9ydCBjb25zdCBhdmF0YXJDbG9zZUJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbF9fY2xvc2UtYnV0dG9uX3R5cGVfYXZhdGFyJylcclxuLy8gLS0tICdBZGQtY2FyZCcgbW9kYWwgY29uc3RzIC0tLSAvL1xyXG5leHBvcnQgY29uc3QgYWRkQ2FyZEJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wcm9maWxlX19hZGQtYnV0dG9uJyk7XHJcbmV4cG9ydCBjb25zdCBhZGRDYXJkTW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubW9kYWxfdHlwZV9hZGQtY2FyZCcpO1xyXG5leHBvcnQgY29uc3QgY2FyZElucHV0VGl0bGUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubW9kYWxfX2lucHV0X3R5cGVfbmFtZScpO1xyXG5leHBvcnQgY29uc3QgY2FyZElucHV0TGluayA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbF9faW5wdXRfdHlwZV9saW5rJyk7XHJcbmV4cG9ydCBjb25zdCBhZGRDYXJkQ2xvc2VCdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubW9kYWxfX2Nsb3NlLWJ1dHRvbl90eXBlX2FkZC1jYXJkJyk7XHJcbi8vIC0tLSAnQWRkLUNhcmQnIGZvcm0gY29uc3RzIC0tLSAvL1xyXG5leHBvcnQgY29uc3QgYWRkQ2FyZEZvcm0gPSBkb2N1bWVudC5mb3Jtcy5hZGQ7XHJcbmV4cG9ydCBjb25zdCBhZGRDYXJkRm9ybVRpdGVsID0gYWRkQ2FyZEZvcm0uZWxlbWVudHMudGl0bGU7XHJcbmV4cG9ydCBjb25zdCBhZGRDYXJkRm9ybUxpbmsgPSBhZGRDYXJkRm9ybS5lbGVtZW50cy5saW5rO1xyXG4vLyAtLS0gR2VuZXJhbCBjb25zdCAtLS0gLy9cclxuZXhwb3J0IGNvbnN0IHN1Ym1pdEJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbF9fc3VibWl0LWJ1dHRvbicpO1xyXG5leHBvcnQgY29uc3QgY2FyZExpc3QgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuY2FyZHNfX2dyaWQnKTtcclxuLy8gLS0tIEJpZyBpbWFnZSBtb2RhbCBjb25zdHMgLS0tIC8vXHJcbmV4cG9ydCBjb25zdCBjYXJkQmlnTW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubW9kYWxfdHlwZV9iaWctaW1hZ2UnKTtcclxuZXhwb3J0IGNvbnN0IGNhcmRCaWdNb2RhbEltYWdlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLm1vZGFsX19iaWctaW1hZ2UnKTtcclxuZXhwb3J0IGNvbnN0IGNhcmRCaWdNb2RhbFRleHQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubW9kYWxfX2ltYWdlLWNhcHRpb24nKTtcclxuZXhwb3J0IGNvbnN0IGNhcmRCaWdNb2RhbENsb3NlSWNvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbF9fY2xvc2UtYnV0dG9uX3R5cGVfYmlnLWltYWdlJyk7XHJcbi8vIC0tLSAnRGVsZXRlIGNhcmQnIG1vZGFsIGNvbnN0cyAtLS0gLy9cclxuZXhwb3J0IGNvbnN0IGRlbGV0ZUNhcmQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX3R5cGVfZGVsZXRlLWNhcmRcIik7XHJcbi8vIC0tLSBGb3JtIGNvbmZpZyBjb25zdHMgLS0tIC8vXHJcbmV4cG9ydCBjb25zdCBmb3JtQ29uZmlnID0ge1xyXG4gIGZvcm1TZWxlY3RvcjogXCIubW9kYWxfX2NvbnRhaW5lclwiLFxyXG4gIGlucHV0U2VsZWN0b3I6IFwiLm1vZGFsX19pbnB1dFwiLFxyXG4gIHN1Ym1pdEJ1dHRvblNlbGVjdG9yOiBcIi5tb2RhbF9fc3VibWl0LWJ1dHRvblwiLFxyXG4gIGluYWN0aXZlQnV0dG9uQ2xhc3M6IFwibW9kYWxfX3N1Ym1pdC1idXR0b25fZGlzYWJsZWRcIixcclxuICBpbnB1dEVycm9yQ2xhc3M6IFwibW9kYWxfX2lucHV0X2Vycm9yXCIsXHJcbiAgZXJyb3JNZXNzYWdlQ2xhc3M6IFwibW9kYWxfX2Vycm9yX3Zpc2libGVcIlxyXG59O1xyXG4iLCJpbXBvcnQgXCIuL2luZGV4LmNzc1wiO1xyXG5pbXBvcnQgRm9ybVZhbGlkYXRvciBmcm9tIFwiLi4vY29tcG9uZW50cy9zY3JpcHRzL0Zvcm1WYWxpZGF0b3IuanNcIjtcclxuaW1wb3J0IENhcmQgZnJvbSBcIi4uL2NvbXBvbmVudHMvc2NyaXB0cy9DYXJkLmpzXCI7XHJcbmltcG9ydCBNb2RhbFdpdGhJbWFnZSBmcm9tIFwiLi4vY29tcG9uZW50cy9zY3JpcHRzL01vZGFsV2l0aEltYWdlLmpzXCI7XHJcbmltcG9ydCBNb2RhbFdpdGhGb3JtIGZyb20gXCIuLi9jb21wb25lbnRzL3NjcmlwdHMvTW9kYWxXaXRoRm9ybS5qc1wiO1xyXG5pbXBvcnQgQXBpIGZyb20gXCIuLi9jb21wb25lbnRzL3NjcmlwdHMvQXBpLmpzXCJcclxuaW1wb3J0IFNlY3Rpb24gZnJvbSBcIi4uL2NvbXBvbmVudHMvc2NyaXB0cy9TZWN0aW9uLmpzXCI7XHJcbmltcG9ydCBVc2VySW5mbyBmcm9tIFwiLi4vY29tcG9uZW50cy9zY3JpcHRzL1VzZXJJbmZvLmpzXCI7XHJcbmltcG9ydCB7XHJcbiAgcHJvZmlsZU5hbWUsXHJcbiAgcHJvZmlsZUpvYixcclxuICBlZGl0QnV0dG9uLFxyXG4gIHByb2ZpbGVNb2RhbCxcclxuICBhZGRDYXJkQnV0dG9uLFxyXG4gIGFkZENhcmRNb2RhbCxcclxuICBhdmF0YXJNb2RhbCxcclxuICBhdmF0YXJJbWFnZSxcclxuICBhdmF0YXJFZGl0QnV0dG9uLFxyXG4gIGNhcmRCaWdNb2RhbCxcclxuICBkZWxldGVDYXJkLFxyXG4gIGZvcm1Db25maWdcclxufSBmcm9tIFwiLi4vY29tcG9uZW50cy91dGlscy9jb25zdGFudHMuanNcIjtcclxuXHJcbi8vID09PT09IE1vZGFscyA9PT09PSAvL1xyXG4vLyAtLS0gQmlnIGltYWdlIG1vZGFsIGluc3RhbmNlIC0tLSAvL1xyXG5jb25zdCBiaWdJbWFnZSA9IG5ldyBNb2RhbFdpdGhJbWFnZShjYXJkQmlnTW9kYWwpO1xyXG5iaWdJbWFnZS5zZXRFdmVudExpc3RlbmVycygpO1xyXG4vLyAtLS0gRGVsZXRlIGNhcmQgbW9kYWwgaW5zdGFuY2UgYW5kIGV2ZW50cyAtLS0gLy9cclxuY29uc3QgZGVsZXRlQ2FyZE1vZGFsID0gbmV3IE1vZGFsV2l0aEZvcm0oe1xyXG4gIG1vZGFsU2VsZWN0b3I6IGRlbGV0ZUNhcmRcclxufSk7XHJcbmRlbGV0ZUNhcmRNb2RhbC5zZXRFdmVudExpc3RlbmVycygpO1xyXG4vLyAtLS0gVVggZm9yIG1vZGFscyAtLS0gLy9cclxuZnVuY3Rpb24gbG9hZGluZ01vZGFsKGlzTG9hZGluZywgbW9kYWwpIHtcclxuICBpZiAoaXNMb2FkaW5nKSB7IG1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX3N1Ym1pdC1idXR0b25cIikudGV4dENvbnRlbnQgPSBcIlNhdmluZy4uLlwiOyB9IFxyXG4gIGVsc2UgeyBtb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19zdWJtaXQtYnV0dG9uXCIpLnRleHRDb250ZW50ID0gXCJTYXZlXCI7IH1cclxufVxyXG5cclxuLy8gPT09PT0gQVBJID09PT09IC8vXHJcbi8vIC0tLSBTZXR0aW5nIHRoZSBkZWZhdWx0IGZldGNoaW5nIHVybCBhbmQgdG9rZW4gLS0tIC8vXHJcbmNvbnN0IGFwaSA9IG5ldyBBcGkoe1xyXG4gIGJhc2VVcmw6IFwiaHR0cHM6Ly9hcm91bmQubm9tb3JlcGFydGllcy5jby92MS9ncm91cC0xMlwiLFxyXG4gIGhlYWRlcnM6IFxyXG4gIHtcclxuICAgIGF1dGhvcml6YXRpb246IFwiNzA5YTBkOWQtZGIwNi00ODkwLWE1OTQtYjA3ZTczMDlhMzUzXCIsXHJcbiAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nIFxyXG4gIH1cclxufSk7XHJcbi8vIC0tLSBHZXRBcHBJbmZvIG1ldGhvZCAtLS0gLy9cclxuYXBpLmdldEFwcEluZm8oKS50aGVuKChbdXNlckRhdGEsIGNhcmRMaXN0RGF0YV0pID0+IHtcclxuICAvLyAtLS0gQ2FyZHMgc2VjdGlvbiBjcmVhdGlvbiAtLS0gLy9cclxuICBjb25zdCBjYXJkc0xpc3QgPSBuZXcgU2VjdGlvbih7XHJcbiAgICBpdGVtczogY2FyZExpc3REYXRhLFxyXG4gICAgcmVuZGVyZXI6IGFkZGluZ05ld0NhcmRcclxuICB9LCAnLmNhcmRzX19ncmlkJylcclxuICAvLyAtLS0gUmVuZGVyIGNhcmRzIC0tLSAvL1xyXG4gIGNhcmRzTGlzdC5yZW5kZXJJdGVtcygpO1xyXG4gIC8vIC0tLSAnQWRkIG5ldyBjYXJkJyBtb2RhbCBpbnN0YW5jZSAtLS0gLy9cclxuICBjb25zdCBhZGROZXdDYXJkTW9kYWwgPSBuZXcgTW9kYWxXaXRoRm9ybSh7XHJcbiAgICBtb2RhbFNlbGVjdG9yOiBhZGRDYXJkTW9kYWwsXHJcbiAgICBtb2RhbFN1Ym1pdGlvbjogKGRhdGEpID0+IHtcclxuICAgICAgbG9hZGluZ01vZGFsKHRydWUsIGFkZENhcmRNb2RhbCk7XHJcbiAgICAgIGFwaVxyXG4gICAgICAgIC5hZGRDYXJkKGRhdGEpXHJcbiAgICAgICAgLnRoZW4oKHJlcykgPT4ge1xyXG4gICAgICAgICAgY29uc29sZS5sb2cocmVzKTtcclxuICAgICAgICAgIGFkZGluZ05ld0NhcmQocmVzKTtcclxuICAgICAgICAgIGFkZE5ld0NhcmRNb2RhbC5jbG9zZSgpO1xyXG4gICAgICAgICAgbG9hZGluZ01vZGFsKGZhbHNlLCBhZGRDYXJkTW9kYWwpO1xyXG4gICAgICAgIH0pXHJcbiAgICAgICAgLmNhdGNoKChlcnIpID0+IGNvbnNvbGUubG9nKGVycikpO1xyXG4gICAgfSxcclxuICB9KTtcclxuICAvLyAtLS0gQWRkIGNhcmQgYnV0dG9uIGZ1bmN0aW9uYWwgYWRkaW5nIC0tLSAvL1xyXG4gIGFkZENhcmRCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcclxuICAgIGFkZE5ld0NhcmRNb2RhbC5vcGVuKCk7XHJcbiAgICBsb2FkaW5nTW9kYWwoZmFsc2UsIGFkZENhcmRNb2RhbCk7XHJcbiAgfSk7XHJcbiAgYWRkTmV3Q2FyZE1vZGFsLnNldEV2ZW50TGlzdGVuZXJzKCk7XHJcbiAgLy8gLS0tIE5ldyBjYXJkIGFkZGluZyAtLS0gLy9cclxuICBmdW5jdGlvbiBhZGRpbmdOZXdDYXJkKGRhdGEpe1xyXG4gICAgY29uc3QgY2FyZEluc3RhbmNlID0gbmV3IENhcmQoe2RhdGEsIFxyXG4gICAgICBoYW5kbGVDYXJkQ2xpY2s6ICh7bmFtZSwgbGlua30pID0+IHtcclxuICAgICAgICBiaWdJbWFnZS5vcGVuKGxpbmssIG5hbWUpfSwgXHJcbiAgICAgIGhhbmRsZURlbGV0ZUNsaWNrOiAoY2FyZElkKSA9PiB7XHJcbiAgICAgICAgZGVsZXRlQ2FyZE1vZGFsLm9wZW4oY2FyZElkKTtcclxuICAgICAgICBkZWxldGVDYXJkTW9kYWwuc2V0U3VibWl0SGFuZGxlcigoKSA9PiB7XHJcbiAgICAgICAgICBhcGkucmVtb3ZlQ2FyZChjYXJkSWQpXHJcbiAgICAgICAgICAgIC50aGVuKCgpID0+IHtcclxuICAgICAgICAgICAgICBjYXJkSW5zdGFuY2UuZGVsZXRlQ2FyZE1vZGFsKCk7XHJcbiAgICAgICAgICAgICAgZGVsZXRlQ2FyZE1vZGFsLmNsb3NlKCk7XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIC5jYXRjaChlcnIgPT4gY29uc29sZS5sb2coZXJyKSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH0sXHJcbiAgICAgIGxpa2VIYW5kbGVyOiAoY2FyZElkKSA9PnsgXHJcbiAgICAgICAgaWYoY2FyZEVsZW1lbnQucXVlcnlTZWxlY3RvcignLmNhcmRfX2xpa2UtYnV0dG9uJykuY2xhc3NMaXN0LmNvbnRhaW5zKCdjYXJkX19saWtlLWJ1dHRvbl9hY3RpdmUnKSkgeyBcclxuICAgICAgICAgIGFwaS5kZWxldGVMaWtlKGNhcmRJZCkudGhlbihyZXMgPT4geyBcclxuICAgICAgICAgICAgY2FyZEVsZW1lbnQucXVlcnlTZWxlY3RvcignLmNhcmRfX2xpa2UtYnV0dG9uJykuY2xhc3NMaXN0LnJlbW92ZSgnY2FyZF9fbGlrZS1idXR0b25fYWN0aXZlJyk7XHJcbiAgICAgICAgICAgIGNhcmRJbnN0YW5jZS5zaG93TGlrZXMocmVzLmxpa2VzLmxlbmd0aCkgXHJcbiAgICAgICAgICAgIGNhcmRJbnN0YW5jZS5fbGlrZXMgPSByZXMubGlrZXM7IH0pXHJcbiAgICAgICAgICAuY2F0Y2goZXJyID0+IGNvbnNvbGUubG9nKGVycikpIFxyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHsgXHJcbiAgICAgICAgICBjYXJkSW5zdGFuY2UuX2NhcmRFbGVtZW50LmNsYXNzTGlzdC50b2dnbGUoXCJjYXJkX19saWtlLWJ1dHRvbl9hY3RpdmVcIik7IFxyXG4gICAgICAgICAgYXBpLmFkZExpa2UoY2FyZElkKS50aGVuKHJlcyA9PiB7IFxyXG4gICAgICAgICAgICBjYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKCcuY2FyZF9fbGlrZS1idXR0b24nKS5jbGFzc0xpc3QuYWRkKCdjYXJkX19saWtlLWJ1dHRvbl9hY3RpdmUnKTsgXHJcbiAgICAgICAgICAgIGNhcmRJbnN0YW5jZS5zaG93TGlrZXMocmVzLmxpa2VzLmxlbmd0aCkgXHJcbiAgICAgICAgICAgIGNhcmRJbnN0YW5jZS5fbGlrZXMgPSByZXMubGlrZXM7fSlcclxuICAgICAgICAgIC5jYXRjaChlcnIgPT4gY29uc29sZS5sb2coZXJyKSkgXHJcbiAgICAgICAgfSBcclxuICAgICAgfVxyXG4gICAgfSxcclxuICAgIHVzZXJEYXRhLl9pZCwnLmNhcmRfX3RlbXBsYXRlJykgXHJcbiAgICBjb25zdCBjYXJkRWxlbWVudCA9IGNhcmRJbnN0YW5jZS5nZW5lcmF0ZUNhcmQoKTsgXHJcbiAgICBjYXJkc0xpc3QuYWRkSXRlbShjYXJkRWxlbWVudCkgXHJcbiAgICBsb2FkaW5nTW9kYWwodHJ1ZSwgYWRkQ2FyZE1vZGFsKTtcclxuICB9XHJcbiAgLy8gLS0tICdQcm9maWxlJyBpbmZvIGVkaXRpbmcgLS0tIC8vXHJcbiAgY29uc3QgcHJvZmlsZUluZm8gPSBuZXcgVXNlckluZm8oIHByb2ZpbGVOYW1lLCBwcm9maWxlSm9iLCBhdmF0YXJJbWFnZSk7XHJcbiAgLy8gLS0tIEZldGNoaW5nIGFuZCBzZXR0aW5nIHVzZXIgcHJvZmlsZSBpbmZvIC0tLSAvL1xyXG4gIGFwaS5nZXRVc2VySW5mbygpLnRoZW4ocmVzID0+IHtcclxuICAgIHByb2ZpbGVJbmZvLnNldFVzZXJJbmZvKCByZXMubmFtZSwgcmVzLmpvYiwgcmVzLmF2YXRhcilcclxuICB9KVxyXG4gIGNvbnN0IHByb2ZpbGVGb3JtID0gbmV3IE1vZGFsV2l0aEZvcm0oe1xyXG4gICAgbW9kYWxTZWxlY3RvcjogcHJvZmlsZU1vZGFsLCBcclxuICAgIG1vZGFsU3VibWl0aW9uOiAoZGF0YSkgPT4ge1xyXG4gICAgICBsb2FkaW5nTW9kYWwodHJ1ZSwgcHJvZmlsZU1vZGFsKTtcclxuICAgICAgYXBpLnNldFVzZXJJbmZvcyh7bmFtZTogZGF0YS50aXRsZSwgYWJvdXQ6ZGF0YS5kZXNjfSlcclxuICAgICAgLnRoZW4ocmVzID0+IHtcclxuICAgICAgICBsb2FkaW5nTW9kYWwoZmFsc2UsIHByb2ZpbGVNb2RhbClcclxuICAgICAgICBwcm9maWxlSW5mby5zZXRVc2VySW5mbyhyZXMubmFtZSwgcmVzLmFib3V0KVxyXG4gICAgICAgIHByb2ZpbGVGb3JtLmNsb3NlKCk7XHJcbiAgICAgICAgY29uc29sZS5sb2cocmVzKVxyXG4gICAgICB9KVxyXG4gICAgICAuY2F0Y2goZXJyID0+IGNvbnNvbGUubG9nKGVycikpXHJcbiAgICB9XHJcbiAgfSlcclxuICAvLyAtLS0gJ1Byb2ZpbGUnIGZvcm0gaGFuZGxlciAtLS0gLy9cclxuICBwcm9maWxlRm9ybS5zZXRFdmVudExpc3RlbmVycygpO1xyXG4gIC8vIC0tLSBPcGVuICdQcm9maWxlJyBmb3JtIHdpdGggY3VycmVudCB2YWx1ZXMgYXMgaW5wdXRzIC0tLSAvL1xyXG4gIGVkaXRCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7XHJcbiAgICBwcm9maWxlRm9ybS5vcGVuKCk7XHJcbiAgICBjb25zdCB1c2VyID0gcHJvZmlsZUluZm8uZ2V0VXNlckluZm8oKTtcclxuICAgIGlucHV0TmFtZS52YWx1ZSA9IHVzZXIudGl0bGU7XHJcbiAgICBpbnB1dEpvYi52YWx1ZSA9IHVzZXIuam9iO1xyXG4gIH0pXHJcbn0pXHJcbi5jYXRjaChlcnIgPT4gY29uc29sZS5sb2coZXJyKSk7XHJcblxyXG4vLyA9PT09PSBBdmF0YXIgPT09PT0gLy9cclxuLy8gLS0tICdBdmF0YXInIGZvcm0gZnVuY3Rpb25hbCAtLS0gLy9cclxuZnVuY3Rpb24gaGFuZGxlQXZhdGFyRWRpdChkYXRhKSB7XHJcbiAgbG9hZGluZ01vZGFsKHRydWUsIGF2YXRhck1vZGFsKTtcclxuICBhcGkuc2V0VXNlckF2YXRhcih7XHJcbiAgICBhdmF0YXI6IGRhdGEuYXZhdGFyVVJMXHJcbiAgfSlcclxuICAudGhlbihyZXMgPT4ge1xyXG4gICAgYXZhdGFySW1hZ2Uuc3JjID0gcmVzLmF2YXRhcjtcclxuICAgIGxvYWRpbmdNb2RhbChmYWxzZSwgYXZhdGFyTW9kYWwpO1xyXG4gICAgZWRpdEF2YXRhci5jbG9zZSgpO1xyXG4gIH0pXHJcbiAgLmNhdGNoKGVyciA9PiBjb25zb2xlLmxvZyhlcnIpKTtcclxufVxyXG4vLyAtLS0gJ0F2YXRhcicgZm9ybSBjcmVhdGlvbiAtLS0gLy9cclxuY29uc3QgZWRpdEF2YXRhciA9IG5ldyBNb2RhbFdpdGhGb3JtKHtcclxuICBtb2RhbFNlbGVjdG9yOiBhdmF0YXJNb2RhbCxcclxuICBtb2RhbFN1Ym1pdGlvbjogKGRhdGEpID0+IHtcclxuICAgIGhhbmRsZUF2YXRhckVkaXQoZGF0YSlcclxuICB9XHJcbn0pO1xyXG4vLyAtLS0gT3BlbiBhdmF0YXIgZWRpdCBtb2RhbCBvbiBjbGljayAtLS0gLy9cclxuYXZhdGFyRWRpdEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xyXG4gIGVkaXRBdmF0YXIub3BlbigpO1xyXG59KTtcclxuLy8gLS0tICdBdmF0YXInIGZvcm0gaGFuZGxlciAtLS0gLy9cclxuZWRpdEF2YXRhci5zZXRFdmVudExpc3RlbmVycygpO1xyXG5cclxuLy8gPT09PT0gVmFsaWRhdGlvbiA9PT09PSAvL1xyXG4vLyAtLS0gJ0VkaXQgcHJvZmlsZScgZm9ybSB2YWxpZGF0aW9uIGFkZGluZyAtLS0gLy9cclxuY29uc3QgcHJvZmlsZUZvcm1WYWxpZGF0aW9uID0gbmV3IEZvcm1WYWxpZGF0b3IoZm9ybUNvbmZpZywgcHJvZmlsZU1vZGFsKTtcclxucHJvZmlsZUZvcm1WYWxpZGF0aW9uLmVuYWJsZVZhbGlkYXRpb24oKTtcclxuLy8gLS0tICdBdmF0YXInIGZvcm0gdmFsaWRhdGlvbiBhZGRpbmcgLS0tIC8vXHJcbmNvbnN0IGF2YXRhckZvcm1WYWxpZGF0aW9uID0gbmV3IEZvcm1WYWxpZGF0b3IoZm9ybUNvbmZpZywgYXZhdGFyTW9kYWwpO1xyXG5hdmF0YXJGb3JtVmFsaWRhdGlvbi5lbmFibGVWYWxpZGF0aW9uKCk7XHJcbi8vIC0tLSAnQWRkIGNhcmQnIGZvcm0gdmFsaWRhdGlvbiBhZGRpbmcgLS0tIC8vXHJcbmNvbnN0IGFkZENhcmRGb3JtVmFsaWRhdGlvbiA9IG5ldyBGb3JtVmFsaWRhdG9yKGZvcm1Db25maWcsIGFkZENhcmRNb2RhbCk7XHJcbmFkZENhcmRGb3JtVmFsaWRhdGlvbi5lbmFibGVWYWxpZGF0aW9uKCk7XHJcblxyXG5leHBvcnQgeyBwcm9maWxlTmFtZSwgcHJvZmlsZUpvYiwgYmlnSW1hZ2UsIGF2YXRhckltYWdlIH0iLCJpbXBvcnQgTW9kYWwgZnJvbSBcIi4vTW9kYWwuanNcIjtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIE1vZGFsV2l0aEltYWdlIGV4dGVuZHMgTW9kYWwge1xyXG4gIC8vIC0tLSBPcGVuIGJpZyBpbWFnZSBtb2RhbCBtZXRob2QgLS0tIC8vXHJcbiAgb3BlbnVwID0gKGV2ZW50KSA9PiB7XHJcbiAgICBjb25zdCBiaWdJbWFnZSA9IGV2ZW50LnRhcmdldDtcclxuICAgIHRoaXMuX21vZGFsRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19iaWctaW1hZ2VcIikuc3JjID0gYmlnSW1hZ2Uuc3JjO1xyXG4gICAgdGhpcy5fbW9kYWxFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2JpZy1pbWFnZVwiKS5hbHQgPSBiaWdJbWFnZS5hbHQ7XHJcbiAgICB0aGlzLl9tb2RhbEVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9faW1hZ2UtY2FwdGlvblwiKS50ZXh0Q29udGVudCA9IGJpZ0ltYWdlLmFsdDtcclxuXHJcbiAgICB0aGlzLm9wZW4oKTtcclxuICB9XHJcbn0iLCJleHBvcnQgZGVmYXVsdCBjbGFzcyBBcGkge1xyXG4gIGNvbnN0cnVjdG9yKHsgYmFzZVVybCwgaGVhZGVycyB9KSB7XHJcbiAgICB0aGlzLl9iYXNlVXJsID0gYmFzZVVybDtcclxuICAgIHRoaXMuX2hlYWRlcnMgPSBoZWFkZXJzO1xyXG4gIH1cclxuXHJcbiAgLy8gPT09IEdldHRpbmcgaW5mbyBmcm9tIHNlcnZlciA9PT0gLy9cclxuICAvLyAtLS0gR2V0IGNhcmQgbGlzdCBmcm9tIHRoZSBzZXJ2ZXIgLS0tIC8vXHJcbiAgZ2V0Q2FyZExpc3QoKSB7XHJcbiAgICByZXR1cm4gKFxyXG4gICAgICBmZXRjaCh0aGlzLl9iYXNlVXJsICsgXCIvY2FyZHNcIiwge1xyXG4gICAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXHJcbiAgICAgIH0pXHJcbiAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlcykge1xyXG4gICAgICAgICAgaWYgKHJlcy5vaykge1xyXG4gICAgICAgICAgICByZXR1cm4gcmVzLmpzb24oKS50aGVuKChkYXRhKSA9PiB7XHJcbiAgICAgICAgICAgICAgcmV0dXJuIGRhdGE7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgUHJvbWlzZS5yZWplY3QoXCJFcnJvciFcIiArIHJlcy5zdGF0dXNUZXh0KTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9KVxyXG4gICAgKTtcclxuICB9XHJcbiAgLy8gLS0tIEdldCB1c2VyIGluZm8gZnJvbSB0aGUgc2VydmVyIC0tLSAvL1xyXG4gIGdldFVzZXJJbmZvKCkge1xyXG4gICAgcmV0dXJuIChcclxuICAgICAgZmV0Y2godGhpcy5fYmFzZVVybCArIFwiL3VzZXJzL21lXCIsIHtcclxuICAgICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxyXG4gICAgICB9KVxyXG4gICAgICAgIC50aGVuKChyZXMpID0+XHJcbiAgICAgICAgICByZXMub2sgPyByZXMuanNvbigpIDogUHJvbWlzZS5yZWplY3QoXCJFcnJvciFcIiArIHJlcy5zdGF0dXNUZXh0KVxyXG4gICAgICAgIClcclxuICAgICk7XHJcbiAgfVxyXG4gIC8vIC0tLSBDaGVjayBpZiBhbGwgaW5mbyBmZXRjaGVkIC0tLSAvL1xyXG4gIGdldEFwcEluZm8oKSB7XHJcbiAgICByZXR1cm4gUHJvbWlzZS5hbGwoW3RoaXMuZ2V0VXNlckluZm8oKSwgdGhpcy5nZXRDYXJkTGlzdCgpXSk7XHJcbiAgfVxyXG5cclxuICAvLyA9PT0gQWRkaW5nL1JlbW92aW5nL0VkaXRpbmcgPT09IC8vXHJcbiAgLy8gLS0tIEFkZGluZyBuZXcgY2FyZCAtLS0gLy9cclxuICBhZGRDYXJkKHsgbmFtZSwgbGluayB9KSB7XHJcbiAgICByZXR1cm4gZmV0Y2godGhpcy5fYmFzZVVybCArIFwiL2NhcmRzXCIsIHtcclxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcclxuICAgICAgbWV0aG9kOiBcIlBPU1RcIixcclxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xyXG4gICAgICAgIG5hbWUsXHJcbiAgICAgICAgbGluayxcclxuICAgICAgfSksXHJcbiAgICB9KS50aGVuKChyZXMpID0+IHtcclxuICAgICAgaWYgKHJlcy5vaykge1xyXG4gICAgICAgIHJldHVybiByZXMuanNvbigpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIFByb21pc2UucmVqZWN0KFwiRXJyb3IhXCIgKyByZXMuc3RhdHVzVGV4dCk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuICAvLyAtLS0gUmVtb3ZpbmcgYSBjYXJkIC0tLSAvL1xyXG4gIHJlbW92ZUNhcmQoY2FyZElkKSB7XHJcbiAgICByZXR1cm4gZmV0Y2godGhpcy5fYmFzZVVybCArIFwiL2NhcmRzL1wiICsgY2FyZElkLCB7XHJcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXHJcbiAgICAgIG1ldGhvZDogXCJERUxFVEVcIixcclxuICAgIH0pLnRoZW4oKHJlcykgPT5cclxuICAgICAgcmVzLm9rID8gcmVzLmpzb24oKSA6IFByb21pc2UucmVqZWN0KFwiRXJyb3IhXCIgKyByZXMuc3RhdHVzVGV4dClcclxuICAgICk7XHJcbiAgfVxyXG4gIC8vIC0tLSBMaWtlIGEgY2FyZCAtLS0gLy9cclxuICBhZGRMaWtlKGNhcmRJZCkge1xyXG4gICAgcmV0dXJuIGZldGNoKHRoaXMuX2Jhc2VVcmwgKyBcIi9jYXJkcy9saWtlcy9cIiArIGNhcmRJZCwge1xyXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxyXG4gICAgICBtZXRob2Q6IFwiUFVUXCIsXHJcbiAgICB9KS50aGVuKChyZXMpID0+IHtcclxuICAgICAgaWYgKHJlcy5vaykge1xyXG4gICAgICAgIHJldHVybiByZXMuanNvbigpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIFByb21pc2UucmVqZWN0KFwiRXJyb3IhXCIgKyByZXMuc3RhdHVzVGV4dCk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuICAvLyAtLS0gVW5saWtlIGEgY2FyZCAtLS0gLy9cclxuICByZW1vdmVMaWtlKGNhcmRJZCkge1xyXG4gICAgcmV0dXJuIGZldGNoKHRoaXMuX2Jhc2VVcmwgKyBcIi9jYXJkcy9saWtlcy9cIiArIGNhcmRJZCwge1xyXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxyXG4gICAgICBtZXRob2Q6IFwiREVMRVRFXCIsXHJcbiAgICB9KS50aGVuKChyZXMpID0+XHJcbiAgICAgIHJlcy5vayA/IHJlcy5qc29uKCkgOiBQcm9taXNlLnJlamVjdChcIkVycm9yIVwiICsgcmVzLnN0YXR1c1RleHQpXHJcbiAgICApO1xyXG4gIH1cclxuICAvLyAtLS0gU2V0dGluZyB1c2VyIHByb2ZpbGUgaW5mbyAtLS0gLy9cclxuICBzZXRVc2VySW5mbyh7IG5hbWUsIGpvYiB9KSB7XHJcbiAgICByZXR1cm4gKFxyXG4gICAgICBmZXRjaCh0aGlzLl9iYXNlVXJsICsgXCIvdXNlcnMvbWVcIiwge1xyXG4gICAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXHJcbiAgICAgICAgbWV0aG9kOiBcIlBBVENIXCIsXHJcbiAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xyXG4gICAgICAgICAgbmFtZSxcclxuICAgICAgICAgIGpvYixcclxuICAgICAgICB9KSxcclxuICAgICAgfSlcclxuICAgICAgICAudGhlbigocmVzKSA9PiB7XHJcbiAgICAgICAgICByZXR1cm4gcmVzLm9rXHJcbiAgICAgICAgICAgID8gcmVzLmpzb24oKVxyXG4gICAgICAgICAgICA6IFByb21pc2UucmVqZWN0KFwiRXJyb3IhXCIgKyByZXMuc3RhdHVzVGV4dCArIHJlcy5zdGF0dXMpO1xyXG4gICAgICAgIH0pXHJcbiAgICApO1xyXG4gIH1cclxuICAvLyAtLS0gU2V0dGluZyB1c2VyIHByb2ZpbGUgYXZhdGFyIC0tLSAvL1xyXG4gIHNldFVzZXJBdmF0YXIoeyBhdmF0YXIgfSkge1xyXG4gICAgcmV0dXJuIGZldGNoKHRoaXMuX2Jhc2VVcmwgKyBcIi91c2Vycy9tZS9hdmF0YXJcIiwge1xyXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxyXG4gICAgICBtZXRob2Q6IFwiUEFUQ0hcIixcclxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xyXG4gICAgICAgIGF2YXRhcixcclxuICAgICAgfSksXHJcbiAgICB9KS50aGVuKChyZXMpID0+XHJcbiAgICAgIHJlcy5vayA/IHJlcy5qc29uKCkgOiBQcm9taXNlLnJlamVjdChcIkVycm9yIVwiICsgcmVzLnN0YXR1c1RleHQpXHJcbiAgICApO1xyXG4gIH1cclxuICAvLyAtLS0gVXBkYXRpbmcvRWRpdGluZyB1c2VyIHByb2ZpbGUgaW5mbyAtLS0gLy9cclxuICB1cGRhdGVVc2VySW5mbyh7IG5hbWUsIGpvYiB9KSB7XHJcbiAgICByZXR1cm4gZmV0Y2godGhpcy5fYmFzZVVybCArIFwiL3VzZXJzL21lXCIsIHtcclxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcclxuICAgICAgbWV0aG9kOiBcIlBBVENIXCIsXHJcbiAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHtcclxuICAgICAgICBuYW1lLFxyXG4gICAgICAgIGpvYixcclxuICAgICAgfSksXHJcbiAgICB9KS50aGVuKChyZXMpID0+IHtcclxuICAgICAgcmV0dXJuIHJlcy5vayA/IHJlcy5qc29uKCkgOiBQcm9taXNlLnJlamVjdChcIkVycm9yIVwiICsgcmVzLnN0YXR1c1RleHQpO1xyXG4gICAgfSk7XHJcbiAgfVxyXG59XHJcbiJdLCJuYW1lcyI6WyJGb3JtVmFsaWRhdG9yIiwiY29uc3RydWN0b3IiLCJmb3JtQ29uZmlnIiwiZm9ybUVsZW1lbnQiLCJ0aGlzIiwiX2Zvcm1Db25maWciLCJfZm9ybUVsZW1lbnQiLCJfc2hvd0lucHV0RXJyb3IiLCJpbnB1dEVsZW1lbnQiLCJlcnJvck1lc3NhZ2UiLCJpbnB1dEVycm9yQ2xhc3MiLCJlcnJvck1lc3NhZ2VDbGFzcyIsImVycm9yRWxlbWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJpZCIsInRleHRDb250ZW50IiwiY2xhc3NMaXN0IiwiYWRkIiwiX2hpZGVJbnB1dEVycm9yIiwicmVtb3ZlIiwicmVzZXRWYWxpZGF0aW9uIiwiaW5wdXRzIiwiZm9yRWFjaCIsImlucHV0IiwiX3RvZ2dsZVN1Ym1pdEJ1dHRvbiIsIl9jaGVja0lucHV0IiwidmFsaWRpdHkiLCJ2YWxpZCIsInZhbGlkYXRpb25NZXNzYWdlIiwiX2NoZWNrSWZGb3JtVmFsaWQiLCJldmVyeSIsImluYWN0aXZlQnV0dG9uQ2xhc3MiLCJzdWJtaXRCdXR0b25TZWxlY3RvciIsImJ1dHRvbkVsZW1lbnQiLCJkaXNhYmxlZCIsIl9zZXRFdmVudExpc3RlbmVycyIsImlucHV0U2VsZWN0b3IiLCJBcnJheSIsImZyb20iLCJxdWVyeVNlbGVjdG9yQWxsIiwiYWRkRXZlbnRMaXN0ZW5lciIsImVuYWJsZVZhbGlkYXRpb24iLCJldmVudCIsInByZXZlbnREZWZhdWx0IiwiQ2FyZCIsImRhdGEiLCJvbkNhcmRDbGljayIsInJlbW92ZUhhbmRsZXIiLCJsaWtlSGFuZGxlciIsInVzZXJJZCIsImNhcmRUZW1wbGF0ZVNlbGVjdG9yIiwiX25hbWUiLCJuYW1lIiwiX2xpbmsiLCJsaW5rIiwiX293bmVyIiwib3duZXIiLCJfY2FyZFRlbXBsYXRlU2VsZWN0b3IiLCJfbGlrZXMiLCJsaWtlcyIsIl91c2VySWQiLCJfb25DYXJkQ2xpY2siLCJfbGlrZUhhbmRsZXIiLCJfaWQiLCJfcmVtb3ZlSGFuZGxlciIsImRlbGV0ZUNhcmQiLCJjYXJkRWxlbWVudCIsImRvY3VtZW50IiwiZ2V0RWxlbWVudEJ5SWQiLCJwYXJlbnROb2RlIiwicmVtb3ZlQ2hpbGQiLCJfY2FyZEVsZW1lbnQiLCJfcmVuZGVyTGlrZXMiLCJzb21lIiwibGlrZSIsInNob3dMaWtlcyIsImNvdW50IiwidXBkYXRlTGlrZXMiLCJuZXdMaWtlcyIsIl9saWtlQ2FyZCIsIl9jYXJkSW1hZ2UiLCJfc2hvd0RlbGV0ZUljb24iLCJnZW5lcmF0ZUNhcmQiLCJfY2FyZFRlbXBsYXRlIiwiY29udGVudCIsImNsb25lTm9kZSIsIl9jYXJkVGl0bGUiLCJzcmMiLCJhbHQiLCJsZW5ndGgiLCJfaXRlbSIsIk1vZGFsIiwibW9kYWxTZWxlY3RvciIsIl9tb2RhbFNlbGVjdG9yIiwiX2NoZWNrRm9yRXNjQ2xvc2UiLCJiaW5kIiwia2V5IiwiY2xvc2UiLCJvcGVuIiwicmVtb3ZlRXZlbnRMaXN0ZW5lciIsInNldEV2ZW50TGlzdGVuZXJzIiwiZSIsInRhcmdldCIsImNvbnRhaW5zIiwiTW9kYWxXaXRoRm9ybSIsImhhbmRsZVN1Ym1pdCIsInN1cGVyIiwiX2hhbmRsZVN1Ym1pdCIsImdldElucHV0VmFsdWVzIiwiaW5wdXRMaXN0IiwiaW5wdXRWYWx1ZXMiLCJ2YWx1ZSIsInNldElucHV0VmFsdWVzIiwidmFsdWVzIiwic2V0U3VibWl0SGFuZGxlciIsInJlc2V0IiwiU2VjdGlvbiIsIml0ZW1zIiwicmVuZGVyZXIiLCJjb250YWluZXJTZWxlY3RvciIsIl9pdGVtcyIsIl9yZW5kZXJlciIsIl9jb250YWluZXIiLCJhZGRJdGVtIiwiZWxlbWVudCIsInByZXBlbmQiLCJjbGVhciIsImlubmVySFRNTCIsInJlbmRlckl0ZW1zIiwiY2FyZCIsIlVzZXJJbmZvIiwiam9iIiwiYXZhdGFyIiwiX2pvYiIsIl9hdmF0YXIiLCJnZXRVc2VySW5mbyIsIl91c2VySW5mbyIsInRpdGxlIiwiX3RpdGxlIiwic2V0VXNlckluZm8iLCJ1c2VyQXZhdGFyIiwiYXZhdGFySW1hZ2UiLCJwcm9maWxlTmFtZSIsInByb2ZpbGVKb2IiLCJlZGl0QnV0dG9uIiwicHJvZmlsZU1vZGFsIiwiYXZhdGFyRWRpdEJ1dHRvbiIsImF2YXRhck1vZGFsIiwiYWRkQ2FyZEJ1dHRvbiIsImFkZENhcmRNb2RhbCIsImFkZENhcmRGb3JtIiwiZm9ybXMiLCJjYXJkQmlnTW9kYWwiLCJlbGVtZW50cyIsImZvcm1TZWxlY3RvciIsImJpZ0ltYWdlIiwib3BlbnVwIiwiX21vZGFsRWxlbWVudCIsImRlbGV0ZUNhcmRNb2RhbCIsImxvYWRpbmdNb2RhbCIsImlzTG9hZGluZyIsIm1vZGFsIiwiYXBpIiwiYmFzZVVybCIsImhlYWRlcnMiLCJfYmFzZVVybCIsIl9oZWFkZXJzIiwiZ2V0Q2FyZExpc3QiLCJmZXRjaCIsInRoZW4iLCJyZXMiLCJvayIsImpzb24iLCJQcm9taXNlIiwicmVqZWN0Iiwic3RhdHVzVGV4dCIsImdldEFwcEluZm8iLCJhbGwiLCJhZGRDYXJkIiwibWV0aG9kIiwiYm9keSIsIkpTT04iLCJzdHJpbmdpZnkiLCJyZW1vdmVDYXJkIiwiY2FyZElkIiwiYWRkTGlrZSIsInJlbW92ZUxpa2UiLCJzdGF0dXMiLCJzZXRVc2VyQXZhdGFyIiwidXBkYXRlVXNlckluZm8iLCJhdXRob3JpemF0aW9uIiwidXNlckRhdGEiLCJjYXJkTGlzdERhdGEiLCJjYXJkc0xpc3QiLCJhZGRpbmdOZXdDYXJkIiwiYWRkTmV3Q2FyZE1vZGFsIiwibW9kYWxTdWJtaXRpb24iLCJjb25zb2xlIiwibG9nIiwiY2F0Y2giLCJlcnIiLCJjYXJkSW5zdGFuY2UiLCJoYW5kbGVDYXJkQ2xpY2siLCJoYW5kbGVEZWxldGVDbGljayIsImRlbGV0ZUxpa2UiLCJ0b2dnbGUiLCJwcm9maWxlSW5mbyIsInByb2ZpbGVGb3JtIiwic2V0VXNlckluZm9zIiwiYWJvdXQiLCJkZXNjIiwidXNlciIsImlucHV0TmFtZSIsImlucHV0Sm9iIiwiZWRpdEF2YXRhciIsImF2YXRhclVSTCIsImhhbmRsZUF2YXRhckVkaXQiXSwic291cmNlUm9vdCI6IiJ9