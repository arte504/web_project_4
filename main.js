!function(){"use strict";class e{constructor(e,t){this._formConfig=e,this._formElement=t}_showInputError=(e,t)=>{const{inputErrorClass:r,errorMessageClass:s}=this._formConfig,n=this._formElement.querySelector(` #${e.id}_error `);n.textContent=t,n.classList.add(s),e.classList.add(r)};_hideInputError=e=>{const{inputErrorClass:t,errorMessageClass:r}=this._formConfig,s=this._formElement.querySelector(` #${e.id}_error `);s.textContent="",s.classList.remove(r),e.classList.remove(t)};resetValidation(){this.inputs.forEach((e=>{this._hideInputError(e)})),this._toggleSubmitButton()}_checkInput=e=>{e.validity.valid?this._hideInputError(e):this._showInputError(e,e.validationMessage)};_checkIfFormValid=()=>this.inputs.every((e=>e.validity.valid));_toggleSubmitButton(){const{inactiveButtonClass:e,submitButtonSelector:t}=this._formConfig,r=this._formElement.querySelector(t);this._checkIfFormValid()?(r.disabled=!1,r.classList.remove(e)):(r.disabled=!0,r.classList.add(e))}_setEventListeners=()=>{const{inputSelector:e}=this._formConfig;return this.inputs=Array.from(this._formElement.querySelectorAll(e)),this.inputs.forEach((e=>{e.addEventListener("input",(()=>{this._checkInput(e),this._toggleSubmitButton()}))})),this._formElement};enableValidation(){this._formElement.addEventListener("submit",(e=>{e.preventDefault()})),this._setEventListeners()}}class t{constructor(e,t,r,{onCardClick:s,removeHandler:n,likeHandler:o}){this._name=e.name,this._link=e.link,this._likes=e.likes,this._ownerId=e.owner._id,this._id=e._id,this._template=t,this._userId=r,this._onCardClick=s,this._likeHandler=o,this._removeHandler=n}_getTemplate(){return this._template.content.querySelector(".card").cloneNode(!0)}_setAttributes(e,t){for(const r in t)e.setAttribute(r,t[r])}deleteCard(){const e=document.getElementById(id);e&&e.parentNode.removeChild(e),this._cardElement=null}_renderLikes(){this._likes.forEach((e=>e._id===this._userId?this._likeCard():this._unlikeCard()))}showLikes(e){this._cardElement.querySelector(".card__like-count").textContent=e}_setEventListeners(){this._cardElement.querySelector(".card__like-button").addEventListener("click",(e=>{this._likeCard(e)})),this._cardElement.querySelector(".card__delete-button").addEventListener("click",(()=>{this._removeHandler(this._id)})),this._cardElement.addEventListener("click",(e=>{this._onCardClick(e)}))}_showDeleteIcon(){this._userId!=this._ownerId&&this._cardElement.querySelector(".card__delete-button").classList.add("card__delete-button_hidden")}isLiked(){return this.likeIcon.classList.contains("card__like-button_active")}generateCard(){return this._cardElement=this._getTemplate(),this.likeIcon=this._cardElement.querySelector(".card__like-button"),this._setAttributes(this._cardElement.querySelector(".card__image"),{src:this._link,alt:this._name}),this._cardElement.querySelector(".card__title").textContent=this._name,this._showDeleteIcon(),this.showLikes(this._likes.length),this._setEventListeners(),this._renderLikes(),this._cardElement}_likeCard(){this.likeIcon.classList.add("card__like-button_active")}_unlikeCard(){this.likeIcon.classList.remove("card__like-button_active")}}class r{constructor(e){this._modal=e}open(){this._modal.classList.add("modal_visible"),document.addEventListener("keyup",this._clickEscHandler),console.log(this._modal)}close(){console.log("Check"),this._modal.classList.remove("modal_visible"),document.removeEventListener("keyup",this._clickEscHandler)}_clickEscHandler=e=>{"Escape"===e.key&&this.close()};setEventListeners(){this._modal.querySelector(".modal__close-button").addEventListener("click",(e=>{this.close(e)})),this._modal.addEventListener("click",(e=>{e.target.classList.contains("modal_visible")&&this.close(e)}))}}class s extends r{constructor({modal:e,handleSubmit:t}){super(e),this._handleSubmit=t,this._form=document.querySelector(".modal__container"),this._formElement=this._form.querySelectorAll(".modal__input")}_getInputValues(){return this._formInputValues={},inputList.forEach((e=>{this._formInputValues[e.name]=e.value})),inputValues}setEventListeners(){super.setEventListeners(),this._form.addEventListener("submit",this.handleSubmit)}handleSubmit=e=>(e.preventDefault(),this._handleSubmit(this._getInputValues));handleRemove(e){this._handleSubmit=e}close(){console.log("Check"),super.close(),this._form.removeEventListener("submit",this.handleSubmit),this._form.reset()}}class n{constructor({items:e,renderer:t},r){this._renderedElements=e,this._renderer=t,this._container=document.querySelector(r)}renderer(){this._renderedElements.forEach((e=>this._renderer(e)))}addItem(e){this._container.append(e)}prependItem(e){this._container.prepend(e)}}class o{constructor(e,t,r){this._name=e,this._job=t,this._avatar=r}getUserInfo(){return this._userInfo={name:this._name.textContent,job:this._job.textContent}}setUserInfo(e){const{name:t,job:r,userAvatar:s}=e;this._name.textContent=t,this._job.textContent=r,this._avatar.src=s}}const i=document.querySelector(".profile__edit-button"),a=document.querySelector(".modal_type_edit"),l=document.querySelector(".profile__title"),d=document.querySelector(".modal__input_type_title"),c=document.querySelector(".profile__subtitle"),_=document.querySelector(".modal__input_type_subtitle"),h=(document.querySelector(".modal__close-button_type_edit"),document.querySelector(".profile__image")),u=(document.querySelector(".profile__image-edit"),document.querySelector(".modal_type_avatar")),m=(u.querySelector(".modal__input_type_avatar"),document.querySelector(".modal__close-button_type_avatar"),document.querySelector(".profile__add-button")),p=document.querySelector(".modal_type_add-card"),b=(document.querySelector(".modal__input_type_name"),document.querySelector(".modal__input_type_link"),document.querySelector(".modal__close-button_type_add-card"),document.forms.add),E=(b.elements.title,b.elements.link,document.querySelector(".modal__submit-button"),document.querySelector(".cards__grid"),document.querySelector("#card__template")),f=document.querySelector(".modal_type_big-image"),k=(document.querySelector(".modal__big-image"),document.querySelector(".modal__image-caption"),document.querySelector(".modal__close-button_type_big-image"),document.querySelector(".modal_type_delete-card")),y={formSelector:".modal__container",inputSelector:".modal__input",submitButtonSelector:".modal__submit-button",inactiveButtonClass:"modal__submit-button_disabled",inputErrorClass:"modal__input_error",errorMessageClass:"modal__error_visible"},v=new class extends r{openup=e=>{const t=e.target;this._modalElement.querySelector(".modal__big-image").src=t.src,this._modalElement.querySelector(".modal__big-image").alt=t.alt,this._modalElement.querySelector(".modal__image-caption").textContent=t.alt,this.open()}}(f);v.setEventListeners();const S=new s({modal:k});function g(e,t){t.querySelector(".modal__submit-button").textContent=e?"Saving...":"Save"}S.setEventListeners();const C=new class{constructor({baseUrl:e,headers:t}){this._baseUrl=e,this._headers=t}getCardList(){return fetch(this._baseUrl+"/cards",{headers:this._headers}).then((function(e){if(e.ok)return e.json().then((e=>e));Promise.reject("Error!"+e.statusText)}))}getUserInfo(){return fetch(this._baseUrl+"/users/me",{headers:this._headers}).then((e=>e.ok?e.json():Promise.reject("Error!"+e.statusText)))}getAppInfo(){return Promise.all([this.getCardList(),this.getUserInfo()])}addCard(e){const{name:t,link:r}=e;return fetch(this._baseUrl+"/cards",{headers:this._headers,method:"POST",body:JSON.stringify({name:t,link:r})}).then((e=>{if(e.ok)return e.json();Promise.reject("Error!"+e.statusText)}))}removeCard(e){return fetch(this._baseUrl+"/cards/"+e,{headers:this._headers,method:"DELETE"}).then((e=>e.ok?e.json():Promise.reject("Error!"+e.statusText)))}likeCard(e){return fetch(this._baseUrl+"/cards/likes/"+e,{headers:this._headers,method:"PUT"}).then((e=>{if(e.ok)return e.json();Promise.reject("Error!"+e.statusText)}))}unlikeCard(e){return fetch(this._baseUrl+"/cards/likes/"+e,{headers:this._headers,method:"DELETE"}).then((e=>e.ok?e.json():Promise.reject("Error!"+e.statusText)))}setUserInfo(e){const{name:t,job:r}=e;return fetch(this._baseUrl+"/users/me",{headers:this._headers,method:"PATCH",body:JSON.stringify({name:t,job:r})}).then((e=>e.ok?e.json():Promise.reject("Error!"+e.statusText+e.status)))}setUserAvatar(e){return fetch(this._baseUrl+"/users/me/avatar",{headers:this._headers,method:"PATCH",body:JSON.stringify({avatar:e})}).then((e=>e.ok?e.json():Promise.reject("Error!"+e.statusText)))}updateUserInfo(e){const{name:t,job:r}=e;return fetch(this._baseUrl+"/users/me",{headers:this._headers,method:"PATCH",body:JSON.stringify({name:t,about:r})}).then((e=>e.ok?e.json():Promise.reject("Error!"+e.statusText)))}}({baseUrl:"https://around.nomoreparties.co/v1/group-12",headers:{authorization:"709a0d9d-db06-4890-a594-b07e7309a353","Content-Type":"application/json"}});C.getAppInfo().then((([e,r])=>{const b=new o(l,c,h);b.setUserInfo(r);const f=e=>{const s=new t(e,E,r._id,{onCardClick:({name:e,link:t})=>{v.open(t,e)},removeHandler:e=>{S.open(),S.handleRemove((()=>{C.removeCard(e).then((()=>{s.deleteCardModal(),S.close()})).catch((e=>console.log(e)))}))},likeHandler:e=>{s.isLiked()?C.unlikeCard(e).then((e=>{s.unlikeCard(),s.showLikes(e.likes.lenght)})):C.likeCard(e).then((e=>{s.unlikeCard(),s.showLikes(e.likes.lenght)})).catch((e=>console.log(e)))}});return s},k=new n({items:e,renderer:e=>{k.addItem(f(e).generateCard())}},".cards__grid");console.log(e),k.renderer();const y=new s({modal:p,handleSubmit:e=>{g(!0,p),C.addCard(e).then((e=>{k.prependItem(f(e).generateCard())})).then((()=>{y.close()})).catch((e=>console.log(e))).finally((()=>g(!1,p)))}});y.setEventListeners(),m.addEventListener("click",(()=>{q.resetValidation(),y.open()}));const I=new s({modal:a,handleSubmit:e=>{g(!0,a),C.updateUserInfo(o).then((e=>{b.setUserInfo(e)})).then((()=>{I.close()})).catch((e=>console.log(e))).finally((()=>g(!1,a)))}});I.setEventListeners(),i.addEventListener("click",(()=>{L.resetValidation();const{name:e,job:t}=b.getUserInfo();d.value=e,_.value=t,I.open()}));const j=new s({modal:u,handleSubmit:e=>{g(!0,u),C.updateUserInfo(e.avatar).then((e=>{b.setUserInfo(e)})).then((()=>{j.close()})).catch((e=>console.log(e))).finally((()=>{g(!1,u)}))}});j.setEventListeners()})).catch((e=>console.log(e)));const L=new e(y,a);L.enableValidation(),new e(y,u).enableValidation();const q=new e(y,p);q.enableValidation()}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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SXpDLEVBQWNFLEVBQVkrSSxHQUN0Q3hHLG1CQUVyQixNQUFNZ0ssRUFBd0IsSUFBSXpNLEVBQWNFLEVBQVlpSixHQUM1RHNELEVBQXNCaEssbUIiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly93ZWJfcHJvamVjdF80Ly4vc3JjL2NvbXBvbmVudHMvc2NyaXB0cy9Gb3JtVmFsaWRhdG9yLmpzIiwid2VicGFjazovL3dlYl9wcm9qZWN0XzQvLi9zcmMvY29tcG9uZW50cy9zY3JpcHRzL0NhcmQuanMiLCJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfNC8uL3NyYy9jb21wb25lbnRzL3NjcmlwdHMvTW9kYWwuanMiLCJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfNC8uL3NyYy9jb21wb25lbnRzL3NjcmlwdHMvTW9kYWxXaXRoRm9ybS5qcyIsIndlYnBhY2s6Ly93ZWJfcHJvamVjdF80Ly4vc3JjL2NvbXBvbmVudHMvc2NyaXB0cy9TZWN0aW9uLmpzIiwid2VicGFjazovL3dlYl9wcm9qZWN0XzQvLi9zcmMvY29tcG9uZW50cy9zY3JpcHRzL1VzZXJJbmZvLmpzIiwid2VicGFjazovL3dlYl9wcm9qZWN0XzQvLi9zcmMvY29tcG9uZW50cy91dGlscy9jb25zdGFudHMuanMiLCJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfNC8uL3NyYy9wYWdlcy9JbmRleC5qcyIsIndlYnBhY2s6Ly93ZWJfcHJvamVjdF80Ly4vc3JjL2NvbXBvbmVudHMvc2NyaXB0cy9Nb2RhbFdpdGhJbWFnZS5qcyIsIndlYnBhY2s6Ly93ZWJfcHJvamVjdF80Ly4vc3JjL2NvbXBvbmVudHMvc2NyaXB0cy9BcGkuanMiXSwic291cmNlc0NvbnRlbnQiOlsiZXhwb3J0IGRlZmF1bHQgY2xhc3MgRm9ybVZhbGlkYXRvciB7XHJcbiAgY29uc3RydWN0b3IoZm9ybUNvbmZpZywgZm9ybUVsZW1lbnQpIHtcclxuICAgIHRoaXMuX2Zvcm1Db25maWcgPSBmb3JtQ29uZmlnO1xyXG4gICAgdGhpcy5fZm9ybUVsZW1lbnQgPSBmb3JtRWxlbWVudDtcclxuICB9XHJcblxyXG4gIF9zaG93SW5wdXRFcnJvciA9IChpbnB1dEVsZW1lbnQsIGVycm9yTWVzc2FnZSkgPT4ge1xyXG4gICAgY29uc3QgeyBpbnB1dEVycm9yQ2xhc3MsIGVycm9yTWVzc2FnZUNsYXNzIH0gPSB0aGlzLl9mb3JtQ29uZmlnO1xyXG4gICAgY29uc3QgZXJyb3JFbGVtZW50ID0gdGhpcy5fZm9ybUVsZW1lbnQucXVlcnlTZWxlY3RvcihgICMke2lucHV0RWxlbWVudC5pZH1fZXJyb3IgYCk7XHJcbiAgICBlcnJvckVsZW1lbnQudGV4dENvbnRlbnQgPSBlcnJvck1lc3NhZ2U7XHJcbiAgICBlcnJvckVsZW1lbnQuY2xhc3NMaXN0LmFkZChlcnJvck1lc3NhZ2VDbGFzcyk7XHJcbiAgICBpbnB1dEVsZW1lbnQuY2xhc3NMaXN0LmFkZChpbnB1dEVycm9yQ2xhc3MpO1xyXG4gIH07XHJcbiAgXHJcbiAgX2hpZGVJbnB1dEVycm9yID0gKGlucHV0RWxlbWVudCkgPT4ge1xyXG4gICAgY29uc3QgeyBpbnB1dEVycm9yQ2xhc3MsIGVycm9yTWVzc2FnZUNsYXNzIH0gPSB0aGlzLl9mb3JtQ29uZmlnO1xyXG4gICAgY29uc3QgZXJyb3JFbGVtZW50ID0gdGhpcy5fZm9ybUVsZW1lbnQucXVlcnlTZWxlY3RvcihgICMke2lucHV0RWxlbWVudC5pZH1fZXJyb3IgYCk7XHJcbiAgICBlcnJvckVsZW1lbnQudGV4dENvbnRlbnQgPSBcIlwiO1xyXG4gICAgZXJyb3JFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoZXJyb3JNZXNzYWdlQ2xhc3MpO1xyXG4gICAgaW5wdXRFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoaW5wdXRFcnJvckNsYXNzKTtcclxuICB9O1xyXG5cclxuICByZXNldFZhbGlkYXRpb24oKSB7XHJcbiAgICB0aGlzLmlucHV0cy5mb3JFYWNoKChpbnB1dCkgPT4ge1xyXG4gICAgICB0aGlzLl9oaWRlSW5wdXRFcnJvcihpbnB1dCk7XHJcbiAgICB9KTtcclxuICAgIHRoaXMuX3RvZ2dsZVN1Ym1pdEJ1dHRvbigpO1xyXG4gIH1cclxuXHJcbiAgX2NoZWNrSW5wdXQgPSAoaW5wdXRFbGVtZW50KSA9PiB7XHJcbiAgICBpZiAoIWlucHV0RWxlbWVudC52YWxpZGl0eS52YWxpZCkge1xyXG4gICAgICB0aGlzLl9zaG93SW5wdXRFcnJvcihpbnB1dEVsZW1lbnQsIGlucHV0RWxlbWVudC52YWxpZGF0aW9uTWVzc2FnZSk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB0aGlzLl9oaWRlSW5wdXRFcnJvcihpbnB1dEVsZW1lbnQpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgX2NoZWNrSWZGb3JtVmFsaWQgPSAoKSA9PiB0aGlzLmlucHV0cy5ldmVyeSgoaW5wdXQpID0+IGlucHV0LnZhbGlkaXR5LnZhbGlkKTtcclxuXHJcbiAgX3RvZ2dsZVN1Ym1pdEJ1dHRvbigpIHtcclxuICAgIGNvbnN0IHsgaW5hY3RpdmVCdXR0b25DbGFzcywgc3VibWl0QnV0dG9uU2VsZWN0b3IgfSA9IHRoaXMuX2Zvcm1Db25maWc7XHJcbiAgICBjb25zdCBidXR0b25FbGVtZW50ID0gdGhpcy5fZm9ybUVsZW1lbnQucXVlcnlTZWxlY3RvcihzdWJtaXRCdXR0b25TZWxlY3Rvcik7XHJcblxyXG4gICAgaWYgKHRoaXMuX2NoZWNrSWZGb3JtVmFsaWQoKSkge1xyXG4gICAgICBidXR0b25FbGVtZW50LmRpc2FibGVkID0gZmFsc2U7XHJcbiAgICAgIGJ1dHRvbkVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZShpbmFjdGl2ZUJ1dHRvbkNsYXNzKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGJ1dHRvbkVsZW1lbnQuZGlzYWJsZWQgPSB0cnVlO1xyXG4gICAgICBidXR0b25FbGVtZW50LmNsYXNzTGlzdC5hZGQoaW5hY3RpdmVCdXR0b25DbGFzcyk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBfc2V0RXZlbnRMaXN0ZW5lcnMgPSAoKSA9PiB7XHJcbiAgICBjb25zdCB7IGlucHV0U2VsZWN0b3IgfSA9IHRoaXMuX2Zvcm1Db25maWc7XHJcbiAgICB0aGlzLmlucHV0cyA9IEFycmF5LmZyb20odGhpcy5fZm9ybUVsZW1lbnQucXVlcnlTZWxlY3RvckFsbChpbnB1dFNlbGVjdG9yKSk7XHJcblxyXG4gICAgdGhpcy5pbnB1dHMuZm9yRWFjaCgoaW5wdXQpID0+IHtcclxuICAgICAgaW5wdXQuYWRkRXZlbnRMaXN0ZW5lcihcImlucHV0XCIsICgpID0+IHtcclxuICAgICAgICB0aGlzLl9jaGVja0lucHV0KGlucHV0KTtcclxuICAgICAgICB0aGlzLl90b2dnbGVTdWJtaXRCdXR0b24oKTtcclxuICAgICAgfSk7XHJcbiAgICB9KTtcclxuICAgIHJldHVybiB0aGlzLl9mb3JtRWxlbWVudDtcclxuICB9O1xyXG5cclxuICBlbmFibGVWYWxpZGF0aW9uKCkge1xyXG4gICAgdGhpcy5fZm9ybUVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCAoZXZlbnQpID0+IHtcclxuICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcclxuICAgIH0pO1xyXG4gICAgdGhpcy5fc2V0RXZlbnRMaXN0ZW5lcnMoKTtcclxuICB9XHJcbn0iLCJleHBvcnQgZGVmYXVsdCBjbGFzcyBDYXJkIHtcclxuICBjb25zdHJ1Y3RvciggZGF0YSwgdGVtcGxhdGUsIHVzZXJJZCwgXHJcbiAgICB7IG9uQ2FyZENsaWNrLCByZW1vdmVIYW5kbGVyLCBsaWtlSGFuZGxlciB9ICkgXHJcbiAge1xyXG4gICAgdGhpcy5fbmFtZSA9IGRhdGEubmFtZTtcclxuICAgIHRoaXMuX2xpbmsgPSBkYXRhLmxpbms7XHJcbiAgICB0aGlzLl9saWtlcyA9IGRhdGEubGlrZXM7XHJcbiAgICB0aGlzLl9vd25lcklkID0gZGF0YS5vd25lci5faWQ7XHJcbiAgICB0aGlzLl9pZCA9IGRhdGEuX2lkO1xyXG4gICAgdGhpcy5fdGVtcGxhdGUgPSB0ZW1wbGF0ZTtcclxuICAgIHRoaXMuX3VzZXJJZCA9IHVzZXJJZDtcclxuXHJcbiAgICB0aGlzLl9vbkNhcmRDbGljayA9IG9uQ2FyZENsaWNrO1xyXG4gICAgdGhpcy5fbGlrZUhhbmRsZXIgPSBsaWtlSGFuZGxlcjtcclxuICAgIHRoaXMuX3JlbW92ZUhhbmRsZXIgPSByZW1vdmVIYW5kbGVyO1xyXG4gIH1cclxuICAvLyAtLS0gR2V0IGNhcmQgdGVtcGxhdGUgLS0tIC8vXHJcbiAgX2dldFRlbXBsYXRlKCkge1xyXG4gICAgY29uc3QgY2FyZEVsZW1lbnQgPSB0aGlzLl90ZW1wbGF0ZVxyXG4gICAgLmNvbnRlbnRcclxuICAgIC5xdWVyeVNlbGVjdG9yKCcuY2FyZCcpXHJcbiAgICAuY2xvbmVOb2RlKHRydWUpO1xyXG5cclxuICAgIHJldHVybiBjYXJkRWxlbWVudDtcclxuICB9XHJcblxyXG4gIF9zZXRBdHRyaWJ1dGVzKGNhcmRFbGVtZW50LCBhdHRyaWJzKSB7XHJcbiAgICBmb3IgKGNvbnN0IGtleSBpbiBhdHRyaWJzKSB7XHJcbiAgICAgIGNhcmRFbGVtZW50LnNldEF0dHJpYnV0ZShrZXksIGF0dHJpYnNba2V5XSk7XHJcbiAgICB9XHJcbiAgfVxyXG4gIC8vIC0tLSBDYXJkIGRlbGV0aW5nIG1ldGhvZCAtLS0gLy9cclxuICBkZWxldGVDYXJkKCkge1xyXG4gICAgY29uc3QgY2FyZEVsZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZCk7XHJcbiAgICBpZihjYXJkRWxlbWVudCl7XHJcbiAgICAgIGNhcmRFbGVtZW50LnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoY2FyZEVsZW1lbnQpO1xyXG4gICAgfVxyXG4gICAgdGhpcy5fY2FyZEVsZW1lbnQgPSBudWxsO1xyXG4gIH1cclxuICAvLyAtLS0gIC0tLSAvL1xyXG4gIF9yZW5kZXJMaWtlcyAoKSB7XHJcbiAgICB0aGlzLl9saWtlcy5mb3JFYWNoKChsaWtlKSA9PiBcclxuICAgICAgbGlrZS5faWQgPT09IHRoaXMuX3VzZXJJZCA/IHRoaXMuX2xpa2VDYXJkKCkgOiB0aGlzLl91bmxpa2VDYXJkKClcclxuICAgICk7XHJcbiAgfVxyXG4gIC8vIC0tLSBTaG93IHRoZSBsaWtlIGFtb3VudCAtLS0gLy9cclxuICBzaG93TGlrZXMoY291bnQpe1xyXG4gICAgdGhpcy5fY2FyZEVsZW1lbnQucXVlcnlTZWxlY3RvcignLmNhcmRfX2xpa2UtY291bnQnKS50ZXh0Q29udGVudCA9IGNvdW50O1xyXG4gIH1cclxuXHJcbiAgLy8gLS0tIFNldCBldmVudHMgbGlzdGVuZXJzIGZvciB0aGUgY2FyZHMgdGhhdCB3aWxsIGJlIGNyZWF0ZWQhIC0tLSAvL1xyXG4gIF9zZXRFdmVudExpc3RlbmVycygpIHtcclxuICAgIHRoaXMuX2NhcmRFbGVtZW50XHJcbiAgICAgIC5xdWVyeVNlbGVjdG9yKCcuY2FyZF9fbGlrZS1idXR0b24nKVxyXG4gICAgICAuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIChldmVudCkgPT4ge1xyXG4gICAgICAgIHRoaXMuX2xpa2VDYXJkKGV2ZW50KTtcclxuICAgICAgfSk7XHJcblxyXG4gICAgdGhpcy5fY2FyZEVsZW1lbnRcclxuICAgICAgLnF1ZXJ5U2VsZWN0b3IoJy5jYXJkX19kZWxldGUtYnV0dG9uJylcclxuICAgICAgLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XHJcbiAgICAgICAgdGhpcy5fcmVtb3ZlSGFuZGxlcih0aGlzLl9pZCk7XHJcbiAgICAgIH0pO1xyXG5cclxuICAgIHRoaXMuX2NhcmRFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoZXZlbnQpID0+IHtcclxuICAgICAgdGhpcy5fb25DYXJkQ2xpY2soZXZlbnQpO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBfc2hvd0RlbGV0ZUljb24oKSB7XHJcbiAgICBpZih0aGlzLl91c2VySWQgIT0gdGhpcy5fb3duZXJJZCkge1xyXG4gICAgICB0aGlzLl9jYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKCcuY2FyZF9fZGVsZXRlLWJ1dHRvbicpLmNsYXNzTGlzdC5hZGQoJ2NhcmRfX2RlbGV0ZS1idXR0b25faGlkZGVuJyk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBpc0xpa2VkKCkge1xyXG4gICAgcmV0dXJuIHRoaXMubGlrZUljb24uY2xhc3NMaXN0LmNvbnRhaW5zKCdjYXJkX19saWtlLWJ1dHRvbl9hY3RpdmUnKTtcclxuICB9XHJcblxyXG4gIC8vIC0tLSBDcmVhdGluZyB0aGUgY2FyZCBhbmQgY2FyZCBlbGVtZW50cyAtLS0gLy9cclxuICBnZW5lcmF0ZUNhcmQoKSB7XHJcbiAgICB0aGlzLl9jYXJkRWxlbWVudCA9IHRoaXMuX2dldFRlbXBsYXRlKCk7XHJcbiAgICB0aGlzLmxpa2VJY29uID0gdGhpcy5fY2FyZEVsZW1lbnQucXVlcnlTZWxlY3RvcignLmNhcmRfX2xpa2UtYnV0dG9uJyk7XHJcbiAgICB0aGlzLl9zZXRBdHRyaWJ1dGVzKHRoaXMuX2NhcmRFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJy5jYXJkX19pbWFnZScpLCB7XHJcbiAgICAgIHNyYzogdGhpcy5fbGluayxcclxuICAgICAgYWx0OiB0aGlzLl9uYW1lXHJcbiAgICB9KTtcclxuICAgIHRoaXMuX2NhcmRFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJy5jYXJkX190aXRsZScpLnRleHRDb250ZW50ID0gdGhpcy5fbmFtZTtcclxuXHJcbiAgICB0aGlzLl9zaG93RGVsZXRlSWNvbigpO1xyXG4gICAgdGhpcy5zaG93TGlrZXModGhpcy5fbGlrZXMubGVuZ3RoKTtcclxuICAgIHRoaXMuX3NldEV2ZW50TGlzdGVuZXJzKCk7XHJcbiAgICB0aGlzLl9yZW5kZXJMaWtlcygpO1xyXG5cclxuICAgIHJldHVybiB0aGlzLl9jYXJkRWxlbWVudDtcclxuICB9XHJcblxyXG4gIF9saWtlQ2FyZCgpIHtcclxuICAgIHRoaXMubGlrZUljb24uY2xhc3NMaXN0LmFkZCgnY2FyZF9fbGlrZS1idXR0b25fYWN0aXZlJyk7XHJcbiAgfVxyXG5cclxuICBfdW5saWtlQ2FyZCgpIHtcclxuICAgIHRoaXMubGlrZUljb24uY2xhc3NMaXN0LnJlbW92ZSgnY2FyZF9fbGlrZS1idXR0b25fYWN0aXZlJyk7XHJcbiAgfVxyXG59XHJcbiIsImV4cG9ydCBkZWZhdWx0IGNsYXNzIE1vZGFsIHtcclxuICBjb25zdHJ1Y3Rvcihtb2RhbCkge1xyXG4gICAgdGhpcy5fbW9kYWwgPSBtb2RhbDtcclxuICB9XHJcbiAgLy8gLS0tIE9wZW4gbW9kYWwgbWV0aG9kIC0tLSAvLyBcclxuICBvcGVuKCkge1xyXG4gICAgdGhpcy5fbW9kYWwuY2xhc3NMaXN0LmFkZChcIm1vZGFsX3Zpc2libGVcIik7XHJcbiAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwia2V5dXBcIiwgdGhpcy5fY2xpY2tFc2NIYW5kbGVyKTtcclxuICAgIGNvbnNvbGUubG9nKHRoaXMuX21vZGFsKTtcclxuICB9XHJcbiAgLy8gLS0tIENsb3NlIG1vZGFsIG1ldGhvZCAtLS0gLy9cclxuICBjbG9zZSgpIHtcclxuICAgIGNvbnNvbGUubG9nKFwiQ2hlY2tcIik7XHJcbiAgICB0aGlzLl9tb2RhbC5jbGFzc0xpc3QucmVtb3ZlKFwibW9kYWxfdmlzaWJsZVwiKTtcclxuICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJrZXl1cFwiLCB0aGlzLl9jbGlja0VzY0hhbmRsZXIpO1xyXG4gIH1cclxuICAvLyAtLS0gQ2xvc2UgbW9kYWwgb24gRVNDIG1ldGhvZCAtLS0gLy9cclxuICBfY2xpY2tFc2NIYW5kbGVyID0gKGV2ZW50KSA9PiB7XHJcbiAgICBpZiAoZXZlbnQua2V5ID09PSAnRXNjYXBlJykge1xyXG4gICAgICB0aGlzLmNsb3NlKCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBzZXRFdmVudExpc3RlbmVycygpIHtcclxuICAgIC8vIC0tLSBDbG9zZSBtb2RhbCBvbiBjbG9zZSgnWCcpIGJ1dHRvbiAtLS0gLy9cclxuICAgIHRoaXMuX21vZGFsXHJcbiAgICAucXVlcnlTZWxlY3RvcignLm1vZGFsX19jbG9zZS1idXR0b24nKVxyXG4gICAgLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoZXZlbnQpID0+IHtcclxuICAgICAgdGhpcy5jbG9zZShldmVudCk7XHJcbiAgICB9KTtcclxuICAgIC8vIENsb3NlIG1vZGFsIG9uIG92ZXJsYXkob3V0IG9mIHRoZSBtb2RhbCkgY2xpY2sgLS0tIC8vL1xyXG4gICAgdGhpcy5fbW9kYWwuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIChldmVudCkgPT4ge1xyXG4gICAgICBpZiAoZXZlbnQudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucyhcIm1vZGFsX3Zpc2libGVcIikpIHtcclxuICAgICAgICB0aGlzLmNsb3NlKGV2ZW50KTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG59IiwiaW1wb3J0IE1vZGFsIGZyb20gXCIuL01vZGFsLmpzXCI7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBNb2RhbFdpdGhGb3JtIGV4dGVuZHMgTW9kYWwge1xyXG4gIGNvbnN0cnVjdG9yKHttb2RhbCwgaGFuZGxlU3VibWl0fSkge1xyXG4gICAgc3VwZXIobW9kYWwpO1xyXG4gICAgdGhpcy5faGFuZGxlU3VibWl0ID0gaGFuZGxlU3VibWl0O1xyXG4gICAgdGhpcy5fZm9ybSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbF9fY29udGFpbmVyJyk7XHJcbiAgICB0aGlzLl9mb3JtRWxlbWVudCA9IHRoaXMuX2Zvcm0ucXVlcnlTZWxlY3RvckFsbCgnLm1vZGFsX19pbnB1dCcpO1xyXG4gIH1cclxuXHJcbiAgX2dldElucHV0VmFsdWVzKCkge1xyXG4gICAgdGhpcy5fZm9ybUlucHV0VmFsdWVzID0ge307XHJcbiAgICBpbnB1dExpc3QuZm9yRWFjaCgoaW5wdXQpID0+IHtcclxuICAgICAgdGhpcy5fZm9ybUlucHV0VmFsdWVzW2lucHV0Lm5hbWVdID0gaW5wdXQudmFsdWU7XHJcbiAgICB9KTtcclxuXHJcbiAgICByZXR1cm4gaW5wdXRWYWx1ZXM7XHJcbiAgfVxyXG5cclxuICBzZXRFdmVudExpc3RlbmVycygpIHtcclxuICAgIHN1cGVyLnNldEV2ZW50TGlzdGVuZXJzKCk7XHJcbiAgICB0aGlzLl9mb3JtLmFkZEV2ZW50TGlzdGVuZXIoJ3N1Ym1pdCcsIHRoaXMuaGFuZGxlU3VibWl0KTtcclxuICB9XHJcblxyXG4gIGhhbmRsZVN1Ym1pdCA9IChldmVudCkgPT57XHJcbiAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgY29uc3QgaW5wdXRWYWx1ZXMgPSB0aGlzLl9oYW5kbGVTdWJtaXQodGhpcy5fZ2V0SW5wdXRWYWx1ZXMpO1xyXG5cclxuICAgIHJldHVybiBpbnB1dFZhbHVlcztcclxuICB9XHJcblxyXG4gIGhhbmRsZVJlbW92ZShoYW5kbGUpIHtcclxuICAgIHRoaXMuX2hhbmRsZVN1Ym1pdCA9IGhhbmRsZTtcclxuICB9XHJcblxyXG4gIGNsb3NlKCkge1xyXG4gICAgY29uc29sZS5sb2coXCJDaGVja1wiKTtcclxuICAgIHN1cGVyLmNsb3NlKCk7XHJcbiAgICB0aGlzLl9mb3JtLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3N1Ym1pdCcsIHRoaXMuaGFuZGxlU3VibWl0KTtcclxuICAgIHRoaXMuX2Zvcm0ucmVzZXQoKTtcclxuICB9XHJcbn0iLCJleHBvcnQgZGVmYXVsdCBjbGFzcyBTZWN0aW9uIHtcclxuICBjb25zdHJ1Y3Rvcih7IGl0ZW1zLCByZW5kZXJlciB9LCBjb250YWluZXJTZWxlY3Rvcikge1xyXG4gICAgdGhpcy5fcmVuZGVyZWRFbGVtZW50cyA9IGl0ZW1zO1xyXG4gICAgdGhpcy5fcmVuZGVyZXIgPSByZW5kZXJlcjtcclxuICAgIHRoaXMuX2NvbnRhaW5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoY29udGFpbmVyU2VsZWN0b3IpO1xyXG4gIH1cclxuXHJcbiAgcmVuZGVyZXIoKSB7XHJcbiAgICB0aGlzLl9yZW5kZXJlZEVsZW1lbnRzLmZvckVhY2goKGl0ZW0pID0+IHRoaXMuX3JlbmRlcmVyKGl0ZW0pKTtcclxuICB9XHJcbiAgXHJcbiAgYWRkSXRlbShpdGVtKSB7XHJcbiAgICB0aGlzLl9jb250YWluZXIuYXBwZW5kKGl0ZW0pO1xyXG4gIH1cclxuXHJcbiAgcHJlcGVuZEl0ZW0oaXRlbSkge1xyXG4gICAgdGhpcy5fY29udGFpbmVyLnByZXBlbmQoaXRlbSk7XHJcbiAgfVxyXG59XHJcbiIsImV4cG9ydCBkZWZhdWx0IGNsYXNzIFVzZXJJbmZvIHtcclxuICBjb25zdHJ1Y3RvcihuYW1lLCBqb2IsIGF2YXRhcikge1xyXG4gICAgdGhpcy5fbmFtZSA9IG5hbWU7XHJcbiAgICB0aGlzLl9qb2IgPSBqb2I7XHJcbiAgICB0aGlzLl9hdmF0YXIgPSBhdmF0YXI7XHJcbiAgfVxyXG5cclxuICBnZXRVc2VySW5mbygpIHtcclxuICAgIHJldHVybiAodGhpcy5fdXNlckluZm8gPSB7XHJcbiAgICAgIG5hbWU6IHRoaXMuX25hbWUudGV4dENvbnRlbnQsXHJcbiAgICAgIGpvYjogdGhpcy5fam9iLnRleHRDb250ZW50XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIHNldFVzZXJJbmZvKHVzZXJJbmZvKSB7XHJcbiAgICBjb25zdCB7IG5hbWUsIGpvYiwgdXNlckF2YXRhciB9ID0gdXNlckluZm87XHJcbiAgICB0aGlzLl9uYW1lLnRleHRDb250ZW50ID0gbmFtZTtcclxuICAgIHRoaXMuX2pvYi50ZXh0Q29udGVudCA9IGpvYjtcclxuICAgIHRoaXMuX2F2YXRhci5zcmMgPSB1c2VyQXZhdGFyO1xyXG4gIH1cclxufVxyXG4iLCIvLyAtLS0gJ0VkaXQgcHJvZmlsZScgbW9kYWwgY29uc3RzIC0tLSAvL1xyXG5leHBvcnQgY29uc3QgZWRpdEJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wcm9maWxlX19lZGl0LWJ1dHRvbicpO1xyXG5leHBvcnQgY29uc3QgcHJvZmlsZU1vZGFsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLm1vZGFsX3R5cGVfZWRpdCcpO1xyXG5leHBvcnQgY29uc3QgcHJvZmlsZU5hbWUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucHJvZmlsZV9fdGl0bGUnKTtcclxuZXhwb3J0IGNvbnN0IG5hbWVJbnB1dCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbF9faW5wdXRfdHlwZV90aXRsZScpO1xyXG5leHBvcnQgY29uc3QgcHJvZmlsZUpvYiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wcm9maWxlX19zdWJ0aXRsZScpO1xyXG5leHBvcnQgY29uc3Qgam9iSW5wdXQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubW9kYWxfX2lucHV0X3R5cGVfc3VidGl0bGUnKTtcclxuZXhwb3J0IGNvbnN0IGVkaXRDbG9zZUJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbF9fY2xvc2UtYnV0dG9uX3R5cGVfZWRpdCcpO1xyXG4vLyAtLS0gJ0F2YXRhclwiIG1vZGFsIGNvbnN0cyAtLS0gLy9cclxuZXhwb3J0IGNvbnN0IHVzZXJBdmF0YXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucHJvZmlsZV9faW1hZ2UnKTtcclxuZXhwb3J0IGNvbnN0IGF2YXRhckVkaXRCdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucHJvZmlsZV9faW1hZ2UtZWRpdCcpO1xyXG5leHBvcnQgY29uc3QgYXZhdGFyTW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubW9kYWxfdHlwZV9hdmF0YXInKTtcclxuZXhwb3J0IGNvbnN0IGF2YXRhck1vZGFsSW5wdXQgPSBhdmF0YXJNb2RhbC5xdWVyeVNlbGVjdG9yKCcubW9kYWxfX2lucHV0X3R5cGVfYXZhdGFyJyk7XHJcbmV4cG9ydCBjb25zdCBhdmF0YXJDbG9zZUJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbF9fY2xvc2UtYnV0dG9uX3R5cGVfYXZhdGFyJylcclxuLy8gLS0tICdBZGQtY2FyZCcgbW9kYWwgY29uc3RzIC0tLSAvL1xyXG5leHBvcnQgY29uc3QgYWRkQ2FyZEJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wcm9maWxlX19hZGQtYnV0dG9uJyk7XHJcbmV4cG9ydCBjb25zdCBhZGRDYXJkTW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubW9kYWxfdHlwZV9hZGQtY2FyZCcpO1xyXG5leHBvcnQgY29uc3QgY2FyZElucHV0VGl0bGUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubW9kYWxfX2lucHV0X3R5cGVfbmFtZScpO1xyXG5leHBvcnQgY29uc3QgY2FyZElucHV0TGluayA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbF9faW5wdXRfdHlwZV9saW5rJyk7XHJcbmV4cG9ydCBjb25zdCBhZGRDYXJkQ2xvc2VCdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubW9kYWxfX2Nsb3NlLWJ1dHRvbl90eXBlX2FkZC1jYXJkJyk7XHJcbi8vIC0tLSAnQWRkLUNhcmQnIGZvcm0gY29uc3RzIC0tLSAvL1xyXG5leHBvcnQgY29uc3QgYWRkQ2FyZEZvcm0gPSBkb2N1bWVudC5mb3Jtcy5hZGQ7XHJcbmV4cG9ydCBjb25zdCBhZGRDYXJkRm9ybVRpdGVsID0gYWRkQ2FyZEZvcm0uZWxlbWVudHMudGl0bGU7XHJcbmV4cG9ydCBjb25zdCBhZGRDYXJkRm9ybUxpbmsgPSBhZGRDYXJkRm9ybS5lbGVtZW50cy5saW5rO1xyXG4vLyAtLS0gR2VuZXJhbCBjb25zdCAtLS0gLy9cclxuZXhwb3J0IGNvbnN0IHN1Ym1pdEJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbF9fc3VibWl0LWJ1dHRvbicpO1xyXG5leHBvcnQgY29uc3QgY2FyZExpc3QgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuY2FyZHNfX2dyaWQnKTtcclxuZXhwb3J0IGNvbnN0IGNhcmRUZW1wbGF0ZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNjYXJkX190ZW1wbGF0ZScpO1xyXG4vLyAtLS0gQmlnIGltYWdlIG1vZGFsIGNvbnN0cyAtLS0gLy9cclxuZXhwb3J0IGNvbnN0IGNhcmRCaWdNb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbF90eXBlX2JpZy1pbWFnZScpO1xyXG5leHBvcnQgY29uc3QgY2FyZEJpZ01vZGFsSW1hZ2UgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubW9kYWxfX2JpZy1pbWFnZScpO1xyXG5leHBvcnQgY29uc3QgY2FyZEJpZ01vZGFsVGV4dCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbF9faW1hZ2UtY2FwdGlvbicpO1xyXG5leHBvcnQgY29uc3QgY2FyZEJpZ01vZGFsQ2xvc2VJY29uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLm1vZGFsX19jbG9zZS1idXR0b25fdHlwZV9iaWctaW1hZ2UnKTtcclxuLy8gLS0tICdEZWxldGUgY2FyZCcgbW9kYWwgY29uc3RzIC0tLSAvL1xyXG5leHBvcnQgY29uc3QgZGVsZXRlQ2FyZCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfdHlwZV9kZWxldGUtY2FyZFwiKTtcclxuLy8gLS0tIEZvcm0gY29uZmlnIGNvbnN0cyAtLS0gLy9cclxuZXhwb3J0IGNvbnN0IGZvcm1Db25maWcgPSB7XHJcbiAgZm9ybVNlbGVjdG9yOiBcIi5tb2RhbF9fY29udGFpbmVyXCIsXHJcbiAgaW5wdXRTZWxlY3RvcjogXCIubW9kYWxfX2lucHV0XCIsXHJcbiAgc3VibWl0QnV0dG9uU2VsZWN0b3I6IFwiLm1vZGFsX19zdWJtaXQtYnV0dG9uXCIsXHJcbiAgaW5hY3RpdmVCdXR0b25DbGFzczogXCJtb2RhbF9fc3VibWl0LWJ1dHRvbl9kaXNhYmxlZFwiLFxyXG4gIGlucHV0RXJyb3JDbGFzczogXCJtb2RhbF9faW5wdXRfZXJyb3JcIixcclxuICBlcnJvck1lc3NhZ2VDbGFzczogXCJtb2RhbF9fZXJyb3JfdmlzaWJsZVwiXHJcbn07XHJcbiIsImltcG9ydCBcIi4vaW5kZXguY3NzXCI7XHJcbmltcG9ydCBGb3JtVmFsaWRhdG9yIGZyb20gXCIuLi9jb21wb25lbnRzL3NjcmlwdHMvRm9ybVZhbGlkYXRvci5qc1wiO1xyXG5pbXBvcnQgQ2FyZCBmcm9tIFwiLi4vY29tcG9uZW50cy9zY3JpcHRzL0NhcmQuanNcIjtcclxuaW1wb3J0IE1vZGFsV2l0aEltYWdlIGZyb20gXCIuLi9jb21wb25lbnRzL3NjcmlwdHMvTW9kYWxXaXRoSW1hZ2UuanNcIjtcclxuaW1wb3J0IE1vZGFsV2l0aEZvcm0gZnJvbSBcIi4uL2NvbXBvbmVudHMvc2NyaXB0cy9Nb2RhbFdpdGhGb3JtLmpzXCI7XHJcbmltcG9ydCBBcGkgZnJvbSBcIi4uL2NvbXBvbmVudHMvc2NyaXB0cy9BcGkuanNcIlxyXG5pbXBvcnQgU2VjdGlvbiBmcm9tIFwiLi4vY29tcG9uZW50cy9zY3JpcHRzL1NlY3Rpb24uanNcIjtcclxuaW1wb3J0IFVzZXJJbmZvIGZyb20gXCIuLi9jb21wb25lbnRzL3NjcmlwdHMvVXNlckluZm8uanNcIjtcclxuaW1wb3J0IHtcclxuICBwcm9maWxlTmFtZSxcclxuICBuYW1lSW5wdXQsXHJcbiAgcHJvZmlsZUpvYixcclxuICBqb2JJbnB1dCxcclxuICBlZGl0QnV0dG9uLFxyXG4gIHByb2ZpbGVNb2RhbCxcclxuICBjYXJkVGVtcGxhdGUsXHJcbiAgYWRkQ2FyZEJ1dHRvbixcclxuICBhZGRDYXJkTW9kYWwsXHJcbiAgYXZhdGFyTW9kYWwsXHJcbiAgdXNlckF2YXRhcixcclxuICBhdmF0YXJFZGl0QnV0dG9uLFxyXG4gIGNhcmRCaWdNb2RhbCxcclxuICBkZWxldGVDYXJkLFxyXG4gIGZvcm1Db25maWdcclxufSBmcm9tIFwiLi4vY29tcG9uZW50cy91dGlscy9jb25zdGFudHMuanNcIjtcclxuXHJcbi8vID09PT09IE1vZGFscyA9PT09PSAvL1xyXG4vLyAtLS0gQmlnIGltYWdlIG1vZGFsIGluc3RhbmNlIC0tLSAvL1xyXG5jb25zdCBiaWdJbWFnZSA9IG5ldyBNb2RhbFdpdGhJbWFnZShjYXJkQmlnTW9kYWwpO1xyXG5iaWdJbWFnZS5zZXRFdmVudExpc3RlbmVycygpO1xyXG4vLyAtLS0gRGVsZXRlIGNhcmQgbW9kYWwgaW5zdGFuY2UgYW5kIGV2ZW50cyAtLS0gLy9cclxuY29uc3QgZGVsZXRlQ2FyZE1vZGFsID0gbmV3IE1vZGFsV2l0aEZvcm0oe1xyXG4gIG1vZGFsOiBkZWxldGVDYXJkXHJcbn0pO1xyXG5kZWxldGVDYXJkTW9kYWwuc2V0RXZlbnRMaXN0ZW5lcnMoKTtcclxuLy8gLS0tIFVYIGZvciBtb2RhbHMgLS0tIC8vXHJcbmZ1bmN0aW9uIGxvYWRpbmdNb2RhbChpc0xvYWRpbmcsIG1vZGFsKSB7XHJcbiAgaWYgKGlzTG9hZGluZykgeyBtb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19zdWJtaXQtYnV0dG9uXCIpLnRleHRDb250ZW50ID0gXCJTYXZpbmcuLi5cIjsgfSBcclxuICBlbHNlIHsgbW9kYWwucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fc3VibWl0LWJ1dHRvblwiKS50ZXh0Q29udGVudCA9IFwiU2F2ZVwiOyB9XHJcbn1cclxuXHJcbi8vID09PT09IEFQSSA9PT09PSAvL1xyXG4vLyAtLS0gU2V0dGluZyB0aGUgZGVmYXVsdCBmZXRjaGluZyB1cmwgYW5kIHRva2VuIC0tLSAvL1xyXG5jb25zdCBhcGkgPSBuZXcgQXBpKHtcclxuICBiYXNlVXJsOiBcImh0dHBzOi8vYXJvdW5kLm5vbW9yZXBhcnRpZXMuY28vdjEvZ3JvdXAtMTJcIixcclxuICBoZWFkZXJzOiBcclxuICB7XHJcbiAgICBhdXRob3JpemF0aW9uOiBcIjcwOWEwZDlkLWRiMDYtNDg5MC1hNTk0LWIwN2U3MzA5YTM1M1wiLFxyXG4gICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJyBcclxuICB9XHJcbn0pO1xyXG4vLyAtLS0gR2V0QXBwSW5mbyBtZXRob2QgLS0tIC8vXHJcbmFwaVxyXG4gIC5nZXRBcHBJbmZvKClcclxuICAudGhlbiggKFtjYXJkTGlzdCwgdXNlckRhdGFdKSA9PiB7XHJcbiAgICAvLyAtLS0gJ1Byb2ZpbGUnIGluZm8gZWRpdGluZyAtLS0gLy9cclxuICAgIGNvbnN0IHByb2ZpbGUgPSBuZXcgVXNlckluZm8ocHJvZmlsZU5hbWUsIHByb2ZpbGVKb2IsIHVzZXJBdmF0YXIpO1xyXG4gICAgcHJvZmlsZS5zZXRVc2VySW5mbyh1c2VyRGF0YSk7XHJcbiAgICAvLyAtLS0gTmV3IGNhcmQgYWRkaW5nIC0tLSAvL1xyXG4gICAgY29uc3QgYWRkaW5nTmV3Q2FyZCA9IChkYXRhKSA9PntcclxuICAgICAgY29uc3QgY2FyZEluc3RhbmNlID0gbmV3IENhcmQoZGF0YSwgY2FyZFRlbXBsYXRlLCB1c2VyRGF0YS5faWQsIHtcclxuICAgICAgICBvbkNhcmRDbGljazogKHtuYW1lLCBsaW5rfSkgPT4ge1xyXG4gICAgICAgICAgYmlnSW1hZ2Uub3BlbihsaW5rLCBuYW1lKTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIHJlbW92ZUhhbmRsZXI6IChjYXJkSWQpID0+IHtcclxuICAgICAgICAgIGRlbGV0ZUNhcmRNb2RhbC5vcGVuKCk7XHJcbiAgICAgICAgICBkZWxldGVDYXJkTW9kYWwuaGFuZGxlUmVtb3ZlKCgpID0+IHtcclxuICAgICAgICAgICAgYXBpXHJcbiAgICAgICAgICAgICAgLnJlbW92ZUNhcmQoY2FyZElkKVxyXG4gICAgICAgICAgICAgIC50aGVuKCgpID0+IHtcclxuICAgICAgICAgICAgICAgIGNhcmRJbnN0YW5jZS5kZWxldGVDYXJkTW9kYWwoKTtcclxuICAgICAgICAgICAgICAgIGRlbGV0ZUNhcmRNb2RhbC5jbG9zZSgpO1xyXG4gICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgLmNhdGNoKGVyciA9PiBjb25zb2xlLmxvZyhlcnIpKTtcclxuICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgbGlrZUhhbmRsZXI6IChjYXJkSWQpID0+e1xyXG4gICAgICAgICAgY29uc3QgbGlrZVRvZ2dsZSA9IGNhcmRJbnN0YW5jZS5pc0xpa2VkKCk7XHJcbiAgICAgICAgICBpZihsaWtlVG9nZ2xlKSB7XHJcbiAgICAgICAgICAgIGFwaVxyXG4gICAgICAgICAgICAgIC51bmxpa2VDYXJkKGNhcmRJZClcclxuICAgICAgICAgICAgICAudGhlbigoY291bnQpID0+IHtcclxuICAgICAgICAgICAgICAgIGNhcmRJbnN0YW5jZS51bmxpa2VDYXJkKCk7XHJcbiAgICAgICAgICAgICAgICBjYXJkSW5zdGFuY2Uuc2hvd0xpa2VzKGNvdW50Lmxpa2VzLmxlbmdodCk7XHJcbiAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgYXBpXHJcbiAgICAgICAgICAgICAgLmxpa2VDYXJkKGNhcmRJZClcclxuICAgICAgICAgICAgICAudGhlbigoY291bnQpID0+IHtcclxuICAgICAgICAgICAgICAgIGNhcmRJbnN0YW5jZS51bmxpa2VDYXJkKCk7XHJcbiAgICAgICAgICAgICAgICBjYXJkSW5zdGFuY2Uuc2hvd0xpa2VzKGNvdW50Lmxpa2VzLmxlbmdodCk7XHJcbiAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAuY2F0Y2goKGVycikgPT4gY29uc29sZS5sb2coZXJyKSk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuICAgICAgcmV0dXJuIGNhcmRJbnN0YW5jZTtcclxuICAgIH07XHJcbiAgICAvLyAtLS0gQ2FyZHMgc2VjdGlvbiBjcmVhdGlvbiAtLS0gLy9cclxuICAgIGNvbnN0IGNhcmRzTGlzdCA9IG5ldyBTZWN0aW9uKHtcclxuICAgICAgaXRlbXM6IGNhcmRMaXN0LFxyXG4gICAgICByZW5kZXJlcjogKGRhdGEpID0+IHtcclxuICAgICAgICBjYXJkc0xpc3QuYWRkSXRlbShhZGRpbmdOZXdDYXJkKGRhdGEpLmdlbmVyYXRlQ2FyZCgpKTtcclxuICAgICAgfVxyXG4gICAgfSwgXHJcbiAgICAnLmNhcmRzX19ncmlkJyk7XHJcbiAgICBjb25zb2xlLmxvZyhjYXJkTGlzdCk7XHJcbiAgICAvLyAtLS0gUmVuZGVyIGNhcmRzIC0tLSAvL1xyXG4gICAgY2FyZHNMaXN0LnJlbmRlcmVyKCk7XHJcbiAgICAvLyAtLS0gTmV3IGNhcmQgYWRkaW5nIGZvcm0gLS0tIC8vXHJcbiAgICBjb25zdCBhZGRDYXJkRm9ybSA9IG5ldyBNb2RhbFdpdGhGb3JtKHtcclxuICAgICAgbW9kYWw6IGFkZENhcmRNb2RhbCxcclxuICAgICAgaGFuZGxlU3VibWl0OiAoZGF0YSkgPT57XHJcbiAgICAgICAgbG9hZGluZ01vZGFsKHRydWUsIGFkZENhcmRNb2RhbCk7XHJcbiAgICAgICAgYXBpXHJcbiAgICAgICAgICAuYWRkQ2FyZChkYXRhKVxyXG4gICAgICAgICAgLnRoZW4oKHJlcykgPT4ge1xyXG4gICAgICAgICAgICBjYXJkc0xpc3QucHJlcGVuZEl0ZW0oYWRkaW5nTmV3Q2FyZChyZXMpLmdlbmVyYXRlQ2FyZCgpKTtcclxuICAgICAgICAgIH0pXHJcbiAgICAgICAgICAudGhlbigoKSA9PiB7XHJcbiAgICAgICAgICAgIGFkZENhcmRGb3JtLmNsb3NlKCk7XHJcbiAgICAgICAgICB9KVxyXG4gICAgICAgICAgLmNhdGNoKChlcnIpID0+IGNvbnNvbGUubG9nKGVycikpXHJcbiAgICAgICAgICAuZmluYWxseSgoKSA9PiBsb2FkaW5nTW9kYWwoZmFsc2UsIGFkZENhcmRNb2RhbCkpO1xyXG4gICAgICB9LFxyXG4gICAgfSk7XHJcbiAgICBhZGRDYXJkRm9ybS5zZXRFdmVudExpc3RlbmVycygpO1xyXG4gICAgLy8gLS0tIEFkZCBjYXJkIGJ1dHRvbiBmdW5jdGlvbmFsIGFkZGluZyAtLS0gLy9cclxuICAgIGFkZENhcmRCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcclxuICAgICAgYWRkQ2FyZEZvcm1WYWxpZGF0aW9uLnJlc2V0VmFsaWRhdGlvbigpO1xyXG4gICAgICBhZGRDYXJkRm9ybS5vcGVuKCk7XHJcbiAgICB9KTtcclxuICAgIC8vIC0tLSBQcm9maWxlIGVkaXQgZm9ybSAtLS0gLy9cclxuICAgIGNvbnN0IHByb2ZpbGVGb3JtID0gbmV3IE1vZGFsV2l0aEZvcm0oe1xyXG4gICAgICBtb2RhbDogcHJvZmlsZU1vZGFsLCBcclxuICAgICAgaGFuZGxlU3VibWl0OiAodXNlckluZm8pID0+IHtcclxuICAgICAgICBsb2FkaW5nTW9kYWwodHJ1ZSwgcHJvZmlsZU1vZGFsKTtcclxuICAgICAgICBhcGlcclxuICAgICAgICAudXBkYXRlVXNlckluZm8oVXNlckluZm8pXHJcbiAgICAgICAgLnRoZW4oKHJlcykgPT4ge1xyXG4gICAgICAgICAgcHJvZmlsZS5zZXRVc2VySW5mbyhyZXMpXHJcbiAgICAgICAgfSlcclxuICAgICAgICAudGhlbigoKSA9PiB7XHJcbiAgICAgICAgICBwcm9maWxlRm9ybS5jbG9zZSgpXHJcbiAgICAgICAgfSlcclxuICAgICAgICAuY2F0Y2goKGVycikgPT4gY29uc29sZS5sb2coZXJyKSlcclxuICAgICAgICAuZmluYWxseSgoKSA9PiBsb2FkaW5nTW9kYWwoZmFsc2UscHJvZmlsZU1vZGFsKSlcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgICBwcm9maWxlRm9ybS5zZXRFdmVudExpc3RlbmVycygpO1xyXG4gICAgLy8gLS0tIE9wZW4gJ1Byb2ZpbGUnIGZvcm0gd2l0aCBjdXJyZW50IHZhbHVlcyBhcyBpbnB1dHMgLS0tIC8vXHJcbiAgICBlZGl0QnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4ge1xyXG4gICAgICBwcm9maWxlRm9ybVZhbGlkYXRpb24ucmVzZXRWYWxpZGF0aW9uKCk7XHJcbiAgICAgIGNvbnN0IHsgbmFtZSwgam9iIH0gPSBwcm9maWxlLmdldFVzZXJJbmZvKCk7XHJcbiAgICAgIG5hbWVJbnB1dC52YWx1ZSA9IG5hbWU7XHJcbiAgICAgIGpvYklucHV0LnZhbHVlID0gam9iO1xyXG4gICAgICBwcm9maWxlRm9ybS5vcGVuKCk7XHJcbiAgICB9KTtcclxuICAgIC8vIC0tLSAnQXZhdGFyJyBlZGl0L3VwZGF0ZSBmb3JtIC0tLSAvL1xyXG4gICAgY29uc3QgYXZhdGFyRm9ybSA9IG5ldyBNb2RhbFdpdGhGb3JtKHtcclxuICAgICAgbW9kYWw6IGF2YXRhck1vZGFsLFxyXG4gICAgICBoYW5kbGVTdWJtaXQ6IChpbWdMaW5rKSA9PiB7XHJcbiAgICAgICAgbG9hZGluZ01vZGFsKHRydWUsIGF2YXRhck1vZGFsKTtcclxuICAgICAgICBhcGlcclxuICAgICAgICAgIC51cGRhdGVVc2VySW5mbyhpbWdMaW5rLmF2YXRhcilcclxuICAgICAgICAgIC50aGVuKChyZXMpID0+IHtcclxuICAgICAgICAgICAgcHJvZmlsZS5zZXRVc2VySW5mbyhyZXMpO1xyXG4gICAgICAgICAgfSlcclxuICAgICAgICAgIC50aGVuKCgpID0+IHtcclxuICAgICAgICAgICAgYXZhdGFyRm9ybS5jbG9zZSgpO1xyXG4gICAgICAgICAgfSlcclxuICAgICAgICAgIC5jYXRjaCgoZXJyKSA9PiBjb25zb2xlLmxvZyhlcnIpKVxyXG4gICAgICAgICAgLmZpbmFsbHkoKCkgPT4ge1xyXG4gICAgICAgICAgICBsb2FkaW5nTW9kYWwoZmFsc2UsIGF2YXRhck1vZGFsKTtcclxuICAgICAgICAgIH0pO1xyXG4gICAgICB9LFxyXG4gICAgfSk7XHJcbiAgICBhdmF0YXJGb3JtLnNldEV2ZW50TGlzdGVuZXJzKCk7XHJcbn0pXHJcbi5jYXRjaCgoZXJyKSA9PiBjb25zb2xlLmxvZyhlcnIpKTtcclxuXHJcbi8qIC8vID09PT09IEF2YXRhciA9PT09PSAvL1xyXG4vLyAtLS0gJ0F2YXRhcicgZm9ybSBmdW5jdGlvbmFsIC0tLSAvL1xyXG5mdW5jdGlvbiBoYW5kbGVBdmF0YXJFZGl0KGRhdGEpIHtcclxuICBsb2FkaW5nTW9kYWwodHJ1ZSwgYXZhdGFyTW9kYWwpO1xyXG4gIGFwaS5zZXRVc2VyQXZhdGFyKHtcclxuICAgIGF2YXRhcjogZGF0YS5hdmF0YXJVUkxcclxuICB9KVxyXG4gIC50aGVuKHJlcyA9PiB7XHJcbiAgICBhdmF0YXJJbWFnZS5zcmMgPSByZXMuYXZhdGFyO1xyXG4gICAgbG9hZGluZ01vZGFsKGZhbHNlLCBhdmF0YXJNb2RhbCk7XHJcbiAgICBlZGl0QXZhdGFyLmNsb3NlKCk7XHJcbiAgfSlcclxuICAuY2F0Y2goZXJyID0+IGNvbnNvbGUubG9nKGVycikpO1xyXG59XHJcbi8vIC0tLSAnQXZhdGFyJyBmb3JtIGNyZWF0aW9uIC0tLSAvL1xyXG5jb25zdCBlZGl0QXZhdGFyID0gbmV3IE1vZGFsV2l0aEZvcm0oe1xyXG4gIG1vZGFsOiBhdmF0YXJNb2RhbCxcclxuICBtb2RhbFN1Ym1pdGlvbjogKGRhdGEpID0+IHtcclxuICAgIGhhbmRsZUF2YXRhckVkaXQoZGF0YSlcclxuICB9XHJcbn0pO1xyXG4vLyAtLS0gT3BlbiBhdmF0YXIgZWRpdCBtb2RhbCBvbiBjbGljayAtLS0gLy9cclxuYXZhdGFyRWRpdEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xyXG4gIGVkaXRBdmF0YXIub3BlbigpO1xyXG59KTtcclxuLy8gLS0tICdBdmF0YXInIGZvcm0gaGFuZGxlciAtLS0gLy9cclxuZWRpdEF2YXRhci5zZXRFdmVudExpc3RlbmVycygpOyAqL1xyXG5cclxuLy8gPT09PT0gVmFsaWRhdGlvbiA9PT09PSAvL1xyXG4vLyAtLS0gJ0VkaXQgcHJvZmlsZScgZm9ybSB2YWxpZGF0aW9uIGFkZGluZyAtLS0gLy9cclxuY29uc3QgcHJvZmlsZUZvcm1WYWxpZGF0aW9uID0gbmV3IEZvcm1WYWxpZGF0b3IoZm9ybUNvbmZpZywgcHJvZmlsZU1vZGFsKTtcclxucHJvZmlsZUZvcm1WYWxpZGF0aW9uLmVuYWJsZVZhbGlkYXRpb24oKTtcclxuLy8gLS0tICdBdmF0YXInIGZvcm0gdmFsaWRhdGlvbiBhZGRpbmcgLS0tIC8vXHJcbmNvbnN0IGF2YXRhckZvcm1WYWxpZGF0aW9uID0gbmV3IEZvcm1WYWxpZGF0b3IoZm9ybUNvbmZpZywgYXZhdGFyTW9kYWwpO1xyXG5hdmF0YXJGb3JtVmFsaWRhdGlvbi5lbmFibGVWYWxpZGF0aW9uKCk7XHJcbi8vIC0tLSAnQWRkIGNhcmQnIGZvcm0gdmFsaWRhdGlvbiBhZGRpbmcgLS0tIC8vXHJcbmNvbnN0IGFkZENhcmRGb3JtVmFsaWRhdGlvbiA9IG5ldyBGb3JtVmFsaWRhdG9yKGZvcm1Db25maWcsIGFkZENhcmRNb2RhbCk7XHJcbmFkZENhcmRGb3JtVmFsaWRhdGlvbi5lbmFibGVWYWxpZGF0aW9uKCk7XHJcbiIsImltcG9ydCBNb2RhbCBmcm9tIFwiLi9Nb2RhbC5qc1wiO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgTW9kYWxXaXRoSW1hZ2UgZXh0ZW5kcyBNb2RhbCB7XHJcbiAgLy8gLS0tIE9wZW4gYmlnIGltYWdlIG1vZGFsIG1ldGhvZCAtLS0gLy9cclxuICBvcGVudXAgPSAoZXZlbnQpID0+IHtcclxuICAgIGNvbnN0IGJpZ0ltYWdlID0gZXZlbnQudGFyZ2V0O1xyXG4gICAgdGhpcy5fbW9kYWxFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2JpZy1pbWFnZVwiKS5zcmMgPSBiaWdJbWFnZS5zcmM7XHJcbiAgICB0aGlzLl9tb2RhbEVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fYmlnLWltYWdlXCIpLmFsdCA9IGJpZ0ltYWdlLmFsdDtcclxuICAgIHRoaXMuX21vZGFsRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19pbWFnZS1jYXB0aW9uXCIpLnRleHRDb250ZW50ID0gYmlnSW1hZ2UuYWx0O1xyXG5cclxuICAgIHRoaXMub3BlbigpO1xyXG4gIH1cclxufSIsImV4cG9ydCBkZWZhdWx0IGNsYXNzIEFwaSB7XHJcbiAgY29uc3RydWN0b3IoeyBiYXNlVXJsLCBoZWFkZXJzIH0pIHtcclxuICAgIHRoaXMuX2Jhc2VVcmwgPSBiYXNlVXJsO1xyXG4gICAgdGhpcy5faGVhZGVycyA9IGhlYWRlcnM7XHJcbiAgfVxyXG5cclxuICAvLyA9PT0gR2V0dGluZyBpbmZvIGZyb20gc2VydmVyID09PSAvL1xyXG4gIC8vIC0tLSBHZXQgY2FyZCBsaXN0IGZyb20gdGhlIHNlcnZlciAtLS0gLy9cclxuICBnZXRDYXJkTGlzdCgpIHtcclxuICAgIHJldHVybiAoXHJcbiAgICAgIGZldGNoKHRoaXMuX2Jhc2VVcmwgKyBcIi9jYXJkc1wiLCB7XHJcbiAgICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcclxuICAgICAgfSlcclxuICAgICAgICAudGhlbihmdW5jdGlvbiAocmVzKSB7XHJcbiAgICAgICAgICBpZiAocmVzLm9rKSB7XHJcbiAgICAgICAgICAgIHJldHVybiByZXMuanNvbigpLnRoZW4oKGRhdGEpID0+IHtcclxuICAgICAgICAgICAgICByZXR1cm4gZGF0YTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBQcm9taXNlLnJlamVjdChcIkVycm9yIVwiICsgcmVzLnN0YXR1c1RleHQpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0pXHJcbiAgICApO1xyXG4gIH1cclxuICAvLyAtLS0gR2V0IHVzZXIgaW5mbyBmcm9tIHRoZSBzZXJ2ZXIgLS0tIC8vXHJcbiAgZ2V0VXNlckluZm8oKSB7XHJcbiAgICByZXR1cm4gKFxyXG4gICAgICBmZXRjaCh0aGlzLl9iYXNlVXJsICsgXCIvdXNlcnMvbWVcIiwge1xyXG4gICAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXHJcbiAgICAgIH0pXHJcbiAgICAgICAgLnRoZW4oKHJlcykgPT5cclxuICAgICAgICAgIHJlcy5vayA/IHJlcy5qc29uKCkgOiBQcm9taXNlLnJlamVjdChcIkVycm9yIVwiICsgcmVzLnN0YXR1c1RleHQpXHJcbiAgICAgICAgKVxyXG4gICAgKTtcclxuICB9XHJcbiAgLy8gLS0tIENoZWNrIGlmIGFsbCBpbmZvIGZldGNoZWQgLS0tIC8vXHJcbiAgZ2V0QXBwSW5mbygpIHtcclxuICAgIHJldHVybiBQcm9taXNlLmFsbChbdGhpcy5nZXRDYXJkTGlzdCgpLCB0aGlzLmdldFVzZXJJbmZvKCldKTtcclxuICB9XHJcblxyXG4gIC8vID09PSBBZGRpbmcvUmVtb3ZpbmcvRWRpdGluZyA9PT0gLy9cclxuICAvLyAtLS0gQWRkaW5nIG5ldyBjYXJkIC0tLSAvL1xyXG4gIGFkZENhcmQoZGF0YSkge1xyXG4gICAgY29uc3Qge25hbWUsIGxpbmt9ID0gZGF0YTtcclxuICAgIHJldHVybiBmZXRjaCh0aGlzLl9iYXNlVXJsICsgXCIvY2FyZHNcIiwge1xyXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxyXG4gICAgICBtZXRob2Q6IFwiUE9TVFwiLFxyXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XHJcbiAgICAgICAgbmFtZSxcclxuICAgICAgICBsaW5rLFxyXG4gICAgICB9KSxcclxuICAgIH0pLnRoZW4oKHJlcykgPT4ge1xyXG4gICAgICBpZiAocmVzLm9rKSB7XHJcbiAgICAgICAgcmV0dXJuIHJlcy5qc29uKCk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgUHJvbWlzZS5yZWplY3QoXCJFcnJvciFcIiArIHJlcy5zdGF0dXNUZXh0KTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG4gIC8vIC0tLSBSZW1vdmluZyBhIGNhcmQgLS0tIC8vXHJcbiAgcmVtb3ZlQ2FyZChjYXJkSWQpIHtcclxuICAgIHJldHVybiBmZXRjaCh0aGlzLl9iYXNlVXJsICsgXCIvY2FyZHMvXCIgKyBjYXJkSWQsIHtcclxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcclxuICAgICAgbWV0aG9kOiBcIkRFTEVURVwiLFxyXG4gICAgfSkudGhlbigocmVzKSA9PlxyXG4gICAgICByZXMub2sgPyByZXMuanNvbigpIDogUHJvbWlzZS5yZWplY3QoXCJFcnJvciFcIiArIHJlcy5zdGF0dXNUZXh0KVxyXG4gICAgKTtcclxuICB9XHJcbiAgLy8gLS0tIExpa2UgYSBjYXJkIC0tLSAvL1xyXG4gIGxpa2VDYXJkKGNhcmRJZCkge1xyXG4gICAgcmV0dXJuIGZldGNoKHRoaXMuX2Jhc2VVcmwgKyBcIi9jYXJkcy9saWtlcy9cIiArIGNhcmRJZCwge1xyXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxyXG4gICAgICBtZXRob2Q6IFwiUFVUXCIsXHJcbiAgICB9KS50aGVuKChyZXMpID0+IHtcclxuICAgICAgaWYgKHJlcy5vaykge1xyXG4gICAgICAgIHJldHVybiByZXMuanNvbigpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIFByb21pc2UucmVqZWN0KFwiRXJyb3IhXCIgKyByZXMuc3RhdHVzVGV4dCk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuICAvLyAtLS0gVW5saWtlIGEgY2FyZCAtLS0gLy9cclxuICB1bmxpa2VDYXJkKGNhcmRJZCkge1xyXG4gICAgcmV0dXJuIGZldGNoKHRoaXMuX2Jhc2VVcmwgKyBcIi9jYXJkcy9saWtlcy9cIiArIGNhcmRJZCwge1xyXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxyXG4gICAgICBtZXRob2Q6IFwiREVMRVRFXCIsXHJcbiAgICB9KS50aGVuKChyZXMpID0+XHJcbiAgICAgIHJlcy5vayA/IHJlcy5qc29uKCkgOiBQcm9taXNlLnJlamVjdChcIkVycm9yIVwiICsgcmVzLnN0YXR1c1RleHQpXHJcbiAgICApO1xyXG4gIH1cclxuICAvLyAtLS0gU2V0dGluZyB1c2VyIHByb2ZpbGUgaW5mbyAtLS0gLy9cclxuICBzZXRVc2VySW5mbyggdXNlckluZm8gKSB7XHJcbiAgICBjb25zdCB7IG5hbWUsIGpvYiB9ID0gdXNlckluZm87XHJcbiAgICByZXR1cm4gKFxyXG4gICAgICBmZXRjaCh0aGlzLl9iYXNlVXJsICsgXCIvdXNlcnMvbWVcIiwge1xyXG4gICAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXHJcbiAgICAgICAgbWV0aG9kOiBcIlBBVENIXCIsXHJcbiAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xyXG4gICAgICAgICAgbmFtZSxcclxuICAgICAgICAgIGpvYixcclxuICAgICAgICB9KSxcclxuICAgICAgfSlcclxuICAgICAgICAudGhlbigocmVzKSA9PiB7XHJcbiAgICAgICAgICByZXR1cm4gcmVzLm9rXHJcbiAgICAgICAgICAgID8gcmVzLmpzb24oKVxyXG4gICAgICAgICAgICA6IFByb21pc2UucmVqZWN0KFwiRXJyb3IhXCIgKyByZXMuc3RhdHVzVGV4dCArIHJlcy5zdGF0dXMpO1xyXG4gICAgICAgIH0pXHJcbiAgICApO1xyXG4gIH1cclxuICAvLyAtLS0gU2V0dGluZyB1c2VyIHByb2ZpbGUgYXZhdGFyIC0tLSAvL1xyXG4gIHNldFVzZXJBdmF0YXIobGluaykge1xyXG4gICAgcmV0dXJuIGZldGNoKHRoaXMuX2Jhc2VVcmwgKyBcIi91c2Vycy9tZS9hdmF0YXJcIiwge1xyXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxyXG4gICAgICBtZXRob2Q6IFwiUEFUQ0hcIixcclxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xyXG4gICAgICAgIGF2YXRhcjogbGluayxcclxuICAgICAgfSksXHJcbiAgICB9KS50aGVuKChyZXMpID0+XHJcbiAgICAgIHJlcy5vayA/IHJlcy5qc29uKCkgOiBQcm9taXNlLnJlamVjdChcIkVycm9yIVwiICsgcmVzLnN0YXR1c1RleHQpXHJcbiAgICApO1xyXG4gIH1cclxuICAvLyAtLS0gVXBkYXRpbmcvRWRpdGluZyB1c2VyIHByb2ZpbGUgaW5mbyAtLS0gLy9cclxuICB1cGRhdGVVc2VySW5mbyh1c2VySW5mbykge1xyXG4gICAgY29uc3QgeyBuYW1lLCBqb2IgfSA9IHVzZXJJbmZvO1xyXG4gICAgcmV0dXJuIGZldGNoKHRoaXMuX2Jhc2VVcmwgKyBcIi91c2Vycy9tZVwiLCB7XHJcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXHJcbiAgICAgIG1ldGhvZDogXCJQQVRDSFwiLFxyXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XHJcbiAgICAgICAgbmFtZSxcclxuICAgICAgICBhYm91dDogam9iLFxyXG4gICAgICB9KSxcclxuICAgIH0pLnRoZW4oKHJlcykgPT4ge1xyXG4gICAgICByZXR1cm4gcmVzLm9rID8gcmVzLmpzb24oKSA6IFByb21pc2UucmVqZWN0KFwiRXJyb3IhXCIgKyByZXMuc3RhdHVzVGV4dCk7XHJcbiAgICB9KTtcclxuICB9XHJcbn1cclxuIl0sIm5hbWVzIjpbIkZvcm1WYWxpZGF0b3IiLCJjb25zdHJ1Y3RvciIsImZvcm1Db25maWciLCJmb3JtRWxlbWVudCIsInRoaXMiLCJfZm9ybUNvbmZpZyIsIl9mb3JtRWxlbWVudCIsIl9zaG93SW5wdXRFcnJvciIsImlucHV0RWxlbWVudCIsImVycm9yTWVzc2FnZSIsImlucHV0RXJyb3JDbGFzcyIsImVycm9yTWVzc2FnZUNsYXNzIiwiZXJyb3JFbGVtZW50IiwicXVlcnlTZWxlY3RvciIsImlkIiwidGV4dENvbnRlbnQiLCJjbGFzc0xpc3QiLCJhZGQiLCJfaGlkZUlucHV0RXJyb3IiLCJyZW1vdmUiLCJyZXNldFZhbGlkYXRpb24iLCJpbnB1dHMiLCJmb3JFYWNoIiwiaW5wdXQiLCJfdG9nZ2xlU3VibWl0QnV0dG9uIiwiX2NoZWNrSW5wdXQiLCJ2YWxpZGl0eSIsInZhbGlkIiwidmFsaWRhdGlvbk1lc3NhZ2UiLCJfY2hlY2tJZkZvcm1WYWxpZCIsImV2ZXJ5IiwiaW5hY3RpdmVCdXR0b25DbGFzcyIsInN1Ym1pdEJ1dHRvblNlbGVjdG9yIiwiYnV0dG9uRWxlbWVudCIsImRpc2FibGVkIiwiX3NldEV2ZW50TGlzdGVuZXJzIiwiaW5wdXRTZWxlY3RvciIsIkFycmF5IiwiZnJvbSIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJhZGRFdmVudExpc3RlbmVyIiwiZW5hYmxlVmFsaWRhdGlvbiIsImV2ZW50IiwicHJldmVudERlZmF1bHQiLCJDYXJkIiwiZGF0YSIsInRlbXBsYXRlIiwidXNlcklkIiwib25DYXJkQ2xpY2siLCJyZW1vdmVIYW5kbGVyIiwibGlrZUhhbmRsZXIiLCJfbmFtZSIsIm5hbWUiLCJfbGluayIsImxpbmsiLCJfbGlrZXMiLCJsaWtlcyIsIl9vd25lcklkIiwib3duZXIiLCJfaWQiLCJfdGVtcGxhdGUiLCJfdXNlcklkIiwiX29uQ2FyZENsaWNrIiwiX2xpa2VIYW5kbGVyIiwiX3JlbW92ZUhhbmRsZXIiLCJfZ2V0VGVtcGxhdGUiLCJjb250ZW50IiwiY2xvbmVOb2RlIiwiX3NldEF0dHJpYnV0ZXMiLCJjYXJkRWxlbWVudCIsImF0dHJpYnMiLCJrZXkiLCJzZXRBdHRyaWJ1dGUiLCJkZWxldGVDYXJkIiwiZG9jdW1lbnQiLCJnZXRFbGVtZW50QnlJZCIsInBhcmVudE5vZGUiLCJyZW1vdmVDaGlsZCIsIl9jYXJkRWxlbWVudCIsIl9yZW5kZXJMaWtlcyIsImxpa2UiLCJfbGlrZUNhcmQiLCJfdW5saWtlQ2FyZCIsInNob3dMaWtlcyIsImNvdW50IiwiX3Nob3dEZWxldGVJY29uIiwiaXNMaWtlZCIsImxpa2VJY29uIiwiY29udGFpbnMiLCJnZW5lcmF0ZUNhcmQiLCJzcmMiLCJhbHQiLCJsZW5ndGgiLCJNb2RhbCIsIm1vZGFsIiwiX21vZGFsIiwib3BlbiIsIl9jbGlja0VzY0hhbmRsZXIiLCJjb25zb2xlIiwibG9nIiwiY2xvc2UiLCJyZW1vdmVFdmVudExpc3RlbmVyIiwic2V0RXZlbnRMaXN0ZW5lcnMiLCJ0YXJnZXQiLCJNb2RhbFdpdGhGb3JtIiwiaGFuZGxlU3VibWl0Iiwic3VwZXIiLCJfaGFuZGxlU3VibWl0IiwiX2Zvcm0iLCJfZ2V0SW5wdXRWYWx1ZXMiLCJfZm9ybUlucHV0VmFsdWVzIiwiaW5wdXRMaXN0IiwidmFsdWUiLCJpbnB1dFZhbHVlcyIsImhhbmRsZVJlbW92ZSIsImhhbmRsZSIsInJlc2V0IiwiU2VjdGlvbiIsIml0ZW1zIiwicmVuZGVyZXIiLCJjb250YWluZXJTZWxlY3RvciIsIl9yZW5kZXJlZEVsZW1lbnRzIiwiX3JlbmRlcmVyIiwiX2NvbnRhaW5lciIsIml0ZW0iLCJhZGRJdGVtIiwiYXBwZW5kIiwicHJlcGVuZEl0ZW0iLCJwcmVwZW5kIiwiVXNlckluZm8iLCJqb2IiLCJhdmF0YXIiLCJfam9iIiwiX2F2YXRhciIsImdldFVzZXJJbmZvIiwiX3VzZXJJbmZvIiwic2V0VXNlckluZm8iLCJ1c2VySW5mbyIsInVzZXJBdmF0YXIiLCJlZGl0QnV0dG9uIiwicHJvZmlsZU1vZGFsIiwicHJvZmlsZU5hbWUiLCJuYW1lSW5wdXQiLCJwcm9maWxlSm9iIiwiam9iSW5wdXQiLCJhdmF0YXJNb2RhbCIsImFkZENhcmRCdXR0b24iLCJhZGRDYXJkTW9kYWwiLCJhZGRDYXJkRm9ybSIsImZvcm1zIiwiY2FyZFRlbXBsYXRlIiwiZWxlbWVudHMiLCJ0aXRsZSIsImNhcmRCaWdNb2RhbCIsImZvcm1TZWxlY3RvciIsImJpZ0ltYWdlIiwib3BlbnVwIiwiX21vZGFsRWxlbWVudCIsImRlbGV0ZUNhcmRNb2RhbCIsImxvYWRpbmdNb2RhbCIsImlzTG9hZGluZyIsImFwaSIsImJhc2VVcmwiLCJoZWFkZXJzIiwiX2Jhc2VVcmwiLCJfaGVhZGVycyIsImdldENhcmRMaXN0IiwiZmV0Y2giLCJ0aGVuIiwicmVzIiwib2siLCJqc29uIiwiUHJvbWlzZSIsInJlamVjdCIsInN0YXR1c1RleHQiLCJnZXRBcHBJbmZvIiwiYWxsIiwiYWRkQ2FyZCIsIm1ldGhvZCIsImJvZHkiLCJKU09OIiwic3RyaW5naWZ5IiwicmVtb3ZlQ2FyZCIsImNhcmRJZCIsImxpa2VDYXJkIiwidW5saWtlQ2FyZCIsInN0YXR1cyIsInNldFVzZXJBdmF0YXIiLCJ1cGRhdGVVc2VySW5mbyIsImFib3V0IiwiYXV0aG9yaXphdGlvbiIsImNhcmRMaXN0IiwidXNlckRhdGEiLCJwcm9maWxlIiwiYWRkaW5nTmV3Q2FyZCIsImNhcmRJbnN0YW5jZSIsImNhdGNoIiwiZXJyIiwibGVuZ2h0IiwiY2FyZHNMaXN0IiwiZmluYWxseSIsImFkZENhcmRGb3JtVmFsaWRhdGlvbiIsInByb2ZpbGVGb3JtIiwicHJvZmlsZUZvcm1WYWxpZGF0aW9uIiwiYXZhdGFyRm9ybSIsImltZ0xpbmsiXSwic291cmNlUm9vdCI6IiJ9