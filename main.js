!function(){"use strict";class e{constructor({cardData:e,isLiked:t,isOwner:s,onCardClick:r,removeHandler:i,likeHandler:n},o){this._name=e.name,this._link=e.link,this._id=e._id,this._ownerId=e.owner._id,this._likes=e.likes,this._likesCount=e.likes.length,this._cardSelector=o,this._onCardClick=r,this._onCardClick=this._onCardClick.bind(this),this._likeHandler=n,this._clickLikeHandler=this._clickLikeHandler.bind(this),this._removeHandler=i,this._removeHandler=this._removeHandler.bind(this),this._isLiked=t,this._isLiked=this._isLiked.bind(this),this._isOwner=s,this._isOwner=this._isOwner.bind(this)}_getTemplate(){return document.querySelector("#card__template").content.querySelector(".card").cloneNode(!0)}likesAmountSet(e){this._item.querySelector(".card__like-count").textContent=e}_likeCard(e){this._item.querySelector("card__like").classList.toggle("card__like-button_active"),this._likeHandler(this),e.stopImmediatePropogation()}deleteCard(){this._item.remove(),this._item=null}_deleteCardHandler(e){e.stopImmediatePropagation(),this._deleteCardHandler(this._id,this)}_setEventListeners(){this._item.querySelector(".card__like-button").addEventListener("click",(e=>{this._likeCard(e)})),this._item.querySelector(".card__delete-button").addEventListener("click",(e=>{this._deleteCardHandler(e)})),this._cardImage.addEventListener("click",(e=>{this._onCardClick(e)}))}generateCard(){return this._item=this._getTemplate(),!0===this._isLiked(this._likes)?this._element.querySelector(".card__like-button").classList.add("card__like_active"):this._element.querySelector(".card__like-button").classList.remove("card__like_active"),!0!==this._isOwner(this._ownerId)&&this._element.querySelector(".card__delete-button").classList.add("card__delete-button_hidden"),this._cardImage=this._item.querySelector(".card__image"),this._setEventListeners(),this._item.querySelector(".card__title").textContent=this._name,this._cardImage.src=this._link,this._cardImage.alt=`Image of  ${this._name} `,this._setEventListeners(),this._item}getID(){return this._id}}class t{constructor(e,t){this._formConfig=e,this._formElement=t}_showInputError=(e,t)=>{const{inputErrorClass:s,errorMessageClass:r}=this._formConfig,i=this._formElement.querySelector(` #${e.id}_error `);i.textContent=t,i.classList.add(r),e.classList.add(s)};_hideInputError=e=>{const{inputErrorClass:t,errorMessageClass:s}=this._formConfig,r=this._formElement.querySelector(` #${e.id}_error `);r.textContent="",r.classList.remove(s),e.classList.remove(t)};resetValidation(){this.inputs.forEach((e=>{this._hideInputError(e)})),this._toggleSubmitButton()}_checkInput=e=>{e.validity.valid?this._hideInputError(e):this._showInputError(e,e.validationMessage)};_checkIfFormValid=()=>this.inputs.every((e=>e.validity.valid));_toggleSubmitButton(){const{inactiveButtonClass:e,submitButtonSelector:t}=this._formConfig,s=this._formElement.querySelector(t);this._checkIfFormValid()?(s.disabled=!1,s.classList.remove(e)):(s.disabled=!0,s.classList.add(e))}_setEventListeners=()=>{const{inputSelector:e}=this._formConfig;return this.inputs=Array.from(this._formElement.querySelectorAll(e)),this.inputs.forEach((e=>{e.addEventListener("input",(()=>{this._checkInput(e),this._toggleSubmitButton()}))})),this._formElement};enableValidation(){this._formElement.addEventListener("submit",(e=>{e.preventDefault()})),this._setEventListeners()}}class s{constructor({items:e,renderer:t},s){this._items=e,this._renderer=t,this._container=document.querySelector(s),this.renderer=t}addItem(e){this._container.append(e)}prependItem(e){this._container.prepend(e)}renderItems(){this._items.forEach((e=>{this._renderer(e)}))}}const r=document.querySelector(".profile__edit-button"),i=document.forms.profile,n=(i.elements.name,i.elements.job,document.querySelector(".modal__close-button_type_edit"),document.querySelector(".profile__add-button")),o=document.querySelector(".modal_type_add-card"),a=(document.querySelector(".modal__input_type_name"),document.querySelector(".modal__input_type_link"),document.querySelector(".modal__close-button_type_add-card"),document.forms.add),l=(a.elements.title,a.elements.link,document.querySelector(".modal__submit-button"),document.querySelector(".cards__grid"),document.querySelector(".modal_type_big-image"),document.querySelector(".modal__big-image"),document.querySelector(".modal__image-caption"),document.querySelector(".modal__close-button_type_big-image"),{formSelector:".modal__container",inputSelector:".modal__input",submitButtonSelector:".modal__submit-button",inactiveButtonClass:"modal__submit-button_disabled",inputErrorClass:"modal__input_error",errorMessageClass:"modal__error_visible"});class d{constructor(e){this._modalElement=document.querySelector(e)}_checkForEscClose=e=>{"Escape"===e.key&&this.close()};open=()=>{this._modalElement.classList.add("modal_visible"),document.addEventListener("keyup",this._checkForEscClose)};close=()=>{this._modalElement.classList.remove("modal_visible"),document.removeEventListener("keyup",this._checkForEscClose)};setEventListeners(){this._modalElement.querySelector(".modal__close-button").addEventListener("click",(e=>{this.close(e)})),this._modalElement.addEventListener("click",(e=>{e.target.classList.contains("modal_visible")&&this.close(e)}))}}class c extends d{constructor(e,t){super(e),this._handleSubmitBtn=t,this._formElement=this._modalElement.querySelector(".modal__container")}getInputValues(){const e=Array.from(this._formElement.querySelectorAll(".modal__input")),t={};return e.forEach((e=>{t[e.name]=e.value})),t}setInputValues(e){Array.from(this._formElement.querySelectorAll(".modal__input")).forEach((t=>{t.value=e[t.name]}))}setEventListeners(){super.setEventListeners(),this._formElement.addEventListener("submit",(()=>{this._handleSubmitBtn(this.getInputValues()),this.close(),this._formElement.reset()}))}close(){super.close(),this._formElement.reset()}}const _=new class{constructor({baseUrl:e,headers:t}){this.baseUrl=e,this.headers=t}getInitialCards(){return fetch(this.baseUrl+"/cards",{headers:this.headers}).then((e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`)))}getUserInfo(){return fetch(this.baseUrl+"/users/me",{headers:this.headers}).then((e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`)))}addCard({name:e,link:t}){return fetch(this.baseUrl+"/cards",{headers:this.headers,method:"POST",body:JSON.stringify({name:e,link:t})}).then((e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`)))}removeCard(e){return fetch(this.baseUrl+"/cards/"+e,{headers:this.headers,method:"DELETE"}).then((e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`)))}getAppInfo(){return Promise.all([this.getInitialCards(),this.getUserInfo()])}addLike(e){return fetch(this.baseUrl+"/cards/likes/"+e.getId(),{headers:this.headers,method:"PUT"}).then((e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`)))}removeLike(e){return fetch(this.baseUrl+"/cards/likes/"+e.getId(),{headers:this.headers,method:"DELETE"}).then((e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`)))}updateUserInfo({name:e,about:t}){return fetch(this.baseUrl+"/users/me",{headers:this.headers,method:"PATCH",body:JSON.stringify({name:e,about:t})}).then((e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`)))}setUserAvatar({avatar:e}){return fetch(this.baseUrl+"/users/me/avatar",{headers:this.headers,method:"PATCH",body:JSON.stringify({avatar:e})}).then((e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`)))}}({baseUrl:"https://around.nomoreparties.co/v1/group-42",headers:{authorization:"c56e30dc-2883-4270-a59e-b2f7bae969c6","Content-Type":"application/json"}});function m(t,s,r){return new e({cardData:t,isLiked:e=>void 0!==e.find((e=>e._id===s._id)),isOwner:e=>s._id===e,clickCardHandler:e=>{imagePopup.open(e)},deleteCardHandler:(e,t)=>{const s=new PopupDeleteConfirm(".delete-card",(()=>{_.removeCard(e).then((e=>t.removeCard())).catch((e=>console.log(e))).finally((function(){s.close()}))}));s.open()},likeCardHandler:e=>{void 0!==e._likes.find((e=>e._id===s._id))?_.removeLike(e).then((t=>{e._likes=t.likes,e.setLikes(t.likes.length)})):_.addLike(e).then((t=>{e._likes=t.likes,e.setLikes(t.likes.length)}))}},"#card")}_.getAppInfo().then((([e,t])=>{const r=new s({data:e,renderer:function(e){const s=m(e,t);r.addItem(s.generateCard())}},".cards__grid");r.setItems(),user.setUserInfo({name:t.name,job:t.about}),user.setUserAvatar({avatar:t.avatar});const i=new c(".add-card",(e=>{_.addCard({name:e.name,link:e.link}).then((e=>{const s=m(e,t);r.addItem(s.generateCard())})).catch((e=>console.log(e))).finally((function(){i.close()}))}));btnAddCard.addEventListener("click",(()=>{popupAddCard.open(),addCardValidator.changeStateSubmit()}))})).catch((e=>console.log(e))),new class extends d{openup=e=>{const t=e.target;this._modalElement.querySelector(".modal__big-image").src=t.src,this._modalElement.querySelector(".modal__big-image").alt=t.alt,this._modalElement.querySelector(".modal__image-caption").textContent=t.alt,this.open()}}(".modal_type_big-image").setEventListeners();const h=new class{constructor({name:e,job:t,avatar:s}){this._name=document.querySelector(`${e}`),this._job=document.querySelector(`${t}`),this._avatar=document.querySelector(`${s}`)}getUserInfo(){return{name:this._name.textContent,job:this._job.textContent,avatar:this._avatar.src}}setUserInfo(e){const{name:t,job:s}=e;this._name.textContent=t,this._job.textContent=s}setUserAvatar({avatar:e}){this._avatar.src=e}}(".profile__title",".profile__subtitle");h.setUserInfo({name:"Artiom Shlyusberg",job:"Junior Web Dev"});const u=new c(".modal_type_edit",(e=>{h.setUserInfo(u.getInputValues()),u.close()}));u.setEventListeners(),r.addEventListener("click",(()=>{u.setInputValues(h.getUserInfo()),k.resetValidation(),u.open()}));const p=new c(".modal_type_add-card",(()=>{const e=p.getInputValues();cardsSection.prependItem(createCard(e)),p.close()}));p.setEventListeners(),n.addEventListener("click",(()=>{b.resetValidation(),p.open()}));const k=new t(l,i);k.enableValidation();const b=new t(l,o);b.enableValidation()}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUssbUJBSzdELE1BQU1nRyxFQUFrQixJQUFJaEYsRUFBYyxvQkFBcUJpRSxJQUM3RFksRUFBZVQsWUFBWVksRUFBZ0I1RSxrQkFDM0M0RSxFQUFnQnRGLFdBR2xCc0YsRUFBZ0JuRixvQkFFaEJuQixFQUFXeEQsaUJBQWlCLFNBQVMsS0FDbkM4SixFQUFnQnhFLGVBQWVxRSxFQUFldEQsZUFDOUMwRCxFQUFzQjFJLGtCQUN0QnlJLEVBQWdCckYsVUFJbEIsTUFBTVQsRUFBYyxJQUFJYyxFQUFjLHdCQUF3QixLQUM1RCxNQUFNc0UsRUFBVXBGLEVBQVlrQixpQkFDNUI0RCxhQUFhMUYsWUFBWTRHLFdBQVdaLElBQ3BDcEYsRUFBWVEsV0FHZFIsRUFBWVcsb0JBRVpmLEVBQWM1RCxpQkFBaUIsU0FBUyxLQUN0Q2lLLEVBQXNCNUksa0JBQ3RCMkMsRUFBWVMsVUFLZCxNQUFNc0YsRUFBd0IsSUFBSXZKLEVBQWNDLEVBQVlnRCxHQUM1RHNHLEVBQXNCdkgsbUJBRXRCLE1BQU15SCxFQUF3QixJQUFJekosRUFBY0MsRUFBWXNELEdBQzVEa0csRUFBc0J6SCxtQiIsInNvdXJjZXMiOlsid2VicGFjazovL3dlYl9wcm9qZWN0XzQvLi9zcmMvY29tcG9uZW50cy9zY3JpcHRzL0NhcmQuanMiLCJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfNC8uL3NyYy9jb21wb25lbnRzL3NjcmlwdHMvRm9ybVZhbGlkYXRvci5qcyIsIndlYnBhY2s6Ly93ZWJfcHJvamVjdF80Ly4vc3JjL2NvbXBvbmVudHMvc2NyaXB0cy9TZWN0aW9uLmpzIiwid2VicGFjazovL3dlYl9wcm9qZWN0XzQvLi9zcmMvY29tcG9uZW50cy91dGlscy9jb25zdGFudHMuanMiLCJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfNC8uL3NyYy9jb21wb25lbnRzL3NjcmlwdHMvTW9kYWwuanMiLCJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfNC8uL3NyYy9jb21wb25lbnRzL3NjcmlwdHMvTW9kYWxXaXRoRm9ybS5qcyIsIndlYnBhY2s6Ly93ZWJfcHJvamVjdF80Ly4vc3JjL3BhZ2VzL0luZGV4LmpzIiwid2VicGFjazovL3dlYl9wcm9qZWN0XzQvLi9zcmMvY29tcG9uZW50cy9zY3JpcHRzL0FwaS5qcyIsIndlYnBhY2s6Ly93ZWJfcHJvamVjdF80Ly4vc3JjL2NvbXBvbmVudHMvc2NyaXB0cy9Nb2RhbFdpdGhJbWFnZS5qcyIsIndlYnBhY2s6Ly93ZWJfcHJvamVjdF80Ly4vc3JjL2NvbXBvbmVudHMvc2NyaXB0cy9Vc2VySW5mby5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnQgY2xhc3MgQ2FyZCB7XHJcbiAgY29uc3RydWN0b3Ioe2NhcmREYXRhLCBpc0xpa2VkLCBpc093bmVyLCBvbkNhcmRDbGljaywgcmVtb3ZlSGFuZGxlciwgbGlrZUhhbmRsZXJ9LCBjYXJkU2VsZWN0b3IpIHtcclxuICAgIHRoaXMuX25hbWUgPSBjYXJkRGF0YS5uYW1lO1xyXG4gICAgdGhpcy5fbGluayA9IGNhcmREYXRhLmxpbms7XHJcbiAgICB0aGlzLl9pZCA9IGNhcmREYXRhLl9pZDtcclxuICAgIHRoaXMuX293bmVySWQgPSBjYXJkRGF0YS5vd25lci5faWQ7XHJcbiAgICB0aGlzLl9saWtlcyA9IGNhcmREYXRhLmxpa2VzO1xyXG4gICAgdGhpcy5fbGlrZXNDb3VudCA9IGNhcmREYXRhLmxpa2VzLmxlbmd0aDtcclxuICAgIHRoaXMuX2NhcmRTZWxlY3RvciA9IGNhcmRTZWxlY3RvcjtcclxuXHJcbiAgICB0aGlzLl9vbkNhcmRDbGljayA9IG9uQ2FyZENsaWNrO1xyXG4gICAgdGhpcy5fb25DYXJkQ2xpY2sgPSB0aGlzLl9vbkNhcmRDbGljay5iaW5kKHRoaXMpO1xyXG4gICAgdGhpcy5fbGlrZUhhbmRsZXIgPSBsaWtlSGFuZGxlcjtcclxuICAgIHRoaXMuX2NsaWNrTGlrZUhhbmRsZXIgPSB0aGlzLl9jbGlja0xpa2VIYW5kbGVyLmJpbmQodGhpcyk7XHJcbiAgICB0aGlzLl9yZW1vdmVIYW5kbGVyID0gcmVtb3ZlSGFuZGxlcjtcclxuICAgIHRoaXMuX3JlbW92ZUhhbmRsZXIgPSB0aGlzLl9yZW1vdmVIYW5kbGVyLmJpbmQodGhpcyk7XHJcblxyXG4gICAgdGhpcy5faXNMaWtlZCA9IGlzTGlrZWQ7XHJcbiAgICB0aGlzLl9pc0xpa2VkID0gdGhpcy5faXNMaWtlZC5iaW5kKHRoaXMpO1xyXG4gICAgdGhpcy5faXNPd25lciA9IGlzT3duZXI7XHJcbiAgICB0aGlzLl9pc093bmVyID0gdGhpcy5faXNPd25lci5iaW5kKHRoaXMpO1xyXG4gIH1cclxuICAvLyAtLS0gR2V0dGluZyB0aGUgdGVtcGxhdGUgLS0tIC8vXHJcbiAgX2dldFRlbXBsYXRlKCkge1xyXG4gICAgY29uc3QgY2FyZCA9IGRvY3VtZW50XHJcbiAgICAgIC5xdWVyeVNlbGVjdG9yKFwiI2NhcmRfX3RlbXBsYXRlXCIpXHJcbiAgICAgIC5jb250ZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZFwiKVxyXG4gICAgICAuY2xvbmVOb2RlKHRydWUpO1xyXG4gICAgcmV0dXJuIGNhcmQ7XHJcbiAgfVxyXG5cclxuICAvLyAtLS0gU2V0IHRoZSBsaWtlcyBhbW91bnQgb2YgYSBjYXJkIC0tLSAvL1xyXG4gIGxpa2VzQW1vdW50U2V0KGxpa2VzQ291bnQpIHtcclxuICAgIHRoaXMuX2l0ZW0ucXVlcnlTZWxlY3RvcignLmNhcmRfX2xpa2UtY291bnQnKS50ZXh0Q29udGVudCA9IGxpa2VzQ291bnQ7XHJcbiAgfVxyXG5cclxuICAvLyAtLS0gVG9nZ2xlIGxpa2UgYnV0dG9uIG1ldGhvZCAtLS0gLy9cclxuICBfbGlrZUNhcmQoZXZlbnQpIHtcclxuICAgIGNvbnN0IGxpa2VFbGVtZW50ID0gdGhpcy5faXRlbS5xdWVyeVNlbGVjdG9yKCdjYXJkX19saWtlJyk7XHJcbiAgICBsaWtlRWxlbWVudC5jbGFzc0xpc3QudG9nZ2xlKFwiY2FyZF9fbGlrZS1idXR0b25fYWN0aXZlXCIpO1xyXG4gICAgdGhpcy5fbGlrZUhhbmRsZXIodGhpcyk7XHJcbiAgICBldmVudC5zdG9wSW1tZWRpYXRlUHJvcG9nYXRpb24oKTtcclxuICB9XHJcbiAgLy8gLS0tIENhcmQgZGVsZXRpbmcgbWV0aG9kIC0tLSAvL1xyXG4gIGRlbGV0ZUNhcmQoKSB7XHJcbiAgICB0aGlzLl9pdGVtLnJlbW92ZSgpO1xyXG4gICAgdGhpcy5faXRlbSA9IG51bGwgXHJcbiAgfVxyXG4gIC8vIC0tLSBUaGUgY2FyZCBkZWxldGluZyBldmVudCBoYW5kbGVyIC0tLSAvL1xyXG4gIF9kZWxldGVDYXJkSGFuZGxlcihldmVudCkge1xyXG4gICAgZXZlbnQuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCk7XHJcbiAgICB0aGlzLl9kZWxldGVDYXJkSGFuZGxlcih0aGlzLl9pZCwgdGhpcyk7XHJcbiAgfVxyXG4gIFxyXG4gIC8vIC0tLSBTZXQgZXZlbnRzIGxpc3RlbmVycyBmb3IgdGhlIGNhcmRzIHRoYXQgd2lsbCBiZSBjcmVhdGVkISAtLS0gLy9cclxuICBfc2V0RXZlbnRMaXN0ZW5lcnMoKSB7XHJcbiAgICB0aGlzLl9pdGVtXHJcbiAgICAgIC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX2xpa2UtYnV0dG9uXCIpXHJcbiAgICAgIC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKGV2ZW50KSA9PiB7XHJcbiAgICAgICAgdGhpcy5fbGlrZUNhcmQoZXZlbnQpO1xyXG4gICAgICB9KTtcclxuXHJcbiAgICB0aGlzLl9pdGVtXHJcbiAgICAgIC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX2RlbGV0ZS1idXR0b25cIilcclxuICAgICAgLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoZXZlbnQpID0+IHtcclxuICAgICAgICB0aGlzLl9kZWxldGVDYXJkSGFuZGxlcihldmVudCk7XHJcbiAgICAgIH0pO1xyXG5cclxuICAgIHRoaXMuX2NhcmRJbWFnZVxyXG4gICAgICAuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIChldmVudCkgPT4ge1xyXG4gICAgICAgIHRoaXMuX29uQ2FyZENsaWNrKGV2ZW50KTtcclxuICAgICAgfSk7XHJcbiAgfVxyXG5cclxuICAvLyAtLS0gQ3JlYXRpbmcgdGhlIGNhcmQgYW5kIGNhcmQgZWxlbWVudHMgLS0tIC8vXHJcbiAgZ2VuZXJhdGVDYXJkKCkge1xyXG4gICAgdGhpcy5faXRlbSA9IHRoaXMuX2dldFRlbXBsYXRlKCk7XHJcblxyXG4gICAgaWYgKHRoaXMuX2lzTGlrZWQodGhpcy5fbGlrZXMpID09PSB0cnVlKSB7XHJcbiAgICAgIHRoaXMuX2VsZW1lbnQucXVlcnlTZWxlY3RvcignLmNhcmRfX2xpa2UtYnV0dG9uJykuY2xhc3NMaXN0LmFkZCgnY2FyZF9fbGlrZV9hY3RpdmUnKTtcclxuICAgIH0gXHJcbiAgICBlbHNlIHtcclxuICAgICAgdGhpcy5fZWxlbWVudC5xdWVyeVNlbGVjdG9yKCcuY2FyZF9fbGlrZS1idXR0b24nKS5jbGFzc0xpc3QucmVtb3ZlKCdjYXJkX19saWtlX2FjdGl2ZScpO1xyXG4gICAgfVxyXG5cclxuICAgIGlmICh0aGlzLl9pc093bmVyKHRoaXMuX293bmVySWQpICE9PSB0cnVlKSB7XHJcbiAgICAgIHRoaXMuX2VsZW1lbnQucXVlcnlTZWxlY3RvcignLmNhcmRfX2RlbGV0ZS1idXR0b24nKS5jbGFzc0xpc3QuYWRkKCdjYXJkX19kZWxldGUtYnV0dG9uX2hpZGRlbicpO1xyXG4gICAgfVxyXG5cclxuICAgIHRoaXMuX2NhcmRJbWFnZSA9IHRoaXMuX2l0ZW1cclxuICAgICAgLnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9faW1hZ2VcIik7XHJcbiAgICB0aGlzLl9zZXRFdmVudExpc3RlbmVycygpO1xyXG4gICAgdGhpcy5faXRlbVxyXG4gICAgICAucXVlcnlTZWxlY3RvcihcIi5jYXJkX190aXRsZVwiKVxyXG4gICAgICAudGV4dENvbnRlbnQgPSB0aGlzLl9uYW1lO1xyXG4gICAgdGhpcy5fY2FyZEltYWdlLnNyYyA9IHRoaXMuX2xpbms7XHJcbiAgICB0aGlzLl9jYXJkSW1hZ2UuYWx0ID0gJ0ltYWdlIG9mICcrYCAke3RoaXMuX25hbWV9IGA7XHJcblxyXG4gICAgdGhpcy5fc2V0RXZlbnRMaXN0ZW5lcnMoKTtcclxuXHJcbiAgICByZXR1cm4gdGhpcy5faXRlbTtcclxuICB9XHJcblxyXG4gIGdldElEKCkge1xyXG4gICAgcmV0dXJuIHRoaXMuX2lkO1xyXG4gIH1cclxufSIsImV4cG9ydCBkZWZhdWx0IGNsYXNzIEZvcm1WYWxpZGF0b3Ige1xyXG4gIGNvbnN0cnVjdG9yKGZvcm1Db25maWcsIGZvcm1FbGVtZW50KSB7XHJcbiAgICB0aGlzLl9mb3JtQ29uZmlnID0gZm9ybUNvbmZpZztcclxuICAgIHRoaXMuX2Zvcm1FbGVtZW50ID0gZm9ybUVsZW1lbnQ7XHJcbiAgfVxyXG5cclxuICBfc2hvd0lucHV0RXJyb3IgPSAoaW5wdXRFbGVtZW50LCBlcnJvck1lc3NhZ2UpID0+IHtcclxuICAgIGNvbnN0IHsgaW5wdXRFcnJvckNsYXNzLCBlcnJvck1lc3NhZ2VDbGFzcyB9ID0gdGhpcy5fZm9ybUNvbmZpZztcclxuICAgIGNvbnN0IGVycm9yRWxlbWVudCA9IHRoaXMuX2Zvcm1FbGVtZW50LnF1ZXJ5U2VsZWN0b3IoYCAjJHtpbnB1dEVsZW1lbnQuaWR9X2Vycm9yIGApO1xyXG4gICAgZXJyb3JFbGVtZW50LnRleHRDb250ZW50ID0gZXJyb3JNZXNzYWdlO1xyXG4gICAgZXJyb3JFbGVtZW50LmNsYXNzTGlzdC5hZGQoZXJyb3JNZXNzYWdlQ2xhc3MpO1xyXG4gICAgaW5wdXRFbGVtZW50LmNsYXNzTGlzdC5hZGQoaW5wdXRFcnJvckNsYXNzKTtcclxuICB9O1xyXG4gIFxyXG4gIF9oaWRlSW5wdXRFcnJvciA9IChpbnB1dEVsZW1lbnQpID0+IHtcclxuICAgIGNvbnN0IHsgaW5wdXRFcnJvckNsYXNzLCBlcnJvck1lc3NhZ2VDbGFzcyB9ID0gdGhpcy5fZm9ybUNvbmZpZztcclxuICAgIGNvbnN0IGVycm9yRWxlbWVudCA9IHRoaXMuX2Zvcm1FbGVtZW50LnF1ZXJ5U2VsZWN0b3IoYCAjJHtpbnB1dEVsZW1lbnQuaWR9X2Vycm9yIGApO1xyXG4gICAgZXJyb3JFbGVtZW50LnRleHRDb250ZW50ID0gXCJcIjtcclxuICAgIGVycm9yRWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKGVycm9yTWVzc2FnZUNsYXNzKTtcclxuICAgIGlucHV0RWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKGlucHV0RXJyb3JDbGFzcyk7XHJcbiAgfTtcclxuXHJcbiAgcmVzZXRWYWxpZGF0aW9uKCkge1xyXG4gICAgdGhpcy5pbnB1dHMuZm9yRWFjaCgoaW5wdXQpID0+IHtcclxuICAgICAgdGhpcy5faGlkZUlucHV0RXJyb3IoaW5wdXQpO1xyXG4gICAgfSk7XHJcbiAgICB0aGlzLl90b2dnbGVTdWJtaXRCdXR0b24oKTtcclxuICB9XHJcblxyXG4gIF9jaGVja0lucHV0ID0gKGlucHV0RWxlbWVudCkgPT4ge1xyXG4gICAgaWYgKCFpbnB1dEVsZW1lbnQudmFsaWRpdHkudmFsaWQpIHtcclxuICAgICAgdGhpcy5fc2hvd0lucHV0RXJyb3IoaW5wdXRFbGVtZW50LCBpbnB1dEVsZW1lbnQudmFsaWRhdGlvbk1lc3NhZ2UpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGhpcy5faGlkZUlucHV0RXJyb3IoaW5wdXRFbGVtZW50KTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIF9jaGVja0lmRm9ybVZhbGlkID0gKCkgPT4gdGhpcy5pbnB1dHMuZXZlcnkoKGlucHV0KSA9PiBpbnB1dC52YWxpZGl0eS52YWxpZCk7XHJcblxyXG4gIF90b2dnbGVTdWJtaXRCdXR0b24oKSB7XHJcbiAgICBjb25zdCB7IGluYWN0aXZlQnV0dG9uQ2xhc3MsIHN1Ym1pdEJ1dHRvblNlbGVjdG9yIH0gPSB0aGlzLl9mb3JtQ29uZmlnO1xyXG4gICAgY29uc3QgYnV0dG9uRWxlbWVudCA9IHRoaXMuX2Zvcm1FbGVtZW50LnF1ZXJ5U2VsZWN0b3Ioc3VibWl0QnV0dG9uU2VsZWN0b3IpO1xyXG5cclxuICAgIGlmICh0aGlzLl9jaGVja0lmRm9ybVZhbGlkKCkpIHtcclxuICAgICAgYnV0dG9uRWxlbWVudC5kaXNhYmxlZCA9IGZhbHNlO1xyXG4gICAgICBidXR0b25FbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoaW5hY3RpdmVCdXR0b25DbGFzcyk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBidXR0b25FbGVtZW50LmRpc2FibGVkID0gdHJ1ZTtcclxuICAgICAgYnV0dG9uRWxlbWVudC5jbGFzc0xpc3QuYWRkKGluYWN0aXZlQnV0dG9uQ2xhc3MpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgX3NldEV2ZW50TGlzdGVuZXJzID0gKCkgPT4ge1xyXG4gICAgY29uc3QgeyBpbnB1dFNlbGVjdG9yIH0gPSB0aGlzLl9mb3JtQ29uZmlnO1xyXG4gICAgdGhpcy5pbnB1dHMgPSBBcnJheS5mcm9tKHRoaXMuX2Zvcm1FbGVtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoaW5wdXRTZWxlY3RvcikpO1xyXG5cclxuICAgIHRoaXMuaW5wdXRzLmZvckVhY2goKGlucHV0KSA9PiB7XHJcbiAgICAgIGlucHV0LmFkZEV2ZW50TGlzdGVuZXIoXCJpbnB1dFwiLCAoKSA9PiB7XHJcbiAgICAgICAgdGhpcy5fY2hlY2tJbnB1dChpbnB1dCk7XHJcbiAgICAgICAgdGhpcy5fdG9nZ2xlU3VibWl0QnV0dG9uKCk7XHJcbiAgICAgIH0pO1xyXG4gICAgfSk7XHJcbiAgICByZXR1cm4gdGhpcy5fZm9ybUVsZW1lbnQ7XHJcbiAgfTtcclxuXHJcbiAgZW5hYmxlVmFsaWRhdGlvbigpIHtcclxuICAgIHRoaXMuX2Zvcm1FbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgKGV2ZW50KSA9PiB7XHJcbiAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICB9KTtcclxuICAgIHRoaXMuX3NldEV2ZW50TGlzdGVuZXJzKCk7XHJcbiAgfVxyXG59IiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgU2VjdGlvbiB7XHJcbiAgY29uc3RydWN0b3IoeyBpdGVtcywgcmVuZGVyZXIgfSwgY29udGFpbmVyU2VsZWN0b3IpIHtcclxuICAgIHRoaXMuX2l0ZW1zID0gaXRlbXM7XHJcbiAgICB0aGlzLl9yZW5kZXJlciA9IHJlbmRlcmVyO1xyXG4gICAgdGhpcy5fY29udGFpbmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcihjb250YWluZXJTZWxlY3Rvcik7XHJcbiAgICB0aGlzLnJlbmRlcmVyID0gcmVuZGVyZXI7XHJcbiAgfVxyXG5cclxuICBhZGRJdGVtKGVsZW1lbnQpIHtcclxuICAgIHRoaXMuX2NvbnRhaW5lci5hcHBlbmQoZWxlbWVudCk7XHJcbiAgfVxyXG5cclxuICBwcmVwZW5kSXRlbShlbGVtZW50KSB7XHJcbiAgICB0aGlzLl9jb250YWluZXIucHJlcGVuZChlbGVtZW50KTtcclxuICB9XHJcblxyXG4gIHJlbmRlckl0ZW1zKCkge1xyXG4gICAgdGhpcy5faXRlbXMuZm9yRWFjaCgoY2FyZCkgPT4ge1xyXG4gICAgICB0aGlzLl9yZW5kZXJlcihjYXJkKTtcclxuICAgIH0pO1xyXG4gIH1cclxufVxyXG4iLCIvLyAtLSAnRWRpdCBwcm9maWxlJyBtb2RhbCBjb25zdHMgLS0gLy9cclxuZXhwb3J0IGNvbnN0IGVkaXRCdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucHJvZmlsZV9fZWRpdC1idXR0b24nKTtcclxuZXhwb3J0IGNvbnN0IHByb2ZpbGVNb2RhbCA9IGRvY3VtZW50LmZvcm1zLnByb2ZpbGU7XHJcbmV4cG9ydCBjb25zdCBuYW1lSW5wdXQgPSBwcm9maWxlTW9kYWwuZWxlbWVudHMubmFtZTtcclxuZXhwb3J0IGNvbnN0IGpvYklucHV0ID0gcHJvZmlsZU1vZGFsLmVsZW1lbnRzLmpvYjtcclxuZXhwb3J0IGNvbnN0IGVkaXRDbG9zZUJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbF9fY2xvc2UtYnV0dG9uX3R5cGVfZWRpdCcpO1xyXG4vLyAtLSAnQWRkLWNhcmQnIG1vZGFsIGNvbnN0cyAtLSAvL1xyXG5leHBvcnQgY29uc3QgYWRkQ2FyZEJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wcm9maWxlX19hZGQtYnV0dG9uJyk7XHJcbmV4cG9ydCBjb25zdCBhZGRDYXJkTW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubW9kYWxfdHlwZV9hZGQtY2FyZCcpO1xyXG5leHBvcnQgY29uc3QgY2FyZElucHV0VGl0bGUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubW9kYWxfX2lucHV0X3R5cGVfbmFtZScpO1xyXG5leHBvcnQgY29uc3QgY2FyZElucHV0TGluayA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbF9faW5wdXRfdHlwZV9saW5rJyk7XHJcbmV4cG9ydCBjb25zdCBhZGRDYXJkQ2xvc2VCdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubW9kYWxfX2Nsb3NlLWJ1dHRvbl90eXBlX2FkZC1jYXJkJyk7XHJcbi8vIC0tLSAnQWRkLUNhcmQnIGZvcm0gY29uc3RzIC0tLSAvL1xyXG5leHBvcnQgY29uc3QgYWRkQ2FyZEZvcm0gPSBkb2N1bWVudC5mb3Jtcy5hZGQ7XHJcbmV4cG9ydCBjb25zdCBhZGRDYXJkRm9ybVRpdGVsID0gYWRkQ2FyZEZvcm0uZWxlbWVudHMudGl0bGU7XHJcbmV4cG9ydCBjb25zdCBhZGRDYXJkRm9ybUxpbmsgPSBhZGRDYXJkRm9ybS5lbGVtZW50cy5saW5rO1xyXG4vLyAtLS0gR2VuZXJhbCBjb25zdCAtLS0gLy9cclxuZXhwb3J0IGNvbnN0IHN1Ym1pdEJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbF9fc3VibWl0LWJ1dHRvbicpO1xyXG5leHBvcnQgY29uc3QgY2FyZExpc3QgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuY2FyZHNfX2dyaWQnKTtcclxuLy8gLS0tIEJpZyBpbWFnZSBtb2RhbCBjb25zdHMgLS0tIC8vXHJcbmV4cG9ydCBjb25zdCBjYXJkQmlnTW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubW9kYWxfdHlwZV9iaWctaW1hZ2UnKTtcclxuZXhwb3J0IGNvbnN0IGNhcmRCaWdNb2RhbEltYWdlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLm1vZGFsX19iaWctaW1hZ2UnKTtcclxuZXhwb3J0IGNvbnN0IGNhcmRCaWdNb2RhbFRleHQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubW9kYWxfX2ltYWdlLWNhcHRpb24nKTtcclxuZXhwb3J0IGNvbnN0IGNhcmRCaWdNb2RhbENsb3NlSWNvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbF9fY2xvc2UtYnV0dG9uX3R5cGVfYmlnLWltYWdlJyk7XHJcbi8vIC0tLSBGb3JtIGNvbmZpZyBjb25zdHMgLS0tIC8vXHJcbmV4cG9ydCBjb25zdCBmb3JtQ29uZmlnID0ge1xyXG4gIGZvcm1TZWxlY3RvcjogXCIubW9kYWxfX2NvbnRhaW5lclwiLFxyXG4gIGlucHV0U2VsZWN0b3I6IFwiLm1vZGFsX19pbnB1dFwiLFxyXG4gIHN1Ym1pdEJ1dHRvblNlbGVjdG9yOiBcIi5tb2RhbF9fc3VibWl0LWJ1dHRvblwiLFxyXG4gIGluYWN0aXZlQnV0dG9uQ2xhc3M6IFwibW9kYWxfX3N1Ym1pdC1idXR0b25fZGlzYWJsZWRcIixcclxuICBpbnB1dEVycm9yQ2xhc3M6IFwibW9kYWxfX2lucHV0X2Vycm9yXCIsXHJcbiAgZXJyb3JNZXNzYWdlQ2xhc3M6IFwibW9kYWxfX2Vycm9yX3Zpc2libGVcIlxyXG59O1xyXG4vLyAtLS0gaW5pdENhcmRzIGNvbnN0cyAtLS0gLy9cclxuZXhwb3J0IGNvbnN0IGluaXRDYXJkcyA9IFtcclxuICB7XHJcbiAgICBuYW1lOiBcIllvc2VtaXRlIFZhbGxleVwiLFxyXG4gICAgbGluazogXCJodHRwczovL2NvZGUuczMueWFuZGV4Lm5ldC93ZWItY29kZS95b3NlbWl0ZS5qcGdcIlxyXG4gIH0sXHJcbiAge1xyXG4gICAgbmFtZTogXCJMYWtlIExvdWlzZVwiLFxyXG4gICAgbGluazogXCJodHRwczovL2NvZGUuczMueWFuZGV4Lm5ldC93ZWItY29kZS9sYWtlLWxvdWlzZS5qcGdcIlxyXG4gIH0sXHJcbiAge1xyXG4gICAgbmFtZTogXCJCYWxkIE1vdW50YWluc1wiLFxyXG4gICAgbGluazogXCJodHRwczovL2NvZGUuczMueWFuZGV4Lm5ldC93ZWItY29kZS9iYWxkLW1vdW50YWlucy5qcGdcIlxyXG4gIH0sXHJcbiAge1xyXG4gICAgbmFtZTogXCJMYXRlbWFyXCIsXHJcbiAgICBsaW5rOiBcImh0dHBzOi8vY29kZS5zMy55YW5kZXgubmV0L3dlYi1jb2RlL2xhdGVtYXIuanBnXCJcclxuICB9LFxyXG4gIHtcclxuICAgIG5hbWU6IFwiVmFub2lzZSBOYXRpb25hbCBQYXJrXCIsXHJcbiAgICBsaW5rOiBcImh0dHBzOi8vY29kZS5zMy55YW5kZXgubmV0L3dlYi1jb2RlL3Zhbm9pc2UuanBnXCJcclxuICB9LFxyXG4gIHtcclxuICAgIG5hbWU6IFwiTGFnbyBkaSBCcmFpZXNcIixcclxuICAgIGxpbms6IFwiaHR0cHM6Ly9jb2RlLnMzLnlhbmRleC5uZXQvd2ViLWNvZGUvbGFnby5qcGdcIlxyXG4gIH1cclxuXTsiLCJleHBvcnQgZGVmYXVsdCBjbGFzcyBNb2RhbCB7XHJcbiAgY29uc3RydWN0b3IobW9kYWxTZWxlY3Rvcikge1xyXG4gICAgdGhpcy5fbW9kYWxFbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcihtb2RhbFNlbGVjdG9yKTtcclxuICB9XHJcbiAgLy8gLS0tIENsb3NlIG1vZGFsIG9uIEVTQyBtZXRob2QgLS0tIC8vXHJcbiAgX2NoZWNrRm9yRXNjQ2xvc2UgPSAoZXZlbnQpID0+IHtcclxuICAgIGlmIChldmVudC5rZXkgPT09IFwiRXNjYXBlXCIpIHtcclxuICAgICAgdGhpcy5jbG9zZSgpO1xyXG4gICAgfVxyXG4gIH1cclxuICAvLyAtLS0gT3BlbiBtb2RhbCBtZXRob2QgLS0tIC8vIFxyXG4gIG9wZW4gPSAoKSA9PiB7XHJcbiAgICB0aGlzLl9tb2RhbEVsZW1lbnQuY2xhc3NMaXN0LmFkZChcIm1vZGFsX3Zpc2libGVcIik7XHJcbiAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwia2V5dXBcIiwgdGhpcy5fY2hlY2tGb3JFc2NDbG9zZSk7XHJcbiAgfVxyXG4gIC8vIC0tLSBDbG9zZSBtb2RhbCBtZXRob2QgLS0tIC8vXHJcbiAgY2xvc2UgPSAoKSA9PiB7XHJcbiAgICB0aGlzLl9tb2RhbEVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZShcIm1vZGFsX3Zpc2libGVcIik7XHJcbiAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKFwia2V5dXBcIiwgdGhpcy5fY2hlY2tGb3JFc2NDbG9zZSk7XHJcbiAgfVxyXG5cclxuICBzZXRFdmVudExpc3RlbmVycygpIHtcclxuICAgIC8vIC0tLSBDbG9zZSBtb2RhbCBvbiBjbG9zZSgnWCcpIGJ1dHRvbiAtLS0gLy9cclxuICAgIHRoaXMuX21vZGFsRWxlbWVudFxyXG4gICAgLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2Nsb3NlLWJ1dHRvblwiKVxyXG4gICAgLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoZXZlbnQpID0+IHtcclxuICAgICAgdGhpcy5jbG9zZShldmVudCk7XHJcbiAgICB9KTtcclxuICAgIC8vIENsb3NlIG1vZGFsIG9uIG92ZXJsYXkob3V0IG9mIHRoZSBtb2RhbCkgY2xpY2sgLS0tIC8vL1xyXG4gICAgdGhpcy5fbW9kYWxFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoZXZlbnQpID0+IHtcclxuICAgICAgaWYgKGV2ZW50LnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoXCJtb2RhbF92aXNpYmxlXCIpKSB7XHJcbiAgICAgICAgdGhpcy5jbG9zZShldmVudCk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxufSIsImltcG9ydCBNb2RhbCBmcm9tIFwiLi9Nb2RhbC5qc1wiO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgTW9kYWxXaXRoRm9ybSBleHRlbmRzIE1vZGFsIHtcclxuICBjb25zdHJ1Y3Rvcihtb2RhbFNlbGVjdG9yLCBoYW5kbGVTdWJtaXQpIHtcclxuICAgIHN1cGVyKG1vZGFsU2VsZWN0b3IpO1xyXG4gICAgdGhpcy5faGFuZGxlU3VibWl0QnRuID0gaGFuZGxlU3VibWl0O1xyXG4gICAgdGhpcy5fZm9ybUVsZW1lbnQgPSB0aGlzLl9tb2RhbEVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fY29udGFpbmVyXCIpO1xyXG4gIH1cclxuXHJcbiAgZ2V0SW5wdXRWYWx1ZXMoKSB7XHJcbiAgICBjb25zdCBpbnB1dExpc3QgPSBBcnJheS5mcm9tKFxyXG4gICAgICB0aGlzLl9mb3JtRWxlbWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLm1vZGFsX19pbnB1dFwiKVxyXG4gICAgKTtcclxuICAgIGNvbnN0IGlucHV0VmFsdWVzID0ge307XHJcbiAgICBpbnB1dExpc3QuZm9yRWFjaCgoaW5wdXQpID0+IHtpbnB1dFZhbHVlc1tpbnB1dC5uYW1lXSA9IGlucHV0LnZhbHVlO30pO1xyXG4gICAgcmV0dXJuIGlucHV0VmFsdWVzO1xyXG4gIH1cclxuXHJcbiAgc2V0SW5wdXRWYWx1ZXModmFsdWVzKSB7XHJcbiAgICBjb25zdCBpbnB1dExpc3QgPSBBcnJheS5mcm9tKFxyXG4gICAgICB0aGlzLl9mb3JtRWxlbWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLm1vZGFsX19pbnB1dFwiKVxyXG4gICAgKTtcclxuICAgIGlucHV0TGlzdC5mb3JFYWNoKChpbnB1dCkgPT4ge2lucHV0LnZhbHVlID0gdmFsdWVzW2lucHV0Lm5hbWVdO30pXHJcbiAgfVxyXG5cclxuICBzZXRFdmVudExpc3RlbmVycygpIHtcclxuICAgIHN1cGVyLnNldEV2ZW50TGlzdGVuZXJzKCk7XHJcbiAgICB0aGlzLl9mb3JtRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsICgpID0+IHtcclxuICAgICAgdGhpcy5faGFuZGxlU3VibWl0QnRuKHRoaXMuZ2V0SW5wdXRWYWx1ZXMoKSk7XHJcbiAgICAgIHRoaXMuY2xvc2UoKTtcclxuICAgICAgdGhpcy5fZm9ybUVsZW1lbnQucmVzZXQoKTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgY2xvc2UoKSB7XHJcbiAgICBzdXBlci5jbG9zZSgpO1xyXG4gICAgdGhpcy5fZm9ybUVsZW1lbnQucmVzZXQoKTtcclxuICB9XHJcbn0iLCJpbXBvcnQgQXBpIGZyb20gXCIuLi9jb21wb25lbnRzL3NjcmlwdHMvQXBpLmpzXCI7XHJcbmltcG9ydCB7IENhcmQgfSBmcm9tIFwiLi4vY29tcG9uZW50cy9zY3JpcHRzL0NhcmQuanNcIjtcclxuaW1wb3J0IEZvcm1WYWxpZGF0b3IgZnJvbSBcIi4uL2NvbXBvbmVudHMvc2NyaXB0cy9Gb3JtVmFsaWRhdG9yLmpzXCI7XHJcbmltcG9ydCBTZWN0aW9uIGZyb20gXCIuLi9jb21wb25lbnRzL3NjcmlwdHMvU2VjdGlvbi5qc1wiO1xyXG5pbXBvcnQge1xyXG4gIGVkaXRCdXR0b24sXHJcbiAgcHJvZmlsZU1vZGFsLFxyXG4gIGFkZENhcmRCdXR0b24sXHJcbiAgYWRkQ2FyZE1vZGFsLFxyXG4gIGluaXRDYXJkcyxcclxuICBmb3JtQ29uZmlnLFxyXG4gIGNhcmRMaXN0XHJcbn0gZnJvbSBcIi4uL2NvbXBvbmVudHMvdXRpbHMvY29uc3RhbnRzLmpzXCI7XHJcbmltcG9ydCBNb2RhbFdpdGhJbWFnZSBmcm9tIFwiLi4vY29tcG9uZW50cy9zY3JpcHRzL01vZGFsV2l0aEltYWdlLmpzXCI7XHJcbmltcG9ydCBNb2RhbFdpdGhGb3JtIGZyb20gXCIuLi9jb21wb25lbnRzL3NjcmlwdHMvTW9kYWxXaXRoRm9ybS5qc1wiO1xyXG5pbXBvcnQgTW9kYWxEZWxldGVDb25maXJtYXRpb24gZnJvbSBcIi4uL2NvbXBvbmVudHMvc2NyaXB0cy9Nb2RhbERlbGV0ZUNvbmZpcm1hdGlvbi5qc1wiO1xyXG5pbXBvcnQgVXNlckluZm8gZnJvbSBcIi4uL2NvbXBvbmVudHMvc2NyaXB0cy9Vc2VySW5mby5qc1wiO1xyXG5pbXBvcnQgXCIuL2luZGV4LmNzc1wiO1xyXG5cclxuY29uc3QgYXBpID0gbmV3IEFwaSh7XHJcbiAgYmFzZVVybDogJ2h0dHBzOi8vYXJvdW5kLm5vbW9yZXBhcnRpZXMuY28vdjEvZ3JvdXAtNDInLFxyXG4gIGhlYWRlcnM6IHtcclxuICAgIGF1dGhvcml6YXRpb246ICdjNTZlMzBkYy0yODgzLTQyNzAtYTU5ZS1iMmY3YmFlOTY5YzYnLFxyXG4gICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJ1xyXG4gIH1cclxufSk7IFxyXG5cclxuLy8gKysrKysgQ2FyZCBTZWN0aW9uICsrKysrIC8vXHJcbmNvbnN0IGNhcmRTZWxlY3RvciA9ICcjY2FyZCc7XHJcbi8vIC0tLSBDYXJkIHJlbmRlciBmdW5jdGlvbiAtLS0gLy9cclxuZnVuY3Rpb24gcmVuZGVyQ2FyZCAoaW5pdENhcmQsIHVzZXIsIHNlbGVjdG9yKSB7XHJcbiAgcmV0dXJuIG5ldyBDYXJkKHtcclxuICAgIGNhcmREYXRhOiBpbml0Q2FyZCxcclxuICAgIGlzTGlrZWQ6IChsaXN0TGlrZXMpID0+IHtcclxuICAgICAgcmV0dXJuIChsaXN0TGlrZXMuZmluZChpdGVtID0+IGl0ZW0uX2lkID09PSB1c2VyLl9pZCkgIT09IHVuZGVmaW5lZCk7XHJcbiAgICB9LFxyXG4gICAgaXNPd25lcjogKG93bmVyKSA9PiB7XHJcbiAgICAgIHJldHVybiAodXNlci5faWQgPT09IG93bmVyKTtcclxuICAgIH0sXHJcbiAgICBjbGlja0NhcmRIYW5kbGVyOiAoY2FyZEluZm8pID0+IHtcclxuICAgICAgaW1hZ2VQb3B1cC5vcGVuKGNhcmRJbmZvKTtcclxuICAgIH0sXHJcbiAgICBkZWxldGVDYXJkSGFuZGxlcjogKGlkLCBjYXJkKSA9PiB7XHJcbiAgICAgIGNvbnN0IGRlbGV0ZUNvbmZpcm0gPSBuZXcgUG9wdXBEZWxldGVDb25maXJtKCcuZGVsZXRlLWNhcmQnLCAoKSA9PiB7XHJcbiAgICAgICAgYXBpLnJlbW92ZUNhcmQoaWQpXHJcbiAgICAgICAgICAudGhlbihyZXMgPT4gY2FyZC5yZW1vdmVDYXJkKCkpXHJcbiAgICAgICAgICAuY2F0Y2goKGVycikgPT4gY29uc29sZS5sb2coZXJyKSlcclxuICAgICAgICAgIC5maW5hbGx5KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgZGVsZXRlQ29uZmlybS5jbG9zZSgpO1xyXG4gICAgICAgICAgfSk7XHJcbiAgICAgIH0pO1xyXG4gICAgICBkZWxldGVDb25maXJtLm9wZW4oKTtcclxuICAgIH0sXHJcbiAgICBsaWtlQ2FyZEhhbmRsZXI6IChjYXJkSW5mbykgPT4ge1xyXG4gICAgICBpZiAoY2FyZEluZm8uX2xpa2VzLmZpbmQoaXRlbSA9PiBpdGVtLl9pZCA9PT0gdXNlci5faWQpICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICBhcGkucmVtb3ZlTGlrZShjYXJkSW5mbylcclxuICAgICAgICAgIC50aGVuKHJlcyA9PiB7XHJcbiAgICAgICAgICAgIGNhcmRJbmZvLl9saWtlcyA9IHJlcy5saWtlcztcclxuICAgICAgICAgICAgY2FyZEluZm8uc2V0TGlrZXMocmVzLmxpa2VzLmxlbmd0aCk7XHJcbiAgICAgICAgICB9KTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBhcGkuYWRkTGlrZShjYXJkSW5mbykudGhlbihyZXMgPT4ge1xyXG4gICAgICAgICAgY2FyZEluZm8uX2xpa2VzID0gcmVzLmxpa2VzO1xyXG4gICAgICAgICAgY2FyZEluZm8uc2V0TGlrZXMocmVzLmxpa2VzLmxlbmd0aCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9LFxyXG4gIGNhcmRTZWxlY3Rvcik7XHJcbn1cclxuXHJcbmFwaS5nZXRBcHBJbmZvKClcclxuICAudGhlbigoW2luaXRpYWxDYXJkcywgdXNlckluZm9dKSA9PiB7XHJcbiAgICBjb25zdCBjYXJkc1NlY3Rpb24gPSBuZXcgU2VjdGlvbih7XHJcbiAgICAgIGRhdGE6IGluaXRpYWxDYXJkcyxcclxuICAgICAgcmVuZGVyZXI6IGZ1bmN0aW9uIChpbml0aWFsQ2FyZCkge1xyXG4gICAgICAgIGNvbnN0IGNhcmQgPSByZW5kZXJDYXJkKGluaXRpYWxDYXJkLCB1c2VySW5mbywgY2FyZFNlbGVjdG9yKTtcclxuICAgICAgICBjYXJkc1NlY3Rpb24uYWRkSXRlbShjYXJkLmdlbmVyYXRlQ2FyZCgpKTtcclxuICAgICAgfVxyXG4gICAgfSwgJy5jYXJkc19fZ3JpZCcpO1xyXG4gICAgY2FyZHNTZWN0aW9uLnNldEl0ZW1zKCk7XHJcblxyXG4gICAgdXNlci5zZXRVc2VySW5mbyh7XHJcbiAgICAgIG5hbWU6IHVzZXJJbmZvLm5hbWUsXHJcbiAgICAgIGpvYjogdXNlckluZm8uYWJvdXRcclxuICAgIH0pO1xyXG5cclxuICAgIHVzZXIuc2V0VXNlckF2YXRhcih7XHJcbiAgICAgIGF2YXRhcjogdXNlckluZm8uYXZhdGFyXHJcbiAgICB9KTtcclxuXHJcbiAgICBjb25zdCBtb2RhbEFkZENhcmQgPSBuZXcgTW9kYWxXaXRoRm9ybSgnLmFkZC1jYXJkJywgKGNhcmREYXRhKSA9PiB7XHJcbiAgICAgIGFwaS5hZGRDYXJkKHsgbmFtZTogY2FyZERhdGEubmFtZSwgbGluazogY2FyZERhdGEubGluayB9KVxyXG4gICAgICAgIC50aGVuKChyZXMpID0+IHtcclxuICAgICAgICAgIGNvbnN0IG5ld0NhcmQgPSByZW5kZXJDYXJkKHJlcywgdXNlckluZm8sIGNhcmRTZWxlY3Rvcik7XHJcbiAgICAgICAgICBjYXJkc1NlY3Rpb24uYWRkSXRlbShuZXdDYXJkLmdlbmVyYXRlQ2FyZCgpKTtcclxuICAgICAgICB9KVxyXG4gICAgICAgIC5jYXRjaCgoZXJyKSA9PiBjb25zb2xlLmxvZyhlcnIpKVxyXG4gICAgICAgIC5maW5hbGx5KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgIG1vZGFsQWRkQ2FyZC5jbG9zZSgpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7XHJcblxyXG4gICAgYnRuQWRkQ2FyZC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHtcclxuICAgICAgcG9wdXBBZGRDYXJkLm9wZW4oKTtcclxuICAgICAgYWRkQ2FyZFZhbGlkYXRvci5jaGFuZ2VTdGF0ZVN1Ym1pdCgpO1xyXG4gICAgfSk7XHJcbiAgfSlcclxuICAuY2F0Y2goKGVycikgPT4gY29uc29sZS5sb2coZXJyKSk7XHJcblxyXG4vLyAtLS0gTW9kYWxXaXRoSW1hZ2UgaW5zdGFuY2UgLS0tIC8vXHJcbmNvbnN0IGJpZ0ltYWdlTW9kYWwgPSBuZXcgTW9kYWxXaXRoSW1hZ2UoXCIubW9kYWxfdHlwZV9iaWctaW1hZ2VcIik7XHJcbmJpZ0ltYWdlTW9kYWwuc2V0RXZlbnRMaXN0ZW5lcnMoKTtcclxuXHJcbi8vICsrKysrICdVc2VyIEluZm8nICsrKysrIC8vXHJcbi8vIC0tLSBVc2VySW5mbyBpbnN0YW5jZSAtLS0gLy9cclxuY29uc3QgdXNlckluZm9WYWx1ZXMgPSBuZXcgVXNlckluZm8oXCIucHJvZmlsZV9fdGl0bGVcIiwgXCIucHJvZmlsZV9fc3VidGl0bGVcIik7XHJcbnVzZXJJbmZvVmFsdWVzLnNldFVzZXJJbmZvKHsgbmFtZTogXCJBcnRpb20gU2hseXVzYmVyZ1wiLCBqb2I6IFwiSnVuaW9yIFdlYiBEZXZcIiB9KTtcclxuXHJcbi8vICsrKysrIEZvcm1zICsrKysrIC8vXHJcbi8vID09PSAnRWRpdCBwcm9maWxlJyBmb3JtID09PSAvL1xyXG4vLyAtLS0gRm9ybSBjcmVhdGlvbiBtZXRob2QgLS0tIC8vXHJcbmNvbnN0IGVkaXRQcm9maWxlRm9ybSA9IG5ldyBNb2RhbFdpdGhGb3JtKFwiLm1vZGFsX3R5cGVfZWRpdFwiLCAoZGF0YSkgPT4ge1xyXG4gIHVzZXJJbmZvVmFsdWVzLnNldFVzZXJJbmZvKGVkaXRQcm9maWxlRm9ybS5nZXRJbnB1dFZhbHVlcygpKTtcclxuICBlZGl0UHJvZmlsZUZvcm0uY2xvc2UoKTtcclxufSk7XHJcbi8vIC0tLSBTZXQgZXZlbnQgbGlzdGVuZXJzIGZvciB0aGUgZm9ybSAtLS0gLy9cclxuZWRpdFByb2ZpbGVGb3JtLnNldEV2ZW50TGlzdGVuZXJzKCk7XHJcbi8vIC0tLSBTZXQgdmFsdWVzIGFuZCBvcGVuIHRoZSBmb3JtIC0tLSAvL1xyXG5lZGl0QnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XHJcbiAgZWRpdFByb2ZpbGVGb3JtLnNldElucHV0VmFsdWVzKHVzZXJJbmZvVmFsdWVzLmdldFVzZXJJbmZvKCkpXHJcbiAgcHJvZmlsZUZvcm1WYWxpZGF0aW9uLnJlc2V0VmFsaWRhdGlvbigpO1xyXG4gIGVkaXRQcm9maWxlRm9ybS5vcGVuKCk7XHJcbn0pO1xyXG4vLyA9PT0gJ0FkZCBjYXJkJyBmb3JtID09PSAvL1xyXG4vLyAtLS0gRm9ybSBjcmVhdGlvbiBtZXRob2QgLS0tIC8vXHJcbmNvbnN0IGFkZENhcmRGb3JtID0gbmV3IE1vZGFsV2l0aEZvcm0oXCIubW9kYWxfdHlwZV9hZGQtY2FyZFwiLCAoKSA9PiB7XHJcbiAgY29uc3QgbmV3Q2FyZCA9IGFkZENhcmRGb3JtLmdldElucHV0VmFsdWVzKCk7XHJcbiAgY2FyZHNTZWN0aW9uLnByZXBlbmRJdGVtKGNyZWF0ZUNhcmQobmV3Q2FyZCkpO1xyXG4gIGFkZENhcmRGb3JtLmNsb3NlKCk7XHJcbn0pO1xyXG4vLyAtLS0gU2V0IGV2ZW50IGxpc3RlbmVycyBmb3IgJ2FkZCBjYXJkJyBtb2RhbCAtLS0gLy9cclxuYWRkQ2FyZEZvcm0uc2V0RXZlbnRMaXN0ZW5lcnMoKTtcclxuLy8gLS0tIE9wZW4gdGhlIGZvcm0gLS0tIC8vXHJcbmFkZENhcmRCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcclxuICBhZGRDYXJkRm9ybVZhbGlkYXRpb24ucmVzZXRWYWxpZGF0aW9uKCk7XHJcbiAgYWRkQ2FyZEZvcm0ub3BlbigpO1xyXG59KTtcclxuXHJcbi8vICsrKysrIFZhbGlkYXRpb24gKysrKysgLy9cclxuLy8gLS0tICdFZGl0IHByb2ZpbGUnIGZvcm0gdmFsaWRhdGlvbiBhZGRpbmcgLS0tIC8vXHJcbmNvbnN0IHByb2ZpbGVGb3JtVmFsaWRhdGlvbiA9IG5ldyBGb3JtVmFsaWRhdG9yKGZvcm1Db25maWcsIHByb2ZpbGVNb2RhbCk7XHJcbnByb2ZpbGVGb3JtVmFsaWRhdGlvbi5lbmFibGVWYWxpZGF0aW9uKCk7XHJcbi8vIC0tLSAnQWRkIGNhcmQnIGZvcm0gdmFsaWRhdGlvbiBhZGRpbmcgLS0tIC8vXHJcbmNvbnN0IGFkZENhcmRGb3JtVmFsaWRhdGlvbiA9IG5ldyBGb3JtVmFsaWRhdG9yKGZvcm1Db25maWcsIGFkZENhcmRNb2RhbCk7XHJcbmFkZENhcmRGb3JtVmFsaWRhdGlvbi5lbmFibGVWYWxpZGF0aW9uKCk7IiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgQXBpIHtcclxuICBjb25zdHJ1Y3Rvcih7IGJhc2VVcmwsIGhlYWRlcnMgfSkge1xyXG4gICAgdGhpcy5iYXNlVXJsID0gYmFzZVVybDtcclxuICAgIHRoaXMuaGVhZGVycyA9IGhlYWRlcnM7XHJcbiAgfVxyXG5cclxuICAvLyAtLS0gR0VUIGh0dHBzOi8vYXJvdW5kLm5vbW9yZXBhcnRpZXMuY28vdjEvZ3JvdXAtNDIvY2FyZHMgLS0tIC8vXHJcbiAgZ2V0SW5pdGlhbENhcmRzKCkge1xyXG4gICAgcmV0dXJuIGZldGNoKHRoaXMuYmFzZVVybCArIFwiL2NhcmRzXCIsIHtcclxuICAgICAgaGVhZGVyczogdGhpcy5oZWFkZXJzXHJcbiAgICB9KVxyXG4gICAgLnRoZW4oKHJlcykgPT4ge1xyXG4gICAgICBpZiAocmVzLm9rKSB7XHJcbiAgICAgICAgcmV0dXJuIHJlcy5qc29uKCk7XHJcbiAgICAgIH0gXHJcbiAgICAgIGVsc2Uge1xyXG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChgRXJyb3I6ICR7cmVzLnN0YXR1c31gKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvLyAtLS0gR0VUIGh0dHBzOi8vYXJvdW5kLm5vbW9yZXBhcnRpZXMuY28vdjEvZ3JvdXAtNDIvdXNlcnMvbWUgLS0tIC8vXHJcbiAgZ2V0VXNlckluZm8oKSB7XHJcbiAgICByZXR1cm4gZmV0Y2godGhpcy5iYXNlVXJsICsgXCIvdXNlcnMvbWVcIiwge1xyXG4gICAgICBoZWFkZXJzOiB0aGlzLmhlYWRlcnNcclxuICAgIH0pXHJcbiAgICAudGhlbigocmVzKSA9PiB7XHJcbiAgICAgIGlmIChyZXMub2spIHtcclxuICAgICAgICByZXR1cm4gcmVzLmpzb24oKTtcclxuICAgICAgfSBcclxuICAgICAgZWxzZSB7XHJcbiAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGBFcnJvcjogJHtyZXMuc3RhdHVzfWApO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8vIC0tLSBQT1NUIGh0dHBzOi8vYXJvdW5kLm5vbW9yZXBhcnRpZXMuY28vdjEvZ3JvdXAtNDIvY2FyZHMgLS0tIC8vXHJcbiAgYWRkQ2FyZCh7IG5hbWUsIGxpbmsgfSkge1xyXG4gICAgcmV0dXJuIGZldGNoKHRoaXMuYmFzZVVybCArIFwiL2NhcmRzXCIsIHtcclxuICAgICAgaGVhZGVyczogdGhpcy5oZWFkZXJzLFxyXG4gICAgICBtZXRob2Q6IFwiUE9TVFwiLFxyXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7bmFtZSxsaW5rfSlcclxuICAgIH0pXHJcbiAgICAudGhlbigocmVzKSA9PiB7XHJcbiAgICAgIGlmIChyZXMub2spIHtcclxuICAgICAgICByZXR1cm4gcmVzLmpzb24oKTtcclxuICAgICAgfSBcclxuICAgICAgZWxzZSB7XHJcbiAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGBFcnJvcjogJHtyZXMuc3RhdHVzfWApO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8vIC0tLSBERUxFVEUgaHR0cHM6Ly9hcm91bmQubm9tb3JlcGFydGllcy5jby92MS9ncm91cC00Mi9jYXJkcy9jYXJkSUQgLS0tIC8vXHJcbiAgcmVtb3ZlQ2FyZChjYXJkSUQpIHtcclxuICAgIHJldHVybiBmZXRjaCh0aGlzLmJhc2VVcmwgKyBcIi9jYXJkcy9cIiArIGNhcmRJRCwge1xyXG4gICAgICBoZWFkZXJzOiB0aGlzLmhlYWRlcnMsXHJcbiAgICAgIG1ldGhvZDogXCJERUxFVEVcIlxyXG4gICAgfSlcclxuICAgIC50aGVuKChyZXMpID0+IHtcclxuICAgICAgaWYgKHJlcy5vaykge1xyXG4gICAgICAgIHJldHVybiByZXMuanNvbigpO1xyXG4gICAgICB9IFxyXG4gICAgICBlbHNlIHtcclxuICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoYEVycm9yOiAke3Jlcy5zdGF0dXN9YCk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgZ2V0QXBwSW5mbygpIHtcclxuICAgIHJldHVybiBQcm9taXNlLmFsbChbdGhpcy5nZXRJbml0aWFsQ2FyZHMoKSwgdGhpcy5nZXRVc2VySW5mbygpXSk7XHJcbiAgfVxyXG5cclxuLy8gLS0tIEFkZC9yZW1vdmUgbGlrZXMgLS0tIC8vXHJcbiAgLy8gLS0tIFBVVCBodHRwczovL2Fyb3VuZC5ub21vcmVwYXJ0aWVzLmNvL3YxL2dyb3VwSWQvY2FyZHMvbGlrZXMvY2FyZElkIC0tLSAvL1xyXG4gIGFkZExpa2UoY2FyZCkge1xyXG4gICAgcmV0dXJuIGZldGNoKHRoaXMuYmFzZVVybCArIFwiL2NhcmRzL2xpa2VzL1wiICsgY2FyZC5nZXRJZCgpLCB7XHJcbiAgICAgIGhlYWRlcnM6IHRoaXMuaGVhZGVycyxcclxuICAgICAgbWV0aG9kOiBcIlBVVFwiXHJcbiAgICB9KVxyXG4gICAgLnRoZW4oKHJlcykgPT4ge1xyXG4gICAgICBpZiAocmVzLm9rKSB7XHJcbiAgICAgICAgcmV0dXJuIHJlcy5qc29uKCk7XHJcbiAgICAgIH0gXHJcbiAgICAgIGVsc2Uge1xyXG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChgRXJyb3I6ICR7cmVzLnN0YXR1c31gKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvLyAtLS0gREVMRVRFIGh0dHBzOi8vYXJvdW5kLm5vbW9yZXBhcnRpZXMuY28vdjEvZ3JvdXBJZC9jYXJkcy9saWtlcy9jYXJkSWQgLS0tIC8vXHJcbiAgcmVtb3ZlTGlrZShjYXJkKSB7XHJcbiAgICByZXR1cm4gZmV0Y2godGhpcy5iYXNlVXJsICsgXCIvY2FyZHMvbGlrZXMvXCIgKyBjYXJkLmdldElkKCksIHtcclxuICAgICAgaGVhZGVyczogdGhpcy5oZWFkZXJzLFxyXG4gICAgICBtZXRob2Q6IFwiREVMRVRFXCJcclxuICAgIH0pXHJcbiAgICAudGhlbigocmVzKSA9PiB7XHJcbiAgICAgIGlmIChyZXMub2spIHtcclxuICAgICAgICByZXR1cm4gcmVzLmpzb24oKTtcclxuICAgICAgfSBcclxuICAgICAgZWxzZSB7XHJcbiAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGBFcnJvcjogJHtyZXMuc3RhdHVzfWApO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4vLyAtLS0gRWRpdGluZyBQcm9maWxlIGluZm8gLS0tIC8vXHJcbiAgLy8gLS0tIFBBVENIIGh0dHBzOi8vYXJvdW5kLm5vbW9yZXBhcnRpZXMuY28vdjEvZ3JvdXBJZC91c2Vycy9tZSAtLS0gLy9cclxuICB1cGRhdGVVc2VySW5mbyh7IG5hbWUsIGFib3V0IH0pIHtcclxuICAgIHJldHVybiBmZXRjaCh0aGlzLmJhc2VVcmwgKyBcIi91c2Vycy9tZVwiLCB7XHJcbiAgICAgIGhlYWRlcnM6IHRoaXMuaGVhZGVycyxcclxuICAgICAgbWV0aG9kOiBcIlBBVENIXCIsXHJcbiAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHtuYW1lLGFib3V0fSlcclxuICAgIH0pXHJcbiAgICAudGhlbigocmVzKSA9PiB7XHJcbiAgICAgIGlmIChyZXMub2spIHtcclxuICAgICAgICByZXR1cm4gcmVzLmpzb24oKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoYEVycm9yOiAke3Jlcy5zdGF0dXN9YCk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLy8gUEFUQ0ggaHR0cHM6Ly9hcm91bmQubm9tb3JlcGFydGllcy5jby92MS9ncm91cElkL3VzZXJzL21lL2F2YXRhclxyXG4gIHNldFVzZXJBdmF0YXIoeyBhdmF0YXIgfSkge1xyXG4gICAgcmV0dXJuIGZldGNoKHRoaXMuYmFzZVVybCArIFwiL3VzZXJzL21lL2F2YXRhclwiLCB7XHJcbiAgICAgIGhlYWRlcnM6IHRoaXMuaGVhZGVycyxcclxuICAgICAgbWV0aG9kOiBcIlBBVENIXCIsXHJcbiAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHthdmF0YXJ9KVxyXG4gICAgfSlcclxuICAgIC50aGVuKChyZXMpID0+IHtcclxuICAgICAgaWYgKHJlcy5vaykge1xyXG4gICAgICAgIHJldHVybiByZXMuanNvbigpO1xyXG4gICAgICB9IFxyXG4gICAgICBlbHNlIHtcclxuICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoYEVycm9yOiAke3Jlcy5zdGF0dXN9YCk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxufSIsImltcG9ydCBNb2RhbCBmcm9tIFwiLi9Nb2RhbC5qc1wiO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgTW9kYWxXaXRoSW1hZ2UgZXh0ZW5kcyBNb2RhbCB7XHJcbiAgLy8gLS0tIE9wZW4gYmlnIGltYWdlIG1vZGFsIG1ldGhvZCAtLS0gLy9cclxuICBvcGVudXAgPSAoZXZlbnQpID0+IHtcclxuICAgIGNvbnN0IGJpZ0ltYWdlID0gZXZlbnQudGFyZ2V0O1xyXG4gICAgdGhpcy5fbW9kYWxFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2JpZy1pbWFnZVwiKS5zcmMgPSBiaWdJbWFnZS5zcmM7XHJcbiAgICB0aGlzLl9tb2RhbEVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fYmlnLWltYWdlXCIpLmFsdCA9IGJpZ0ltYWdlLmFsdDtcclxuICAgIHRoaXMuX21vZGFsRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19pbWFnZS1jYXB0aW9uXCIpLnRleHRDb250ZW50ID0gYmlnSW1hZ2UuYWx0O1xyXG5cclxuICAgIHRoaXMub3BlbigpO1xyXG4gIH1cclxufSIsImV4cG9ydCBkZWZhdWx0IGNsYXNzIFVzZXJJbmZvIHtcclxuICBjb25zdHJ1Y3Rvcigge25hbWUsIGpvYiwgYXZhdGFyfSApIHtcclxuICAgIHRoaXMuX25hbWUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGAke25hbWV9YCk7XHJcbiAgICB0aGlzLl9qb2IgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGAke2pvYn1gKTtcclxuICAgIHRoaXMuX2F2YXRhciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYCR7YXZhdGFyfWApO1xyXG4gIH1cclxuXHJcbiAgZ2V0VXNlckluZm8oKSB7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgbmFtZSA6IHRoaXMuX25hbWUudGV4dENvbnRlbnQsXHJcbiAgICBqb2IgOiB0aGlzLl9qb2IudGV4dENvbnRlbnQsXHJcbiAgICBhdmF0YXI6IHRoaXMuX2F2YXRhci5zcmNcclxuICAgIH07XHJcbiAgfVxyXG5cclxuICBzZXRVc2VySW5mbyh1c2VySW5mbykge1xyXG4gICAgY29uc3QgeyBuYW1lLCBqb2IgfSA9IHVzZXJJbmZvO1xyXG4gICAgdGhpcy5fbmFtZS50ZXh0Q29udGVudCA9IG5hbWU7XHJcbiAgICB0aGlzLl9qb2IudGV4dENvbnRlbnQgPSBqb2I7XHJcbiAgfVxyXG5cclxuICBzZXRVc2VyQXZhdGFyKCB7YXZhdGFyfSApIHtcclxuICAgIHRoaXMuX2F2YXRhci5zcmMgPSBhdmF0YXI7XHJcbiAgfVxyXG59XHJcbiJdLCJuYW1lcyI6WyJDYXJkIiwiY29uc3RydWN0b3IiLCJjYXJkRGF0YSIsImlzTGlrZWQiLCJpc093bmVyIiwib25DYXJkQ2xpY2siLCJyZW1vdmVIYW5kbGVyIiwibGlrZUhhbmRsZXIiLCJjYXJkU2VsZWN0b3IiLCJ0aGlzIiwiX25hbWUiLCJuYW1lIiwiX2xpbmsiLCJsaW5rIiwiX2lkIiwiX293bmVySWQiLCJvd25lciIsIl9saWtlcyIsImxpa2VzIiwiX2xpa2VzQ291bnQiLCJsZW5ndGgiLCJfY2FyZFNlbGVjdG9yIiwiX29uQ2FyZENsaWNrIiwiYmluZCIsIl9saWtlSGFuZGxlciIsIl9jbGlja0xpa2VIYW5kbGVyIiwiX3JlbW92ZUhhbmRsZXIiLCJfaXNMaWtlZCIsIl9pc093bmVyIiwiX2dldFRlbXBsYXRlIiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwiY29udGVudCIsImNsb25lTm9kZSIsImxpa2VzQW1vdW50U2V0IiwibGlrZXNDb3VudCIsIl9pdGVtIiwidGV4dENvbnRlbnQiLCJfbGlrZUNhcmQiLCJldmVudCIsImNsYXNzTGlzdCIsInRvZ2dsZSIsInN0b3BJbW1lZGlhdGVQcm9wb2dhdGlvbiIsImRlbGV0ZUNhcmQiLCJyZW1vdmUiLCJfZGVsZXRlQ2FyZEhhbmRsZXIiLCJzdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24iLCJfc2V0RXZlbnRMaXN0ZW5lcnMiLCJhZGRFdmVudExpc3RlbmVyIiwiX2NhcmRJbWFnZSIsImdlbmVyYXRlQ2FyZCIsIl9lbGVtZW50IiwiYWRkIiwic3JjIiwiYWx0IiwiZ2V0SUQiLCJGb3JtVmFsaWRhdG9yIiwiZm9ybUNvbmZpZyIsImZvcm1FbGVtZW50IiwiX2Zvcm1Db25maWciLCJfZm9ybUVsZW1lbnQiLCJfc2hvd0lucHV0RXJyb3IiLCJpbnB1dEVsZW1lbnQiLCJlcnJvck1lc3NhZ2UiLCJpbnB1dEVycm9yQ2xhc3MiLCJlcnJvck1lc3NhZ2VDbGFzcyIsImVycm9yRWxlbWVudCIsImlkIiwiX2hpZGVJbnB1dEVycm9yIiwicmVzZXRWYWxpZGF0aW9uIiwiaW5wdXRzIiwiZm9yRWFjaCIsImlucHV0IiwiX3RvZ2dsZVN1Ym1pdEJ1dHRvbiIsIl9jaGVja0lucHV0IiwidmFsaWRpdHkiLCJ2YWxpZCIsInZhbGlkYXRpb25NZXNzYWdlIiwiX2NoZWNrSWZGb3JtVmFsaWQiLCJldmVyeSIsImluYWN0aXZlQnV0dG9uQ2xhc3MiLCJzdWJtaXRCdXR0b25TZWxlY3RvciIsImJ1dHRvbkVsZW1lbnQiLCJkaXNhYmxlZCIsImlucHV0U2VsZWN0b3IiLCJBcnJheSIsImZyb20iLCJxdWVyeVNlbGVjdG9yQWxsIiwiZW5hYmxlVmFsaWRhdGlvbiIsInByZXZlbnREZWZhdWx0IiwiU2VjdGlvbiIsIml0ZW1zIiwicmVuZGVyZXIiLCJjb250YWluZXJTZWxlY3RvciIsIl9pdGVtcyIsIl9yZW5kZXJlciIsIl9jb250YWluZXIiLCJhZGRJdGVtIiwiZWxlbWVudCIsImFwcGVuZCIsInByZXBlbmRJdGVtIiwicHJlcGVuZCIsInJlbmRlckl0ZW1zIiwiY2FyZCIsImVkaXRCdXR0b24iLCJwcm9maWxlTW9kYWwiLCJmb3JtcyIsInByb2ZpbGUiLCJhZGRDYXJkQnV0dG9uIiwiZWxlbWVudHMiLCJqb2IiLCJhZGRDYXJkTW9kYWwiLCJhZGRDYXJkRm9ybSIsInRpdGxlIiwiZm9ybVNlbGVjdG9yIiwiTW9kYWwiLCJtb2RhbFNlbGVjdG9yIiwiX21vZGFsRWxlbWVudCIsIl9jaGVja0ZvckVzY0Nsb3NlIiwia2V5IiwiY2xvc2UiLCJvcGVuIiwicmVtb3ZlRXZlbnRMaXN0ZW5lciIsInNldEV2ZW50TGlzdGVuZXJzIiwidGFyZ2V0IiwiY29udGFpbnMiLCJNb2RhbFdpdGhGb3JtIiwiaGFuZGxlU3VibWl0Iiwic3VwZXIiLCJfaGFuZGxlU3VibWl0QnRuIiwiZ2V0SW5wdXRWYWx1ZXMiLCJpbnB1dExpc3QiLCJpbnB1dFZhbHVlcyIsInZhbHVlIiwic2V0SW5wdXRWYWx1ZXMiLCJ2YWx1ZXMiLCJyZXNldCIsImFwaSIsImJhc2VVcmwiLCJoZWFkZXJzIiwiZ2V0SW5pdGlhbENhcmRzIiwiZmV0Y2giLCJ0aGVuIiwicmVzIiwib2siLCJqc29uIiwiUHJvbWlzZSIsInJlamVjdCIsInN0YXR1cyIsImdldFVzZXJJbmZvIiwiYWRkQ2FyZCIsIm1ldGhvZCIsImJvZHkiLCJKU09OIiwic3RyaW5naWZ5IiwicmVtb3ZlQ2FyZCIsImNhcmRJRCIsImdldEFwcEluZm8iLCJhbGwiLCJhZGRMaWtlIiwiZ2V0SWQiLCJyZW1vdmVMaWtlIiwidXBkYXRlVXNlckluZm8iLCJhYm91dCIsInNldFVzZXJBdmF0YXIiLCJhdmF0YXIiLCJhdXRob3JpemF0aW9uIiwicmVuZGVyQ2FyZCIsImluaXRDYXJkIiwidXNlciIsInNlbGVjdG9yIiwibGlzdExpa2VzIiwidW5kZWZpbmVkIiwiZmluZCIsIml0ZW0iLCJjbGlja0NhcmRIYW5kbGVyIiwiY2FyZEluZm8iLCJpbWFnZVBvcHVwIiwiZGVsZXRlQ2FyZEhhbmRsZXIiLCJkZWxldGVDb25maXJtIiwiUG9wdXBEZWxldGVDb25maXJtIiwiY2F0Y2giLCJlcnIiLCJjb25zb2xlIiwibG9nIiwiZmluYWxseSIsImxpa2VDYXJkSGFuZGxlciIsInNldExpa2VzIiwiaW5pdGlhbENhcmRzIiwidXNlckluZm8iLCJjYXJkc1NlY3Rpb24iLCJkYXRhIiwiaW5pdGlhbENhcmQiLCJzZXRJdGVtcyIsInNldFVzZXJJbmZvIiwibW9kYWxBZGRDYXJkIiwibmV3Q2FyZCIsImJ0bkFkZENhcmQiLCJwb3B1cEFkZENhcmQiLCJhZGRDYXJkVmFsaWRhdG9yIiwiY2hhbmdlU3RhdGVTdWJtaXQiLCJvcGVudXAiLCJiaWdJbWFnZSIsInVzZXJJbmZvVmFsdWVzIiwiX2pvYiIsIl9hdmF0YXIiLCJlZGl0UHJvZmlsZUZvcm0iLCJwcm9maWxlRm9ybVZhbGlkYXRpb24iLCJjcmVhdGVDYXJkIiwiYWRkQ2FyZEZvcm1WYWxpZGF0aW9uIl0sInNvdXJjZVJvb3QiOiIifQ==