!function(){"use strict";class e{constructor({cardData:e,user:t,onCardClick:r,removeHandler:s,likeHandler:o},i){this._name=e.name,this._link=e.link,this._cardId=e._id,this._ownerId=e.owner._id,this._userID=t,this._likes=e.likes,this._cardSelector=i,this._onCardClick=r,this._likeHandler=o,this._removeHandler=s}_getTemplate(){return document.querySelector("#card__template").content.querySelector(".card").cloneNode(!0)}deleteCard(){this._item.remove(),this._item=null}_renderLikes(){this.isLiked()?this._item.querySelector(".card__like-button").classList.add("card__like-button_active"):this._item.querySelector(".card__like-button").classList.remove("card__like-button_active"),this._item.querySelector(".card__like-counter").textContent=this._likes.length}isLiked(){return this._likes.some((e=>e._id===this._userId))}updateLikes(e){this._likes=e,this._renderLikes()}_setEventListeners(){this._item.querySelector(".card__like-button").addEventListener("click",(e=>{this._likeCard(e)})),this._item.querySelector(".card__delete-button").addEventListener("click",(()=>{this._removeHandler(this._cardId)})),this._cardImage.addEventListener("click",(e=>{this._onCardClick(e)}))}generateCard(){return this._item=this._getTemplate(),this._ownerId!==this._userId&&this._element.querySelector(".card__delete-button").classList.add("card__delete-button_hidden"),this._cardImage=this._item.querySelector(".card__image"),this._item.querySelector(".card__title").textContent=this._name,this._cardImage.src=this._link,this._cardImage.alt=`Image of  ${this._name} `,this._renderLikes(),this._setEventListeners(),this._item}}class t{constructor(e,t){this._formConfig=e,this._formElement=t}_showInputError=(e,t)=>{const{inputErrorClass:r,errorMessageClass:s}=this._formConfig,o=this._formElement.querySelector(` #${e.id}_error `);o.textContent=t,o.classList.add(s),e.classList.add(r)};_hideInputError=e=>{const{inputErrorClass:t,errorMessageClass:r}=this._formConfig,s=this._formElement.querySelector(` #${e.id}_error `);s.textContent="",s.classList.remove(r),e.classList.remove(t)};resetValidation(){this.inputs.forEach((e=>{this._hideInputError(e)})),this._toggleSubmitButton()}_checkInput=e=>{e.validity.valid?this._hideInputError(e):this._showInputError(e,e.validationMessage)};_checkIfFormValid=()=>this.inputs.every((e=>e.validity.valid));_toggleSubmitButton(){const{inactiveButtonClass:e,submitButtonSelector:t}=this._formConfig,r=this._formElement.querySelector(t);this._checkIfFormValid()?(r.disabled=!1,r.classList.remove(e)):(r.disabled=!0,r.classList.add(e))}_setEventListeners=()=>{const{inputSelector:e}=this._formConfig;return this.inputs=Array.from(this._formElement.querySelectorAll(e)),this.inputs.forEach((e=>{e.addEventListener("input",(()=>{this._checkInput(e),this._toggleSubmitButton()}))})),this._formElement};enableValidation(){this._formElement.addEventListener("submit",(e=>{e.preventDefault()})),this._setEventListeners()}}class r{constructor({items:e,renderer:t},r){this._items=e,this._renderer=t,this._container=document.querySelector(r)}addItem(e){this._container.prepend(e)}clear(){this._container.innerHTML=""}renderItems(){this.clear(),this._items.forEach((e=>{this._renderer(e)}))}}const s=document.querySelector(".profile__edit-button"),o=document.forms.profile,i=document.querySelector(".profile__title"),n=(o.elements.name,document.querySelector(".profile__subtitle")),a=(o.elements.job,document.querySelector(".modal__close-button_type_edit"),document.querySelector(".profile__image")),l=document.querySelector(".profile__image-edit"),c=document.forms.avatar,d=(c.elements.link,document.querySelector(".modal__close-button_type_avatar"),document.querySelector(".profile__add-button")),_=document.querySelector(".modal_type_add-card"),m=(document.querySelector(".modal__input_type_name"),document.querySelector(".modal__input_type_link"),document.querySelector(".modal__close-button_type_add-card"),document.forms.add),u=(m.elements.title,m.elements.link,document.querySelector(".modal__submit-button"),document.querySelector(".cards__grid"),document.querySelector(".modal_type_big-image")),h=(document.querySelector(".modal__big-image"),document.querySelector(".modal__image-caption"),document.querySelector(".modal__close-button_type_big-image"),document.querySelector(".modal_type_delete-card")),b={formSelector:".modal__container",inputSelector:".modal__input",submitButtonSelector:".modal__submit-button",inactiveButtonClass:"modal__submit-button_disabled",inputErrorClass:"modal__input_error",errorMessageClass:"modal__error_visible"};class f{constructor(e){this._modalSelector=e,this._checkForEscClose=this._checkForEscClose.bind(this)}_checkForEscClose=e=>{"Escape"===e.key&&this.close()};open=()=>{this._modalSelector.classList.add("modal_visible"),document.addEventListener("keyup",this._checkForEscClose)};close=()=>{this._modalSelector.classList.remove("modal_visible"),document.removeEventListener("keyup",this._checkForEscClose)};setEventListeners(){this._modalSelector.querySelector(".modal__close-button").addEventListener("click",(e=>{this.close(e)})),this._modalSelector.addEventListener("click",(e=>{e.target.classList.contains("modal_visible")&&this.close(e)}))}}class k extends f{constructor(e,t){super(e),this._handleSubmitBtn=t,this._formElement=e.querySelector(".modal__container")}getInputValues(){const e=Array.from(this._formElement.querySelectorAll(".modal__input")),t={};return e.forEach((e=>{t[e.name]=e.value})),t}setInputValues(e){Array.from(this._formElement.querySelectorAll(".modal__input")).forEach((t=>{t.value=e[t.name]}))}saving(e){this._formElement.querySelector(".modal__submit-button").textContent=e?"Saving...":"Save"}setEventListeners(){super.setEventListeners(),this._formElement.addEventListener("submit",(()=>{this._handleSubmitBtn(this.getInputValues()),this.close()}))}close(){super.close(),this._formElement.reset()}}class p{constructor(e,t,r){this._name=e,this._job=t,this._avatar=r}getUserInfo(){return this._userInfo={title:this._title.textContent,job:this._job.textContent}}setUserInfo(e,t,r){this._userInfo={title:e,job:t,userAvatar:r},r?(avatarImage.src=this._userInfo.userAvatar,profileName.textContent=this._userInfo.title,profileJob.textContent=this._userInfo.job):(profileName.textContent=this._userInfo.title,profileJob.textContent=this._userInfo.job)}}const v=new class extends f{openup=e=>{const t=e.target;this._modalElement.querySelector(".modal__big-image").src=t.src,this._modalElement.querySelector(".modal__big-image").alt=t.alt,this._modalElement.querySelector(".modal__image-caption").textContent=t.alt,this.open()}}(u);v.setEventListeners();const g=new k(h);function S(e,t){t.querySelector(".modal__submit-button").textContent=e?"Saving...":"Save"}g.setEventListeners();const E=new class{constructor({baseUrl:e,headers:t}){this._baseUrl=e,this._headers=t}getCardList(){return fetch(this._baseUrl+"/cards",{headers:this._headers}).then((function(e){if(e.ok)return e.json().then((e=>e));Promise.reject("Error!"+e.statusText)}))}getUserInfo(){return fetch(this._baseUrl+"/users/me",{headers:this._headers}).then((e=>e.ok?e.json():Promise.reject("Error!"+e.statusText)))}getAppInfo(){return Promise.all([this.getUserInfo(),this.getCardList()])}addCard({name:e,link:t}){return fetch(this._baseUrl+"/cards",{headers:this._headers,method:"POST",body:JSON.stringify({name:e,link:t})}).then((e=>{if(e.ok)return e.json();Promise.reject("Error!"+e.statusText)}))}removeCard(e){return fetch(this._baseUrl+"/cards/"+e,{headers:this._headers,method:"DELETE"}).then((e=>e.ok?e.json():Promise.reject("Error!"+e.statusText)))}addLike(e){return fetch(this._baseUrl+"/cards/likes/"+e,{headers:this._headers,method:"PUT"}).then((e=>{if(e.ok)return e.json();Promise.reject("Error!"+e.statusText)}))}removeLike(e){return fetch(this._baseUrl+"/cards/likes/"+e,{headers:this._headers,method:"DELETE"}).then((e=>e.ok?e.json():Promise.reject("Error!"+e.statusText)))}setUserInfo({name:e,job:t}){return fetch(this._baseUrl+"/users/me",{headers:this._headers,method:"PATCH",body:JSON.stringify({name:e,job:t})}).then((e=>e.ok?e.json():Promise.reject("Error!"+e.statusText+e.status)))}setUserAvatar({avatar:e}){return fetch(this._baseUrl+"/users/me/avatar",{headers:this._headers,method:"PATCH",body:JSON.stringify({avatar:e})}).then((e=>e.ok?e.json():Promise.reject("Error!"+e.statusText)))}updateUserInfo({name:e,job:t}){return fetch(this._baseUrl+"/users/me",{headers:this._headers,method:"PATCH",body:JSON.stringify({name:e,job:t})}).then((e=>e.ok?e.json():Promise.reject("Error!"+e.statusText)))}}({baseUrl:"https://around.nomoreparties.co/v1/group-6",headers:{authorization:"709a0d9d-db06-4890-a594-b07e7309a353","Content-Type":"application/json"}});E.getAppInfo().then((([t,o])=>{const l=new r({items:o,renderer:m},".cards__grid");E.getUserInfo().then((e=>{u.setUserInfo(e.name,e.job,e.avatar)})),l.renderItems();const c=new k({modalSelector:_,modalSubmition:e=>{S(!0,addImageModal),E.addCard(e).then((e=>{console.log(e),m(e),c.close(),S(!1,addImageModal)})).catch((e=>console.log(e)))}});function m(r){const s=new e({data:r,handleCardClick:({name:e,link:t})=>{v.open(t,e)},handleDeleteClick:e=>{g.open(e),g.setSubmitHandler((()=>{E.removeCard(e).then((()=>{s.deleteCard(),g.close()})).catch((e=>console.log(e)))}))},likeHandler:e=>{o.querySelector(".card__like-button").classList.contains("card__like-button_active")?E.deleteLike(e).then((e=>{o.querySelector(".card__like-button").classList.remove("card__like-button_active"),s.showLikes(e.likes.length),s._likes=e.likes})).catch((e=>console.log(e))):(s._cardElement.classList.toggle("card__like-button_active"),E.addLike(e).then((e=>{o.querySelector(".card__like-button").classList.add("card__like-button_active"),s.showLikes(e.likes.length),s._likes=e.likes})).catch((e=>console.log(e))))}},t._id,".card__template"),o=s.generateCard();l.addItem(o),S(!0,addImageModal)}d.addEventListener("click",(()=>{c.open(),S(!1,addImageModal)})),c.setEventListeners();const u=new p(i,n,a),h=new k({modalSelector:editProfileModal,modalSubmition:e=>{S(!0,editProfileModal),E.setUserInfos({name:e.title,about:e.desc}).then((e=>{S(!1,editProfileModal),u.setUserInfo(e.name,e.about),h.close(),console.log(e)})).catch((e=>console.log(e)))}});h.setEventListeners(),s.addEventListener("click",(()=>{h.open();const e=u.getUserInfo();inputName.value=e.title,inputJob.value=e.job}))})).catch((e=>console.log(e)));const y=new k({modalSelector:c,modalSubmition:e=>{!function(e){S(!0,c),E.setUserAvatar({avatar:e.avatarURL}).then((e=>{a.src=e.avatar,S(!1,c),y.close()})).catch((e=>console.log(e)))}(e)}});l.addEventListener("click",(()=>{y.open()})),y.setEventListeners(),new t(b,o).enableValidation(),new t(b,c).enableValidation(),new t(b,_).enableValidation()}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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Z0QsWUFFZHBELE1BQUtDLElBQ0ozRCxFQUFBQSxJQUFrQjJELEVBQUl2RCxPQUN0QjRDLEdBQWEsRUFBTzdDLEdBQ3BCMEcsRUFBVzNGLFdBRVp5RSxPQUFNQyxHQUFPSCxRQUFRQyxJQUFJRSxLQU14Qm1CLENBQWlCakQsTUFJckI1RCxFQUFpQmpFLGlCQUFpQixTQUFTLEtBQ3pDNEssRUFBVzFGLFVBR2IwRixFQUFXeEYsb0JBSW1CLElBQUk1RSxFQUFjQyxFQUFZZ0QsR0FDdENqQixtQkFFTyxJQUFJaEMsRUFBY0MsRUFBWXlELEdBQ3RDMUIsbUJBRVMsSUFBSWhDLEVBQWNDLEVBQVk0RCxHQUN0QzdCLG1CIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfNC8uL3NyYy9jb21wb25lbnRzL3NjcmlwdHMvQ2FyZC5qcyIsIndlYnBhY2s6Ly93ZWJfcHJvamVjdF80Ly4vc3JjL2NvbXBvbmVudHMvc2NyaXB0cy9Gb3JtVmFsaWRhdG9yLmpzIiwid2VicGFjazovL3dlYl9wcm9qZWN0XzQvLi9zcmMvY29tcG9uZW50cy9zY3JpcHRzL1NlY3Rpb24uanMiLCJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfNC8uL3NyYy9jb21wb25lbnRzL3V0aWxzL2NvbnN0YW50cy5qcyIsIndlYnBhY2s6Ly93ZWJfcHJvamVjdF80Ly4vc3JjL2NvbXBvbmVudHMvc2NyaXB0cy9Nb2RhbC5qcyIsIndlYnBhY2s6Ly93ZWJfcHJvamVjdF80Ly4vc3JjL2NvbXBvbmVudHMvc2NyaXB0cy9Nb2RhbFdpdGhGb3JtLmpzIiwid2VicGFjazovL3dlYl9wcm9qZWN0XzQvLi9zcmMvY29tcG9uZW50cy9zY3JpcHRzL1VzZXJJbmZvLmpzIiwid2VicGFjazovL3dlYl9wcm9qZWN0XzQvLi9zcmMvcGFnZXMvSW5kZXguanMiLCJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfNC8uL3NyYy9jb21wb25lbnRzL3NjcmlwdHMvTW9kYWxXaXRoSW1hZ2UuanMiLCJ3ZWJwYWNrOi8vd2ViX3Byb2plY3RfNC8uL3NyYy9jb21wb25lbnRzL3NjcmlwdHMvQXBpLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImV4cG9ydCBjbGFzcyBDYXJkIHtcclxuICBjb25zdHJ1Y3RvcihcclxuICAgIHsgY2FyZERhdGEsIHVzZXIsIG9uQ2FyZENsaWNrLCByZW1vdmVIYW5kbGVyLCBsaWtlSGFuZGxlciB9LFxyXG4gICAgY2FyZFNlbGVjdG9yXHJcbiAgKSB7XHJcbiAgICB0aGlzLl9uYW1lID0gY2FyZERhdGEubmFtZTtcclxuICAgIHRoaXMuX2xpbmsgPSBjYXJkRGF0YS5saW5rO1xyXG4gICAgdGhpcy5fY2FyZElkID0gY2FyZERhdGEuX2lkO1xyXG4gICAgdGhpcy5fb3duZXJJZCA9IGNhcmREYXRhLm93bmVyLl9pZDtcclxuICAgIHRoaXMuX3VzZXJJRCA9IHVzZXI7XHJcbiAgICB0aGlzLl9saWtlcyA9IGNhcmREYXRhLmxpa2VzO1xyXG4gICAgdGhpcy5fY2FyZFNlbGVjdG9yID0gY2FyZFNlbGVjdG9yO1xyXG5cclxuICAgIHRoaXMuX29uQ2FyZENsaWNrID0gb25DYXJkQ2xpY2s7XHJcbiAgICB0aGlzLl9saWtlSGFuZGxlciA9IGxpa2VIYW5kbGVyO1xyXG4gICAgdGhpcy5fcmVtb3ZlSGFuZGxlciA9IHJlbW92ZUhhbmRsZXI7XHJcbiAgfVxyXG4gIC8vIC0tLSBHZXR0aW5nIHRoZSB0ZW1wbGF0ZSAtLS0gLy9cclxuICBfZ2V0VGVtcGxhdGUoKSB7XHJcbiAgICBjb25zdCBjYXJkID0gZG9jdW1lbnRcclxuICAgICAgLnF1ZXJ5U2VsZWN0b3IoXCIjY2FyZF9fdGVtcGxhdGVcIilcclxuICAgICAgLmNvbnRlbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkXCIpXHJcbiAgICAgIC5jbG9uZU5vZGUodHJ1ZSk7XHJcbiAgICByZXR1cm4gY2FyZDtcclxuICB9XHJcblxyXG4gIC8vIC0tLSBDYXJkIGRlbGV0aW5nIG1ldGhvZCAtLS0gLy9cclxuICBkZWxldGVDYXJkKCkge1xyXG4gICAgdGhpcy5faXRlbS5yZW1vdmUoKTtcclxuICAgIHRoaXMuX2l0ZW0gPSBudWxsO1xyXG4gIH1cclxuXHJcbiAgX3JlbmRlckxpa2VzKCkge1xyXG4gICAgaWYgKHRoaXMuaXNMaWtlZCgpKSB7XHJcbiAgICAgIHRoaXMuX2l0ZW1cclxuICAgICAgICAucXVlcnlTZWxlY3RvcihcIi5jYXJkX19saWtlLWJ1dHRvblwiKVxyXG4gICAgICAgIC5jbGFzc0xpc3QuYWRkKFwiY2FyZF9fbGlrZS1idXR0b25fYWN0aXZlXCIpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGhpcy5faXRlbVxyXG4gICAgICAgIC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX2xpa2UtYnV0dG9uXCIpXHJcbiAgICAgICAgLmNsYXNzTGlzdC5yZW1vdmUoXCJjYXJkX19saWtlLWJ1dHRvbl9hY3RpdmVcIik7XHJcbiAgICB9XHJcbiAgICB0aGlzLl9pdGVtLnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9fbGlrZS1jb3VudGVyXCIpLnRleHRDb250ZW50ID1cclxuICAgICAgdGhpcy5fbGlrZXMubGVuZ3RoO1xyXG4gIH1cclxuXHJcbiAgLy8gLS0tIENoZWNrIGlmIGNhcmQgbGlrZWQgYnkgYW5vdGhlciB1c2VyIC0tLSAvL1xyXG4gIGlzTGlrZWQoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5fbGlrZXMuc29tZSgodXNlcikgPT4gdXNlci5faWQgPT09IHRoaXMuX3VzZXJJZCk7XHJcbiAgfVxyXG5cclxuICAvLyAtLS0gVG9nZ2xlIGxpa2UgYnV0dG9uIG1ldGhvZCAtLS0gLy9cclxuICB1cGRhdGVMaWtlcyhuZXdMaWtlcykge1xyXG4gICAgdGhpcy5fbGlrZXMgPSBuZXdMaWtlcztcclxuICAgIHRoaXMuX3JlbmRlckxpa2VzKCk7XHJcbiAgfVxyXG5cclxuICAvLyAtLS0gU2V0IGV2ZW50cyBsaXN0ZW5lcnMgZm9yIHRoZSBjYXJkcyB0aGF0IHdpbGwgYmUgY3JlYXRlZCEgLS0tIC8vXHJcbiAgX3NldEV2ZW50TGlzdGVuZXJzKCkge1xyXG4gICAgdGhpcy5faXRlbVxyXG4gICAgICAucXVlcnlTZWxlY3RvcihcIi5jYXJkX19saWtlLWJ1dHRvblwiKVxyXG4gICAgICAuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIChldmVudCkgPT4ge1xyXG4gICAgICAgIHRoaXMuX2xpa2VDYXJkKGV2ZW50KTtcclxuICAgICAgfSk7XHJcblxyXG4gICAgdGhpcy5faXRlbVxyXG4gICAgICAucXVlcnlTZWxlY3RvcihcIi5jYXJkX19kZWxldGUtYnV0dG9uXCIpXHJcbiAgICAgIC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xyXG4gICAgICAgIHRoaXMuX3JlbW92ZUhhbmRsZXIodGhpcy5fY2FyZElkKTtcclxuICAgICAgfSk7XHJcblxyXG4gICAgdGhpcy5fY2FyZEltYWdlLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoZXZlbnQpID0+IHtcclxuICAgICAgdGhpcy5fb25DYXJkQ2xpY2soZXZlbnQpO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvLyAtLS0gQ3JlYXRpbmcgdGhlIGNhcmQgYW5kIGNhcmQgZWxlbWVudHMgLS0tIC8vXHJcbiAgZ2VuZXJhdGVDYXJkKCkge1xyXG4gICAgdGhpcy5faXRlbSA9IHRoaXMuX2dldFRlbXBsYXRlKCk7XHJcblxyXG4gICAgaWYgKHRoaXMuX293bmVySWQgIT09IHRoaXMuX3VzZXJJZCkge1xyXG4gICAgICB0aGlzLl9lbGVtZW50XHJcbiAgICAgICAgLnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9fZGVsZXRlLWJ1dHRvblwiKVxyXG4gICAgICAgIC5jbGFzc0xpc3QuYWRkKFwiY2FyZF9fZGVsZXRlLWJ1dHRvbl9oaWRkZW5cIik7XHJcbiAgICB9XHJcblxyXG4gICAgdGhpcy5fY2FyZEltYWdlID0gdGhpcy5faXRlbS5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX2ltYWdlXCIpO1xyXG4gICAgdGhpcy5faXRlbS5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX3RpdGxlXCIpLnRleHRDb250ZW50ID0gdGhpcy5fbmFtZTtcclxuICAgIHRoaXMuX2NhcmRJbWFnZS5zcmMgPSB0aGlzLl9saW5rO1xyXG4gICAgdGhpcy5fY2FyZEltYWdlLmFsdCA9IFwiSW1hZ2Ugb2YgXCIgKyBgICR7dGhpcy5fbmFtZX0gYDtcclxuICAgIHRoaXMuX3JlbmRlckxpa2VzKCk7XHJcblxyXG4gICAgdGhpcy5fc2V0RXZlbnRMaXN0ZW5lcnMoKTtcclxuXHJcbiAgICByZXR1cm4gdGhpcy5faXRlbTtcclxuICB9XHJcbn1cclxuIiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgRm9ybVZhbGlkYXRvciB7XHJcbiAgY29uc3RydWN0b3IoZm9ybUNvbmZpZywgZm9ybUVsZW1lbnQpIHtcclxuICAgIHRoaXMuX2Zvcm1Db25maWcgPSBmb3JtQ29uZmlnO1xyXG4gICAgdGhpcy5fZm9ybUVsZW1lbnQgPSBmb3JtRWxlbWVudDtcclxuICB9XHJcblxyXG4gIF9zaG93SW5wdXRFcnJvciA9IChpbnB1dEVsZW1lbnQsIGVycm9yTWVzc2FnZSkgPT4ge1xyXG4gICAgY29uc3QgeyBpbnB1dEVycm9yQ2xhc3MsIGVycm9yTWVzc2FnZUNsYXNzIH0gPSB0aGlzLl9mb3JtQ29uZmlnO1xyXG4gICAgY29uc3QgZXJyb3JFbGVtZW50ID0gdGhpcy5fZm9ybUVsZW1lbnQucXVlcnlTZWxlY3RvcihgICMke2lucHV0RWxlbWVudC5pZH1fZXJyb3IgYCk7XHJcbiAgICBlcnJvckVsZW1lbnQudGV4dENvbnRlbnQgPSBlcnJvck1lc3NhZ2U7XHJcbiAgICBlcnJvckVsZW1lbnQuY2xhc3NMaXN0LmFkZChlcnJvck1lc3NhZ2VDbGFzcyk7XHJcbiAgICBpbnB1dEVsZW1lbnQuY2xhc3NMaXN0LmFkZChpbnB1dEVycm9yQ2xhc3MpO1xyXG4gIH07XHJcbiAgXHJcbiAgX2hpZGVJbnB1dEVycm9yID0gKGlucHV0RWxlbWVudCkgPT4ge1xyXG4gICAgY29uc3QgeyBpbnB1dEVycm9yQ2xhc3MsIGVycm9yTWVzc2FnZUNsYXNzIH0gPSB0aGlzLl9mb3JtQ29uZmlnO1xyXG4gICAgY29uc3QgZXJyb3JFbGVtZW50ID0gdGhpcy5fZm9ybUVsZW1lbnQucXVlcnlTZWxlY3RvcihgICMke2lucHV0RWxlbWVudC5pZH1fZXJyb3IgYCk7XHJcbiAgICBlcnJvckVsZW1lbnQudGV4dENvbnRlbnQgPSBcIlwiO1xyXG4gICAgZXJyb3JFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoZXJyb3JNZXNzYWdlQ2xhc3MpO1xyXG4gICAgaW5wdXRFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoaW5wdXRFcnJvckNsYXNzKTtcclxuICB9O1xyXG5cclxuICByZXNldFZhbGlkYXRpb24oKSB7XHJcbiAgICB0aGlzLmlucHV0cy5mb3JFYWNoKChpbnB1dCkgPT4ge1xyXG4gICAgICB0aGlzLl9oaWRlSW5wdXRFcnJvcihpbnB1dCk7XHJcbiAgICB9KTtcclxuICAgIHRoaXMuX3RvZ2dsZVN1Ym1pdEJ1dHRvbigpO1xyXG4gIH1cclxuXHJcbiAgX2NoZWNrSW5wdXQgPSAoaW5wdXRFbGVtZW50KSA9PiB7XHJcbiAgICBpZiAoIWlucHV0RWxlbWVudC52YWxpZGl0eS52YWxpZCkge1xyXG4gICAgICB0aGlzLl9zaG93SW5wdXRFcnJvcihpbnB1dEVsZW1lbnQsIGlucHV0RWxlbWVudC52YWxpZGF0aW9uTWVzc2FnZSk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB0aGlzLl9oaWRlSW5wdXRFcnJvcihpbnB1dEVsZW1lbnQpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgX2NoZWNrSWZGb3JtVmFsaWQgPSAoKSA9PiB0aGlzLmlucHV0cy5ldmVyeSgoaW5wdXQpID0+IGlucHV0LnZhbGlkaXR5LnZhbGlkKTtcclxuXHJcbiAgX3RvZ2dsZVN1Ym1pdEJ1dHRvbigpIHtcclxuICAgIGNvbnN0IHsgaW5hY3RpdmVCdXR0b25DbGFzcywgc3VibWl0QnV0dG9uU2VsZWN0b3IgfSA9IHRoaXMuX2Zvcm1Db25maWc7XHJcbiAgICBjb25zdCBidXR0b25FbGVtZW50ID0gdGhpcy5fZm9ybUVsZW1lbnQucXVlcnlTZWxlY3RvcihzdWJtaXRCdXR0b25TZWxlY3Rvcik7XHJcblxyXG4gICAgaWYgKHRoaXMuX2NoZWNrSWZGb3JtVmFsaWQoKSkge1xyXG4gICAgICBidXR0b25FbGVtZW50LmRpc2FibGVkID0gZmFsc2U7XHJcbiAgICAgIGJ1dHRvbkVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZShpbmFjdGl2ZUJ1dHRvbkNsYXNzKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGJ1dHRvbkVsZW1lbnQuZGlzYWJsZWQgPSB0cnVlO1xyXG4gICAgICBidXR0b25FbGVtZW50LmNsYXNzTGlzdC5hZGQoaW5hY3RpdmVCdXR0b25DbGFzcyk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBfc2V0RXZlbnRMaXN0ZW5lcnMgPSAoKSA9PiB7XHJcbiAgICBjb25zdCB7IGlucHV0U2VsZWN0b3IgfSA9IHRoaXMuX2Zvcm1Db25maWc7XHJcbiAgICB0aGlzLmlucHV0cyA9IEFycmF5LmZyb20odGhpcy5fZm9ybUVsZW1lbnQucXVlcnlTZWxlY3RvckFsbChpbnB1dFNlbGVjdG9yKSk7XHJcblxyXG4gICAgdGhpcy5pbnB1dHMuZm9yRWFjaCgoaW5wdXQpID0+IHtcclxuICAgICAgaW5wdXQuYWRkRXZlbnRMaXN0ZW5lcihcImlucHV0XCIsICgpID0+IHtcclxuICAgICAgICB0aGlzLl9jaGVja0lucHV0KGlucHV0KTtcclxuICAgICAgICB0aGlzLl90b2dnbGVTdWJtaXRCdXR0b24oKTtcclxuICAgICAgfSk7XHJcbiAgICB9KTtcclxuICAgIHJldHVybiB0aGlzLl9mb3JtRWxlbWVudDtcclxuICB9O1xyXG5cclxuICBlbmFibGVWYWxpZGF0aW9uKCkge1xyXG4gICAgdGhpcy5fZm9ybUVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCAoZXZlbnQpID0+IHtcclxuICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcclxuICAgIH0pO1xyXG4gICAgdGhpcy5fc2V0RXZlbnRMaXN0ZW5lcnMoKTtcclxuICB9XHJcbn0iLCJleHBvcnQgZGVmYXVsdCBjbGFzcyBTZWN0aW9uIHtcclxuICBjb25zdHJ1Y3Rvcih7IGl0ZW1zLCByZW5kZXJlciB9LCBjb250YWluZXJTZWxlY3Rvcikge1xyXG4gICAgdGhpcy5faXRlbXMgPSBpdGVtcztcclxuICAgIHRoaXMuX3JlbmRlcmVyID0gcmVuZGVyZXI7XHJcbiAgICB0aGlzLl9jb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGNvbnRhaW5lclNlbGVjdG9yKTtcclxuICB9XHJcblxyXG4gIGFkZEl0ZW0oZWxlbWVudCkge1xyXG4gICAgdGhpcy5fY29udGFpbmVyLnByZXBlbmQoZWxlbWVudCk7XHJcbiAgfVxyXG5cclxuICBjbGVhciAoKSB7XHJcbiAgICB0aGlzLl9jb250YWluZXIuaW5uZXJIVE1MID0gJyc7XHJcbiAgfVxyXG5cclxuICByZW5kZXJJdGVtcygpIHtcclxuICAgIHRoaXMuY2xlYXIoKTtcclxuICAgIFxyXG4gICAgdGhpcy5faXRlbXMuZm9yRWFjaCgoY2FyZCkgPT4ge1xyXG4gICAgICB0aGlzLl9yZW5kZXJlcihjYXJkKTtcclxuICAgIH0pO1xyXG4gIH1cclxufVxyXG4iLCIvLyAtLS0gJ0VkaXQgcHJvZmlsZScgbW9kYWwgY29uc3RzIC0tLSAvL1xyXG5leHBvcnQgY29uc3QgZWRpdEJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wcm9maWxlX19lZGl0LWJ1dHRvbicpO1xyXG5leHBvcnQgY29uc3QgcHJvZmlsZU1vZGFsID0gZG9jdW1lbnQuZm9ybXMucHJvZmlsZTtcclxuZXhwb3J0IGNvbnN0IHByb2ZpbGVOYW1lID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnByb2ZpbGVfX3RpdGxlJyk7XHJcbmV4cG9ydCBjb25zdCBuYW1lSW5wdXQgPSBwcm9maWxlTW9kYWwuZWxlbWVudHMubmFtZTtcclxuZXhwb3J0IGNvbnN0IHByb2ZpbGVKb2IgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucHJvZmlsZV9fc3VidGl0bGUnKTtcclxuZXhwb3J0IGNvbnN0IGpvYklucHV0ID0gcHJvZmlsZU1vZGFsLmVsZW1lbnRzLmpvYjtcclxuZXhwb3J0IGNvbnN0IGVkaXRDbG9zZUJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbF9fY2xvc2UtYnV0dG9uX3R5cGVfZWRpdCcpO1xyXG4vLyAtLS0gJ0F2YXRhclwiIG1vZGFsIGNvbnN0cyAtLS0gLy9cclxuZXhwb3J0IGNvbnN0IGF2YXRhckltYWdlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnByb2ZpbGVfX2ltYWdlJyk7XHJcbmV4cG9ydCBjb25zdCBhdmF0YXJFZGl0QnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnByb2ZpbGVfX2ltYWdlLWVkaXQnKTtcclxuZXhwb3J0IGNvbnN0IGF2YXRhck1vZGFsID0gZG9jdW1lbnQuZm9ybXMuYXZhdGFyO1xyXG5leHBvcnQgY29uc3QgYXZhdGFyTW9kYWxJbnB1dCA9IGF2YXRhck1vZGFsLmVsZW1lbnRzLmxpbms7XHJcbmV4cG9ydCBjb25zdCBhdmF0YXJDbG9zZUJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbF9fY2xvc2UtYnV0dG9uX3R5cGVfYXZhdGFyJylcclxuLy8gLS0tICdBZGQtY2FyZCcgbW9kYWwgY29uc3RzIC0tLSAvL1xyXG5leHBvcnQgY29uc3QgYWRkQ2FyZEJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wcm9maWxlX19hZGQtYnV0dG9uJyk7XHJcbmV4cG9ydCBjb25zdCBhZGRDYXJkTW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubW9kYWxfdHlwZV9hZGQtY2FyZCcpO1xyXG5leHBvcnQgY29uc3QgY2FyZElucHV0VGl0bGUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubW9kYWxfX2lucHV0X3R5cGVfbmFtZScpO1xyXG5leHBvcnQgY29uc3QgY2FyZElucHV0TGluayA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbF9faW5wdXRfdHlwZV9saW5rJyk7XHJcbmV4cG9ydCBjb25zdCBhZGRDYXJkQ2xvc2VCdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubW9kYWxfX2Nsb3NlLWJ1dHRvbl90eXBlX2FkZC1jYXJkJyk7XHJcbi8vIC0tLSAnQWRkLUNhcmQnIGZvcm0gY29uc3RzIC0tLSAvL1xyXG5leHBvcnQgY29uc3QgYWRkQ2FyZEZvcm0gPSBkb2N1bWVudC5mb3Jtcy5hZGQ7XHJcbmV4cG9ydCBjb25zdCBhZGRDYXJkRm9ybVRpdGVsID0gYWRkQ2FyZEZvcm0uZWxlbWVudHMudGl0bGU7XHJcbmV4cG9ydCBjb25zdCBhZGRDYXJkRm9ybUxpbmsgPSBhZGRDYXJkRm9ybS5lbGVtZW50cy5saW5rO1xyXG4vLyAtLS0gR2VuZXJhbCBjb25zdCAtLS0gLy9cclxuZXhwb3J0IGNvbnN0IHN1Ym1pdEJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbF9fc3VibWl0LWJ1dHRvbicpO1xyXG5leHBvcnQgY29uc3QgY2FyZExpc3QgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuY2FyZHNfX2dyaWQnKTtcclxuLy8gLS0tIEJpZyBpbWFnZSBtb2RhbCBjb25zdHMgLS0tIC8vXHJcbmV4cG9ydCBjb25zdCBjYXJkQmlnTW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubW9kYWxfdHlwZV9iaWctaW1hZ2UnKTtcclxuZXhwb3J0IGNvbnN0IGNhcmRCaWdNb2RhbEltYWdlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLm1vZGFsX19iaWctaW1hZ2UnKTtcclxuZXhwb3J0IGNvbnN0IGNhcmRCaWdNb2RhbFRleHQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubW9kYWxfX2ltYWdlLWNhcHRpb24nKTtcclxuZXhwb3J0IGNvbnN0IGNhcmRCaWdNb2RhbENsb3NlSWNvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbF9fY2xvc2UtYnV0dG9uX3R5cGVfYmlnLWltYWdlJyk7XHJcbi8vIC0tLSAnRGVsZXRlIGNhcmQnIG1vZGFsIGNvbnN0cyAtLS0gLy9cclxuZXhwb3J0IGNvbnN0IGRlbGV0ZUNhcmRNb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfdHlwZV9kZWxldGUtY2FyZFwiKTtcclxuLy8gLS0tIEZvcm0gY29uZmlnIGNvbnN0cyAtLS0gLy9cclxuZXhwb3J0IGNvbnN0IGZvcm1Db25maWcgPSB7XHJcbiAgZm9ybVNlbGVjdG9yOiBcIi5tb2RhbF9fY29udGFpbmVyXCIsXHJcbiAgaW5wdXRTZWxlY3RvcjogXCIubW9kYWxfX2lucHV0XCIsXHJcbiAgc3VibWl0QnV0dG9uU2VsZWN0b3I6IFwiLm1vZGFsX19zdWJtaXQtYnV0dG9uXCIsXHJcbiAgaW5hY3RpdmVCdXR0b25DbGFzczogXCJtb2RhbF9fc3VibWl0LWJ1dHRvbl9kaXNhYmxlZFwiLFxyXG4gIGlucHV0RXJyb3JDbGFzczogXCJtb2RhbF9faW5wdXRfZXJyb3JcIixcclxuICBlcnJvck1lc3NhZ2VDbGFzczogXCJtb2RhbF9fZXJyb3JfdmlzaWJsZVwiXHJcbn07XHJcbiIsImV4cG9ydCBkZWZhdWx0IGNsYXNzIE1vZGFsIHtcclxuICBjb25zdHJ1Y3Rvcihtb2RhbFNlbGVjdG9yKSB7XHJcbiAgICB0aGlzLl9tb2RhbFNlbGVjdG9yID0gbW9kYWxTZWxlY3RvcjtcclxuICAgIHRoaXMuX2NoZWNrRm9yRXNjQ2xvc2UgPSB0aGlzLl9jaGVja0ZvckVzY0Nsb3NlLmJpbmQodGhpcyk7XHJcbiAgfVxyXG4gIC8vIC0tLSBDbG9zZSBtb2RhbCBvbiBFU0MgbWV0aG9kIC0tLSAvL1xyXG4gIF9jaGVja0ZvckVzY0Nsb3NlID0gKGV2ZW50KSA9PiB7XHJcbiAgICBpZiAoZXZlbnQua2V5ID09PSBcIkVzY2FwZVwiKSB7XHJcbiAgICAgIHRoaXMuY2xvc2UoKTtcclxuICAgIH1cclxuICB9XHJcbiAgLy8gLS0tIE9wZW4gbW9kYWwgbWV0aG9kIC0tLSAvLyBcclxuICBvcGVuID0gKCkgPT4ge1xyXG4gICAgdGhpcy5fbW9kYWxTZWxlY3Rvci5jbGFzc0xpc3QuYWRkKFwibW9kYWxfdmlzaWJsZVwiKTtcclxuICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJrZXl1cFwiLCB0aGlzLl9jaGVja0ZvckVzY0Nsb3NlKTtcclxuICB9XHJcbiAgLy8gLS0tIENsb3NlIG1vZGFsIG1ldGhvZCAtLS0gLy9cclxuICBjbG9zZSA9ICgpID0+IHtcclxuICAgIHRoaXMuX21vZGFsU2VsZWN0b3IuY2xhc3NMaXN0LnJlbW92ZShcIm1vZGFsX3Zpc2libGVcIik7XHJcbiAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKFwia2V5dXBcIiwgdGhpcy5fY2hlY2tGb3JFc2NDbG9zZSk7XHJcbiAgfVxyXG5cclxuICBzZXRFdmVudExpc3RlbmVycygpIHtcclxuICAgIC8vIC0tLSBDbG9zZSBtb2RhbCBvbiBjbG9zZSgnWCcpIGJ1dHRvbiAtLS0gLy9cclxuICAgIHRoaXMuX21vZGFsU2VsZWN0b3JcclxuICAgIC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19jbG9zZS1idXR0b25cIilcclxuICAgIC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKGV2ZW50KSA9PiB7XHJcbiAgICAgIHRoaXMuY2xvc2UoZXZlbnQpO1xyXG4gICAgfSk7XHJcbiAgICAvLyBDbG9zZSBtb2RhbCBvbiBvdmVybGF5KG91dCBvZiB0aGUgbW9kYWwpIGNsaWNrIC0tLSAvLy9cclxuICAgIHRoaXMuX21vZGFsU2VsZWN0b3IuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIChldmVudCkgPT4ge1xyXG4gICAgICBpZiAoZXZlbnQudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucyhcIm1vZGFsX3Zpc2libGVcIikpIHtcclxuICAgICAgICB0aGlzLmNsb3NlKGV2ZW50KTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG59IiwiaW1wb3J0IE1vZGFsIGZyb20gXCIuL01vZGFsLmpzXCI7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBNb2RhbFdpdGhGb3JtIGV4dGVuZHMgTW9kYWwge1xyXG4gIGNvbnN0cnVjdG9yKG1vZGFsU2VsZWN0b3IsIGhhbmRsZVN1Ym1pdCkge1xyXG4gICAgc3VwZXIobW9kYWxTZWxlY3Rvcik7XHJcbiAgICB0aGlzLl9oYW5kbGVTdWJtaXRCdG4gPSBoYW5kbGVTdWJtaXQ7XHJcbiAgICB0aGlzLl9mb3JtRWxlbWVudCA9IG1vZGFsU2VsZWN0b3IucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fY29udGFpbmVyXCIpO1xyXG4gIH1cclxuXHJcbiAgZ2V0SW5wdXRWYWx1ZXMoKSB7XHJcbiAgICBjb25zdCBpbnB1dExpc3QgPSBBcnJheS5mcm9tKFxyXG4gICAgICB0aGlzLl9mb3JtRWxlbWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLm1vZGFsX19pbnB1dFwiKVxyXG4gICAgKTtcclxuICAgIGNvbnN0IGlucHV0VmFsdWVzID0ge307XHJcbiAgICBpbnB1dExpc3QuZm9yRWFjaCgoaW5wdXQpID0+IHtpbnB1dFZhbHVlc1tpbnB1dC5uYW1lXSA9IGlucHV0LnZhbHVlO30pO1xyXG4gICAgcmV0dXJuIGlucHV0VmFsdWVzO1xyXG4gIH1cclxuXHJcbiAgc2V0SW5wdXRWYWx1ZXModmFsdWVzKSB7XHJcbiAgICBjb25zdCBpbnB1dExpc3QgPSBBcnJheS5mcm9tKFxyXG4gICAgICB0aGlzLl9mb3JtRWxlbWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLm1vZGFsX19pbnB1dFwiKVxyXG4gICAgKTtcclxuICAgIGlucHV0TGlzdC5mb3JFYWNoKChpbnB1dCkgPT4ge2lucHV0LnZhbHVlID0gdmFsdWVzW2lucHV0Lm5hbWVdO30pXHJcbiAgfVxyXG5cclxuICBzYXZpbmcoaXNTYXZpbmcpIHtcclxuICAgIGlmIChpc1NhdmluZykge1xyXG4gICAgICB0aGlzLl9mb3JtRWxlbWVudC5xdWVyeVNlbGVjdG9yKFxyXG4gICAgICAgIFwiLm1vZGFsX19zdWJtaXQtYnV0dG9uXCJcclxuICAgICAgKS50ZXh0Q29udGVudCA9IFwiU2F2aW5nLi4uXCI7XHJcbiAgICB9IFxyXG4gICAgZWxzZSB7XHJcbiAgICAgIHRoaXMuX2Zvcm1FbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXHJcbiAgICAgICAgXCIubW9kYWxfX3N1Ym1pdC1idXR0b25cIlxyXG4gICAgICApLnRleHRDb250ZW50ID0gXCJTYXZlXCI7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBzZXRFdmVudExpc3RlbmVycygpIHtcclxuICAgIHN1cGVyLnNldEV2ZW50TGlzdGVuZXJzKCk7XHJcbiAgICB0aGlzLl9mb3JtRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsICgpID0+IHtcclxuICAgICAgdGhpcy5faGFuZGxlU3VibWl0QnRuKHRoaXMuZ2V0SW5wdXRWYWx1ZXMoKSk7XHJcbiAgICAgIHRoaXMuY2xvc2UoKTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgY2xvc2UoKSB7XHJcbiAgICBzdXBlci5jbG9zZSgpO1xyXG4gICAgdGhpcy5fZm9ybUVsZW1lbnQucmVzZXQoKTtcclxuICB9XHJcbn0iLCJleHBvcnQgZGVmYXVsdCBjbGFzcyBVc2VySW5mbyB7XHJcbiAgY29uc3RydWN0b3IoIG5hbWUsIGpvYiwgYXZhdGFyICkge1xyXG4gICAgdGhpcy5fbmFtZSA9IG5hbWU7XHJcbiAgICB0aGlzLl9qb2IgPSBqb2I7XHJcbiAgICB0aGlzLl9hdmF0YXIgPSBhdmF0YXI7XHJcbiAgfVxyXG5cclxuICBnZXRVc2VySW5mbygpe1xyXG4gICAgcmV0dXJuIHRoaXMuX3VzZXJJbmZvID0ge3RpdGxlOiB0aGlzLl90aXRsZS50ZXh0Q29udGVudCwgam9iOnRoaXMuX2pvYi50ZXh0Q29udGVudH07XHJcbiAgfVxyXG5cclxuICBzZXRVc2VySW5mbyh0aXRsZSwgam9iLCB1c2VyQXZhdGFyKXtcclxuICAgIHRoaXMuX3VzZXJJbmZvID0geyB0aXRsZSwgam9iLCB1c2VyQXZhdGFyIH07XHJcbiAgICBpZih1c2VyQXZhdGFyKXtcclxuICAgICAgICBhdmF0YXJJbWFnZS5zcmMgPSB0aGlzLl91c2VySW5mby51c2VyQXZhdGFyO1xyXG4gICAgICAgIHByb2ZpbGVOYW1lLnRleHRDb250ZW50ID0gdGhpcy5fdXNlckluZm8udGl0bGU7XHJcbiAgICAgICAgcHJvZmlsZUpvYi50ZXh0Q29udGVudCA9IHRoaXMuX3VzZXJJbmZvLmpvYjtcclxuICAgIH1cclxuICAgIGVsc2V7XHJcbiAgICAgICAgcHJvZmlsZU5hbWUudGV4dENvbnRlbnQgPSB0aGlzLl91c2VySW5mby50aXRsZTtcclxuICAgICAgICBwcm9maWxlSm9iLnRleHRDb250ZW50ID0gdGhpcy5fdXNlckluZm8uam9iO1xyXG4gICAgfVxyXG59XHJcbn1cclxuIiwiaW1wb3J0IEFwaSBmcm9tIFwiLi4vY29tcG9uZW50cy9zY3JpcHRzL0FwaS5qc1wiXHJcbmltcG9ydCB7IENhcmQgfSBmcm9tIFwiLi4vY29tcG9uZW50cy9zY3JpcHRzL0NhcmQuanNcIjtcclxuaW1wb3J0IEZvcm1WYWxpZGF0b3IgZnJvbSBcIi4uL2NvbXBvbmVudHMvc2NyaXB0cy9Gb3JtVmFsaWRhdG9yLmpzXCI7XHJcbmltcG9ydCBTZWN0aW9uIGZyb20gXCIuLi9jb21wb25lbnRzL3NjcmlwdHMvU2VjdGlvbi5qc1wiO1xyXG5pbXBvcnQge1xyXG4gIHByb2ZpbGVOYW1lLFxyXG4gIHByb2ZpbGVKb2IsXHJcbiAgZWRpdEJ1dHRvbixcclxuICBwcm9maWxlTW9kYWwsXHJcbiAgYWRkQ2FyZEJ1dHRvbixcclxuICBhZGRDYXJkTW9kYWwsXHJcbiAgYXZhdGFyTW9kYWwsXHJcbiAgYXZhdGFySW1hZ2UsXHJcbiAgYXZhdGFyRWRpdEJ1dHRvbixcclxuICBjYXJkQmlnTW9kYWwsXHJcbiAgZGVsZXRlQ2FyZE1vZGFsLFxyXG4gIGZvcm1Db25maWdcclxufSBmcm9tIFwiLi4vY29tcG9uZW50cy91dGlscy9jb25zdGFudHMuanNcIjtcclxuaW1wb3J0IE1vZGFsV2l0aEltYWdlIGZyb20gXCIuLi9jb21wb25lbnRzL3NjcmlwdHMvTW9kYWxXaXRoSW1hZ2UuanNcIjtcclxuaW1wb3J0IE1vZGFsV2l0aEZvcm0gZnJvbSBcIi4uL2NvbXBvbmVudHMvc2NyaXB0cy9Nb2RhbFdpdGhGb3JtLmpzXCI7XHJcbmltcG9ydCBVc2VySW5mbyBmcm9tIFwiLi4vY29tcG9uZW50cy9zY3JpcHRzL1VzZXJJbmZvLmpzXCI7XHJcbmltcG9ydCBcIi4vaW5kZXguY3NzXCI7XHJcblxyXG4vLyA9PT09PSBNb2RhbHMgPT09PT0gLy9cclxuLy8gLS0tIEJpZyBpbWFnZSBtb2RhbCBpbnN0YW5jZSAtLS0gLy9cclxuY29uc3QgYmlnSW1hZ2UgPSBuZXcgTW9kYWxXaXRoSW1hZ2UoY2FyZEJpZ01vZGFsKTtcclxuYmlnSW1hZ2Uuc2V0RXZlbnRMaXN0ZW5lcnMoKTtcclxuLy8gLS0tIERlbGV0ZSBjYXJkIG1vZGFsIGluc3RhbmNlIGFuZCBldmVudHMgLS0tIC8vXHJcbmNvbnN0IGRlbGV0ZUNhcmQgPSBuZXcgTW9kYWxXaXRoRm9ybShkZWxldGVDYXJkTW9kYWwpO1xyXG5kZWxldGVDYXJkLnNldEV2ZW50TGlzdGVuZXJzKCk7XHJcbi8vIC0tLSBVWCBmb3IgbW9kYWxzIC0tLSAvL1xyXG5mdW5jdGlvbiBsb2FkaW5nTW9kYWwoaXNMb2FkaW5nLCBtb2RhbCkge1xyXG4gIGlmIChpc0xvYWRpbmcpIHsgbW9kYWwucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fc3VibWl0LWJ1dHRvblwiKS50ZXh0Q29udGVudCA9IFwiU2F2aW5nLi4uXCI7IH0gXHJcbiAgZWxzZSB7IG1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX3N1Ym1pdC1idXR0b25cIikudGV4dENvbnRlbnQgPSBcIlNhdmVcIjsgfVxyXG59XHJcblxyXG4vLyA9PT09PSBBUEkgPT09PT0gLy9cclxuLy8gLS0tIFNldHRpbmcgdGhlIGRlZmF1bHQgZmV0Y2hpbmcgdXJsIGFuZCB0b2tlbiAtLS0gLy9cclxuY29uc3QgYXBpID0gbmV3IEFwaSh7XHJcbiAgYmFzZVVybDogXCJodHRwczovL2Fyb3VuZC5ub21vcmVwYXJ0aWVzLmNvL3YxL2dyb3VwLTZcIixcclxuICBoZWFkZXJzOiBcclxuICB7XHJcbiAgICBhdXRob3JpemF0aW9uOiBcIjcwOWEwZDlkLWRiMDYtNDg5MC1hNTk0LWIwN2U3MzA5YTM1M1wiLFxyXG4gICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJyBcclxuICB9XHJcbn0pO1xyXG4vLyAtLS0gR2V0QXBwSW5mbyBtZXRob2QgLS0tIC8vXHJcbmFwaS5nZXRBcHBJbmZvKCkudGhlbigoW3VzZXJEYXRhLCBjYXJkTGlzdERhdGFdKSA9PiB7XHJcbiAgLy8gLS0tIENhcmRzIHNlY3Rpb24gY3JlYXRpb24gLS0tIC8vXHJcbiAgY29uc3QgY2FyZHNMaXN0ID0gbmV3IFNlY3Rpb24oe1xyXG4gICAgaXRlbXM6IGNhcmRMaXN0RGF0YSxcclxuICAgIHJlbmRlcmVyOiBhZGRpbmdOZXdDYXJkXHJcbiAgfSwgJy5jYXJkc19fZ3JpZCcpXHJcbiAgLy8gLS0tIEZldGNoaW5nIGFuZCBzZXR0aW5nIHVzZXIgcHJvZmlsZSBpbmZvIC0tLSAvL1xyXG4gIGFwaS5nZXRVc2VySW5mbygpLnRoZW4ocmVzID0+IHtcclxuICAgIHByb2ZpbGVJbmZvLnNldFVzZXJJbmZvKCByZXMubmFtZSwgcmVzLmpvYiwgcmVzLmF2YXRhcilcclxuICB9KVxyXG4gIC8vIC0tLSBSZW5kZXIgY2FyZHMgLS0tIC8vXHJcbiAgY2FyZHNMaXN0LnJlbmRlckl0ZW1zKCk7XHJcbiAgLy8gLS0tICdBZGQgbmV3IGNhcmQnIG1vZGFsIGluc3RhbmNlIC0tLSAvL1xyXG4gIGNvbnN0IGFkZE5ld0NhcmRNb2RhbCA9IG5ldyBNb2RhbFdpdGhGb3JtKHtcclxuICAgIG1vZGFsU2VsZWN0b3I6IGFkZENhcmRNb2RhbCxcclxuICAgIG1vZGFsU3VibWl0aW9uOiAoZGF0YSkgPT4ge1xyXG4gICAgICBsb2FkaW5nTW9kYWwodHJ1ZSwgYWRkSW1hZ2VNb2RhbCk7XHJcbiAgICAgIGFwaVxyXG4gICAgICAgIC5hZGRDYXJkKGRhdGEpXHJcbiAgICAgICAgLnRoZW4oKHJlcykgPT4ge1xyXG4gICAgICAgICAgY29uc29sZS5sb2cocmVzKTtcclxuICAgICAgICAgIGFkZGluZ05ld0NhcmQocmVzKTtcclxuICAgICAgICAgIGFkZE5ld0NhcmRNb2RhbC5jbG9zZSgpO1xyXG4gICAgICAgICAgbG9hZGluZ01vZGFsKGZhbHNlLCBhZGRJbWFnZU1vZGFsKTtcclxuICAgICAgICB9KVxyXG4gICAgICAgIC5jYXRjaCgoZXJyKSA9PiBjb25zb2xlLmxvZyhlcnIpKTtcclxuICAgIH0sXHJcbiAgfSk7XHJcbiAgLy8gLS0tIEFkZCBjYXJkIGJ1dHRvbiBmdW5jdGlvbmFsIGFkZGluZyAtLS0gLy9cclxuICBhZGRDYXJkQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XHJcbiAgICBhZGROZXdDYXJkTW9kYWwub3BlbigpO1xyXG4gICAgbG9hZGluZ01vZGFsKGZhbHNlLCBhZGRJbWFnZU1vZGFsKTtcclxuICB9KTtcclxuICBhZGROZXdDYXJkTW9kYWwuc2V0RXZlbnRMaXN0ZW5lcnMoKTtcclxuICAvLyAtLS0gTmV3IGNhcmQgYWRkaW5nIC0tLSAvL1xyXG4gIGZ1bmN0aW9uIGFkZGluZ05ld0NhcmQoZGF0YSl7XHJcbiAgICBjb25zdCBjYXJkSW5zdGFuY2UgPSBuZXcgQ2FyZCh7ZGF0YSwgXHJcbiAgICAgIGhhbmRsZUNhcmRDbGljazogKHtuYW1lLCBsaW5rfSkgPT4ge1xyXG4gICAgICAgIGJpZ0ltYWdlLm9wZW4obGluaywgbmFtZSl9LCBcclxuICAgICAgaGFuZGxlRGVsZXRlQ2xpY2s6IChjYXJkSWQpID0+IHtcclxuICAgICAgICBkZWxldGVDYXJkLm9wZW4oY2FyZElkKTtcclxuICAgICAgICBkZWxldGVDYXJkLnNldFN1Ym1pdEhhbmRsZXIoKCkgPT4ge1xyXG4gICAgICAgICAgYXBpLnJlbW92ZUNhcmQoY2FyZElkKVxyXG4gICAgICAgICAgICAudGhlbigoKSA9PiB7XHJcbiAgICAgICAgICAgICAgY2FyZEluc3RhbmNlLmRlbGV0ZUNhcmQoKTtcclxuICAgICAgICAgICAgICBkZWxldGVDYXJkLmNsb3NlKCk7XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIC5jYXRjaChlcnIgPT4gY29uc29sZS5sb2coZXJyKSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH0sXHJcbiAgICAgIGxpa2VIYW5kbGVyOiAoY2FyZElkKSA9PnsgXHJcbiAgICAgICAgaWYoY2FyZEVsZW1lbnQucXVlcnlTZWxlY3RvcignLmNhcmRfX2xpa2UtYnV0dG9uJykuY2xhc3NMaXN0LmNvbnRhaW5zKCdjYXJkX19saWtlLWJ1dHRvbl9hY3RpdmUnKSkgeyBcclxuICAgICAgICAgIGFwaS5kZWxldGVMaWtlKGNhcmRJZCkudGhlbihyZXMgPT4geyBcclxuICAgICAgICAgICAgY2FyZEVsZW1lbnQucXVlcnlTZWxlY3RvcignLmNhcmRfX2xpa2UtYnV0dG9uJykuY2xhc3NMaXN0LnJlbW92ZSgnY2FyZF9fbGlrZS1idXR0b25fYWN0aXZlJyk7XHJcbiAgICAgICAgICAgIGNhcmRJbnN0YW5jZS5zaG93TGlrZXMocmVzLmxpa2VzLmxlbmd0aCkgXHJcbiAgICAgICAgICAgIGNhcmRJbnN0YW5jZS5fbGlrZXMgPSByZXMubGlrZXM7IH0pXHJcbiAgICAgICAgICAuY2F0Y2goZXJyID0+IGNvbnNvbGUubG9nKGVycikpIFxyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHsgXHJcbiAgICAgICAgICBjYXJkSW5zdGFuY2UuX2NhcmRFbGVtZW50LmNsYXNzTGlzdC50b2dnbGUoXCJjYXJkX19saWtlLWJ1dHRvbl9hY3RpdmVcIik7IFxyXG4gICAgICAgICAgYXBpLmFkZExpa2UoY2FyZElkKS50aGVuKHJlcyA9PiB7IFxyXG4gICAgICAgICAgICBjYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKCcuY2FyZF9fbGlrZS1idXR0b24nKS5jbGFzc0xpc3QuYWRkKCdjYXJkX19saWtlLWJ1dHRvbl9hY3RpdmUnKTsgXHJcbiAgICAgICAgICAgIGNhcmRJbnN0YW5jZS5zaG93TGlrZXMocmVzLmxpa2VzLmxlbmd0aCkgXHJcbiAgICAgICAgICAgIGNhcmRJbnN0YW5jZS5fbGlrZXMgPSByZXMubGlrZXM7fSlcclxuICAgICAgICAgIC5jYXRjaChlcnIgPT4gY29uc29sZS5sb2coZXJyKSkgXHJcbiAgICAgICAgfSBcclxuICAgICAgfVxyXG4gICAgfSxcclxuICAgIHVzZXJEYXRhLl9pZCwnLmNhcmRfX3RlbXBsYXRlJykgXHJcbiAgICBjb25zdCBjYXJkRWxlbWVudCA9IGNhcmRJbnN0YW5jZS5nZW5lcmF0ZUNhcmQoKTsgXHJcbiAgICBjYXJkc0xpc3QuYWRkSXRlbShjYXJkRWxlbWVudCkgXHJcbiAgICBsb2FkaW5nTW9kYWwodHJ1ZSwgYWRkSW1hZ2VNb2RhbCk7XHJcbiAgfVxyXG4gIC8vIC0tLSAnUHJvZmlsZScgaW5mbyBlZGl0aW5nIC0tLSAvL1xyXG4gIGNvbnN0IHByb2ZpbGVJbmZvID0gbmV3IFVzZXJJbmZvKCBwcm9maWxlTmFtZSwgcHJvZmlsZUpvYiwgYXZhdGFySW1hZ2UpO1xyXG4gIGNvbnN0IHByb2ZpbGVGb3JtID0gbmV3IE1vZGFsV2l0aEZvcm0oe1xyXG4gICAgbW9kYWxTZWxlY3RvcjogZWRpdFByb2ZpbGVNb2RhbCwgXHJcbiAgICBtb2RhbFN1Ym1pdGlvbjogKGRhdGEpID0+IHtcclxuICAgICAgbG9hZGluZ01vZGFsKHRydWUsIGVkaXRQcm9maWxlTW9kYWwpO1xyXG4gICAgICBhcGkuc2V0VXNlckluZm9zKHtuYW1lOiBkYXRhLnRpdGxlLCBhYm91dDpkYXRhLmRlc2N9KVxyXG4gICAgICAudGhlbihyZXMgPT4ge1xyXG4gICAgICAgIGxvYWRpbmdNb2RhbChmYWxzZSwgZWRpdFByb2ZpbGVNb2RhbClcclxuICAgICAgICBwcm9maWxlSW5mby5zZXRVc2VySW5mbyhyZXMubmFtZSwgcmVzLmFib3V0KVxyXG4gICAgICAgIHByb2ZpbGVGb3JtLmNsb3NlKCk7XHJcbiAgICAgICAgY29uc29sZS5sb2cocmVzKVxyXG4gICAgICB9KVxyXG4gICAgICAuY2F0Y2goZXJyID0+IGNvbnNvbGUubG9nKGVycikpXHJcbiAgICB9XHJcbiAgfSlcclxuICAvLyAtLS0gJ1Byb2ZpbGUnIGZvcm0gaGFuZGxlciAtLS0gLy9cclxuICBwcm9maWxlRm9ybS5zZXRFdmVudExpc3RlbmVycygpO1xyXG4gIC8vIC0tLSBPcGVuICdQcm9maWxlJyBmb3JtIHdpdGggY3VycmVudCB2YWx1ZXMgYXMgaW5wdXRzIC0tLSAvL1xyXG4gIGVkaXRCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7XHJcbiAgICBwcm9maWxlRm9ybS5vcGVuKCk7XHJcbiAgICBjb25zdCB1c2VyID0gcHJvZmlsZUluZm8uZ2V0VXNlckluZm8oKTtcclxuICAgIGlucHV0TmFtZS52YWx1ZSA9IHVzZXIudGl0bGU7XHJcbiAgICBpbnB1dEpvYi52YWx1ZSA9IHVzZXIuam9iO1xyXG4gIH0pXHJcbn0pXHJcbi5jYXRjaChlcnIgPT4gY29uc29sZS5sb2coZXJyKSk7XHJcblxyXG4vLyA9PT09PSBBdmF0YXIgPT09PT0gLy9cclxuLy8gLS0tICdBdmF0YXInIGZvcm0gZnVuY3Rpb25hbCAtLS0gLy9cclxuZnVuY3Rpb24gaGFuZGxlQXZhdGFyRWRpdChkYXRhKSB7XHJcbiAgbG9hZGluZ01vZGFsKHRydWUsIGF2YXRhck1vZGFsKTtcclxuICBhcGkuc2V0VXNlckF2YXRhcih7XHJcbiAgICBhdmF0YXI6IGRhdGEuYXZhdGFyVVJMXHJcbiAgfSlcclxuICAudGhlbihyZXMgPT4ge1xyXG4gICAgYXZhdGFySW1hZ2Uuc3JjID0gcmVzLmF2YXRhcjtcclxuICAgIGxvYWRpbmdNb2RhbChmYWxzZSwgYXZhdGFyTW9kYWwpO1xyXG4gICAgZWRpdEF2YXRhci5jbG9zZSgpO1xyXG4gIH0pXHJcbiAgLmNhdGNoKGVyciA9PiBjb25zb2xlLmxvZyhlcnIpKTtcclxufVxyXG4vLyAtLS0gJ0F2YXRhcicgZm9ybSBjcmVhdGlvbiAtLS0gLy9cclxuY29uc3QgZWRpdEF2YXRhciA9IG5ldyBNb2RhbFdpdGhGb3JtKHtcclxuICBtb2RhbFNlbGVjdG9yOiBhdmF0YXJNb2RhbCxcclxuICBtb2RhbFN1Ym1pdGlvbjogKGRhdGEpID0+IHtcclxuICAgIGhhbmRsZUF2YXRhckVkaXQoZGF0YSlcclxuICB9XHJcbn0pO1xyXG4vLyAtLS0gT3BlbiBhdmF0YXIgZWRpdCBtb2RhbCBvbiBjbGljayAtLS0gLy9cclxuYXZhdGFyRWRpdEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xyXG4gIGVkaXRBdmF0YXIub3BlbigpO1xyXG59KTtcclxuLy8gLS0tICdBdmF0YXInIGZvcm0gaGFuZGxlciAtLS0gLy9cclxuZWRpdEF2YXRhci5zZXRFdmVudExpc3RlbmVycygpO1xyXG5cclxuLy8gPT09PT0gVmFsaWRhdGlvbiA9PT09PSAvL1xyXG4vLyAtLS0gJ0VkaXQgcHJvZmlsZScgZm9ybSB2YWxpZGF0aW9uIGFkZGluZyAtLS0gLy9cclxuY29uc3QgcHJvZmlsZUZvcm1WYWxpZGF0aW9uID0gbmV3IEZvcm1WYWxpZGF0b3IoZm9ybUNvbmZpZywgcHJvZmlsZU1vZGFsKTtcclxucHJvZmlsZUZvcm1WYWxpZGF0aW9uLmVuYWJsZVZhbGlkYXRpb24oKTtcclxuLy8gLS0tICdBdmF0YXInIGZvcm0gdmFsaWRhdGlvbiBhZGRpbmcgLS0tIC8vXHJcbmNvbnN0IGF2YXRhckZvcm1WYWxpZGF0aW9uID0gbmV3IEZvcm1WYWxpZGF0b3IoZm9ybUNvbmZpZywgYXZhdGFyTW9kYWwpO1xyXG5hdmF0YXJGb3JtVmFsaWRhdGlvbi5lbmFibGVWYWxpZGF0aW9uKCk7XHJcbi8vIC0tLSAnQWRkIGNhcmQnIGZvcm0gdmFsaWRhdGlvbiBhZGRpbmcgLS0tIC8vXHJcbmNvbnN0IGFkZENhcmRGb3JtVmFsaWRhdGlvbiA9IG5ldyBGb3JtVmFsaWRhdG9yKGZvcm1Db25maWcsIGFkZENhcmRNb2RhbCk7XHJcbmFkZENhcmRGb3JtVmFsaWRhdGlvbi5lbmFibGVWYWxpZGF0aW9uKCk7XHJcblxyXG5leHBvcnQgeyBwcm9maWxlTmFtZSwgcHJvZmlsZUpvYiwgYmlnSW1hZ2UsIGF2YXRhckltYWdlIH0iLCJpbXBvcnQgTW9kYWwgZnJvbSBcIi4vTW9kYWwuanNcIjtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIE1vZGFsV2l0aEltYWdlIGV4dGVuZHMgTW9kYWwge1xyXG4gIC8vIC0tLSBPcGVuIGJpZyBpbWFnZSBtb2RhbCBtZXRob2QgLS0tIC8vXHJcbiAgb3BlbnVwID0gKGV2ZW50KSA9PiB7XHJcbiAgICBjb25zdCBiaWdJbWFnZSA9IGV2ZW50LnRhcmdldDtcclxuICAgIHRoaXMuX21vZGFsRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19iaWctaW1hZ2VcIikuc3JjID0gYmlnSW1hZ2Uuc3JjO1xyXG4gICAgdGhpcy5fbW9kYWxFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2JpZy1pbWFnZVwiKS5hbHQgPSBiaWdJbWFnZS5hbHQ7XHJcbiAgICB0aGlzLl9tb2RhbEVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9faW1hZ2UtY2FwdGlvblwiKS50ZXh0Q29udGVudCA9IGJpZ0ltYWdlLmFsdDtcclxuXHJcbiAgICB0aGlzLm9wZW4oKTtcclxuICB9XHJcbn0iLCJleHBvcnQgZGVmYXVsdCBjbGFzcyBBcGkge1xyXG4gIGNvbnN0cnVjdG9yKHsgYmFzZVVybCwgaGVhZGVycyB9KSB7XHJcbiAgICB0aGlzLl9iYXNlVXJsID0gYmFzZVVybDtcclxuICAgIHRoaXMuX2hlYWRlcnMgPSBoZWFkZXJzO1xyXG4gIH1cclxuXHJcbiAgLy8gPT09IEdldHRpbmcgaW5mbyBmcm9tIHNlcnZlciA9PT0gLy9cclxuICAvLyAtLS0gR2V0IGNhcmQgbGlzdCBmcm9tIHRoZSBzZXJ2ZXIgLS0tIC8vXHJcbiAgZ2V0Q2FyZExpc3QoKSB7XHJcbiAgICByZXR1cm4gKFxyXG4gICAgICBmZXRjaCh0aGlzLl9iYXNlVXJsICsgXCIvY2FyZHNcIiwge1xyXG4gICAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXHJcbiAgICAgIH0pXHJcbiAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlcykge1xyXG4gICAgICAgICAgaWYgKHJlcy5vaykge1xyXG4gICAgICAgICAgICByZXR1cm4gcmVzLmpzb24oKS50aGVuKChkYXRhKSA9PiB7XHJcbiAgICAgICAgICAgICAgcmV0dXJuIGRhdGE7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgUHJvbWlzZS5yZWplY3QoXCJFcnJvciFcIiArIHJlcy5zdGF0dXNUZXh0KTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9KVxyXG4gICAgKTtcclxuICB9XHJcbiAgLy8gLS0tIEdldCB1c2VyIGluZm8gZnJvbSB0aGUgc2VydmVyIC0tLSAvL1xyXG4gIGdldFVzZXJJbmZvKCkge1xyXG4gICAgcmV0dXJuIChcclxuICAgICAgZmV0Y2godGhpcy5fYmFzZVVybCArIFwiL3VzZXJzL21lXCIsIHtcclxuICAgICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxyXG4gICAgICB9KVxyXG4gICAgICAgIC50aGVuKChyZXMpID0+XHJcbiAgICAgICAgICByZXMub2sgPyByZXMuanNvbigpIDogUHJvbWlzZS5yZWplY3QoXCJFcnJvciFcIiArIHJlcy5zdGF0dXNUZXh0KVxyXG4gICAgICAgIClcclxuICAgICk7XHJcbiAgfVxyXG4gIC8vIC0tLSBDaGVjayBpZiBhbGwgaW5mbyBmZXRjaGVkIC0tLSAvL1xyXG4gIGdldEFwcEluZm8oKSB7XHJcbiAgICByZXR1cm4gUHJvbWlzZS5hbGwoW3RoaXMuZ2V0VXNlckluZm8oKSwgdGhpcy5nZXRDYXJkTGlzdCgpXSk7XHJcbiAgfVxyXG5cclxuICAvLyA9PT0gQWRkaW5nL1JlbW92aW5nL0VkaXRpbmcgPT09IC8vXHJcbiAgLy8gLS0tIEFkZGluZyBuZXcgY2FyZCAtLS0gLy9cclxuICBhZGRDYXJkKHsgbmFtZSwgbGluayB9KSB7XHJcbiAgICByZXR1cm4gZmV0Y2godGhpcy5fYmFzZVVybCArIFwiL2NhcmRzXCIsIHtcclxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcclxuICAgICAgbWV0aG9kOiBcIlBPU1RcIixcclxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xyXG4gICAgICAgIG5hbWUsXHJcbiAgICAgICAgbGluayxcclxuICAgICAgfSksXHJcbiAgICB9KS50aGVuKChyZXMpID0+IHtcclxuICAgICAgaWYgKHJlcy5vaykge1xyXG4gICAgICAgIHJldHVybiByZXMuanNvbigpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIFByb21pc2UucmVqZWN0KFwiRXJyb3IhXCIgKyByZXMuc3RhdHVzVGV4dCk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuICAvLyAtLS0gUmVtb3ZpbmcgYSBjYXJkIC0tLSAvL1xyXG4gIHJlbW92ZUNhcmQoY2FyZElkKSB7XHJcbiAgICByZXR1cm4gZmV0Y2godGhpcy5fYmFzZVVybCArIFwiL2NhcmRzL1wiICsgY2FyZElkLCB7XHJcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXHJcbiAgICAgIG1ldGhvZDogXCJERUxFVEVcIixcclxuICAgIH0pLnRoZW4oKHJlcykgPT5cclxuICAgICAgcmVzLm9rID8gcmVzLmpzb24oKSA6IFByb21pc2UucmVqZWN0KFwiRXJyb3IhXCIgKyByZXMuc3RhdHVzVGV4dClcclxuICAgICk7XHJcbiAgfVxyXG4gIC8vIC0tLSBMaWtlIGEgY2FyZCAtLS0gLy9cclxuICBhZGRMaWtlKGNhcmRJZCkge1xyXG4gICAgcmV0dXJuIGZldGNoKHRoaXMuX2Jhc2VVcmwgKyBcIi9jYXJkcy9saWtlcy9cIiArIGNhcmRJZCwge1xyXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxyXG4gICAgICBtZXRob2Q6IFwiUFVUXCIsXHJcbiAgICB9KS50aGVuKChyZXMpID0+IHtcclxuICAgICAgaWYgKHJlcy5vaykge1xyXG4gICAgICAgIHJldHVybiByZXMuanNvbigpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIFByb21pc2UucmVqZWN0KFwiRXJyb3IhXCIgKyByZXMuc3RhdHVzVGV4dCk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuICAvLyAtLS0gVW5saWtlIGEgY2FyZCAtLS0gLy9cclxuICByZW1vdmVMaWtlKGNhcmRJZCkge1xyXG4gICAgcmV0dXJuIGZldGNoKHRoaXMuX2Jhc2VVcmwgKyBcIi9jYXJkcy9saWtlcy9cIiArIGNhcmRJZCwge1xyXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxyXG4gICAgICBtZXRob2Q6IFwiREVMRVRFXCIsXHJcbiAgICB9KS50aGVuKChyZXMpID0+XHJcbiAgICAgIHJlcy5vayA/IHJlcy5qc29uKCkgOiBQcm9taXNlLnJlamVjdChcIkVycm9yIVwiICsgcmVzLnN0YXR1c1RleHQpXHJcbiAgICApO1xyXG4gIH1cclxuICAvLyAtLS0gU2V0dGluZyB1c2VyIHByb2ZpbGUgaW5mbyAtLS0gLy9cclxuICBzZXRVc2VySW5mbyh7IG5hbWUsIGpvYiB9KSB7XHJcbiAgICByZXR1cm4gKFxyXG4gICAgICBmZXRjaCh0aGlzLl9iYXNlVXJsICsgXCIvdXNlcnMvbWVcIiwge1xyXG4gICAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXHJcbiAgICAgICAgbWV0aG9kOiBcIlBBVENIXCIsXHJcbiAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xyXG4gICAgICAgICAgbmFtZSxcclxuICAgICAgICAgIGpvYixcclxuICAgICAgICB9KSxcclxuICAgICAgfSlcclxuICAgICAgICAudGhlbigocmVzKSA9PiB7XHJcbiAgICAgICAgICByZXR1cm4gcmVzLm9rXHJcbiAgICAgICAgICAgID8gcmVzLmpzb24oKVxyXG4gICAgICAgICAgICA6IFByb21pc2UucmVqZWN0KFwiRXJyb3IhXCIgKyByZXMuc3RhdHVzVGV4dCArIHJlcy5zdGF0dXMpO1xyXG4gICAgICAgIH0pXHJcbiAgICApO1xyXG4gIH1cclxuICAvLyAtLS0gU2V0dGluZyB1c2VyIHByb2ZpbGUgYXZhdGFyIC0tLSAvL1xyXG4gIHNldFVzZXJBdmF0YXIoeyBhdmF0YXIgfSkge1xyXG4gICAgcmV0dXJuIGZldGNoKHRoaXMuX2Jhc2VVcmwgKyBcIi91c2Vycy9tZS9hdmF0YXJcIiwge1xyXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxyXG4gICAgICBtZXRob2Q6IFwiUEFUQ0hcIixcclxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xyXG4gICAgICAgIGF2YXRhcixcclxuICAgICAgfSksXHJcbiAgICB9KS50aGVuKChyZXMpID0+XHJcbiAgICAgIHJlcy5vayA/IHJlcy5qc29uKCkgOiBQcm9taXNlLnJlamVjdChcIkVycm9yIVwiICsgcmVzLnN0YXR1c1RleHQpXHJcbiAgICApO1xyXG4gIH1cclxuICAvLyAtLS0gVXBkYXRpbmcvRWRpdGluZyB1c2VyIHByb2ZpbGUgaW5mbyAtLS0gLy9cclxuICB1cGRhdGVVc2VySW5mbyh7IG5hbWUsIGpvYiB9KSB7XHJcbiAgICByZXR1cm4gZmV0Y2godGhpcy5fYmFzZVVybCArIFwiL3VzZXJzL21lXCIsIHtcclxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcclxuICAgICAgbWV0aG9kOiBcIlBBVENIXCIsXHJcbiAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHtcclxuICAgICAgICBuYW1lLFxyXG4gICAgICAgIGpvYixcclxuICAgICAgfSksXHJcbiAgICB9KS50aGVuKChyZXMpID0+IHtcclxuICAgICAgcmV0dXJuIHJlcy5vayA/IHJlcy5qc29uKCkgOiBQcm9taXNlLnJlamVjdChcIkVycm9yIVwiICsgcmVzLnN0YXR1c1RleHQpO1xyXG4gICAgfSk7XHJcbiAgfVxyXG59XHJcbiJdLCJuYW1lcyI6WyJDYXJkIiwiY29uc3RydWN0b3IiLCJjYXJkRGF0YSIsInVzZXIiLCJvbkNhcmRDbGljayIsInJlbW92ZUhhbmRsZXIiLCJsaWtlSGFuZGxlciIsImNhcmRTZWxlY3RvciIsInRoaXMiLCJfbmFtZSIsIm5hbWUiLCJfbGluayIsImxpbmsiLCJfY2FyZElkIiwiX2lkIiwiX293bmVySWQiLCJvd25lciIsIl91c2VySUQiLCJfbGlrZXMiLCJsaWtlcyIsIl9jYXJkU2VsZWN0b3IiLCJfb25DYXJkQ2xpY2siLCJfbGlrZUhhbmRsZXIiLCJfcmVtb3ZlSGFuZGxlciIsIl9nZXRUZW1wbGF0ZSIsImRvY3VtZW50IiwicXVlcnlTZWxlY3RvciIsImNvbnRlbnQiLCJjbG9uZU5vZGUiLCJkZWxldGVDYXJkIiwiX2l0ZW0iLCJyZW1vdmUiLCJfcmVuZGVyTGlrZXMiLCJpc0xpa2VkIiwiY2xhc3NMaXN0IiwiYWRkIiwidGV4dENvbnRlbnQiLCJsZW5ndGgiLCJzb21lIiwiX3VzZXJJZCIsInVwZGF0ZUxpa2VzIiwibmV3TGlrZXMiLCJfc2V0RXZlbnRMaXN0ZW5lcnMiLCJhZGRFdmVudExpc3RlbmVyIiwiZXZlbnQiLCJfbGlrZUNhcmQiLCJfY2FyZEltYWdlIiwiZ2VuZXJhdGVDYXJkIiwiX2VsZW1lbnQiLCJzcmMiLCJhbHQiLCJGb3JtVmFsaWRhdG9yIiwiZm9ybUNvbmZpZyIsImZvcm1FbGVtZW50IiwiX2Zvcm1Db25maWciLCJfZm9ybUVsZW1lbnQiLCJfc2hvd0lucHV0RXJyb3IiLCJpbnB1dEVsZW1lbnQiLCJlcnJvck1lc3NhZ2UiLCJpbnB1dEVycm9yQ2xhc3MiLCJlcnJvck1lc3NhZ2VDbGFzcyIsImVycm9yRWxlbWVudCIsImlkIiwiX2hpZGVJbnB1dEVycm9yIiwicmVzZXRWYWxpZGF0aW9uIiwiaW5wdXRzIiwiZm9yRWFjaCIsImlucHV0IiwiX3RvZ2dsZVN1Ym1pdEJ1dHRvbiIsIl9jaGVja0lucHV0IiwidmFsaWRpdHkiLCJ2YWxpZCIsInZhbGlkYXRpb25NZXNzYWdlIiwiX2NoZWNrSWZGb3JtVmFsaWQiLCJldmVyeSIsImluYWN0aXZlQnV0dG9uQ2xhc3MiLCJzdWJtaXRCdXR0b25TZWxlY3RvciIsImJ1dHRvbkVsZW1lbnQiLCJkaXNhYmxlZCIsImlucHV0U2VsZWN0b3IiLCJBcnJheSIsImZyb20iLCJxdWVyeVNlbGVjdG9yQWxsIiwiZW5hYmxlVmFsaWRhdGlvbiIsInByZXZlbnREZWZhdWx0IiwiU2VjdGlvbiIsIml0ZW1zIiwicmVuZGVyZXIiLCJjb250YWluZXJTZWxlY3RvciIsIl9pdGVtcyIsIl9yZW5kZXJlciIsIl9jb250YWluZXIiLCJhZGRJdGVtIiwiZWxlbWVudCIsInByZXBlbmQiLCJjbGVhciIsImlubmVySFRNTCIsInJlbmRlckl0ZW1zIiwiY2FyZCIsImVkaXRCdXR0b24iLCJwcm9maWxlTW9kYWwiLCJmb3JtcyIsInByb2ZpbGUiLCJwcm9maWxlTmFtZSIsInByb2ZpbGVKb2IiLCJlbGVtZW50cyIsImF2YXRhckltYWdlIiwiam9iIiwiYXZhdGFyRWRpdEJ1dHRvbiIsImF2YXRhck1vZGFsIiwiYXZhdGFyIiwiYWRkQ2FyZEJ1dHRvbiIsImFkZENhcmRNb2RhbCIsImFkZENhcmRGb3JtIiwiY2FyZEJpZ01vZGFsIiwidGl0bGUiLCJkZWxldGVDYXJkTW9kYWwiLCJmb3JtU2VsZWN0b3IiLCJNb2RhbCIsIm1vZGFsU2VsZWN0b3IiLCJfbW9kYWxTZWxlY3RvciIsIl9jaGVja0ZvckVzY0Nsb3NlIiwiYmluZCIsImtleSIsImNsb3NlIiwib3BlbiIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJzZXRFdmVudExpc3RlbmVycyIsInRhcmdldCIsImNvbnRhaW5zIiwiTW9kYWxXaXRoRm9ybSIsImhhbmRsZVN1Ym1pdCIsInN1cGVyIiwiX2hhbmRsZVN1Ym1pdEJ0biIsImdldElucHV0VmFsdWVzIiwiaW5wdXRMaXN0IiwiaW5wdXRWYWx1ZXMiLCJ2YWx1ZSIsInNldElucHV0VmFsdWVzIiwidmFsdWVzIiwic2F2aW5nIiwiaXNTYXZpbmciLCJyZXNldCIsIlVzZXJJbmZvIiwiX2pvYiIsIl9hdmF0YXIiLCJnZXRVc2VySW5mbyIsIl91c2VySW5mbyIsIl90aXRsZSIsInNldFVzZXJJbmZvIiwidXNlckF2YXRhciIsImJpZ0ltYWdlIiwib3BlbnVwIiwiX21vZGFsRWxlbWVudCIsImxvYWRpbmdNb2RhbCIsImlzTG9hZGluZyIsIm1vZGFsIiwiYXBpIiwiYmFzZVVybCIsImhlYWRlcnMiLCJfYmFzZVVybCIsIl9oZWFkZXJzIiwiZ2V0Q2FyZExpc3QiLCJmZXRjaCIsInRoZW4iLCJyZXMiLCJvayIsImpzb24iLCJkYXRhIiwiUHJvbWlzZSIsInJlamVjdCIsInN0YXR1c1RleHQiLCJnZXRBcHBJbmZvIiwiYWxsIiwiYWRkQ2FyZCIsIm1ldGhvZCIsImJvZHkiLCJKU09OIiwic3RyaW5naWZ5IiwicmVtb3ZlQ2FyZCIsImNhcmRJZCIsImFkZExpa2UiLCJyZW1vdmVMaWtlIiwic3RhdHVzIiwic2V0VXNlckF2YXRhciIsInVwZGF0ZVVzZXJJbmZvIiwiYXV0aG9yaXphdGlvbiIsInVzZXJEYXRhIiwiY2FyZExpc3REYXRhIiwiY2FyZHNMaXN0IiwiYWRkaW5nTmV3Q2FyZCIsInByb2ZpbGVJbmZvIiwiYWRkTmV3Q2FyZE1vZGFsIiwibW9kYWxTdWJtaXRpb24iLCJhZGRJbWFnZU1vZGFsIiwiY29uc29sZSIsImxvZyIsImNhdGNoIiwiZXJyIiwiY2FyZEluc3RhbmNlIiwiaGFuZGxlQ2FyZENsaWNrIiwiaGFuZGxlRGVsZXRlQ2xpY2siLCJzZXRTdWJtaXRIYW5kbGVyIiwiY2FyZEVsZW1lbnQiLCJkZWxldGVMaWtlIiwic2hvd0xpa2VzIiwiX2NhcmRFbGVtZW50IiwidG9nZ2xlIiwicHJvZmlsZUZvcm0iLCJlZGl0UHJvZmlsZU1vZGFsIiwic2V0VXNlckluZm9zIiwiYWJvdXQiLCJkZXNjIiwiaW5wdXROYW1lIiwiaW5wdXRKb2IiLCJlZGl0QXZhdGFyIiwiYXZhdGFyVVJMIiwiaGFuZGxlQXZhdGFyRWRpdCJdLCJzb3VyY2VSb290IjoiIn0=